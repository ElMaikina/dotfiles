"use strict";var cz=Object.create;var PS=Object.defineProperty;var PU=Object.getOwnPropertyDescriptor;var uz=Object.getOwnPropertyNames;var dz=Object.getPrototypeOf,pz=Object.prototype.hasOwnProperty;var mz=(n,e)=>()=>(n&&(e=n(n=0)),e);var O=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),kU=(n,e)=>{for(var t in e)PS(n,t,{get:e[t],enumerable:!0})},xU=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of uz(e))!pz.call(n,i)&&i!==t&&PS(n,i,{get:()=>e[i],enumerable:!(r=PU(e,i))||r.enumerable});return n};var k=(n,e,t)=>(t=n!=null?cz(dz(n)):{},xU(e||!n||!n.__esModule?PS(t,"default",{value:n,enumerable:!0}):t,n)),DU=n=>xU(PS({},"__esModule",{value:!0}),n),v=(n,e,t,r)=>{for(var i=r>1?void 0:r?PU(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&PS(e,t,i),i},m=(n,e)=>(t,r)=>e(t,r,n);var TU=O(()=>{var _U;(function(n){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(n);typeof t.Reflect>"u"?t.Reflect=n:r=i(t.Reflect,r),e(r);function i(o,s){return function(a,l){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:l}),s&&s(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=r&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!s&&!a,c={create:s?function(){return en(Object.create(null))}:a?function(){return en({__proto__:null})}:function(){return en({})},has:l?function(B,X){return t.call(B,X)}:function(B,X){return X in B},get:l?function(B,X){return t.call(B,X)?B[X]:void 0}:function(B,X){return B[X]}},u=Object.getPrototypeOf(Function),d=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",f=!d&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Er(),g=!d&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Vr(),b=!d&&typeof WeakMap=="function"?WeakMap:Pr(),I=new b;function w(B,X,de,ye){if(sr(de)){if(!Ic(B))throw new TypeError;if(!W(X))throw new TypeError;return Ie(B,X)}else{if(!Ic(B))throw new TypeError;if(!Wr(X))throw new TypeError;if(!Wr(ye)&&!sr(ye)&&!fi(ye))throw new TypeError;return fi(ye)&&(ye=void 0),de=Yn(de),Oe(B,X,de,ye)}}e("decorate",w);function D(B,X){function de(ye,Be){if(!Wr(ye))throw new TypeError;if(!sr(Be)&&!pe(Be))throw new TypeError;_e(B,X,ye,Be)}return de}e("metadata",D);function A(B,X,de,ye){if(!Wr(de))throw new TypeError;return sr(ye)||(ye=Yn(ye)),_e(B,X,de,ye)}e("defineMetadata",A);function T(B,X,de){if(!Wr(X))throw new TypeError;return sr(de)||(de=Yn(de)),mt(B,X,de)}e("hasMetadata",T);function $(B,X,de){if(!Wr(X))throw new TypeError;return sr(de)||(de=Yn(de)),kt(B,X,de)}e("hasOwnMetadata",$);function ne(B,X,de){if(!Wr(X))throw new TypeError;return sr(de)||(de=Yn(de)),ee(B,X,de)}e("getMetadata",ne);function H(B,X,de){if(!Wr(X))throw new TypeError;return sr(de)||(de=Yn(de)),Pe(B,X,de)}e("getOwnMetadata",H);function oe(B,X){if(!Wr(B))throw new TypeError;return sr(X)||(X=Yn(X)),he(B,X)}e("getMetadataKeys",oe);function ae(B,X){if(!Wr(B))throw new TypeError;return sr(X)||(X=Yn(X)),gt(B,X)}e("getOwnMetadataKeys",ae);function Y(B,X,de){if(!Wr(X))throw new TypeError;sr(de)||(de=Yn(de));var ye=pt(X,de,!1);if(sr(ye)||!ye.delete(B))return!1;if(ye.size>0)return!0;var Be=I.get(X);return Be.delete(de),Be.size>0||I.delete(X),!0}e("deleteMetadata",Y);function Ie(B,X){for(var de=B.length-1;de>=0;--de){var ye=B[de],Be=ye(X);if(!sr(Be)&&!fi(Be)){if(!W(Be))throw new TypeError;X=Be}}return X}function Oe(B,X,de,ye){for(var Be=B.length-1;Be>=0;--Be){var tn=B[Be],yt=tn(X,de,ye);if(!sr(yt)&&!fi(yt)){if(!Wr(yt))throw new TypeError;ye=yt}}return ye}function pt(B,X,de){var ye=I.get(B);if(sr(ye)){if(!de)return;ye=new f,I.set(B,ye)}var Be=ye.get(X);if(sr(Be)){if(!de)return;Be=new f,ye.set(X,Be)}return Be}function mt(B,X,de){var ye=kt(B,X,de);if(ye)return!0;var Be=Dt(X);return fi(Be)?!1:mt(B,Be,de)}function kt(B,X,de){var ye=pt(X,de,!1);return sr(ye)?!1:Rt(ye.has(B))}function ee(B,X,de){var ye=kt(B,X,de);if(ye)return Pe(B,X,de);var Be=Dt(X);if(!fi(Be))return ee(B,Be,de)}function Pe(B,X,de){var ye=pt(X,de,!1);if(!sr(ye))return ye.get(B)}function _e(B,X,de,ye){var Be=pt(de,ye,!0);Be.set(B,X)}function he(B,X){var de=gt(B,X),ye=Dt(B);if(ye===null)return de;var Be=he(ye,X);if(Be.length<=0)return de;if(de.length<=0)return Be;for(var tn=new g,yt=[],wt=0,Qe=de;wt<Qe.length;wt++){var Tt=Qe[wt],Z=tn.has(Tt);Z||(tn.add(Tt),yt.push(Tt))}for(var ce=0,V=Be;ce<V.length;ce++){var Tt=V[ce],Z=tn.has(Tt);Z||(tn.add(Tt),yt.push(Tt))}return yt}function gt(B,X){var de=[],ye=pt(B,X,!1);if(sr(ye))return de;for(var Be=ye.keys(),tn=ze(Be),yt=0;;){var wt=Ut(tn);if(!wt)return de.length=yt,de;var Qe=Zr(wt);try{de[yt]=Qe}catch(Tt){try{At(tn)}finally{throw Tt}}yt++}}function Oi(B){if(B===null)return 1;switch(typeof B){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return B===null?1:6;default:return 6}}function sr(B){return B===void 0}function fi(B){return B===null}function Lu(B){return typeof B=="symbol"}function Wr(B){return typeof B=="object"?B!==null:typeof B=="function"}function zs(B,X){switch(Oi(B)){case 0:return B;case 1:return B;case 2:return B;case 3:return B;case 4:return B;case 5:return B}var de=X===3?"string":X===5?"number":"default",ye=Te(B,i);if(ye!==void 0){var Be=ye.call(B,de);if(Wr(Be))throw new TypeError;return Be}return Ja(B,de==="default"?"number":de)}function Ja(B,X){if(X==="string"){var de=B.toString;if(F(de)){var ye=de.call(B);if(!Wr(ye))return ye}var Be=B.valueOf;if(F(Be)){var ye=Be.call(B);if(!Wr(ye))return ye}}else{var Be=B.valueOf;if(F(Be)){var ye=Be.call(B);if(!Wr(ye))return ye}var tn=B.toString;if(F(tn)){var ye=tn.call(B);if(!Wr(ye))return ye}}throw new TypeError}function Rt(B){return!!B}function Fi(B){return""+B}function Yn(B){var X=zs(B,3);return Lu(X)?X:Fi(X)}function Ic(B){return Array.isArray?Array.isArray(B):B instanceof Object?B instanceof Array:Object.prototype.toString.call(B)==="[object Array]"}function F(B){return typeof B=="function"}function W(B){return typeof B=="function"}function pe(B){switch(Oi(B)){case 3:return!0;case 4:return!0;default:return!1}}function Te(B,X){var de=B[X];if(de!=null){if(!F(de))throw new TypeError;return de}}function ze(B){var X=Te(B,o);if(!F(X))throw new TypeError;var de=X.call(B);if(!Wr(de))throw new TypeError;return de}function Zr(B){return B.value}function Ut(B){var X=B.next();return X.done?!1:X}function At(B){var X=B.return;X&&X.call(B)}function Dt(B){var X=Object.getPrototypeOf(B);if(typeof B!="function"||B===u||X!==u)return X;var de=B.prototype,ye=de&&Object.getPrototypeOf(de);if(ye==null||ye===Object.prototype)return X;var Be=ye.constructor;return typeof Be!="function"||Be===B?X:Be}function Er(){var B={},X=[],de=function(){function yt(wt,Qe,Tt){this._index=0,this._keys=wt,this._values=Qe,this._selector=Tt}return yt.prototype["@@iterator"]=function(){return this},yt.prototype[o]=function(){return this},yt.prototype.next=function(){var wt=this._index;if(wt>=0&&wt<this._keys.length){var Qe=this._selector(this._keys[wt],this._values[wt]);return wt+1>=this._keys.length?(this._index=-1,this._keys=X,this._values=X):this._index++,{value:Qe,done:!1}}return{value:void 0,done:!0}},yt.prototype.throw=function(wt){throw this._index>=0&&(this._index=-1,this._keys=X,this._values=X),wt},yt.prototype.return=function(wt){return this._index>=0&&(this._index=-1,this._keys=X,this._values=X),{value:wt,done:!0}},yt}();return function(){function yt(){this._keys=[],this._values=[],this._cacheKey=B,this._cacheIndex=-2}return Object.defineProperty(yt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),yt.prototype.has=function(wt){return this._find(wt,!1)>=0},yt.prototype.get=function(wt){var Qe=this._find(wt,!1);return Qe>=0?this._values[Qe]:void 0},yt.prototype.set=function(wt,Qe){var Tt=this._find(wt,!0);return this._values[Tt]=Qe,this},yt.prototype.delete=function(wt){var Qe=this._find(wt,!1);if(Qe>=0){for(var Tt=this._keys.length,Z=Qe+1;Z<Tt;Z++)this._keys[Z-1]=this._keys[Z],this._values[Z-1]=this._values[Z];return this._keys.length--,this._values.length--,wt===this._cacheKey&&(this._cacheKey=B,this._cacheIndex=-2),!0}return!1},yt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=B,this._cacheIndex=-2},yt.prototype.keys=function(){return new de(this._keys,this._values,ye)},yt.prototype.values=function(){return new de(this._keys,this._values,Be)},yt.prototype.entries=function(){return new de(this._keys,this._values,tn)},yt.prototype["@@iterator"]=function(){return this.entries()},yt.prototype[o]=function(){return this.entries()},yt.prototype._find=function(wt,Qe){return this._cacheKey!==wt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=wt)),this._cacheIndex<0&&Qe&&(this._cacheIndex=this._keys.length,this._keys.push(wt),this._values.push(void 0)),this._cacheIndex},yt}();function ye(yt,wt){return yt}function Be(yt,wt){return wt}function tn(yt,wt){return[yt,wt]}}function Vr(){return function(){function B(){this._map=new f}return Object.defineProperty(B.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),B.prototype.has=function(X){return this._map.has(X)},B.prototype.add=function(X){return this._map.set(X,X),this},B.prototype.delete=function(X){return this._map.delete(X)},B.prototype.clear=function(){this._map.clear()},B.prototype.keys=function(){return this._map.keys()},B.prototype.values=function(){return this._map.values()},B.prototype.entries=function(){return this._map.entries()},B.prototype["@@iterator"]=function(){return this.keys()},B.prototype[o]=function(){return this.keys()},B}()}function Pr(){var B=16,X=c.create(),de=ye();return function(){function Qe(){this._key=ye()}return Qe.prototype.has=function(Tt){var Z=Be(Tt,!1);return Z!==void 0?c.has(Z,this._key):!1},Qe.prototype.get=function(Tt){var Z=Be(Tt,!1);return Z!==void 0?c.get(Z,this._key):void 0},Qe.prototype.set=function(Tt,Z){var ce=Be(Tt,!0);return ce[this._key]=Z,this},Qe.prototype.delete=function(Tt){var Z=Be(Tt,!1);return Z!==void 0?delete Z[this._key]:!1},Qe.prototype.clear=function(){this._key=ye()},Qe}();function ye(){var Qe;do Qe="@@WeakMap@@"+wt();while(c.has(X,Qe));return X[Qe]=!0,Qe}function Be(Qe,Tt){if(!t.call(Qe,de)){if(!Tt)return;Object.defineProperty(Qe,de,{value:c.create()})}return Qe[de]}function tn(Qe,Tt){for(var Z=0;Z<Tt;++Z)Qe[Z]=Math.random()*255|0;return Qe}function yt(Qe){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(Qe)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(Qe)):tn(new Uint8Array(Qe),Qe):tn(new Array(Qe),Qe)}function wt(){var Qe=yt(B);Qe[6]=Qe[6]&79|64,Qe[8]=Qe[8]&191|128;for(var Tt="",Z=0;Z<B;++Z){var ce=Qe[Z];(Z===4||Z===6||Z===8)&&(Tt+="-"),ce<16&&(Tt+="0"),Tt+=ce.toString(16).toLowerCase()}return Tt}}function en(B){return B.__=void 0,delete B.__,B}})})(_U||(_U={}))});var RU={};kU(RU,{isPreRelesVersionOfJupyterExtension:()=>fz});var fz,AU=mz(()=>{"use strict";fz=!1});var hW=O(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});Qa.EventEmitter=Qa.once=Qa.toPromise=void 0;function Jz(n,e){return e?e.aborted?Promise.resolve(void 0):new Promise(t=>{let r=(0,Qa.once)(n,o=>{e.removeEventListener("abort",i),t(o)}),i=()=>{r.dispose(),e.removeEventListener("abort",i),t(void 0)};e.addEventListener("abort",i)}):new Promise(t=>(0,Qa.once)(n,t))}Qa.toPromise=Jz;var Bz=(n,e)=>{let t=n(r=>{e(r),t.dispose()});return t};Qa.once=Bz;var tA=class{constructor(){this.event=(e,t,r)=>{let i=this.add(t?e.bind(t):e);return r?.push(i),i}}get size(){return this.listeners?typeof this.listeners=="function"?1:this.listeners.length:0}fire(e){if(this.listeners)if(typeof this.listeners=="function")this.listeners(e);else for(let t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?typeof this.listeners=="function"?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if(typeof this.listeners=="function"){this.listeners===e&&(this.listeners=void 0);return}let t=this.listeners.indexOf(e);t!==-1&&(this.listeners.length===2?this.listeners=t===0?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}};Qa.EventEmitter=tA});var Sn=O(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.NON_CUSTOM_TAG_KEYS=qt.PRE_DESTROY=qt.POST_CONSTRUCT=qt.DESIGN_PARAM_TYPES=qt.PARAM_TYPES=qt.TAGGED_PROP=qt.TAGGED=qt.MULTI_INJECT_TAG=qt.INJECT_TAG=qt.OPTIONAL_TAG=qt.UNMANAGED_TAG=qt.NAME_TAG=qt.NAMED_TAG=void 0;qt.NAMED_TAG="named";qt.NAME_TAG="name";qt.UNMANAGED_TAG="unmanaged";qt.OPTIONAL_TAG="optional";qt.INJECT_TAG="inject";qt.MULTI_INJECT_TAG="multi_inject";qt.TAGGED="inversify:tagged";qt.TAGGED_PROP="inversify:tagged_props";qt.PARAM_TYPES="inversify:paramtypes";qt.DESIGN_PARAM_TYPES="design:paramtypes";qt.POST_CONSTRUCT="post_construct";qt.PRE_DESTROY="pre_destroy";function $z(){return[qt.INJECT_TAG,qt.MULTI_INJECT_TAG,qt.NAME_TAG,qt.UNMANAGED_TAG,qt.NAMED_TAG,qt.OPTIONAL_TAG]}qt.NON_CUSTOM_TAG_KEYS=$z()});var ta=O(Xu=>{"use strict";Object.defineProperty(Xu,"__esModule",{value:!0});Xu.TargetTypeEnum=Xu.BindingTypeEnum=Xu.BindingScopeEnum=void 0;var qz={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Xu.BindingScopeEnum=qz;var Hz={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Xu.BindingTypeEnum=Hz;var Gz={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Xu.TargetTypeEnum=Gz});var Zu=O(Zw=>{"use strict";Object.defineProperty(Zw,"__esModule",{value:!0});Zw.id=void 0;var zz=0;function Qz(){return zz++}Zw.id=Qz});var wW=O(eP=>{"use strict";Object.defineProperty(eP,"__esModule",{value:!0});eP.Binding=void 0;var EW=ta(),Yz=Zu(),Xz=function(){function n(e,t){this.id=(0,Yz.id)(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=EW.BindingTypeEnum.Invalid,this.constraint=function(r){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return n.prototype.clone=function(){var e=new n(this.serviceIdentifier,this.scope);return e.activated=e.scope===EW.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e},n}();eP.Binding=Xz});var Ii=O(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.STACK_OVERFLOW=Me.CIRCULAR_DEPENDENCY_IN_FACTORY=Me.ON_DEACTIVATION_ERROR=Me.PRE_DESTROY_ERROR=Me.POST_CONSTRUCT_ERROR=Me.ASYNC_UNBIND_REQUIRED=Me.MULTIPLE_POST_CONSTRUCT_METHODS=Me.MULTIPLE_PRE_DESTROY_METHODS=Me.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Me.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Me.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Me.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Me.ARGUMENTS_LENGTH_MISMATCH=Me.INVALID_DECORATOR_OPERATION=Me.INVALID_TO_SELF_VALUE=Me.LAZY_IN_SYNC=Me.INVALID_FUNCTION_BINDING=Me.INVALID_MIDDLEWARE_RETURN=Me.NO_MORE_SNAPSHOTS_AVAILABLE=Me.INVALID_BINDING_TYPE=Me.NOT_IMPLEMENTED=Me.CIRCULAR_DEPENDENCY=Me.UNDEFINED_INJECT_ANNOTATION=Me.MISSING_INJECT_ANNOTATION=Me.MISSING_INJECTABLE_ANNOTATION=Me.NOT_REGISTERED=Me.CANNOT_UNBIND=Me.AMBIGUOUS_MATCH=Me.KEY_NOT_FOUND=Me.NULL_ARGUMENT=Me.DUPLICATED_METADATA=Me.DUPLICATED_INJECTABLE_DECORATOR=void 0;Me.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";Me.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";Me.NULL_ARGUMENT="NULL argument";Me.KEY_NOT_FOUND="Key Not Found";Me.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";Me.CANNOT_UNBIND="Could not unbind serviceIdentifier:";Me.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";Me.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";Me.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var Zz=function(n){return"@inject called with undefined this could mean that the class "+n+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Me.UNDEFINED_INJECT_ANNOTATION=Zz;Me.CIRCULAR_DEPENDENCY="Circular dependency found:";Me.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";Me.INVALID_BINDING_TYPE="Invalid binding type:";Me.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";Me.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";Me.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";var eQ=function(n){return"You are attempting to construct '"+n+`' in a synchronous way
 but it has asynchronous dependencies.`};Me.LAZY_IN_SYNC=eQ;Me.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";Me.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var tQ=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return"The number of constructor arguments in the derived class "+(n[0]+" must be >= than the number of constructor arguments of its base class.")};Me.ARGUMENTS_LENGTH_MISMATCH=tQ;Me.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";Me.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";Me.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";Me.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";Me.MULTIPLE_PRE_DESTROY_METHODS="Cannot apply @preDestroy decorator multiple times in the same class";Me.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";Me.ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)";var rQ=function(n,e){return"@postConstruct error in class "+n+": "+e};Me.POST_CONSTRUCT_ERROR=rQ;var nQ=function(n,e){return"@preDestroy error in class "+n+": "+e};Me.PRE_DESTROY_ERROR=nQ;var iQ=function(n,e){return"onDeactivation() error in class "+n+": "+e};Me.ON_DEACTIVATION_ERROR=iQ;var oQ=function(n,e){return"It looks like there is a circular dependency in one of the '"+n+"' bindings. Please investigate bindings with"+("service identifier '"+e+"'.")};Me.CIRCULAR_DEPENDENCY_IN_FACTORY=oQ;Me.STACK_OVERFLOW="Maximum call stack size exceeded"});var sA=O(Ya=>{"use strict";var sQ=Ya&&Ya.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),aQ=Ya&&Ya.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),lQ=Ya&&Ya.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&sQ(e,n,t);return aQ(e,n),e};Object.defineProperty(Ya,"__esModule",{value:!0});Ya.MetadataReader=void 0;var oA=lQ(Sn()),cQ=function(){function n(){}return n.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(oA.PARAM_TYPES,e),r=Reflect.getMetadata(oA.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:r||{}}},n.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(oA.TAGGED_PROP,e)||[];return t},n}();Ya.MetadataReader=cQ});var PW=O(tP=>{"use strict";Object.defineProperty(tP,"__esModule",{value:!0});tP.BindingCount=void 0;var uQ={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};tP.BindingCount=uQ});var aA=O(ms=>{"use strict";var dQ=ms&&ms.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),pQ=ms&&ms.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),mQ=ms&&ms.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&dQ(e,n,t);return pQ(e,n),e};Object.defineProperty(ms,"__esModule",{value:!0});ms.tryAndThrowErrorIfStackOverflow=ms.isStackOverflowExeption=void 0;var fQ=mQ(Ii());function kW(n){return n instanceof RangeError||n.message===fQ.STACK_OVERFLOW}ms.isStackOverflowExeption=kW;var hQ=function(n,e){try{return n()}catch(t){throw kW(t)&&(t=e()),t}};ms.tryAndThrowErrorIfStackOverflow=hQ});var Ch=O(Cn=>{"use strict";var gQ=Cn&&Cn.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),vQ=Cn&&Cn.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),yQ=Cn&&Cn.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&gQ(e,n,t);return vQ(e,n),e};Object.defineProperty(Cn,"__esModule",{value:!0});Cn.getSymbolDescription=Cn.circularDependencyToException=Cn.listMetadataForTarget=Cn.listRegisteredBindingsForServiceIdentifier=Cn.getServiceIdentifierAsString=Cn.getFunctionName=void 0;var bQ=yQ(Ii());function xW(n){if(typeof n=="function"){var e=n;return e.name}else{if(typeof n=="symbol")return n.toString();var e=n;return e}}Cn.getServiceIdentifierAsString=xW;function IQ(n,e,t){var r="",i=t(n,e);return i.length!==0&&(r=`
Registered bindings:`,i.forEach(function(o){var s="Object";o.implementationType!==null&&(s=TW(o.implementationType)),r=r+`
 `+s,o.constraint.metaData&&(r=r+" - "+o.constraint.metaData)})),r}Cn.listRegisteredBindingsForServiceIdentifier=IQ;function DW(n,e){return n.parentRequest===null?!1:n.parentRequest.serviceIdentifier===e?!0:DW(n.parentRequest,e)}function SQ(n){function e(r,i){i===void 0&&(i=[]);var o=xW(r.serviceIdentifier);return i.push(o),r.parentRequest!==null?e(r.parentRequest,i):i}var t=e(n);return t.reverse().join(" --> ")}function _W(n){n.childRequests.forEach(function(e){if(DW(e,e.serviceIdentifier)){var t=SQ(e);throw new Error(bQ.CIRCULAR_DEPENDENCY+" "+t)}else _W(e)})}Cn.circularDependencyToException=_W;function CQ(n,e){if(e.isTagged()||e.isNamed()){var t="",r=e.getNamedTag(),i=e.getCustomTags();return r!==null&&(t+=r.toString()+`
`),i!==null&&i.forEach(function(o){t+=o.toString()+`
`})," "+n+`
 `+n+" - "+t}else return" "+n}Cn.listMetadataForTarget=CQ;function TW(n){if(n.name)return n.name;var e=n.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}Cn.getFunctionName=TW;function EQ(n){return n.toString().slice(7,-1)}Cn.getSymbolDescription=EQ});var RW=O(rP=>{"use strict";Object.defineProperty(rP,"__esModule",{value:!0});rP.Context=void 0;var wQ=Zu(),PQ=function(){function n(e){this.id=(0,wQ.id)(),this.container=e}return n.prototype.addPlan=function(e){this.plan=e},n.prototype.setCurrentRequest=function(e){this.currentRequest=e},n}();rP.Context=PQ});var ra=O(Xa=>{"use strict";var kQ=Xa&&Xa.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),xQ=Xa&&Xa.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),DQ=Xa&&Xa.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&kQ(e,n,t);return xQ(e,n),e};Object.defineProperty(Xa,"__esModule",{value:!0});Xa.Metadata=void 0;var _Q=DQ(Sn()),TQ=function(){function n(e,t){this.key=e,this.value=t}return n.prototype.toString=function(){return this.key===_Q.NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},n}();Xa.Metadata=TQ});var AW=O(nP=>{"use strict";Object.defineProperty(nP,"__esModule",{value:!0});nP.Plan=void 0;var RQ=function(){function n(e,t){this.parentContext=e,this.rootRequest=t}return n}();nP.Plan=RQ});var lA=O(iP=>{"use strict";Object.defineProperty(iP,"__esModule",{value:!0});iP.LazyServiceIdentifer=void 0;var AQ=function(){function n(e){this._cb=e}return n.prototype.unwrap=function(){return this._cb()},n}();iP.LazyServiceIdentifer=AQ});var NW=O(oP=>{"use strict";Object.defineProperty(oP,"__esModule",{value:!0});oP.QueryableString=void 0;var NQ=function(){function n(e){this.str=e}return n.prototype.startsWith=function(e){return this.str.indexOf(e)===0},n.prototype.endsWith=function(e){var t="",r=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},r)},n.prototype.contains=function(e){return this.str.indexOf(e)!==-1},n.prototype.equals=function(e){return this.str===e},n.prototype.value=function(){return this.str},n}();oP.QueryableString=NQ});var cA=O(Za=>{"use strict";var MQ=Za&&Za.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),KQ=Za&&Za.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),OQ=Za&&Za.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&MQ(e,n,t);return KQ(e,n),e};Object.defineProperty(Za,"__esModule",{value:!0});Za.Target=void 0;var Pc=OQ(Sn()),FQ=Zu(),LQ=Ch(),MW=ra(),UQ=NW(),WQ=function(){function n(e,t,r,i){this.id=(0,FQ.id)(),this.type=e,this.serviceIdentifier=r;var o=typeof t=="symbol"?(0,LQ.getSymbolDescription)(t):t;this.name=new UQ.QueryableString(o||""),this.identifier=t,this.metadata=new Array;var s=null;typeof i=="string"?s=new MW.Metadata(Pc.NAMED_TAG,i):i instanceof MW.Metadata&&(s=i),s!==null&&this.metadata.push(s)}return n.prototype.hasTag=function(e){for(var t=0,r=this.metadata;t<r.length;t++){var i=r[t];if(i.key===e)return!0}return!1},n.prototype.isArray=function(){return this.hasTag(Pc.MULTI_INJECT_TAG)},n.prototype.matchesArray=function(e){return this.matchesTag(Pc.MULTI_INJECT_TAG)(e)},n.prototype.isNamed=function(){return this.hasTag(Pc.NAMED_TAG)},n.prototype.isTagged=function(){return this.metadata.some(function(e){return Pc.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},n.prototype.isOptional=function(){return this.matchesTag(Pc.OPTIONAL_TAG)(!0)},n.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Pc.NAMED_TAG})[0]:null},n.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Pc.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},n.prototype.matchesNamedTag=function(e){return this.matchesTag(Pc.NAMED_TAG)(e)},n.prototype.matchesTag=function(e){var t=this;return function(r){for(var i=0,o=t.metadata;i<o.length;i++){var s=o[i];if(s.key===e&&s.value===r)return!0}return!1}},n}();Za.Target=WQ});var jW=O(Si=>{"use strict";var VQ=Si&&Si.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),jQ=Si&&Si.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),KW=Si&&Si.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&VQ(e,n,t);return jQ(e,n),e},sP=Si&&Si.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Si,"__esModule",{value:!0});Si.getFunctionName=Si.getBaseClassDependencyCount=Si.getDependencies=void 0;var JQ=lA(),uA=KW(Ii()),OW=ta(),BS=KW(Sn()),dA=Ch();Object.defineProperty(Si,"getFunctionName",{enumerable:!0,get:function(){return dA.getFunctionName}});var FW=cA();function BQ(n,e){var t=(0,dA.getFunctionName)(e);return LW(n,t,e,!1)}Si.getDependencies=BQ;function LW(n,e,t,r){var i=n.getConstructorMetadata(t),o=i.compilerGeneratedMetadata;if(o===void 0){var s=uA.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=i.userGeneratedMetadata,l=Object.keys(a),c=t.length===0&&l.length>0,u=l.length>t.length,d=c||u?l.length:t.length,f=qQ(r,e,o,a,d),g=UW(n,t,e),b=sP(sP([],f,!0),g,!0);return b}function $Q(n,e,t,r,i){var o=i[n.toString()]||[],s=VW(o),a=s.unmanaged!==!0,l=r[n],c=s.inject||s.multiInject;if(l=c||l,l instanceof JQ.LazyServiceIdentifer&&(l=l.unwrap()),a){var u=l===Object,d=l===Function,f=l===void 0,g=u||d||f;if(!e&&g){var b=uA.MISSING_INJECT_ANNOTATION+" argument "+n+" in class "+t+".";throw new Error(b)}var I=new FW.Target(OW.TargetTypeEnum.ConstructorArgument,s.targetName,l);return I.metadata=o,I}return null}function qQ(n,e,t,r,i){for(var o=[],s=0;s<i;s++){var a=s,l=$Q(a,n,e,t,r);l!==null&&o.push(l)}return o}function HQ(n,e,t,r){var i=n||e;if(i===void 0){var o=uA.MISSING_INJECTABLE_ANNOTATION+" for property "+String(t)+" in class "+r+".";throw new Error(o)}return i}function UW(n,e,t){for(var r=n.getPropertiesMetadata(e),i=[],o=Object.getOwnPropertySymbols(r),s=Object.keys(r),a=s.concat(o),l=0,c=a;l<c.length;l++){var u=c[l],d=r[u],f=VW(d),g=f.targetName||u,b=HQ(f.inject,f.multiInject,u,t),I=new FW.Target(OW.TargetTypeEnum.ClassProperty,g,b);I.metadata=d,i.push(I)}var w=Object.getPrototypeOf(e.prototype).constructor;if(w!==Object){var D=UW(n,w,t);i=sP(sP([],i,!0),D,!0)}return i}function WW(n,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var r=(0,dA.getFunctionName)(t),i=LW(n,r,t,!0),o=i.map(function(l){return l.metadata.filter(function(c){return c.key===BS.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=i.length-s;return a>0?a:WW(n,t)}else return 0}Si.getBaseClassDependencyCount=WW;function VW(n){var e={};return n.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[BS.INJECT_TAG],multiInject:e[BS.MULTI_INJECT_TAG],targetName:e[BS.NAME_TAG],unmanaged:e[BS.UNMANAGED_TAG]}}});var JW=O(aP=>{"use strict";Object.defineProperty(aP,"__esModule",{value:!0});aP.Request=void 0;var GQ=Zu(),zQ=function(){function n(e,t,r,i,o){this.id=(0,GQ.id)(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=r,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=r===null?new Map:null}return n.prototype.addChildRequest=function(e,t,r){var i=new n(e,this.parentContext,this,t,r);return this.childRequests.push(i),i},n}();aP.Request=zQ});var gA=O(ro=>{"use strict";var QQ=ro&&ro.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),YQ=ro&&ro.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),qW=ro&&ro.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&QQ(e,n,t);return YQ(e,n),e};Object.defineProperty(ro,"__esModule",{value:!0});ro.getBindingDictionary=ro.createMockRequest=ro.plan=void 0;var lP=PW(),mA=qW(Ii()),HW=ta(),BW=qW(Sn()),XQ=aA(),Eh=Ch(),GW=RW(),fA=ra(),ZQ=AW(),pA=jW(),hA=JW(),zW=cA();function QW(n){return n._bindingDictionary}ro.getBindingDictionary=QW;function eY(n,e,t,r,i,o){var s=n?BW.MULTI_INJECT_TAG:BW.INJECT_TAG,a=new fA.Metadata(s,t),l=new zW.Target(e,r,t,a);if(i!==void 0){var c=new fA.Metadata(i,o);l.metadata.push(c)}return l}function $W(n,e,t,r,i){var o=$S(t.container,i.serviceIdentifier),s=[];return o.length===lP.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&n.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),o=$S(t.container,i.serviceIdentifier)),e?s=o:s=o.filter(function(a){var l=new hA.Request(a.serviceIdentifier,t,r,a,i);return a.constraint(l)}),tY(i.serviceIdentifier,s,i,t.container),s}function tY(n,e,t,r){switch(e.length){case lP.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var i=(0,Eh.getServiceIdentifierAsString)(n),o=mA.NOT_REGISTERED;throw o+=(0,Eh.listMetadataForTarget)(i,t),o+=(0,Eh.listRegisteredBindingsForServiceIdentifier)(r,i,$S),new Error(o);case lP.BindingCount.OnlyOneBindingAvailable:return e;case lP.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var i=(0,Eh.getServiceIdentifierAsString)(n),o=mA.AMBIGUOUS_MATCH+" "+i;throw o+=(0,Eh.listRegisteredBindingsForServiceIdentifier)(r,i,$S),new Error(o)}}function YW(n,e,t,r,i,o){var s,a;if(i===null){s=$W(n,e,r,null,o),a=new hA.Request(t,r,null,s,o);var l=new ZQ.Plan(r,a);r.addPlan(l)}else s=$W(n,e,r,i,o),a=i.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(c){var u=null;if(o.isArray())u=a.addChildRequest(c.serviceIdentifier,c,o);else{if(c.cache)return;u=a}if(c.type===HW.BindingTypeEnum.Instance&&c.implementationType!==null){var d=(0,pA.getDependencies)(n,c.implementationType);if(!r.container.options.skipBaseClassChecks){var f=(0,pA.getBaseClassDependencyCount)(n,c.implementationType);if(d.length<f){var g=mA.ARGUMENTS_LENGTH_MISMATCH((0,pA.getFunctionName)(c.implementationType));throw new Error(g)}}d.forEach(function(b){YW(n,!1,b.serviceIdentifier,r,u,b)})}})}function $S(n,e){var t=[],r=QW(n);return r.hasKey(e)?t=r.get(e):n.parent!==null&&(t=$S(n.parent,e)),t}function rY(n,e,t,r,i,o,s,a){a===void 0&&(a=!1);var l=new GW.Context(e),c=eY(t,r,i,"",o,s);try{return YW(n,a,i,l,null,c),l}catch(u){throw(0,XQ.isStackOverflowExeption)(u)&&(0,Eh.circularDependencyToException)(l.plan.rootRequest),u}}ro.plan=rY;function nY(n,e,t,r){var i=new zW.Target(HW.TargetTypeEnum.Variable,"",e,new fA.Metadata(t,r)),o=new GW.Context(n),s=new hA.Request(e,o,null,[],i);return s}ro.createMockRequest=nY});var qS=O(wh=>{"use strict";Object.defineProperty(wh,"__esModule",{value:!0});wh.isPromiseOrContainsPromise=wh.isPromise=void 0;function vA(n){var e=typeof n=="object"&&n!==null||typeof n=="function";return e&&typeof n.then=="function"}wh.isPromise=vA;function iY(n){return vA(n)?!0:Array.isArray(n)&&n.some(vA)}wh.isPromiseOrContainsPromise=iY});var XW=O(el=>{"use strict";var oY=el&&el.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},sY=el&&el.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(el,"__esModule",{value:!0});el.saveToScope=el.tryGetFromScope=void 0;var cP=N(),aY=qS(),lY=function(n,e){return e.scope===cP.BindingScopeEnum.Singleton&&e.activated?e.cache:e.scope===cP.BindingScopeEnum.Request&&n.has(e.id)?n.get(e.id):null};el.tryGetFromScope=lY;var cY=function(n,e,t){e.scope===cP.BindingScopeEnum.Singleton&&dY(e,t),e.scope===cP.BindingScopeEnum.Request&&uY(n,e,t)};el.saveToScope=cY;var uY=function(n,e,t){n.has(e.id)||n.set(e.id,t)},dY=function(n,e){n.cache=e,n.activated=!0,(0,aY.isPromise)(e)&&pY(n,e)},pY=function(n,e){return oY(void 0,void 0,void 0,function(){var t,r;return sY(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return t=i.sent(),n.cache=t,[3,3];case 2:throw r=i.sent(),n.cache=null,n.activated=!1,r;case 3:return[2]}})})}});var ZW=O(HS=>{"use strict";Object.defineProperty(HS,"__esModule",{value:!0});HS.FactoryType=void 0;var mY;(function(n){n.DynamicValue="toDynamicValue",n.Factory="toFactory",n.Provider="toProvider"})(mY=HS.FactoryType||(HS.FactoryType={}))});var bA=O(no=>{"use strict";var fY=no&&no.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),hY=no&&no.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),gY=no&&no.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&fY(e,n,t);return hY(e,n),e};Object.defineProperty(no,"__esModule",{value:!0});no.getFactoryDetails=no.ensureFullyBound=no.multiBindToService=void 0;var vY=N(),yY=gY(Ii()),tl=ta(),yA=ZW(),bY=function(n){return function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.forEach(function(i){return n.bind(i).toService(e)})}}};no.multiBindToService=bY;var IY=function(n){var e=null;switch(n.type){case tl.BindingTypeEnum.ConstantValue:case tl.BindingTypeEnum.Function:e=n.cache;break;case tl.BindingTypeEnum.Constructor:case tl.BindingTypeEnum.Instance:e=n.implementationType;break;case tl.BindingTypeEnum.DynamicValue:e=n.dynamicValue;break;case tl.BindingTypeEnum.Provider:e=n.provider;break;case tl.BindingTypeEnum.Factory:e=n.factory;break}if(e===null){var t=(0,vY.getServiceIdentifierAsString)(n.serviceIdentifier);throw new Error(yY.INVALID_BINDING_TYPE+" "+t)}};no.ensureFullyBound=IY;var SY=function(n){switch(n.type){case tl.BindingTypeEnum.Factory:return{factory:n.factory,factoryType:yA.FactoryType.Factory};case tl.BindingTypeEnum.Provider:return{factory:n.provider,factoryType:yA.FactoryType.Provider};case tl.BindingTypeEnum.DynamicValue:return{factory:n.dynamicValue,factoryType:yA.FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+n.type)}};no.getFactoryDetails=SY});var oV=O(Bn=>{"use strict";var Ph=Bn&&Bn.__assign||function(){return Ph=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Ph.apply(this,arguments)},CY=Bn&&Bn.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),EY=Bn&&Bn.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),wY=Bn&&Bn.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&CY(e,n,t);return EY(e,n),e},rV=Bn&&Bn.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},nV=Bn&&Bn.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},PY=Bn&&Bn.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.resolveInstance=void 0;var IA=Ii(),CA=ta(),SA=wY(Sn()),EA=qS();function kY(n,e){return n.reduce(function(t,r){var i=e(r),o=r.target.type;return o===CA.TargetTypeEnum.ConstructorArgument?t.constructorInjections.push(i):(t.propertyRequests.push(r),t.propertyInjections.push(i)),t.isAsync||(t.isAsync=(0,EA.isPromiseOrContainsPromise)(i)),t},{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}function xY(n,e,t){var r;if(e.length>0){var i=kY(e,t),o=Ph(Ph({},i),{constr:n});i.isAsync?r=DY(o):r=iV(o)}else r=new n;return r}function iV(n){var e,t=new((e=n.constr).bind.apply(e,PY([void 0],n.constructorInjections,!1)));return n.propertyRequests.forEach(function(r,i){var o=r.target.identifier,s=n.propertyInjections[i];t[o]=s}),t}function DY(n){return rV(this,void 0,void 0,function(){var e,t;return nV(this,function(r){switch(r.label){case 0:return[4,eV(n.constructorInjections)];case 1:return e=r.sent(),[4,eV(n.propertyInjections)];case 2:return t=r.sent(),[2,iV(Ph(Ph({},n),{constructorInjections:e,propertyInjections:t}))]}})})}function eV(n){return rV(this,void 0,void 0,function(){var e,t,r,i;return nV(this,function(o){for(e=[],t=0,r=n;t<r.length;t++)i=r[t],Array.isArray(i)?e.push(Promise.all(i)):e.push(i);return[2,Promise.all(e)]})})}function tV(n,e){var t=_Y(n,e);return(0,EA.isPromise)(t)?t.then(function(){return e}):e}function _Y(n,e){var t,r;if(Reflect.hasMetadata(SA.POST_CONSTRUCT,n)){var i=Reflect.getMetadata(SA.POST_CONSTRUCT,n);try{return(r=(t=e)[i.value])===null||r===void 0?void 0:r.call(t)}catch(o){throw new Error((0,IA.POST_CONSTRUCT_ERROR)(n.name,o.message))}}}function TY(n,e){n.scope!==CA.BindingScopeEnum.Singleton&&RY(n,e)}function RY(n,e){var t="Class cannot be instantiated in "+(n.scope===CA.BindingScopeEnum.Request?"request":"transient")+" scope.";if(typeof n.onDeactivation=="function")throw new Error((0,IA.ON_DEACTIVATION_ERROR)(e.name,t));if(Reflect.hasMetadata(SA.PRE_DESTROY,e))throw new Error((0,IA.PRE_DESTROY_ERROR)(e.name,t))}function AY(n,e,t,r){TY(n,e);var i=xY(e,t,r);return(0,EA.isPromise)(i)?i.then(function(o){return tV(e,o)}):tV(e,i)}Bn.resolveInstance=AY});var uV=O(io=>{"use strict";var NY=io&&io.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),MY=io&&io.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),KY=io&&io.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&NY(e,n,t);return MY(e,n),e},OY=io&&io.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},FY=io&&io.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(io,"__esModule",{value:!0});io.resolve=void 0;var LY=KY(Ii()),uP=ta(),UY=gA(),sV=XW(),wA=qS(),lV=bA(),WY=aA(),VY=oV(),PA=function(n){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,r=e.childRequests,i=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(i&&o)return r.map(function(a){var l=PA(n);return l(a)});if(e.target.isOptional()&&t.length===0)return;var s=t[0];return $Y(n,e,s)}},jY=function(n,e){var t=(0,lV.getFactoryDetails)(n);return(0,WY.tryAndThrowErrorIfStackOverflow)(function(){return t.factory.bind(n)(e)},function(){return new Error(LY.CIRCULAR_DEPENDENCY_IN_FACTORY(t.factoryType,e.currentRequest.serviceIdentifier.toString()))})},JY=function(n,e,t){var r,i=e.childRequests;switch((0,lV.ensureFullyBound)(t),t.type){case uP.BindingTypeEnum.ConstantValue:case uP.BindingTypeEnum.Function:r=t.cache;break;case uP.BindingTypeEnum.Constructor:r=t.implementationType;break;case uP.BindingTypeEnum.Instance:r=(0,VY.resolveInstance)(t,t.implementationType,i,PA(n));break;default:r=jY(t,e.parentContext)}return r},BY=function(n,e,t){var r=(0,sV.tryGetFromScope)(n,e);return r!==null||(r=t(),(0,sV.saveToScope)(n,e,r)),r},$Y=function(n,e,t){return BY(n,t,function(){var r=JY(n,e,t);return(0,wA.isPromise)(r)?r=r.then(function(i){return aV(e,t,i)}):r=aV(e,t,r),r})};function aV(n,e,t){var r=qY(n.parentContext,e,t),i=zY(n.parentContext.container),o,s=i.next();do{o=s.value;var a=n.parentContext,l=n.serviceIdentifier,c=GY(o,l);(0,wA.isPromise)(r)?r=cV(c,a,r):r=HY(c,a,r),s=i.next()}while(s.done!==!0&&!(0,UY.getBindingDictionary)(o).hasKey(n.serviceIdentifier));return r}var qY=function(n,e,t){var r;return typeof e.onActivation=="function"?r=e.onActivation(n,t):r=t,r},HY=function(n,e,t){for(var r=n.next();!r.done;){if(t=r.value(e,t),(0,wA.isPromise)(t))return cV(n,e,t);r=n.next()}return t},cV=function(n,e,t){return OY(void 0,void 0,void 0,function(){var r,i;return FY(this,function(o){switch(o.label){case 0:return[4,t];case 1:r=o.sent(),i=n.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(e,r)];case 3:return r=o.sent(),i=n.next(),[3,2];case 4:return[2,r]}})})},GY=function(n,e){var t=n._activations;return t.hasKey(e)?t.get(e).values():[].values()},zY=function(n){for(var e=[n],t=n.parent;t!==null;)e.push(t),t=t.parent;var r=function(){var o=e.pop();return o!==void 0?{done:!1,value:o}:{done:!0,value:void 0}},i={next:r};return i};function QY(n){var e=PA(n.plan.rootRequest.requestScope);return e(n.plan.rootRequest)}io.resolve=QY});var kA=O(Ci=>{"use strict";var YY=Ci&&Ci.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),XY=Ci&&Ci.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),ZY=Ci&&Ci.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&YY(e,n,t);return XY(e,n),e};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.typeConstraint=Ci.namedConstraint=Ci.taggedConstraint=Ci.traverseAncerstors=void 0;var eX=ZY(Sn()),tX=ra(),dV=function(n,e){var t=n.parentRequest;return t!==null?e(t)?!0:dV(t,e):!1};Ci.traverseAncerstors=dV;var pV=function(n){return function(e){var t=function(r){return r!==null&&r.target!==null&&r.target.matchesTag(n)(e)};return t.metaData=new tX.Metadata(n,e),t}};Ci.taggedConstraint=pV;var rX=pV(eX.NAMED_TAG);Ci.namedConstraint=rX;var nX=function(n){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof n=="string"){var r=t.serviceIdentifier;return r===n}else{var i=e.bindings[0].implementationType;return n===i}return!1}};Ci.typeConstraint=nX});var pP=O(dP=>{"use strict";Object.defineProperty(dP,"__esModule",{value:!0});dP.BindingWhenSyntax=void 0;var Wi=mP(),_n=kA(),iX=function(){function n(e){this._binding=e}return n.prototype.when=function(e){return this._binding.constraint=e,new Wi.BindingOnSyntax(this._binding)},n.prototype.whenTargetNamed=function(e){return this._binding.constraint=(0,_n.namedConstraint)(e),new Wi.BindingOnSyntax(this._binding)},n.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){if(e===null)return!1;var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=(0,_n.taggedConstraint)(e)(t),new Wi.BindingOnSyntax(this._binding)},n.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return t!==null&&(0,_n.typeConstraint)(e)(t.parentRequest)},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,_n.namedConstraint)(e)(t.parentRequest)},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(r){return r!==null&&(0,_n.taggedConstraint)(e)(t)(r.parentRequest)},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&(0,_n.traverseAncerstors)(t,(0,_n.typeConstraint)(e))},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,_n.traverseAncerstors)(t,(0,_n.typeConstraint)(e))},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,_n.traverseAncerstors)(t,(0,_n.namedConstraint)(e))},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,_n.traverseAncerstors)(t,(0,_n.namedConstraint)(e))},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(r){return r!==null&&(0,_n.traverseAncerstors)(r,(0,_n.taggedConstraint)(e)(t))},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(r){return r!==null&&!(0,_n.traverseAncerstors)(r,(0,_n.taggedConstraint)(e)(t))},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&(0,_n.traverseAncerstors)(t,e)},new Wi.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,_n.traverseAncerstors)(t,e)},new Wi.BindingOnSyntax(this._binding)},n}();dP.BindingWhenSyntax=iX});var mP=O(fP=>{"use strict";Object.defineProperty(fP,"__esModule",{value:!0});fP.BindingOnSyntax=void 0;var mV=pP(),oX=function(){function n(e){this._binding=e}return n.prototype.onActivation=function(e){return this._binding.onActivation=e,new mV.BindingWhenSyntax(this._binding)},n.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new mV.BindingWhenSyntax(this._binding)},n}();fP.BindingOnSyntax=oX});var xA=O(hP=>{"use strict";Object.defineProperty(hP,"__esModule",{value:!0});hP.BindingWhenOnSyntax=void 0;var sX=mP(),aX=pP(),lX=function(){function n(e){this._binding=e,this._bindingWhenSyntax=new aX.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new sX.BindingOnSyntax(this._binding)}return n.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},n.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},n.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},n.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},n.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},n.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},n.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},n.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},n.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},n.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},n.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},n.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},n.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},n.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},n.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},n.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},n.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},n}();hP.BindingWhenOnSyntax=lX});var fV=O(gP=>{"use strict";Object.defineProperty(gP,"__esModule",{value:!0});gP.BindingInSyntax=void 0;var DA=ta(),_A=xA(),cX=function(){function n(e){this._binding=e}return n.prototype.inRequestScope=function(){return this._binding.scope=DA.BindingScopeEnum.Request,new _A.BindingWhenOnSyntax(this._binding)},n.prototype.inSingletonScope=function(){return this._binding.scope=DA.BindingScopeEnum.Singleton,new _A.BindingWhenOnSyntax(this._binding)},n.prototype.inTransientScope=function(){return this._binding.scope=DA.BindingScopeEnum.Transient,new _A.BindingWhenOnSyntax(this._binding)},n}();gP.BindingInSyntax=cX});var hV=O(vP=>{"use strict";Object.defineProperty(vP,"__esModule",{value:!0});vP.BindingInWhenOnSyntax=void 0;var uX=fV(),dX=mP(),pX=pP(),mX=function(){function n(e){this._binding=e,this._bindingWhenSyntax=new pX.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new dX.BindingOnSyntax(this._binding),this._bindingInSyntax=new uX.BindingInSyntax(e)}return n.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},n.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},n.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},n.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},n.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},n.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},n.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},n.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},n.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},n.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},n.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},n.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},n.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},n.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},n.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},n.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},n.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},n.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},n.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},n.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},n}();vP.BindingInWhenOnSyntax=mX});var yV=O(rl=>{"use strict";var fX=rl&&rl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),hX=rl&&rl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),gX=rl&&rl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&fX(e,n,t);return hX(e,n),e};Object.defineProperty(rl,"__esModule",{value:!0});rl.BindingToSyntax=void 0;var gV=gX(Ii()),Vi=ta(),vV=hV(),kh=xA(),vX=function(){function n(e){this._binding=e}return n.prototype.to=function(e){return this._binding.type=Vi.BindingTypeEnum.Instance,this._binding.implementationType=e,new vV.BindingInWhenOnSyntax(this._binding)},n.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+gV.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},n.prototype.toConstantValue=function(e){return this._binding.type=Vi.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Vi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},n.prototype.toDynamicValue=function(e){return this._binding.type=Vi.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new vV.BindingInWhenOnSyntax(this._binding)},n.prototype.toConstructor=function(e){return this._binding.type=Vi.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=Vi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},n.prototype.toFactory=function(e){return this._binding.type=Vi.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=Vi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},n.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(gV.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=Vi.BindingTypeEnum.Function,this._binding.scope=Vi.BindingScopeEnum.Singleton,t},n.prototype.toAutoFactory=function(e){return this._binding.type=Vi.BindingTypeEnum.Factory,this._binding.factory=function(t){var r=function(){return t.container.get(e)};return r},this._binding.scope=Vi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},n.prototype.toAutoNamedFactory=function(e){return this._binding.type=Vi.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(r){return t.container.getNamed(e,r)}},new kh.BindingWhenOnSyntax(this._binding)},n.prototype.toProvider=function(e){return this._binding.type=Vi.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=Vi.BindingScopeEnum.Singleton,new kh.BindingWhenOnSyntax(this._binding)},n.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},n}();rl.BindingToSyntax=vX});var bV=O(yP=>{"use strict";Object.defineProperty(yP,"__esModule",{value:!0});yP.ContainerSnapshot=void 0;var yX=function(){function n(){}return n.of=function(e,t,r,i,o){var s=new n;return s.bindings=e,s.middleware=t,s.deactivations=i,s.activations=r,s.moduleActivationStore=o,s},n}();yP.ContainerSnapshot=yX});var IV=O(bP=>{"use strict";Object.defineProperty(bP,"__esModule",{value:!0});bP.isClonable=void 0;function bX(n){return typeof n=="object"&&n!==null&&"clone"in n&&typeof n.clone=="function"}bP.isClonable=bX});var TA=O(nl=>{"use strict";var IX=nl&&nl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),SX=nl&&nl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),CX=nl&&nl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&IX(e,n,t);return SX(e,n),e};Object.defineProperty(nl,"__esModule",{value:!0});nl.Lookup=void 0;var Zp=CX(Ii()),EX=IV(),wX=function(){function n(){this._map=new Map}return n.prototype.getMap=function(){return this._map},n.prototype.add=function(e,t){if(e==null)throw new Error(Zp.NULL_ARGUMENT);if(t==null)throw new Error(Zp.NULL_ARGUMENT);var r=this._map.get(e);r!==void 0?r.push(t):this._map.set(e,[t])},n.prototype.get=function(e){if(e==null)throw new Error(Zp.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(Zp.KEY_NOT_FOUND)},n.prototype.remove=function(e){if(e==null)throw new Error(Zp.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(Zp.KEY_NOT_FOUND)},n.prototype.removeIntersection=function(e){var t=this;this.traverse(function(r,i){var o=e.hasKey(r)?e.get(r):void 0;if(o!==void 0){var s=i.filter(function(a){return!o.some(function(l){return a===l})});t._setValue(r,s)}})},n.prototype.removeByCondition=function(e){var t=this,r=[];return this._map.forEach(function(i,o){for(var s=[],a=0,l=i;a<l.length;a++){var c=l[a],u=e(c);u?r.push(c):s.push(c)}t._setValue(o,s)}),r},n.prototype.hasKey=function(e){if(e==null)throw new Error(Zp.NULL_ARGUMENT);return this._map.has(e)},n.prototype.clone=function(){var e=new n;return this._map.forEach(function(t,r){t.forEach(function(i){return e.add(r,(0,EX.isClonable)(i)?i.clone():i)})}),e},n.prototype.traverse=function(e){this._map.forEach(function(t,r){e(r,t)})},n.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},n}();nl.Lookup=wX});var CV=O(IP=>{"use strict";Object.defineProperty(IP,"__esModule",{value:!0});IP.ModuleActivationStore=void 0;var SV=TA(),PX=function(){function n(){this._map=new Map}return n.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},n.prototype.addDeactivation=function(e,t,r){this._getModuleActivationHandlers(e).onDeactivations.add(t,r)},n.prototype.addActivation=function(e,t,r){this._getModuleActivationHandlers(e).onActivations.add(t,r)},n.prototype.clone=function(){var e=new n;return this._map.forEach(function(t,r){e._map.set(r,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})}),e},n.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},n.prototype._getEmptyHandlersStore=function(){var e={onActivations:new SV.Lookup,onDeactivations:new SV.Lookup};return e},n}();IP.ModuleActivationStore=PX});var RA=O($n=>{"use strict";var CP=$n&&$n.__assign||function(){return CP=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},CP.apply(this,arguments)},kX=$n&&$n.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),xX=$n&&$n.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),EV=$n&&$n.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&kX(e,n,t);return xX(e,n),e},fs=$n&&$n.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},hs=$n&&$n.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},DX=$n&&$n.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty($n,"__esModule",{value:!0});$n.Container=void 0;var _X=wW(),na=EV(Ii()),xh=ta(),em=EV(Sn()),TX=sA(),SP=gA(),RX=uV(),AX=yV(),tm=qS(),NX=Zu(),MX=Ch(),KX=bV(),GS=TA(),OX=CV(),FX=function(){function n(e){var t=e||{};if(typeof t!="object")throw new Error(""+na.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=xh.BindingScopeEnum.Transient;else if(t.defaultScope!==xh.BindingScopeEnum.Singleton&&t.defaultScope!==xh.BindingScopeEnum.Transient&&t.defaultScope!==xh.BindingScopeEnum.Request)throw new Error(""+na.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+na.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+na.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=(0,NX.id)(),this._bindingDictionary=new GS.Lookup,this._snapshots=[],this._middleware=null,this._activations=new GS.Lookup,this._deactivations=new GS.Lookup,this.parent=null,this._metadataReader=new TX.MetadataReader,this._moduleActivationStore=new OX.ModuleActivationStore}return n.merge=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new n,s=DX([e,t],r,!0).map(function(c){return(0,SP.getBindingDictionary)(c)}),a=(0,SP.getBindingDictionary)(o);function l(c,u){c.traverse(function(d,f){f.forEach(function(g){u.add(g.serviceIdentifier,g.clone())})})}return s.forEach(function(c){l(c,a)}),o},n.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this._getContainerModuleHelpersFactory(),i=0,o=e;i<o.length;i++){var s=o[i],a=r(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},n.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return fs(this,void 0,void 0,function(){var r,i,o,s,a;return hs(this,function(l){switch(l.label){case 0:r=this._getContainerModuleHelpersFactory(),i=0,o=e,l.label=1;case 1:return i<o.length?(s=o[i],a=r(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)]):[3,4];case 2:l.sent(),l.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},n.prototype.unload=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.forEach(function(i){var o=e._removeModuleBindings(i.id);e._deactivateSingletons(o),e._removeModuleHandlers(i.id)})},n.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return fs(this,void 0,void 0,function(){var r,i,o,s;return hs(this,function(a){switch(a.label){case 0:r=0,i=e,a.label=1;case 1:return r<i.length?(o=i[r],s=this._removeModuleBindings(o.id),[4,this._deactivateSingletonsAsync(s)]):[3,4];case 2:a.sent(),this._removeModuleHandlers(o.id),a.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},n.prototype.bind=function(e){var t=this.options.defaultScope||xh.BindingScopeEnum.Transient,r=new _X.Binding(e,t);return this._bindingDictionary.add(e,r),new AX.BindingToSyntax(r)},n.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},n.prototype.rebindAsync=function(e){return fs(this,void 0,void 0,function(){return hs(this,function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}})})},n.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},n.prototype.unbindAsync=function(e){return fs(this,void 0,void 0,function(){var t;return hs(this,function(r){switch(r.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:r.sent(),r.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}})})},n.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse(function(t,r){e._deactivateSingletons(r)}),this._bindingDictionary=new GS.Lookup},n.prototype.unbindAllAsync=function(){return fs(this,void 0,void 0,function(){var e,t=this;return hs(this,function(r){switch(r.label){case 0:return e=[],this._bindingDictionary.traverse(function(i,o){e.push(t._deactivateSingletonsAsync(o))}),[4,Promise.all(e)];case 1:return r.sent(),this._bindingDictionary=new GS.Lookup,[2]}})})},n.prototype.onActivation=function(e,t){this._activations.add(e,t)},n.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},n.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},n.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},n.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,em.NAMED_TAG,t)},n.prototype.isBoundTagged=function(e,t,r){var i=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=(0,SP.createMockRequest)(this,e,t,r);i=o.some(function(a){return a.constraint(s)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(e,t,r)),i},n.prototype.snapshot=function(){this._snapshots.push(KX.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},n.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(na.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},n.prototype.createChild=function(e){var t=new n(e||this.options);return t.parent=this,t},n.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(i,o){return o(i)},r)},n.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},n.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},n.prototype.getAsync=function(e){return fs(this,void 0,void 0,function(){var t;return hs(this,function(r){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]})})},n.prototype.getTagged=function(e,t,r){var i=this._getNotAllArgs(e,!1,t,r);return this._getButThrowIfAsync(i)},n.prototype.getTaggedAsync=function(e,t,r){return fs(this,void 0,void 0,function(){var i;return hs(this,function(o){return i=this._getNotAllArgs(e,!1,t,r),[2,this._get(i)]})})},n.prototype.getNamed=function(e,t){return this.getTagged(e,em.NAMED_TAG,t)},n.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,em.NAMED_TAG,t)},n.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},n.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},n.prototype.getAllTagged=function(e,t,r){var i=this._getNotAllArgs(e,!0,t,r);return this._getButThrowIfAsync(i)},n.prototype.getAllTaggedAsync=function(e,t,r){var i=this._getNotAllArgs(e,!0,t,r);return this._getAll(i)},n.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,em.NAMED_TAG,t)},n.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,em.NAMED_TAG,t)},n.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var r=this.get(e);return t||this.unbind(e),r},n.prototype._preDestroy=function(e,t){if(Reflect.hasMetadata(em.PRE_DESTROY,e)){var r=Reflect.getMetadata(em.PRE_DESTROY,e);return t[r.value]()}},n.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},n.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition(function(t){return t.moduleId===e})},n.prototype._deactivate=function(e,t){var r=this,i=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var o=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if((0,tm.isPromise)(o))return this._handleDeactivationError(o.then(function(){return r._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i)}),i)}var s=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i);if((0,tm.isPromise)(s))return this._handleDeactivationError(s,i)}catch(a){throw new Error(na.ON_DEACTIVATION_ERROR(i.name,a.message))}},n.prototype._handleDeactivationError=function(e,t){return fs(this,void 0,void 0,function(){var r;return hs(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return i.sent(),[3,3];case 2:throw r=i.sent(),new Error(na.ON_DEACTIVATION_ERROR(t.name,r.message));case 3:return[2]}})})},n.prototype._deactivateContainer=function(e,t){for(var r=this,i=t.next();i.value;){var o=i.value(e);if((0,tm.isPromise)(o))return o.then(function(){return r._deactivateContainerAsync(e,t)});i=t.next()}},n.prototype._deactivateContainerAsync=function(e,t){return fs(this,void 0,void 0,function(){var r;return hs(this,function(i){switch(i.label){case 0:r=t.next(),i.label=1;case 1:return r.value?[4,r.value(e)]:[3,3];case 2:return i.sent(),r=t.next(),[3,1];case 3:return[2]}})})},n.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(u,d){u._binding.moduleId=d},r=function(u){return function(d){var f=e.bind(d);return t(f,u),f}},i=function(){return function(u){return e.unbind(u)}},o=function(){return function(u){return e.unbindAsync(u)}},s=function(){return function(u){return e.isBound(u)}},a=function(u){return function(d){var f=e.rebind(d);return t(f,u),f}},l=function(u){return function(d,f){e._moduleActivationStore.addActivation(u,d,f),e.onActivation(d,f)}},c=function(u){return function(d,f){e._moduleActivationStore.addDeactivation(u,d,f),e.onDeactivation(d,f)}};return function(u){return{bindFunction:r(u),isboundFunction:s(),onActivationFunction:l(u),onDeactivationFunction:c(u),rebindFunction:a(u),unbindFunction:i(),unbindAsyncFunction:o()}}},n.prototype._getAll=function(e){return Promise.all(this._get(e))},n.prototype._get=function(e){var t=CP(CP({},e),{contextInterceptor:function(i){return i},targetType:xh.TargetTypeEnum.Variable});if(this._middleware){var r=this._middleware(t);if(r==null)throw new Error(na.INVALID_MIDDLEWARE_RETURN);return r}return this._planAndResolve()(t)},n.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if((0,tm.isPromiseOrContainsPromise)(t))throw new Error(na.LAZY_IN_SYNC(e.serviceIdentifier));return t},n.prototype._getAllArgs=function(e){var t={avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e};return t},n.prototype._getNotAllArgs=function(e,t,r,i){var o={avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:r,value:i};return o},n.prototype._planAndResolve=function(){var e=this;return function(t){var r=(0,SP.plan)(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);r=t.contextInterceptor(r);var i=(0,RX.resolve)(r);return i}},n.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return(0,tm.isPromise)(e.cache)?e.cache.then(function(r){return t._deactivate(e,r)}):this._deactivate(e,e.cache)},n.prototype._deactivateSingletons=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],o=this._deactivateIfSingleton(i);if((0,tm.isPromise)(o))throw new Error(na.ASYNC_UNBIND_REQUIRED)}},n.prototype._deactivateSingletonsAsync=function(e){return fs(this,void 0,void 0,function(){var t=this;return hs(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(i){return t._deactivateIfSingleton(i)}))];case 1:return r.sent(),[2]}})})},n.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,r){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,r)},n.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,r){return fs(this,void 0,void 0,function(){return hs(this,function(i){switch(i.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,r)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},n.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(na.CANNOT_UNBIND+" "+(0,MX.getServiceIdentifierAsString)(e))}},n.prototype._bindingDeactivationAndPreDestroy=function(e,t,r){var i=this;if(typeof e.onDeactivation=="function"){var o=e.onDeactivation(t);if((0,tm.isPromise)(o))return o.then(function(){return i._preDestroy(r,t)})}return this._preDestroy(r,t)},n.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,r){return fs(this,void 0,void 0,function(){return hs(this,function(i){switch(i.label){case 0:return typeof e.onDeactivation!="function"?[3,2]:[4,e.onDeactivation(t)];case 1:i.sent(),i.label=2;case 2:return[4,this._preDestroy(r,t)];case 3:return i.sent(),[2]}})})},n}();$n.Container=FX});var PV=O(Dh=>{"use strict";Object.defineProperty(Dh,"__esModule",{value:!0});Dh.AsyncContainerModule=Dh.ContainerModule=void 0;var wV=Zu(),LX=function(){function n(e){this.id=(0,wV.id)(),this.registry=e}return n}();Dh.ContainerModule=LX;var UX=function(){function n(e){this.id=(0,wV.id)(),this.registry=e}return n}();Dh.AsyncContainerModule=UX});var kV=O(EP=>{"use strict";Object.defineProperty(EP,"__esModule",{value:!0});EP.getFirstArrayDuplicate=void 0;function WX(n){for(var e=new Set,t=0,r=n;t<r.length;t++){var i=r[t];if(e.has(i))return i;e.add(i)}}EP.getFirstArrayDuplicate=WX});var kc=O(Ei=>{"use strict";var VX=Ei&&Ei.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),jX=Ei&&Ei.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),DV=Ei&&Ei.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&VX(e,n,t);return jX(e,n),e};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.createTaggedDecorator=Ei.tagProperty=Ei.tagParameter=Ei.decorate=void 0;var wP=DV(Ii()),_V=DV(Sn()),JX=kV();function BX(n){return n.prototype!==void 0}function $X(n){if(n!==void 0)throw new Error(wP.INVALID_DECORATOR_OPERATION)}function TV(n,e,t,r){$X(e),AV(_V.TAGGED,n,t.toString(),r)}Ei.tagParameter=TV;function RV(n,e,t){if(BX(n))throw new Error(wP.INVALID_DECORATOR_OPERATION);AV(_V.TAGGED_PROP,n.constructor,e,t)}Ei.tagProperty=RV;function qX(n){var e=[];if(Array.isArray(n)){e=n;var t=(0,JX.getFirstArrayDuplicate)(e.map(function(r){return r.key}));if(t!==void 0)throw new Error(wP.DUPLICATED_METADATA+" "+t.toString())}else e=[n];return e}function AV(n,e,t,r){var i=qX(r),o={};Reflect.hasOwnMetadata(n,e)&&(o=Reflect.getMetadata(n,e));var s=o[t];if(s===void 0)s=[];else for(var a=function(d){if(i.some(function(f){return f.key===d.key}))throw new Error(wP.DUPLICATED_METADATA+" "+d.key.toString())},l=0,c=s;l<c.length;l++){var u=c[l];a(u)}s.push.apply(s,i),o[t]=s,Reflect.defineMetadata(n,o,e)}function HX(n){return function(e,t,r){typeof r=="number"?TV(e,t,r,n):RV(e,t,n)}}Ei.createTaggedDecorator=HX;function xV(n,e){Reflect.decorate(n,e)}function GX(n,e){return function(t,r){e(t,r,n)}}function zX(n,e,t){typeof t=="number"?xV([GX(t,n)],e):typeof t=="string"?Reflect.decorate([n],e,t):xV([n],e)}Ei.decorate=zX});var MV=O(il=>{"use strict";var QX=il&&il.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),YX=il&&il.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),NV=il&&il.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&QX(e,n,t);return YX(e,n),e};Object.defineProperty(il,"__esModule",{value:!0});il.injectable=void 0;var XX=NV(Ii()),AA=NV(Sn());function ZX(){return function(n){if(Reflect.hasOwnMetadata(AA.PARAM_TYPES,n))throw new Error(XX.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(AA.DESIGN_PARAM_TYPES,n)||[];return Reflect.defineMetadata(AA.PARAM_TYPES,e,n),n}}il.injectable=ZX});var KV=O(PP=>{"use strict";Object.defineProperty(PP,"__esModule",{value:!0});PP.tagged=void 0;var eZ=ra(),tZ=kc();function rZ(n,e){return(0,tZ.createTaggedDecorator)(new eZ.Metadata(n,e))}PP.tagged=rZ});var OV=O(ol=>{"use strict";var nZ=ol&&ol.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),iZ=ol&&ol.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),oZ=ol&&ol.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&nZ(e,n,t);return iZ(e,n),e};Object.defineProperty(ol,"__esModule",{value:!0});ol.named=void 0;var sZ=oZ(Sn()),aZ=ra(),lZ=kc();function cZ(n){return(0,lZ.createTaggedDecorator)(new aZ.Metadata(sZ.NAMED_TAG,n))}ol.named=cZ});var NA=O(kP=>{"use strict";Object.defineProperty(kP,"__esModule",{value:!0});kP.injectBase=void 0;var uZ=Ii(),dZ=ra(),pZ=kc();function mZ(n){return function(e){return function(t,r,i){if(e===void 0){var o=typeof t=="function"?t.name:t.constructor.name;throw new Error((0,uZ.UNDEFINED_INJECT_ANNOTATION)(o))}return(0,pZ.createTaggedDecorator)(new dZ.Metadata(n,e))(t,r,i)}}}kP.injectBase=mZ});var FV=O(sl=>{"use strict";var fZ=sl&&sl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),hZ=sl&&sl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),gZ=sl&&sl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&fZ(e,n,t);return hZ(e,n),e};Object.defineProperty(sl,"__esModule",{value:!0});sl.inject=void 0;var vZ=gZ(Sn()),yZ=NA(),bZ=(0,yZ.injectBase)(vZ.INJECT_TAG);sl.inject=bZ});var LV=O(al=>{"use strict";var IZ=al&&al.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),SZ=al&&al.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),CZ=al&&al.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&IZ(e,n,t);return SZ(e,n),e};Object.defineProperty(al,"__esModule",{value:!0});al.optional=void 0;var EZ=CZ(Sn()),wZ=ra(),PZ=kc();function kZ(){return(0,PZ.createTaggedDecorator)(new wZ.Metadata(EZ.OPTIONAL_TAG,!0))}al.optional=kZ});var UV=O(ll=>{"use strict";var xZ=ll&&ll.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),DZ=ll&&ll.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),_Z=ll&&ll.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&xZ(e,n,t);return DZ(e,n),e};Object.defineProperty(ll,"__esModule",{value:!0});ll.unmanaged=void 0;var TZ=_Z(Sn()),RZ=ra(),AZ=kc();function NZ(){return function(n,e,t){var r=new RZ.Metadata(TZ.UNMANAGED_TAG,!0);(0,AZ.tagParameter)(n,e,t,r)}}ll.unmanaged=NZ});var WV=O(cl=>{"use strict";var MZ=cl&&cl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),KZ=cl&&cl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),OZ=cl&&cl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&MZ(e,n,t);return KZ(e,n),e};Object.defineProperty(cl,"__esModule",{value:!0});cl.multiInject=void 0;var FZ=OZ(Sn()),LZ=NA(),UZ=(0,LZ.injectBase)(FZ.MULTI_INJECT_TAG);cl.multiInject=UZ});var VV=O(ul=>{"use strict";var WZ=ul&&ul.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),VZ=ul&&ul.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),jZ=ul&&ul.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&WZ(e,n,t);return VZ(e,n),e};Object.defineProperty(ul,"__esModule",{value:!0});ul.targetName=void 0;var JZ=jZ(Sn()),BZ=ra(),$Z=kc();function qZ(n){return function(e,t,r){var i=new BZ.Metadata(JZ.NAME_TAG,n);(0,$Z.tagParameter)(e,t,r,i)}}ul.targetName=qZ});var MA=O(xP=>{"use strict";Object.defineProperty(xP,"__esModule",{value:!0});xP.propertyEventDecorator=void 0;var HZ=ra();function GZ(n,e){return function(){return function(t,r){var i=new HZ.Metadata(n,r);if(Reflect.hasOwnMetadata(n,t.constructor))throw new Error(e);Reflect.defineMetadata(n,i,t.constructor)}}}xP.propertyEventDecorator=GZ});var JV=O(dl=>{"use strict";var zZ=dl&&dl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),QZ=dl&&dl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),jV=dl&&dl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&zZ(e,n,t);return QZ(e,n),e};Object.defineProperty(dl,"__esModule",{value:!0});dl.postConstruct=void 0;var YZ=jV(Ii()),XZ=jV(Sn()),ZZ=MA(),eee=(0,ZZ.propertyEventDecorator)(XZ.POST_CONSTRUCT,YZ.MULTIPLE_POST_CONSTRUCT_METHODS);dl.postConstruct=eee});var $V=O(pl=>{"use strict";var tee=pl&&pl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),ree=pl&&pl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),BV=pl&&pl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&tee(e,n,t);return ree(e,n),e};Object.defineProperty(pl,"__esModule",{value:!0});pl.preDestroy=void 0;var nee=BV(Ii()),iee=BV(Sn()),oee=MA(),see=(0,oee.propertyEventDecorator)(iee.PRE_DESTROY,nee.MULTIPLE_PRE_DESTROY_METHODS);pl.preDestroy=see});var qV=O(DP=>{"use strict";Object.defineProperty(DP,"__esModule",{value:!0});DP.interfaces=void 0;var KA;KA||(KA={});DP.interfaces=KA});var N=O(Ke=>{"use strict";var aee=Ke&&Ke.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),lee=Ke&&Ke.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),cee=Ke&&Ke.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&aee(e,n,t);return lee(e,n),e};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.multiBindToService=Ke.getServiceIdentifierAsString=Ke.typeConstraint=Ke.namedConstraint=Ke.taggedConstraint=Ke.traverseAncerstors=Ke.decorate=Ke.interfaces=Ke.id=Ke.MetadataReader=Ke.preDestroy=Ke.postConstruct=Ke.targetName=Ke.multiInject=Ke.unmanaged=Ke.optional=Ke.LazyServiceIdentifer=Ke.inject=Ke.named=Ke.tagged=Ke.injectable=Ke.createTaggedDecorator=Ke.ContainerModule=Ke.AsyncContainerModule=Ke.TargetTypeEnum=Ke.BindingTypeEnum=Ke.BindingScopeEnum=Ke.Container=Ke.METADATA_KEY=void 0;var uee=cee(Sn());Ke.METADATA_KEY=uee;var dee=RA();Object.defineProperty(Ke,"Container",{enumerable:!0,get:function(){return dee.Container}});var OA=ta();Object.defineProperty(Ke,"BindingScopeEnum",{enumerable:!0,get:function(){return OA.BindingScopeEnum}});Object.defineProperty(Ke,"BindingTypeEnum",{enumerable:!0,get:function(){return OA.BindingTypeEnum}});Object.defineProperty(Ke,"TargetTypeEnum",{enumerable:!0,get:function(){return OA.TargetTypeEnum}});var HV=PV();Object.defineProperty(Ke,"AsyncContainerModule",{enumerable:!0,get:function(){return HV.AsyncContainerModule}});Object.defineProperty(Ke,"ContainerModule",{enumerable:!0,get:function(){return HV.ContainerModule}});var pee=kc();Object.defineProperty(Ke,"createTaggedDecorator",{enumerable:!0,get:function(){return pee.createTaggedDecorator}});var mee=MV();Object.defineProperty(Ke,"injectable",{enumerable:!0,get:function(){return mee.injectable}});var fee=KV();Object.defineProperty(Ke,"tagged",{enumerable:!0,get:function(){return fee.tagged}});var hee=OV();Object.defineProperty(Ke,"named",{enumerable:!0,get:function(){return hee.named}});var gee=FV();Object.defineProperty(Ke,"inject",{enumerable:!0,get:function(){return gee.inject}});var vee=lA();Object.defineProperty(Ke,"LazyServiceIdentifer",{enumerable:!0,get:function(){return vee.LazyServiceIdentifer}});var yee=LV();Object.defineProperty(Ke,"optional",{enumerable:!0,get:function(){return yee.optional}});var bee=UV();Object.defineProperty(Ke,"unmanaged",{enumerable:!0,get:function(){return bee.unmanaged}});var Iee=WV();Object.defineProperty(Ke,"multiInject",{enumerable:!0,get:function(){return Iee.multiInject}});var See=VV();Object.defineProperty(Ke,"targetName",{enumerable:!0,get:function(){return See.targetName}});var Cee=JV();Object.defineProperty(Ke,"postConstruct",{enumerable:!0,get:function(){return Cee.postConstruct}});var Eee=$V();Object.defineProperty(Ke,"preDestroy",{enumerable:!0,get:function(){return Eee.preDestroy}});var wee=sA();Object.defineProperty(Ke,"MetadataReader",{enumerable:!0,get:function(){return wee.MetadataReader}});var Pee=Zu();Object.defineProperty(Ke,"id",{enumerable:!0,get:function(){return Pee.id}});var kee=qV();Object.defineProperty(Ke,"interfaces",{enumerable:!0,get:function(){return kee.interfaces}});var xee=kc();Object.defineProperty(Ke,"decorate",{enumerable:!0,get:function(){return xee.decorate}});var _P=kA();Object.defineProperty(Ke,"traverseAncerstors",{enumerable:!0,get:function(){return _P.traverseAncerstors}});Object.defineProperty(Ke,"taggedConstraint",{enumerable:!0,get:function(){return _P.taggedConstraint}});Object.defineProperty(Ke,"namedConstraint",{enumerable:!0,get:function(){return _P.namedConstraint}});Object.defineProperty(Ke,"typeConstraint",{enumerable:!0,get:function(){return _P.typeConstraint}});var Dee=Ch();Object.defineProperty(Ke,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return Dee.getServiceIdentifierAsString}});var _ee=bA();Object.defineProperty(Ke,"multiBindToService",{enumerable:!0,get:function(){return _ee.multiBindToService}})});var QV=O(td=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});td.PythonExtension=td.PVSC_EXTENSION_ID=void 0;var Ree=require("vscode");td.PVSC_EXTENSION_ID="ms-python.python";var Aee;(function(n){async function e(){let t=Ree.extensions.getExtension(td.PVSC_EXTENSION_ID);if(t===void 0)throw new Error("Python extension is not installed or is disabled");return t.isActive||await t.activate(),t.exports}n.api=e})(Aee=td.PythonExtension||(td.PythonExtension={}))});var JA=O((gye,XV)=>{XV.exports=require("util").format});var f2=O(rC=>{rC.get=function(n){var e=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var t={},r=Error.prepareStackTrace;Error.prepareStackTrace=function(o,s){return s},Error.captureStackTrace(t,n||rC.get);var i=t.stack;return Error.prepareStackTrace=r,Error.stackTraceLimit=e,i};rC.parse=function(n){if(!n.stack)return[];var e=this,t=n.stack.split(`
`).slice(1);return t.map(function(r){if(r.match(/^\s*[-]{4,}$/))return e._createParsedCallSite({fileName:r,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var i=r.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(i){var o=null,s=null,a=null,l=null,c=null,u=i[5]==="native";if(i[1]){a=i[1];var d=a.lastIndexOf(".");if(a[d-1]=="."&&d--,d>0){o=a.substr(0,d),s=a.substr(d+1);var f=o.indexOf(".Module");f>0&&(a=a.substr(f+1),o=o.substr(0,f))}l=null}s&&(l=o,c=s),s==="<anonymous>"&&(c=null,a=null);var g={fileName:i[2]||null,lineNumber:parseInt(i[3],10)||null,functionName:a,typeName:l,methodName:c,columnNumber:parseInt(i[4],10)||null,native:u};return e._createParsedCallSite(g)}}).filter(function(r){return!!r})};function tC(n){for(var e in n)this[e]=n[e]}var $ee=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"],qee=["topLevel","eval","native","constructor"];$ee.forEach(function(n){tC.prototype[n]=null,tC.prototype["get"+n[0].toUpperCase()+n.substr(1)]=function(){return this[n]}});qee.forEach(function(n){tC.prototype[n]=!1,tC.prototype["is"+n[0].toUpperCase()+n.substr(1)]=function(){return this[n]}});rC._createParsedCallSite=function(n){return new tC(n)}});var lm=O((St,j2)=>{St=j2.exports=Wt;var Sr;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?Sr=function(){var n=Array.prototype.slice.call(arguments,0);n.unshift("SEMVER"),console.log.apply(console,n)}:Sr=function(){};St.SEMVER_SPEC_VERSION="2.0.0";var oC=256,GP=Number.MAX_SAFE_INTEGER||9007199254740991,zA=16,iie=oC-6,sC=St.re=[],Or=St.safeRe=[],ue=St.src=[],Ot=0,eN="[a-zA-Z0-9-]",QA=[["\\s",1],["\\d",oC],[eN,iie]];function ek(n){for(var e=0;e<QA.length;e++){var t=QA[e][0],r=QA[e][1];n=n.split(t+"*").join(t+"{0,"+r+"}").split(t+"+").join(t+"{1,"+r+"}")}return n}var jh=Ot++;ue[jh]="0|[1-9]\\d*";var Jh=Ot++;ue[Jh]="\\d+";var tN=Ot++;ue[tN]="\\d*[a-zA-Z-]"+eN+"*";var D2=Ot++;ue[D2]="("+ue[jh]+")\\.("+ue[jh]+")\\.("+ue[jh]+")";var _2=Ot++;ue[_2]="("+ue[Jh]+")\\.("+ue[Jh]+")\\.("+ue[Jh]+")";var YA=Ot++;ue[YA]="(?:"+ue[jh]+"|"+ue[tN]+")";var XA=Ot++;ue[XA]="(?:"+ue[Jh]+"|"+ue[tN]+")";var rN=Ot++;ue[rN]="(?:-("+ue[YA]+"(?:\\."+ue[YA]+")*))";var nN=Ot++;ue[nN]="(?:-?("+ue[XA]+"(?:\\."+ue[XA]+")*))";var ZA=Ot++;ue[ZA]=eN+"+";var lC=Ot++;ue[lC]="(?:\\+("+ue[ZA]+"(?:\\."+ue[ZA]+")*))";var iN=Ot++,T2="v?"+ue[D2]+ue[rN]+"?"+ue[lC]+"?";ue[iN]="^"+T2+"$";var oN="[v=\\s]*"+ue[_2]+ue[nN]+"?"+ue[lC]+"?",sN=Ot++;ue[sN]="^"+oN+"$";var Gh=Ot++;ue[Gh]="((?:<|>)?=?)";var zP=Ot++;ue[zP]=ue[Jh]+"|x|X|\\*";var QP=Ot++;ue[QP]=ue[jh]+"|x|X|\\*";var om=Ot++;ue[om]="[v=\\s]*("+ue[QP]+")(?:\\.("+ue[QP]+")(?:\\.("+ue[QP]+")(?:"+ue[rN]+")?"+ue[lC]+"?)?)?";var $h=Ot++;ue[$h]="[v=\\s]*("+ue[zP]+")(?:\\.("+ue[zP]+")(?:\\.("+ue[zP]+")(?:"+ue[nN]+")?"+ue[lC]+"?)?)?";var R2=Ot++;ue[R2]="^"+ue[Gh]+"\\s*"+ue[om]+"$";var A2=Ot++;ue[A2]="^"+ue[Gh]+"\\s*"+ue[$h]+"$";var N2=Ot++;ue[N2]="(?:^|[^\\d])(\\d{1,"+zA+"})(?:\\.(\\d{1,"+zA+"}))?(?:\\.(\\d{1,"+zA+"}))?(?:$|[^\\d])";var tk=Ot++;ue[tk]="(?:~>?)";var qh=Ot++;ue[qh]="(\\s*)"+ue[tk]+"\\s+";sC[qh]=new RegExp(ue[qh],"g");Or[qh]=new RegExp(ek(ue[qh]),"g");var oie="$1~",M2=Ot++;ue[M2]="^"+ue[tk]+ue[om]+"$";var K2=Ot++;ue[K2]="^"+ue[tk]+ue[$h]+"$";var rk=Ot++;ue[rk]="(?:\\^)";var Hh=Ot++;ue[Hh]="(\\s*)"+ue[rk]+"\\s+";sC[Hh]=new RegExp(ue[Hh],"g");Or[Hh]=new RegExp(ek(ue[Hh]),"g");var sie="$1^",O2=Ot++;ue[O2]="^"+ue[rk]+ue[om]+"$";var F2=Ot++;ue[F2]="^"+ue[rk]+ue[$h]+"$";var aN=Ot++;ue[aN]="^"+ue[Gh]+"\\s*("+oN+")$|^$";var lN=Ot++;ue[lN]="^"+ue[Gh]+"\\s*("+T2+")$|^$";var sm=Ot++;ue[sm]="(\\s*)"+ue[Gh]+"\\s*("+oN+"|"+ue[om]+")";sC[sm]=new RegExp(ue[sm],"g");Or[sm]=new RegExp(ek(ue[sm]),"g");var aie="$1$2$3",L2=Ot++;ue[L2]="^\\s*("+ue[om]+")\\s+-\\s+("+ue[om]+")\\s*$";var U2=Ot++;ue[U2]="^\\s*("+ue[$h]+")\\s+-\\s+("+ue[$h]+")\\s*$";var W2=Ot++;ue[W2]="(<|>)?=?\\s*\\*";for(gl=0;gl<Ot;gl++)Sr(gl,ue[gl]),sC[gl]||(sC[gl]=new RegExp(ue[gl]),Or[gl]=new RegExp(ek(ue[gl])));var gl;St.parse=am;function am(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof Wt)return n;if(typeof n!="string"||n.length>oC)return null;var t=e.loose?Or[sN]:Or[iN];if(!t.test(n))return null;try{return new Wt(n,e)}catch{return null}}St.valid=lie;function lie(n,e){var t=am(n,e);return t?t.version:null}St.clean=cie;function cie(n,e){var t=am(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null}St.SemVer=Wt;function Wt(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof Wt){if(n.loose===e.loose)return n;n=n.version}else if(typeof n!="string")throw new TypeError("Invalid Version: "+n);if(n.length>oC)throw new TypeError("version is longer than "+oC+" characters");if(!(this instanceof Wt))return new Wt(n,e);Sr("SemVer",n,e),this.options=e,this.loose=!!e.loose;var t=n.trim().match(e.loose?Or[sN]:Or[iN]);if(!t)throw new TypeError("Invalid Version: "+n);if(this.raw=n,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>GP||this.major<0)throw new TypeError("Invalid major version");if(this.minor>GP||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>GP||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(r){if(/^[0-9]+$/.test(r)){var i=+r;if(i>=0&&i<GP)return i}return r}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}Wt.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};Wt.prototype.toString=function(){return this.version};Wt.prototype.compare=function(n){return Sr("SemVer.compare",this.version,this.options,n),n instanceof Wt||(n=new Wt(n,this.options)),this.compareMain(n)||this.comparePre(n)};Wt.prototype.compareMain=function(n){return n instanceof Wt||(n=new Wt(n,this.options)),Bh(this.major,n.major)||Bh(this.minor,n.minor)||Bh(this.patch,n.patch)};Wt.prototype.comparePre=function(n){if(n instanceof Wt||(n=new Wt(n,this.options)),this.prerelease.length&&!n.prerelease.length)return-1;if(!this.prerelease.length&&n.prerelease.length)return 1;if(!this.prerelease.length&&!n.prerelease.length)return 0;var e=0;do{var t=this.prerelease[e],r=n.prerelease[e];if(Sr("prerelease compare",e,t,r),t===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(t===void 0)return-1;if(t===r)continue;return Bh(t,r)}while(++e)};Wt.prototype.inc=function(n,e){switch(n){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)typeof this.prerelease[t]=="number"&&(this.prerelease[t]++,t=-2);t===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+n)}return this.format(),this.raw=this.version,this};St.inc=uie;function uie(n,e,t,r){typeof t=="string"&&(r=t,t=void 0);try{return new Wt(n,t).inc(e,r).version}catch{return null}}St.diff=die;function die(n,e){if(cN(n,e))return null;var t=am(n),r=am(e),i="";if(t.prerelease.length||r.prerelease.length){i="pre";var o="prerelease"}for(var s in t)if((s==="major"||s==="minor"||s==="patch")&&t[s]!==r[s])return i+s;return o}St.compareIdentifiers=Bh;var x2=/^[0-9]+$/;function Bh(n,e){var t=x2.test(n),r=x2.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1}St.rcompareIdentifiers=pie;function pie(n,e){return Bh(e,n)}St.major=mie;function mie(n,e){return new Wt(n,e).major}St.minor=fie;function fie(n,e){return new Wt(n,e).minor}St.patch=hie;function hie(n,e){return new Wt(n,e).patch}St.compare=Tc;function Tc(n,e,t){return new Wt(n,t).compare(new Wt(e,t))}St.compareLoose=gie;function gie(n,e){return Tc(n,e,!0)}St.rcompare=vie;function vie(n,e,t){return Tc(e,n,t)}St.sort=yie;function yie(n,e){return n.sort(function(t,r){return St.compare(t,r,e)})}St.rsort=bie;function bie(n,e){return n.sort(function(t,r){return St.rcompare(t,r,e)})}St.gt=aC;function aC(n,e,t){return Tc(n,e,t)>0}St.lt=YP;function YP(n,e,t){return Tc(n,e,t)<0}St.eq=cN;function cN(n,e,t){return Tc(n,e,t)===0}St.neq=V2;function V2(n,e,t){return Tc(n,e,t)!==0}St.gte=uN;function uN(n,e,t){return Tc(n,e,t)>=0}St.lte=dN;function dN(n,e,t){return Tc(n,e,t)<=0}St.cmp=XP;function XP(n,e,t,r){switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return cN(n,t,r);case"!=":return V2(n,t,r);case">":return aC(n,t,r);case">=":return uN(n,t,r);case"<":return YP(n,t,r);case"<=":return dN(n,t,r);default:throw new TypeError("Invalid operator: "+e)}}St.Comparator=vs;function vs(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof vs){if(n.loose===!!e.loose)return n;n=n.value}if(!(this instanceof vs))return new vs(n,e);n=n.trim().split(/\s+/).join(" "),Sr("comparator",n,e),this.options=e,this.loose=!!e.loose,this.parse(n),this.semver===cC?this.value="":this.value=this.operator+this.semver.version,Sr("comp",this)}var cC={};vs.prototype.parse=function(n){var e=this.options.loose?Or[aN]:Or[lN],t=n.match(e);if(!t)throw new TypeError("Invalid comparator: "+n);this.operator=t[1],this.operator==="="&&(this.operator=""),t[2]?this.semver=new Wt(t[2],this.options.loose):this.semver=cC};vs.prototype.toString=function(){return this.value};vs.prototype.test=function(n){return Sr("Comparator.test",n,this.options.loose),this.semver===cC?!0:(typeof n=="string"&&(n=new Wt(n,this.options)),XP(n,this.operator,this.semver,this.options))};vs.prototype.intersects=function(n,e){if(!(n instanceof vs))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var t;if(this.operator==="")return t=new on(n.value,e),ZP(this.value,t,e);if(n.operator==="")return t=new on(this.value,e),ZP(n.semver,t,e);var r=(this.operator===">="||this.operator===">")&&(n.operator===">="||n.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(n.operator==="<="||n.operator==="<"),o=this.semver.version===n.semver.version,s=(this.operator===">="||this.operator==="<=")&&(n.operator===">="||n.operator==="<="),a=XP(this.semver,"<",n.semver,e)&&(this.operator===">="||this.operator===">")&&(n.operator==="<="||n.operator==="<"),l=XP(this.semver,">",n.semver,e)&&(this.operator==="<="||this.operator==="<")&&(n.operator===">="||n.operator===">");return r||i||o&&s||a||l};St.Range=on;function on(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof on)return n.loose===!!e.loose&&n.includePrerelease===!!e.includePrerelease?n:new on(n.raw,e);if(n instanceof vs)return new on(n.value,e);if(!(this instanceof on))return new on(n,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=n.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(t){return this.parseRange(t.trim())},this).filter(function(t){return t.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}on.prototype.format=function(){return this.range=this.set.map(function(n){return n.join(" ").trim()}).join("||").trim(),this.range};on.prototype.toString=function(){return this.range};on.prototype.parseRange=function(n){var e=this.options.loose,t=e?Or[U2]:Or[L2];n=n.replace(t,_ie),Sr("hyphen replace",n),n=n.replace(Or[sm],aie),Sr("comparator trim",n,Or[sm]),n=n.replace(Or[qh],oie),n=n.replace(Or[Hh],sie);var r=e?Or[aN]:Or[lN],i=n.split(" ").map(function(o){return Sie(o,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(o){return!!o.match(r)})),i=i.map(function(o){return new vs(o,this.options)},this),i};on.prototype.intersects=function(n,e){if(!(n instanceof on))throw new TypeError("a Range is required");return this.set.some(function(t){return t.every(function(r){return n.set.some(function(i){return i.every(function(o){return r.intersects(o,e)})})})})};St.toComparators=Iie;function Iie(n,e){return new on(n,e).set.map(function(t){return t.map(function(r){return r.value}).join(" ").trim().split(" ")})}function Sie(n,e){return Sr("comp",n,e),n=wie(n,e),Sr("caret",n),n=Cie(n,e),Sr("tildes",n),n=kie(n,e),Sr("xrange",n),n=Die(n,e),Sr("stars",n),n}function Bi(n){return!n||n.toLowerCase()==="x"||n==="*"}function Cie(n,e){return n.trim().split(/\s+/).map(function(t){return Eie(t,e)}).join(" ")}function Eie(n,e){var t=e.loose?Or[K2]:Or[M2];return n.replace(t,function(r,i,o,s,a){Sr("tilde",n,r,i,o,s,a);var l;return Bi(i)?l="":Bi(o)?l=">="+i+".0.0 <"+(+i+1)+".0.0":Bi(s)?l=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":a?(Sr("replaceTilde pr",a),l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0"):l=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0",Sr("tilde return",l),l})}function wie(n,e){return n.trim().split(/\s+/).map(function(t){return Pie(t,e)}).join(" ")}function Pie(n,e){Sr("caret",n,e);var t=e.loose?Or[F2]:Or[O2];return n.replace(t,function(r,i,o,s,a){Sr("caret",n,r,i,o,s,a);var l;return Bi(i)?l="":Bi(o)?l=">="+i+".0.0 <"+(+i+1)+".0.0":Bi(s)?i==="0"?l=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+".0 <"+(+i+1)+".0.0":a?(Sr("replaceCaret pr",a),i==="0"?o==="0"?l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+o+"."+(+s+1):l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+"."+s+"-"+a+" <"+(+i+1)+".0.0"):(Sr("no pr"),i==="0"?o==="0"?l=">="+i+"."+o+"."+s+" <"+i+"."+o+"."+(+s+1):l=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+"."+s+" <"+(+i+1)+".0.0"),Sr("caret return",l),l})}function kie(n,e){return Sr("replaceXRanges",n,e),n.split(/\s+/).map(function(t){return xie(t,e)}).join(" ")}function xie(n,e){n=n.trim();var t=e.loose?Or[A2]:Or[R2];return n.replace(t,function(r,i,o,s,a,l){Sr("xRange",n,r,i,o,s,a,l);var c=Bi(o),u=c||Bi(s),d=u||Bi(a),f=d;return i==="="&&f&&(i=""),c?i===">"||i==="<"?r="<0.0.0":r="*":i&&f?(u&&(s=0),a=0,i===">"?(i=">=",u?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",u?o=+o+1:s=+s+1),r=i+o+"."+s+"."+a):u?r=">="+o+".0.0 <"+(+o+1)+".0.0":d&&(r=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),Sr("xRange return",r),r})}function Die(n,e){return Sr("replaceStars",n,e),n.trim().replace(Or[W2],"")}function _ie(n,e,t,r,i,o,s,a,l,c,u,d,f){return Bi(t)?e="":Bi(r)?e=">="+t+".0.0":Bi(i)?e=">="+t+"."+r+".0":e=">="+e,Bi(l)?a="":Bi(c)?a="<"+(+l+1)+".0.0":Bi(u)?a="<"+l+"."+(+c+1)+".0":d?a="<="+l+"."+c+"."+u+"-"+d:a="<="+a,(e+" "+a).trim()}on.prototype.test=function(n){if(!n)return!1;typeof n=="string"&&(n=new Wt(n,this.options));for(var e=0;e<this.set.length;e++)if(Tie(this.set[e],n,this.options))return!0;return!1};function Tie(n,e,t){for(var r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(r=0;r<n.length;r++)if(Sr(n[r].semver),n[r].semver!==cC&&n[r].semver.prerelease.length>0){var i=n[r].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}St.satisfies=ZP;function ZP(n,e,t){try{e=new on(e,t)}catch{return!1}return e.test(n)}St.maxSatisfying=Rie;function Rie(n,e,t){var r=null,i=null;try{var o=new on(e,t)}catch{return null}return n.forEach(function(s){o.test(s)&&(!r||i.compare(s)===-1)&&(r=s,i=new Wt(r,t))}),r}St.minSatisfying=Aie;function Aie(n,e,t){var r=null,i=null;try{var o=new on(e,t)}catch{return null}return n.forEach(function(s){o.test(s)&&(!r||i.compare(s)===1)&&(r=s,i=new Wt(r,t))}),r}St.minVersion=Nie;function Nie(n,e){n=new on(n,e);var t=new Wt("0.0.0");if(n.test(t)||(t=new Wt("0.0.0-0"),n.test(t)))return t;t=null;for(var r=0;r<n.set.length;++r){var i=n.set[r];i.forEach(function(o){var s=new Wt(o.semver.version);switch(o.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!t||aC(t,s))&&(t=s);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+o.operator)}})}return t&&n.test(t)?t:null}St.validRange=Mie;function Mie(n,e){try{return new on(n,e).range||"*"}catch{return null}}St.ltr=Kie;function Kie(n,e,t){return pN(n,e,"<",t)}St.gtr=Oie;function Oie(n,e,t){return pN(n,e,">",t)}St.outside=pN;function pN(n,e,t,r){n=new Wt(n,r),e=new on(e,r);var i,o,s,a,l;switch(t){case">":i=aC,o=dN,s=YP,a=">",l=">=";break;case"<":i=YP,o=uN,s=aC,a="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ZP(n,e,r))return!1;for(var c=0;c<e.set.length;++c){var u=e.set[c],d=null,f=null;if(u.forEach(function(g){g.semver===cC&&(g=new vs(">=0.0.0")),d=d||g,f=f||g,i(g.semver,d.semver,r)?d=g:s(g.semver,f.semver,r)&&(f=g)}),d.operator===a||d.operator===l||(!f.operator||f.operator===a)&&o(n,f.semver))return!1;if(f.operator===l&&s(n,f.semver))return!1}return!0}St.prerelease=Fie;function Fie(n,e){var t=am(n,e);return t&&t.prerelease.length?t.prerelease:null}St.intersects=Lie;function Lie(n,e,t){return n=new on(n,t),e=new on(e,t),n.intersects(e)}St.coerce=Uie;function Uie(n){if(n instanceof Wt)return n;if(typeof n!="string")return null;var e=n.match(Or[N2]);return e==null?null:am(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var dj=O((OSe,uj)=>{"use strict";uj.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var fj=O(yN=>{"use strict";var toe=Object.prototype.hasOwnProperty,roe;function pj(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function mj(n){try{return encodeURIComponent(n)}catch{return null}}function noe(n){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},r;r=e.exec(n);){var i=pj(r[1]),o=pj(r[2]);i===null||o===null||i in t||(t[i]=o)}return t}function ioe(n,e){e=e||"";var t=[],r,i;typeof e!="string"&&(e="?");for(i in n)if(toe.call(n,i)){if(r=n[i],!r&&(r===null||r===roe||isNaN(r))&&(r=""),i=mj(i),r=mj(r),i===null||r===null)continue;t.push(i+"="+r)}return t.length?e+t.join("&"):""}yN.stringify=ioe;yN.parse=noe});var Cj=O((LSe,Sj)=>{"use strict";var gj=dj(),Ik=fj(),ooe=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,vj=/[\n\r\t]/g,soe=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,yj=/:\d+$/,aoe=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,loe=/^[a-zA-Z]:/;function IN(n){return(n||"").toString().replace(ooe,"")}var bN=[["#","hash"],["?","query"],function(e,t){return bl(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],hj={hash:1,query:1};function bj(n){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};n=n||t;var r={},i=typeof n,o;if(n.protocol==="blob:")r=new Il(unescape(n.pathname),{});else if(i==="string"){r=new Il(n,{});for(o in hj)delete r[o]}else if(i==="object"){for(o in n)o in hj||(r[o]=n[o]);r.slashes===void 0&&(r.slashes=soe.test(n.href))}return r}function bl(n){return n==="file:"||n==="ftp:"||n==="http:"||n==="https:"||n==="ws:"||n==="wss:"}function Ij(n,e){n=IN(n),n=n.replace(vj,""),e=e||{};var t=aoe.exec(n),r=t[1]?t[1].toLowerCase():"",i=!!t[2],o=!!t[3],s=0,a;return i?o?(a=t[2]+t[3]+t[4],s=t[2].length+t[3].length):(a=t[2]+t[4],s=t[2].length):o?(a=t[3]+t[4],s=t[3].length):a=t[4],r==="file:"?s>=2&&(a=a.slice(2)):bl(r)?a=t[4]:r?i&&(a=a.slice(2)):s>=2&&bl(e.protocol)&&(a=t[4]),{protocol:r,slashes:i||bl(r),slashesCount:s,rest:a}}function coe(n,e){if(n==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(n.split("/")),r=t.length,i=t[r-1],o=!1,s=0;r--;)t[r]==="."?t.splice(r,1):t[r]===".."?(t.splice(r,1),s++):s&&(r===0&&(o=!0),t.splice(r,1),s--);return o&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function Il(n,e,t){if(n=IN(n),n=n.replace(vj,""),!(this instanceof Il))return new Il(n,e,t);var r,i,o,s,a,l,c=bN.slice(),u=typeof e,d=this,f=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=Ik.parse),e=bj(e),i=Ij(n||"",e),r=!i.protocol&&!i.slashes,d.slashes=i.slashes||r&&e.slashes,d.protocol=i.protocol||e.protocol||"",n=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||loe.test(n))||!i.slashes&&(i.protocol||i.slashesCount<2||!bl(d.protocol)))&&(c[3]=[/(.*)/,"pathname"]);f<c.length;f++){if(s=c[f],typeof s=="function"){n=s(n,d);continue}o=s[0],l=s[1],o!==o?d[l]=n:typeof o=="string"?(a=o==="@"?n.lastIndexOf(o):n.indexOf(o),~a&&(typeof s[2]=="number"?(d[l]=n.slice(0,a),n=n.slice(a+s[2])):(d[l]=n.slice(a),n=n.slice(0,a)))):(a=o.exec(n))&&(d[l]=a[1],n=n.slice(0,a.index)),d[l]=d[l]||r&&s[3]&&e[l]||"",s[4]&&(d[l]=d[l].toLowerCase())}t&&(d.query=t(d.query)),r&&e.slashes&&d.pathname.charAt(0)!=="/"&&(d.pathname!==""||e.pathname!=="")&&(d.pathname=coe(d.pathname,e.pathname)),d.pathname.charAt(0)!=="/"&&bl(d.protocol)&&(d.pathname="/"+d.pathname),gj(d.port,d.protocol)||(d.host=d.hostname,d.port=""),d.username=d.password="",d.auth&&(a=d.auth.indexOf(":"),~a?(d.username=d.auth.slice(0,a),d.username=encodeURIComponent(decodeURIComponent(d.username)),d.password=d.auth.slice(a+1),d.password=encodeURIComponent(decodeURIComponent(d.password))):d.username=encodeURIComponent(decodeURIComponent(d.auth)),d.auth=d.password?d.username+":"+d.password:d.username),d.origin=d.protocol!=="file:"&&bl(d.protocol)&&d.host?d.protocol+"//"+d.host:"null",d.href=d.toString()}function uoe(n,e,t){var r=this;switch(n){case"query":typeof e=="string"&&e.length&&(e=(t||Ik.parse)(e)),r[n]=e;break;case"port":r[n]=e,gj(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[n]="");break;case"hostname":r[n]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[n]=e,yj.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!t;break;case"pathname":case"hash":if(e){var i=n==="pathname"?"/":"#";r[n]=e.charAt(0)!==i?i+e:e}else r[n]=e;break;case"username":case"password":r[n]=encodeURIComponent(e);break;case"auth":var o=e.indexOf(":");~o?(r.username=e.slice(0,o),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(o+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<bN.length;s++){var a=bN[s];a[4]&&(r[a[1]]=r[a[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&bl(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function doe(n){(!n||typeof n!="function")&&(n=Ik.stringify);var e,t=this,r=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(t.protocol&&t.slashes||bl(t.protocol)?"//":"");return t.username?(o+=t.username,t.password&&(o+=":"+t.password),o+="@"):t.password?(o+=":"+t.password,o+="@"):t.protocol!=="file:"&&bl(t.protocol)&&!r&&t.pathname!=="/"&&(o+="@"),(r[r.length-1]===":"||yj.test(t.hostname)&&!t.port)&&(r+=":"),o+=r+t.pathname,e=typeof t.query=="object"?n(t.query):t.query,e&&(o+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(o+=t.hash),o}Il.prototype={set:uoe,toString:doe};Il.extractProtocol=Ij;Il.location=bj;Il.trimLeft=IN;Il.qs=Ik;Sj.exports=Il});var SN=O((WSe,Pj)=>{"use strict";var Ej=Array.isArray,wj=Object.keys,poe=Object.prototype.hasOwnProperty;Pj.exports=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Ej(e),i=Ej(t),o,s,a;if(r&&i){if(s=e.length,s!=t.length)return!1;for(o=s;o--!==0;)if(!n(e[o],t[o]))return!1;return!0}if(r!=i)return!1;var l=e instanceof Date,c=t instanceof Date;if(l!=c)return!1;if(l&&c)return e.getTime()==t.getTime();var u=e instanceof RegExp,d=t instanceof RegExp;if(u!=d)return!1;if(u&&d)return e.toString()==t.toString();var f=wj(e);if(s=f.length,s!==wj(t).length)return!1;for(o=s;o--!==0;)if(!poe.call(t,f[o]))return!1;for(o=s;o--!==0;)if(a=f[o],!n(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}});var VN=O(xd=>{"use strict";Object.defineProperty(xd,"__esModule",{value:!0});xd.TargetPopulation=xd.Filters=xd.VSCodeFilterProvider=void 0;var tx=require("vscode"),WN=class n{constructor(e,t,r){this.extensionName=e,this.extensionVersion=t,this.targetPopulation=r}static trimVersionSuffix(e){let t=/\-[a-zA-Z0-9]+$/;return e.split(t)[0]}getFilterValue(e){switch(e){case Rl.ApplicationVersion:return n.trimVersionSuffix(tx.version);case Rl.Build:return tx.env.appName;case Rl.ClientId:return tx.env.machineId;case Rl.ExtensionName:return this.extensionName;case Rl.ExtensionVersion:return n.trimVersionSuffix(this.extensionVersion);case Rl.Language:return tx.env.language;case Rl.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let e=new Map,t=Object.values(Rl);for(let r of t)e.set(r,this.getFilterValue(r));return e}};xd.VSCodeFilterProvider=WN;var Rl;(function(n){n.Market="X-MSEdge-Market",n.CorpNet="X-FD-Corpnet",n.ApplicationVersion="X-VSCode-AppVersion",n.Build="X-VSCode-Build",n.ClientId="X-MSEdge-ClientId",n.ExtensionName="X-VSCode-ExtensionName",n.ExtensionVersion="X-VSCode-ExtensionVersion",n.Language="X-VSCode-Language",n.TargetPopulation="X-VSCode-TargetPopulation"})(Rl||(xd.Filters=Rl={}));var w9;(function(n){n.Team="team",n.Internal="internal",n.Insiders="insider",n.Public="public"})(w9||(xd.TargetPopulation=w9={}))});var P9=O(rx=>{"use strict";Object.defineProperty(rx,"__esModule",{value:!0});rx.BaseFeatureProvider=void 0;var jN=class{constructor(e){this.telemetry=e,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let e=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,e}};rx.BaseFeatureProvider=jN});var k9=O(nx=>{"use strict";Object.defineProperty(nx,"__esModule",{value:!0});nx.FilteredFeatureProvider=void 0;var Ooe=P9(),JN=class extends Ooe.BaseFeatureProvider{constructor(e,t){super(e),this.telemetry=e,this.filterProviders=t,this.cachedTelemetryEvents=[]}getFilters(){let e=new Map;for(let t of this.filterProviders){let r=t.getFilters();for(let i of r.keys()){let o=r.get(i);e.set(i,o)}}return e}PostEventToTelemetry(e){if(this.cachedTelemetryEvents.includes(e))return;let t=JSON.stringify(e);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",t]])),this.cachedTelemetryEvents.push(e)}};nx.FilteredFeatureProvider=JN});var x9=O(Dd=>{"use strict";Object.defineProperty(Dd,"__esModule",{value:!0});Dd.TasApiFeatureProvider=Dd.TASAPI_FETCHERROR_EVENTNAME=void 0;var Foe=k9();Dd.TASAPI_FETCHERROR_EVENTNAME="call-tas-error";var BN="ErrorType",$N=class extends Foe.FilteredFeatureProvider{constructor(e,t,r){super(t,r),this.httpClient=e,this.telemetry=t,this.filterProviders=r}async fetch(){let e=this.getFilters(),t={};for(let a of e.keys()){let l=e.get(a);t[a]=l}let r;try{r=await this.httpClient.get({headers:t})}catch(a){let l=a,c=new Map;l.responseReceived&&!l.responseOk?c.set(BN,"ServerError"):l.responseReceived===!1?c.set(BN,"NoResponse"):c.set(BN,"GenericError"),this.telemetry.postEvent(Dd.TASAPI_FETCHERROR_EVENTNAME,c)}if(!r)throw Error(Dd.TASAPI_FETCHERROR_EVENTNAME);e.keys.length>0&&this.PostEventToTelemetry(t);let i=r.data,o=i.Configs,s=[];for(let a of o)if(a.Parameters)for(let l of Object.keys(a.Parameters)){let c=l+(a.Parameters[l]?"":"cf");s.includes(c)||s.push(c)}return{features:s,assignmentContext:i.AssignmentContext,configs:o}}};Dd.TasApiFeatureProvider=$N});var D9=O(Tg=>{"use strict";Object.defineProperty(Tg,"__esModule",{value:!0});Tg.HttpClient=Tg.FetchError=void 0;var _g=class extends Error{constructor(e,t,r){super(e),this.responseReceived=t,this.responseOk=r}};Tg.FetchError=_g;var qN=class{constructor(e){this.endpoint=e}async get(e){let t=await fetch(this.endpoint,{method:"GET",headers:e?.headers});if(!t)throw new _g("No response received",!1);if(!t.ok)throw new _g("Response not ok",!0,!1);let r=await t.json();if(!r)throw new _g("No data received",!1);return{data:r}}};Tg.HttpClient=qN});var _9=O(ix=>{"use strict";Object.defineProperty(ix,"__esModule",{value:!0});ix.MemoryKeyValueStorage=void 0;var HN=class{constructor(){this.storage=new Map}async getValue(e,t){return this.storage.has(e)?await Promise.resolve(this.storage.get(e)):await Promise.resolve(t||void 0)}setValue(e,t){this.storage.set(e,t)}};ix.MemoryKeyValueStorage=HN});var T9=O(ox=>{"use strict";Object.defineProperty(ox,"__esModule",{value:!0});ox.ExperimentationServiceBase=void 0;var Loe=_9(),GN=class{get features(){return this._features}set features(e){this._features=e,this.telemetry&&this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext)}constructor(e,t,r,i,o){this.telemetry=e,this.assignmentContextTelemetryPropertyName=t,this.telemetryEventName=r,this.storageKey=i,this.storage=o,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(o=new Loe.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((s,a)=>{this.resolveInitialFetchPromise=s})}async getFeaturesAsync(e=!1){if(this.fetchPromise!=null){try{await this.fetchPromise}catch{}return this.features}if(!this.featureProviders||this.featureProviders.length===0)return Promise.resolve({features:[],assignmentContext:"",configs:[]});try{this.fetchPromise=Promise.all(this.featureProviders.map(async r=>await r.getFeatures()));let t=await this.fetchPromise;this.updateFeatures(t,e)}catch{}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(e,t=!1){let r={features:[],assignmentContext:"",configs:[]};for(let i of e){for(let o of i.features)r.features.includes(o)||r.features.push(o);for(let o of i.configs){let s=r.configs.find(a=>a.Id===o.Id);s?s.Parameters=Object.assign(Object.assign({},s.Parameters),o.Parameters):r.configs.push(o)}r.assignmentContext+=i.assignmentContext}(t||!this.featuresConsumed)&&(this.features=r),this.storage&&this.storage.setValue(this.storageKey,r)}async loadCachedFeatureData(){let e;this.storage&&(e=await this.storage.getValue(this.storageKey),e!==void 0&&e.configs===void 0&&(e.configs=[])),this.features.features.length===0&&(this.features=e||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(e){return this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isCachedFlightEnabled(e){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isFlightEnabledAsync(e){let t=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(e),t.features.includes(e)}getTreatmentVariable(e,t){this.featuresConsumed=!0,this.PostEventToTelemetry(`${e}.${t}`);let r=this.features.configs.find(i=>i.Id===e);return r?.Parameters[t]}async getTreatmentVariableAsync(e,t,r){if(r){let i=this.featuresConsumed,o=this.getTreatmentVariable(e,t);if(o===void 0)this.featuresConsumed=i;else return o}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(e,t)}PostEventToTelemetry(e){this.cachedTelemetryEvents.includes(e)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",e]])),this.cachedTelemetryEvents.push(e))}invokeInit(){this.init()}addFeatureProvider(...e){if(!(e==null||this.featureProviders==null))for(let t of e)this.featureProviders.push(t)}};ox.ExperimentationServiceBase=GN});var R9=O(sx=>{"use strict";Object.defineProperty(sx,"__esModule",{value:!0});sx.PollingService=void 0;var zN=class{constructor(e){this.fetchInterval=e}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(e){this.onTick=e}StartPolling(e=!1){this.intervalHandle&&this.StopPolling(),this.onTick!=null&&(e&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}};sx.PollingService=zN});var A9=O(ax=>{"use strict";Object.defineProperty(ax,"__esModule",{value:!0});ax.ExperimentationServiceAutoPolling=void 0;var Uoe=T9(),Woe=R9(),QN=class extends Uoe.ExperimentationServiceBase{constructor(e,t,r,i,o,s,a){if(super(e,i,o,s,a),this.telemetry=e,this.filterProviders=t,this.refreshRateMs=r,this.assignmentContextTelemetryPropertyName=i,this.telemetryEventName=o,this.storageKey=s,this.storage=a,r<1e3&&r!==0)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");r>0&&(this.pollingService=new Woe.PollingService(r),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(e=!1){if(this.pollingService){this.pollingService.StopPolling();let t=await super.getFeaturesAsync(e);return this.pollingService.StartPolling(),t}else return await super.getFeaturesAsync(e)}};ax.ExperimentationServiceAutoPolling=QN});var N9=O(cx=>{"use strict";Object.defineProperty(cx,"__esModule",{value:!0});cx.ExperimentationService=void 0;var Voe=x9(),joe=D9(),Joe=A9(),lx=class extends Joe.ExperimentationServiceAutoPolling{constructor(e){super(e.telemetry,e.filterProviders||[],e.refetchInterval!=null?e.refetchInterval:0,e.assignmentContextTelemetryPropertyName,e.telemetryEventName,e.storageKey,e.keyValueStorage),this.options=e,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new Voe.TasApiFeatureProvider(new joe.HttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}};cx.ExperimentationService=lx;lx.REFRESH_RATE_IN_MINUTES=30});var M9=O(ux=>{"use strict";Object.defineProperty(ux,"__esModule",{value:!0});ux.ExperimentationService=void 0;var Boe=N9();Object.defineProperty(ux,"ExperimentationService",{enumerable:!0,get:function(){return Boe.ExperimentationService}})});var K9=O(dx=>{"use strict";Object.defineProperty(dx,"__esModule",{value:!0});dx.MementoKeyValueStorage=void 0;var YN=class{constructor(e){this.mementoGlobalStorage=e}async getValue(e,t){return await this.mementoGlobalStorage.get(e)||t}setValue(e,t){this.mementoGlobalStorage.update(e,t)}};dx.MementoKeyValueStorage=YN});var O9=O(ZN=>{"use strict";Object.defineProperty(ZN,"__esModule",{value:!0});var XN=class{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,t){}getTreatmentVariableAsync(e,t){return Promise.resolve(void 0)}};ZN.default=XN});var L9=O(Rg=>{"use strict";Object.defineProperty(Rg,"__esModule",{value:!0});Rg.getExperimentationServiceAsync=Rg.getExperimentationService=void 0;var $oe=VN(),qoe=M9(),eM=require("vscode"),Hoe=K9(),Goe=O9(),zoe="https://default.exp-tas.com/vscode/ab",Qoe="query-expfeature",Yoe="abexp.assignmentcontext",Xoe="VSCode.ABExp.FeatureData",Zoe=1e3*60*30;function F9(n,e,t,r,i,...o){if(!i)throw new Error("Memento storage was not provided.");let s=eM.workspace.getConfiguration("telemetry");if(!(eM.env.isTelemetryEnabled===void 0?s.get("enableTelemetry",!0):eM.env.isTelemetryEnabled))return new Goe.default;let c=[new $oe.VSCodeFilterProvider(n,e,t),...o],u=new Hoe.MementoKeyValueStorage(i);return new qoe.ExperimentationService({filterProviders:c,telemetry:r,storageKey:Xoe,keyValueStorage:u,featuresTelemetryPropertyName:"",assignmentContextTelemetryPropertyName:Yoe,telemetryEventName:Qoe,endpoint:zoe,refetchInterval:Zoe})}Rg.getExperimentationService=F9;async function ese(n,e,t,r,i,...o){let s=F9(n,e,t,r,i,...o);return await s.initializePromise,s}Rg.getExperimentationServiceAsync=ese});var W9=O(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});_d.TargetPopulation=_d.getExperimentationServiceAsync=_d.getExperimentationService=void 0;var U9=L9();Object.defineProperty(_d,"getExperimentationService",{enumerable:!0,get:function(){return U9.getExperimentationService}});Object.defineProperty(_d,"getExperimentationServiceAsync",{enumerable:!0,get:function(){return U9.getExperimentationServiceAsync}});var tse=VN();Object.defineProperty(_d,"TargetPopulation",{enumerable:!0,get:function(){return tse.TargetPopulation}})});var Y9=O((r_e,Q9)=>{"use strict";function ise(){let n=[].slice.call(arguments).filter(t=>t),e=n.shift();return n.forEach(t=>{Object.keys(t).forEach(r=>{e[r]=t[r]})}),e}Q9.exports=ise});var ho=O(nM=>{"use strict";nM.fromCallback=function(n){return Object.defineProperty(function(){if(typeof arguments[arguments.length-1]=="function")n.apply(this,arguments);else return new Promise((e,t)=>{arguments[arguments.length]=(r,i)=>{if(r)return t(r);e(i)},arguments.length++,n.apply(this,arguments)})},"name",{value:n.name})};nM.fromPromise=function(n){return Object.defineProperty(function(){let e=arguments[arguments.length-1];if(typeof e!="function")return n.apply(this,arguments);n.apply(this,arguments).then(t=>e(null,t),e)},"name",{value:n.name})}});var Z9=O((i_e,X9)=>{var Nd=require("constants"),ose=process.cwd,yx=null,sse=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return yx||(yx=ose.call(process)),yx};try{process.cwd()}catch{}typeof process.chdir=="function"&&(iM=process.chdir,process.chdir=function(n){yx=null,iM.call(process,n)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,iM));var iM;X9.exports=ase;function ase(n){Nd.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(n),n.lutimes||t(n),n.chown=o(n.chown),n.fchown=o(n.fchown),n.lchown=o(n.lchown),n.chmod=r(n.chmod),n.fchmod=r(n.fchmod),n.lchmod=r(n.lchmod),n.chownSync=s(n.chownSync),n.fchownSync=s(n.fchownSync),n.lchownSync=s(n.lchownSync),n.chmodSync=i(n.chmodSync),n.fchmodSync=i(n.fchmodSync),n.lchmodSync=i(n.lchmodSync),n.stat=a(n.stat),n.fstat=a(n.fstat),n.lstat=a(n.lstat),n.statSync=l(n.statSync),n.fstatSync=l(n.fstatSync),n.lstatSync=l(n.lstatSync),n.chmod&&!n.lchmod&&(n.lchmod=function(u,d,f){f&&process.nextTick(f)},n.lchmodSync=function(){}),n.chown&&!n.lchown&&(n.lchown=function(u,d,f,g){g&&process.nextTick(g)},n.lchownSync=function(){}),sse==="win32"&&(n.rename=typeof n.rename!="function"?n.rename:function(u){function d(f,g,b){var I=Date.now(),w=0;u(f,g,function D(A){if(A&&(A.code==="EACCES"||A.code==="EPERM"||A.code==="EBUSY")&&Date.now()-I<6e4){setTimeout(function(){n.stat(g,function(T,$){T&&T.code==="ENOENT"?u(f,g,D):b(A)})},w),w<100&&(w+=10);return}b&&b(A)})}return Object.setPrototypeOf&&Object.setPrototypeOf(d,u),d}(n.rename)),n.read=typeof n.read!="function"?n.read:function(u){function d(f,g,b,I,w,D){var A;if(D&&typeof D=="function"){var T=0;A=function($,ne,H){if($&&$.code==="EAGAIN"&&T<10)return T++,u.call(n,f,g,b,I,w,A);D.apply(this,arguments)}}return u.call(n,f,g,b,I,w,A)}return Object.setPrototypeOf&&Object.setPrototypeOf(d,u),d}(n.read),n.readSync=typeof n.readSync!="function"?n.readSync:function(u){return function(d,f,g,b,I){for(var w=0;;)try{return u.call(n,d,f,g,b,I)}catch(D){if(D.code==="EAGAIN"&&w<10){w++;continue}throw D}}}(n.readSync);function e(u){u.lchmod=function(d,f,g){u.open(d,Nd.O_WRONLY|Nd.O_SYMLINK,f,function(b,I){if(b){g&&g(b);return}u.fchmod(I,f,function(w){u.close(I,function(D){g&&g(w||D)})})})},u.lchmodSync=function(d,f){var g=u.openSync(d,Nd.O_WRONLY|Nd.O_SYMLINK,f),b=!0,I;try{I=u.fchmodSync(g,f),b=!1}finally{if(b)try{u.closeSync(g)}catch{}else u.closeSync(g)}return I}}function t(u){Nd.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(d,f,g,b){u.open(d,Nd.O_SYMLINK,function(I,w){if(I){b&&b(I);return}u.futimes(w,f,g,function(D){u.close(w,function(A){b&&b(D||A)})})})},u.lutimesSync=function(d,f,g){var b=u.openSync(d,Nd.O_SYMLINK),I,w=!0;try{I=u.futimesSync(b,f,g),w=!1}finally{if(w)try{u.closeSync(b)}catch{}else u.closeSync(b)}return I}):u.futimes&&(u.lutimes=function(d,f,g,b){b&&process.nextTick(b)},u.lutimesSync=function(){})}function r(u){return u&&function(d,f,g){return u.call(n,d,f,function(b){c(b)&&(b=null),g&&g.apply(this,arguments)})}}function i(u){return u&&function(d,f){try{return u.call(n,d,f)}catch(g){if(!c(g))throw g}}}function o(u){return u&&function(d,f,g,b){return u.call(n,d,f,g,function(I){c(I)&&(I=null),b&&b.apply(this,arguments)})}}function s(u){return u&&function(d,f,g){try{return u.call(n,d,f,g)}catch(b){if(!c(b))throw b}}}function a(u){return u&&function(d,f,g){typeof f=="function"&&(g=f,f=null);function b(I,w){w&&(w.uid<0&&(w.uid+=4294967296),w.gid<0&&(w.gid+=4294967296)),g&&g.apply(this,arguments)}return f?u.call(n,d,f,b):u.call(n,d,b)}}function l(u){return u&&function(d,f){var g=f?u.call(n,d,f):u.call(n,d);return g&&(g.uid<0&&(g.uid+=4294967296),g.gid<0&&(g.gid+=4294967296)),g}}function c(u){if(!u||u.code==="ENOSYS")return!0;var d=!process.getuid||process.getuid()!==0;return!!(d&&(u.code==="EINVAL"||u.code==="EPERM"))}}});var rJ=O((o_e,tJ)=>{var eJ=require("stream").Stream;tJ.exports=lse;function lse(n){return{ReadStream:e,WriteStream:t};function e(r,i){if(!(this instanceof e))return new e(r,i);eJ.call(this);var o=this;this.path=r,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,l=s.length;a<l;a++){var c=s[a];this[c]=i[c]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}n.open(this.path,this.flags,this.mode,function(u,d){if(u){o.emit("error",u),o.readable=!1;return}o.fd=d,o.emit("open",d),o._read()})}function t(r,i){if(!(this instanceof t))return new t(r,i);eJ.call(this),this.path=r,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var l=o[s];this[l]=i[l]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=n.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var iJ=O((s_e,nJ)=>{"use strict";nJ.exports=use;var cse=Object.getPrototypeOf||function(n){return n.__proto__};function use(n){if(n===null||typeof n!="object")return n;if(n instanceof Object)var e={__proto__:cse(n)};else var e=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}});var xn=O((a_e,aM)=>{var an=require("fs"),dse=Z9(),pse=rJ(),mse=iJ(),bx=require("util"),ni,Sx;typeof Symbol=="function"&&typeof Symbol.for=="function"?(ni=Symbol.for("graceful-fs.queue"),Sx=Symbol.for("graceful-fs.previous")):(ni="___graceful-fs.queue",Sx="___graceful-fs.previous");function fse(){}function aJ(n,e){Object.defineProperty(n,ni,{get:function(){return e}})}var Sm=fse;bx.debuglog?Sm=bx.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Sm=function(){var n=bx.format.apply(bx,arguments);n="GFS4: "+n.split(/\n/).join(`
GFS4: `),console.error(n)});an[ni]||(oJ=global[ni]||[],aJ(an,oJ),an.close=function(n){function e(t,r){return n.call(an,t,function(i){i||sJ(),typeof r=="function"&&r.apply(this,arguments)})}return Object.defineProperty(e,Sx,{value:n}),e}(an.close),an.closeSync=function(n){function e(t){n.apply(an,arguments),sJ()}return Object.defineProperty(e,Sx,{value:n}),e}(an.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Sm(an[ni]),require("assert").equal(an[ni].length,0)}));var oJ;global[ni]||aJ(global,an[ni]);aM.exports=oM(mse(an));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!an.__patched&&(aM.exports=oM(an),an.__patched=!0);function oM(n){dse(n),n.gracefulify=oM,n.createReadStream=ne,n.createWriteStream=H;var e=n.readFile;n.readFile=t;function t(Y,Ie,Oe){return typeof Ie=="function"&&(Oe=Ie,Ie=null),pt(Y,Ie,Oe);function pt(mt,kt,ee,Pe){return e(mt,kt,function(_e){_e&&(_e.code==="EMFILE"||_e.code==="ENFILE")?Lg([pt,[mt,kt,ee],_e,Pe||Date.now(),Date.now()]):typeof ee=="function"&&ee.apply(this,arguments)})}}var r=n.writeFile;n.writeFile=i;function i(Y,Ie,Oe,pt){return typeof Oe=="function"&&(pt=Oe,Oe=null),mt(Y,Ie,Oe,pt);function mt(kt,ee,Pe,_e,he){return r(kt,ee,Pe,function(gt){gt&&(gt.code==="EMFILE"||gt.code==="ENFILE")?Lg([mt,[kt,ee,Pe,_e],gt,he||Date.now(),Date.now()]):typeof _e=="function"&&_e.apply(this,arguments)})}}var o=n.appendFile;o&&(n.appendFile=s);function s(Y,Ie,Oe,pt){return typeof Oe=="function"&&(pt=Oe,Oe=null),mt(Y,Ie,Oe,pt);function mt(kt,ee,Pe,_e,he){return o(kt,ee,Pe,function(gt){gt&&(gt.code==="EMFILE"||gt.code==="ENFILE")?Lg([mt,[kt,ee,Pe,_e],gt,he||Date.now(),Date.now()]):typeof _e=="function"&&_e.apply(this,arguments)})}}var a=n.copyFile;a&&(n.copyFile=l);function l(Y,Ie,Oe,pt){return typeof Oe=="function"&&(pt=Oe,Oe=0),mt(Y,Ie,Oe,pt);function mt(kt,ee,Pe,_e,he){return a(kt,ee,Pe,function(gt){gt&&(gt.code==="EMFILE"||gt.code==="ENFILE")?Lg([mt,[kt,ee,Pe,_e],gt,he||Date.now(),Date.now()]):typeof _e=="function"&&_e.apply(this,arguments)})}}var c=n.readdir;n.readdir=d;var u=/^v[0-5]\./;function d(Y,Ie,Oe){typeof Ie=="function"&&(Oe=Ie,Ie=null);var pt=u.test(process.version)?function(ee,Pe,_e,he){return c(ee,mt(ee,Pe,_e,he))}:function(ee,Pe,_e,he){return c(ee,Pe,mt(ee,Pe,_e,he))};return pt(Y,Ie,Oe);function mt(kt,ee,Pe,_e){return function(he,gt){he&&(he.code==="EMFILE"||he.code==="ENFILE")?Lg([pt,[kt,ee,Pe],he,_e||Date.now(),Date.now()]):(gt&&gt.sort&&gt.sort(),typeof Pe=="function"&&Pe.call(this,he,gt))}}}if(process.version.substr(0,4)==="v0.8"){var f=pse(n);D=f.ReadStream,T=f.WriteStream}var g=n.ReadStream;g&&(D.prototype=Object.create(g.prototype),D.prototype.open=A);var b=n.WriteStream;b&&(T.prototype=Object.create(b.prototype),T.prototype.open=$),Object.defineProperty(n,"ReadStream",{get:function(){return D},set:function(Y){D=Y},enumerable:!0,configurable:!0}),Object.defineProperty(n,"WriteStream",{get:function(){return T},set:function(Y){T=Y},enumerable:!0,configurable:!0});var I=D;Object.defineProperty(n,"FileReadStream",{get:function(){return I},set:function(Y){I=Y},enumerable:!0,configurable:!0});var w=T;Object.defineProperty(n,"FileWriteStream",{get:function(){return w},set:function(Y){w=Y},enumerable:!0,configurable:!0});function D(Y,Ie){return this instanceof D?(g.apply(this,arguments),this):D.apply(Object.create(D.prototype),arguments)}function A(){var Y=this;ae(Y.path,Y.flags,Y.mode,function(Ie,Oe){Ie?(Y.autoClose&&Y.destroy(),Y.emit("error",Ie)):(Y.fd=Oe,Y.emit("open",Oe),Y.read())})}function T(Y,Ie){return this instanceof T?(b.apply(this,arguments),this):T.apply(Object.create(T.prototype),arguments)}function $(){var Y=this;ae(Y.path,Y.flags,Y.mode,function(Ie,Oe){Ie?(Y.destroy(),Y.emit("error",Ie)):(Y.fd=Oe,Y.emit("open",Oe))})}function ne(Y,Ie){return new n.ReadStream(Y,Ie)}function H(Y,Ie){return new n.WriteStream(Y,Ie)}var oe=n.open;n.open=ae;function ae(Y,Ie,Oe,pt){return typeof Oe=="function"&&(pt=Oe,Oe=null),mt(Y,Ie,Oe,pt);function mt(kt,ee,Pe,_e,he){return oe(kt,ee,Pe,function(gt,Oi){gt&&(gt.code==="EMFILE"||gt.code==="ENFILE")?Lg([mt,[kt,ee,Pe,_e],gt,he||Date.now(),Date.now()]):typeof _e=="function"&&_e.apply(this,arguments)})}}return n}function Lg(n){Sm("ENQUEUE",n[0].name,n[1]),an[ni].push(n),sM()}var Ix;function sJ(){for(var n=Date.now(),e=0;e<an[ni].length;++e)an[ni][e].length>2&&(an[ni][e][3]=n,an[ni][e][4]=n);sM()}function sM(){if(clearTimeout(Ix),Ix=void 0,an[ni].length!==0){var n=an[ni].shift(),e=n[0],t=n[1],r=n[2],i=n[3],o=n[4];if(i===void 0)Sm("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Sm("TIMEOUT",e.name,t);var s=t.pop();typeof s=="function"&&s.call(null,r)}else{var a=Date.now()-o,l=Math.max(o-i,1),c=Math.min(l*1.2,100);a>=c?(Sm("RETRY",e.name,t),e.apply(null,t.concat([i]))):an[ni].push(n)}Ix===void 0&&(Ix=setTimeout(sM,0))}}});var lM=O(Ug=>{var hse=ho().fromCallback,pa=xn(),gse=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(n=>typeof pa[n]=="function");Object.keys(pa).forEach(n=>{Ug[n]=pa[n]});gse.forEach(n=>{Ug[n]=hse(pa[n])});Ug.exists=function(n,e){return typeof e=="function"?pa.exists(n,e):new Promise(t=>pa.exists(n,t))};Ug.read=function(n,e,t,r,i,o){return typeof o=="function"?pa.read(n,e,t,r,i,o):new Promise((s,a)=>{pa.read(n,e,t,r,i,(l,c,u)=>{if(l)return a(l);s({bytesRead:c,buffer:u})})})};Ug.write=function(n,e,t,r,i,o){return typeof arguments[arguments.length-1]=="function"?pa.write(n,e,t,r,i,o):typeof e=="string"?new Promise((s,a)=>{pa.write(n,e,t,r,(l,c,u)=>{if(l)return a(l);s({bytesWritten:c,buffer:u})})}):new Promise((s,a)=>{pa.write(n,e,t,r,i,(l,c,u)=>{if(l)return a(l);s({bytesWritten:c,buffer:u})})})}});var uJ=O((c_e,cJ)=>{"use strict";var Uo=xn(),lJ=require("os"),Cx=require("path");function vse(){let n=Cx.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));n=Cx.join(lJ.tmpdir(),n);let e=new Date(1435410243862);Uo.writeFileSync(n,"https://github.com/jprichardson/node-fs-extra/pull/141");let t=Uo.openSync(n,"r+");return Uo.futimesSync(t,e,e),Uo.closeSync(t),Uo.statSync(n).mtime>1435410243e3}function yse(n){let e=Cx.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));e=Cx.join(lJ.tmpdir(),e);let t=new Date(1435410243862);Uo.writeFile(e,"https://github.com/jprichardson/node-fs-extra/pull/141",r=>{if(r)return n(r);Uo.open(e,"r+",(i,o)=>{if(i)return n(i);Uo.futimes(o,t,t,s=>{if(s)return n(s);Uo.close(o,a=>{if(a)return n(a);Uo.stat(e,(l,c)=>{if(l)return n(l);n(null,c.mtime>1435410243e3)})})})})})}function bse(n){if(typeof n=="number")return Math.floor(n/1e3)*1e3;if(n instanceof Date)return new Date(Math.floor(n.getTime()/1e3)*1e3);throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")}function Ise(n,e,t,r){Uo.open(n,"r+",(i,o)=>{if(i)return r(i);Uo.futimes(o,e,t,s=>{Uo.close(o,a=>{r&&r(s||a)})})})}cJ.exports={hasMillisRes:yse,hasMillisResSync:vse,timeRemoveMillis:bse,utimesMillis:Ise}});var cM=O((u_e,dJ)=>{var Wo=xn(),_C=require("path"),Sse=uJ();function Cse(n,e,t,r){r||(r=t,t={});var i=process.cwd(),o=_C.resolve(i,n),s=_C.resolve(i,e),a=t.filter,l=t.transform,c=t.overwrite;c===void 0&&(c=t.clobber),c===void 0&&(c=!0);var u=t.errorOnExist,d=t.dereference,f=t.preserveTimestamps===!0,g=0,b=0,I=0,w=!1;D(o);function D(ee){if(g++,a){if(a instanceof RegExp){if(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),!a.test(ee))return kt(!0)}else if(typeof a=="function"&&!a(ee,e))return kt(!0)}return A(ee)}function A(ee){var Pe=d?Wo.stat:Wo.lstat;I++,Pe(ee,function(_e,he){if(_e)return mt(_e);var gt={name:ee,mode:he.mode,mtime:he.mtime,atime:he.atime,stats:he};if(he.isDirectory())return H(gt);if(he.isFile()||he.isCharacterDevice()||he.isBlockDevice())return T(gt);if(he.isSymbolicLink())return Y(ee)})}function T(ee){var Pe=ee.name.replace(o,s.replace("$","$$$$"));pt(Pe,function(_e){_e?$(ee,Pe):c?ne(Pe,function(){$(ee,Pe)}):u?mt(new Error(Pe+" already exists")):kt()})}function $(ee,Pe){var _e=Wo.createReadStream(ee.name),he=Wo.createWriteStream(Pe,{mode:ee.mode});_e.on("error",mt),he.on("error",mt),l?l(_e,he,ee):he.on("open",function(){_e.pipe(he)}),he.once("close",function(){Wo.chmod(Pe,ee.mode,function(gt){if(gt)return mt(gt);f?Sse.utimesMillis(Pe,ee.atime,ee.mtime,function(Oi){return Oi?mt(Oi):kt()}):kt()})})}function ne(ee,Pe){Wo.unlink(ee,function(_e){return _e?mt(_e):Pe()})}function H(ee){var Pe=ee.name.replace(o,s.replace("$","$$$$"));pt(Pe,function(_e){if(_e)return oe(ee,Pe);ae(ee.name)})}function oe(ee,Pe){Wo.mkdir(Pe,ee.mode,function(_e){if(_e)return mt(_e);Wo.chmod(Pe,ee.mode,function(he){if(he)return mt(he);ae(ee.name)})})}function ae(ee){Wo.readdir(ee,function(Pe,_e){return Pe?mt(Pe):(_e.forEach(function(he){D(_C.join(ee,he))}),kt())})}function Y(ee){var Pe=ee.replace(o,s);Wo.readlink(ee,function(_e,he){if(_e)return mt(_e);Ie(he,Pe)})}function Ie(ee,Pe){d&&(ee=_C.resolve(i,ee)),pt(Pe,function(_e){if(_e)return Oe(ee,Pe);Wo.readlink(Pe,function(he,gt){return he?mt(he):(d&&(gt=_C.resolve(i,gt)),gt===ee?kt():ne(Pe,function(){Oe(ee,Pe)}))})})}function Oe(ee,Pe){Wo.symlink(ee,Pe,function(_e){return _e?mt(_e):kt()})}function pt(ee,Pe){Wo.lstat(ee,function(_e){return _e&&_e.code==="ENOENT"?Pe(!0):Pe(!1)})}function mt(ee){if(!w&&r!==void 0)return w=!0,r(ee)}function kt(ee){if(ee||I--,b++,g===b&&I===0&&r!==void 0)return r(null)}}dJ.exports=Cse});var dM=O((d_e,mJ)=>{"use strict";var uM=require("path");function pJ(n){return n=uM.normalize(uM.resolve(n)).split(uM.sep),n.length>0?n[0]:null}var Ese=/[<>:"|?*]/;function wse(n){let e=pJ(n);return n=n.replace(e,""),Ese.test(n)}mJ.exports={getRootPath:pJ,invalidWin32Path:wse}});var hJ=O((p_e,fJ)=>{"use strict";var Pse=xn(),pM=require("path"),kse=dM().invalidWin32Path,xse=parseInt("0777",8);function mM(n,e,t,r){if(typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e}),process.platform==="win32"&&kse(n)){let s=new Error(n+" contains invalid WIN32 path characters.");return s.code="EINVAL",t(s)}let i=e.mode,o=e.fs||Pse;i===void 0&&(i=xse&~process.umask()),r||(r=null),t=t||function(){},n=pM.resolve(n),o.mkdir(n,i,s=>{if(!s)return r=r||n,t(null,r);switch(s.code){case"ENOENT":if(pM.dirname(n)===n)return t(s);mM(pM.dirname(n),e,(a,l)=>{a?t(a,l):mM(n,e,t,l)});break;default:o.stat(n,(a,l)=>{a||!l.isDirectory()?t(s,r):t(null,r)});break}})}fJ.exports=mM});var vJ=O((m_e,gJ)=>{"use strict";var Dse=xn(),fM=require("path"),_se=dM().invalidWin32Path,Tse=parseInt("0777",8);function hM(n,e,t){(!e||typeof e!="object")&&(e={mode:e});let r=e.mode,i=e.fs||Dse;if(process.platform==="win32"&&_se(n)){let o=new Error(n+" contains invalid WIN32 path characters.");throw o.code="EINVAL",o}r===void 0&&(r=Tse&~process.umask()),t||(t=null),n=fM.resolve(n);try{i.mkdirSync(n,r),t=t||n}catch(o){switch(o.code){case"ENOENT":if(fM.dirname(n)===n)throw o;t=hM(fM.dirname(n),e,t),hM(n,e,t);break;default:let s;try{s=i.statSync(n)}catch{throw o}if(!s.isDirectory())throw o;break}}return t}gJ.exports=hM});var Vo=O((f_e,yJ)=>{"use strict";var Rse=ho().fromCallback,gM=Rse(hJ()),vM=vJ();yJ.exports={mkdirs:gM,mkdirsSync:vM,mkdirp:gM,mkdirpSync:vM,ensureDir:gM,ensureDirSync:vM}});var Fc=O((h_e,IJ)=>{"use strict";var Ase=ho().fromPromise,bJ=lM();function Nse(n){return bJ.access(n).then(()=>!0).catch(()=>!1)}IJ.exports={pathExists:Ase(Nse),pathExistsSync:bJ.existsSync}});var EJ=O((g_e,CJ)=>{"use strict";var Mse=xn(),TC=require("path"),SJ=cM(),Kse=Vo(),Ose=Fc().pathExists;function Fse(n,e,t,r){typeof t=="function"&&!r?(r=t,t={}):(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),r=r||function(){},t=t||{},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let i=process.cwd(),o=TC.resolve(i,n),s=TC.resolve(i,e);if(o===s)return r(new Error("Source and destination must not be the same."));Mse.lstat(n,(a,l)=>{if(a)return r(a);let c=null;if(l.isDirectory()){let u=e.split(TC.sep);u.pop(),c=u.join(TC.sep)}else c=TC.dirname(e);Ose(c,(u,d)=>{if(u)return r(u);if(d)return SJ(n,e,t,r);Kse.mkdirs(c,f=>{if(f)return r(f);SJ(n,e,t,r)})})})}CJ.exports=Fse});var PJ=O((v_e,wJ)=>{var Lse=ho().fromCallback;wJ.exports={copy:Lse(EJ())}});var yM=O((y_e,kJ)=>{kJ.exports=function(n){if(typeof Buffer.allocUnsafe=="function")try{return Buffer.allocUnsafe(n)}catch{return new Buffer(n)}return new Buffer(n)}});var TJ=O((b_e,_J)=>{"use strict";var Nl=xn(),DJ=64*1024,xJ=yM()(DJ);function Use(n,e,t){let r=t.overwrite,i=t.errorOnExist,o=t.preserveTimestamps;if(Nl.existsSync(e))if(r)Nl.unlinkSync(e);else{if(i)throw new Error(`${e} already exists`);return}let s=Nl.openSync(n,"r"),a=Nl.fstatSync(s),l=Nl.openSync(e,"w",a.mode),c=1,u=0;for(;c>0;)c=Nl.readSync(s,xJ,0,DJ,u),Nl.writeSync(l,xJ,0,c),u+=c;o&&Nl.futimesSync(l,a.atime,a.mtime),Nl.closeSync(s),Nl.closeSync(l)}_J.exports=Use});var MJ=O((I_e,NJ)=>{"use strict";var Cm=xn(),bM=require("path"),Wse=TJ(),RJ=Vo();function AJ(n,e,t){(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),t=t||{},t.recursive=!!t.recursive,t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.dereference="dereference"in t?!!t.dereference:!1,t.preserveTimestamps="preserveTimestamps"in t?!!t.preserveTimestamps:!1,t.filter=t.filter||function(){return!0},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let r=t.recursive&&!t.dereference?Cm.lstatSync(n):Cm.statSync(n),i=bM.dirname(e),o=Cm.existsSync(i),s=!1;if(t.filter instanceof RegExp?(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),s=t.filter.test(n)):typeof t.filter=="function"&&(s=t.filter(n,e)),r.isFile()&&s)o||RJ.mkdirsSync(i),Wse(n,e,{overwrite:t.overwrite,errorOnExist:t.errorOnExist,preserveTimestamps:t.preserveTimestamps});else if(r.isDirectory()&&s)Cm.existsSync(e)||RJ.mkdirsSync(e),Cm.readdirSync(n).forEach(l=>{let c=t;c.recursive=!0,AJ(bM.join(n,l),bM.join(e,l),c)});else if(t.recursive&&r.isSymbolicLink()&&s){let a=Cm.readlinkSync(n);Cm.symlinkSync(a,e)}}NJ.exports=AJ});var IM=O((S_e,KJ)=>{KJ.exports={copySync:MJ()}});var BJ=O((C_e,JJ)=>{"use strict";var OJ=xn(),WJ=require("path"),or=require("assert"),RC=process.platform==="win32";function VJ(n){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{n[t]=n[t]||OJ[t],t=t+"Sync",n[t]=n[t]||OJ[t]}),n.maxBusyTries=n.maxBusyTries||3}function SM(n,e,t){let r=0;typeof e=="function"&&(t=e,e={}),or(n,"rimraf: missing path"),or.equal(typeof n,"string","rimraf: path should be a string"),or.equal(typeof t,"function","rimraf: callback function required"),or(e,"rimraf: invalid options argument provided"),or.equal(typeof e,"object","rimraf: options should be object"),VJ(e),FJ(n,e,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&r<e.maxBusyTries){r++;let s=r*100;return setTimeout(()=>FJ(n,e,i),s)}o.code==="ENOENT"&&(o=null)}t(o)})}function FJ(n,e,t){or(n),or(e),or(typeof t=="function"),e.lstat(n,(r,i)=>{if(r&&r.code==="ENOENT")return t(null);if(r&&r.code==="EPERM"&&RC)return LJ(n,e,r,t);if(i&&i.isDirectory())return Ex(n,e,r,t);e.unlink(n,o=>{if(o){if(o.code==="ENOENT")return t(null);if(o.code==="EPERM")return RC?LJ(n,e,o,t):Ex(n,e,o,t);if(o.code==="EISDIR")return Ex(n,e,o,t)}return t(o)})})}function LJ(n,e,t,r){or(n),or(e),or(typeof r=="function"),t&&or(t instanceof Error),e.chmod(n,438,i=>{i?r(i.code==="ENOENT"?null:t):e.stat(n,(o,s)=>{o?r(o.code==="ENOENT"?null:t):s.isDirectory()?Ex(n,e,t,r):e.unlink(n,r)})})}function UJ(n,e,t){let r;or(n),or(e),t&&or(t instanceof Error);try{e.chmodSync(n,438)}catch(i){if(i.code==="ENOENT")return;throw t}try{r=e.statSync(n)}catch(i){if(i.code==="ENOENT")return;throw t}r.isDirectory()?wx(n,e,t):e.unlinkSync(n)}function Ex(n,e,t,r){or(n),or(e),t&&or(t instanceof Error),or(typeof r=="function"),e.rmdir(n,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?Vse(n,e,r):i&&i.code==="ENOTDIR"?r(t):r(i)})}function Vse(n,e,t){or(n),or(e),or(typeof t=="function"),e.readdir(n,(r,i)=>{if(r)return t(r);let o=i.length,s;if(o===0)return e.rmdir(n,t);i.forEach(a=>{SM(WJ.join(n,a),e,l=>{if(!s){if(l)return t(s=l);--o===0&&e.rmdir(n,t)}})})})}function jJ(n,e){let t;e=e||{},VJ(e),or(n,"rimraf: missing path"),or.equal(typeof n,"string","rimraf: path should be a string"),or(e,"rimraf: missing options"),or.equal(typeof e,"object","rimraf: options should be object");try{t=e.lstatSync(n)}catch(r){if(r.code==="ENOENT")return;r.code==="EPERM"&&RC&&UJ(n,e,r)}try{t&&t.isDirectory()?wx(n,e,null):e.unlinkSync(n)}catch(r){if(r.code==="ENOENT")return;if(r.code==="EPERM")return RC?UJ(n,e,r):wx(n,e,r);if(r.code!=="EISDIR")throw r;wx(n,e,r)}}function wx(n,e,t){or(n),or(e),t&&or(t instanceof Error);try{e.rmdirSync(n)}catch(r){if(r.code==="ENOTDIR")throw t;if(r.code==="ENOTEMPTY"||r.code==="EEXIST"||r.code==="EPERM")jse(n,e);else if(r.code!=="ENOENT")throw r}}function jse(n,e){or(n),or(e),e.readdirSync(n).forEach(i=>jJ(WJ.join(n,i),e));let t=RC?100:1,r=0;do{let i=!0;try{let o=e.rmdirSync(n,e);return i=!1,o}finally{if(++r<t&&i)continue}}while(!0)}JJ.exports=SM;SM.sync=jJ});var AC=O((E_e,qJ)=>{"use strict";var Jse=ho().fromCallback,$J=BJ();qJ.exports={remove:Jse($J),removeSync:$J.sync}});var QJ=O((w_e,zJ)=>{var Wg;try{Wg=xn()}catch{Wg=require("fs")}function Bse(n,e,t){t==null&&(t=e,e={}),typeof e=="string"&&(e={encoding:e}),e=e||{};var r=e.fs||Wg,i=!0;"throws"in e&&(i=e.throws),r.readFile(n,e,function(o,s){if(o)return t(o);s=GJ(s);var a;try{a=JSON.parse(s,e?e.reviver:null)}catch(l){return i?(l.message=n+": "+l.message,t(l)):t(null,null)}t(null,a)})}function $se(n,e){e=e||{},typeof e=="string"&&(e={encoding:e});var t=e.fs||Wg,r=!0;"throws"in e&&(r=e.throws);try{var i=t.readFileSync(n,e);return i=GJ(i),JSON.parse(i,e.reviver)}catch(o){if(r)throw o.message=n+": "+o.message,o;return null}}function HJ(n,e){var t,r=`
`;typeof e=="object"&&e!==null&&(e.spaces&&(t=e.spaces),e.EOL&&(r=e.EOL));var i=JSON.stringify(n,e?e.replacer:null,t);return i.replace(/\n/g,r)+r}function qse(n,e,t,r){r==null&&(r=t,t={}),t=t||{};var i=t.fs||Wg,o="";try{o=HJ(e,t)}catch(s){r&&r(s,null);return}i.writeFile(n,o,t,r)}function Hse(n,e,t){t=t||{};var r=t.fs||Wg,i=HJ(e,t);return r.writeFileSync(n,i,t)}function GJ(n){return Buffer.isBuffer(n)&&(n=n.toString("utf8")),n=n.replace(/^\uFEFF/,""),n}var Gse={readFile:Bse,readFileSync:$se,writeFile:qse,writeFileSync:Hse};zJ.exports=Gse});var kx=O((P_e,XJ)=>{"use strict";var YJ=ho().fromCallback,Px=QJ();XJ.exports={readJson:YJ(Px.readFile),readJsonSync:Px.readFileSync,writeJson:YJ(Px.writeFile),writeJsonSync:Px.writeFileSync}});var tB=O((k_e,eB)=>{"use strict";var zse=require("path"),Qse=Vo(),Yse=Fc().pathExists,ZJ=kx();function Xse(n,e,t,r){typeof t=="function"&&(r=t,t={});let i=zse.dirname(n);Yse(i,(o,s)=>{if(o)return r(o);if(s)return ZJ.writeJson(n,e,t,r);Qse.mkdirs(i,a=>{if(a)return r(a);ZJ.writeJson(n,e,t,r)})})}eB.exports=Xse});var nB=O((x_e,rB)=>{"use strict";var Zse=xn(),eae=require("path"),tae=Vo(),rae=kx();function nae(n,e,t){let r=eae.dirname(n);Zse.existsSync(r)||tae.mkdirsSync(r),rae.writeJsonSync(n,e,t)}rB.exports=nae});var oB=O((D_e,iB)=>{"use strict";var iae=ho().fromCallback,Gi=kx();Gi.outputJson=iae(tB());Gi.outputJsonSync=nB();Gi.outputJSON=Gi.outputJson;Gi.outputJSONSync=Gi.outputJsonSync;Gi.writeJSON=Gi.writeJson;Gi.writeJSONSync=Gi.writeJsonSync;Gi.readJSON=Gi.readJson;Gi.readJSONSync=Gi.readJsonSync;iB.exports=Gi});var cB=O((__e,lB)=>{"use strict";var oae=ho().fromCallback,Ml=xn(),sae=cM(),Em=require("path"),xx=AC().remove,aae=Vo().mkdirs;function CM(n,e,t,r){typeof t=="function"&&(r=t,t={});let i=t.overwrite||t.clobber||!1;cae(n,e,(s,a)=>{if(s)return r(s);if(a)return r(new Error(`Cannot move '${n}' to a subdirectory of itself, '${e}'.`));aae(Em.dirname(e),l=>{if(l)return r(l);o()})});function o(){Em.resolve(n)===Em.resolve(e)?Ml.access(n,r):i?Ml.rename(n,e,s=>{if(!s)return r();if(s.code==="ENOTEMPTY"||s.code==="EEXIST"){xx(e,a=>{if(a)return r(a);t.overwrite=!1,CM(n,e,t,r)});return}if(s.code==="EPERM"){setTimeout(()=>{xx(e,a=>{if(a)return r(a);t.overwrite=!1,CM(n,e,t,r)})},200);return}if(s.code!=="EXDEV")return r(s);sB(n,e,i,r)}):Ml.link(n,e,s=>s?s.code==="EXDEV"||s.code==="EISDIR"||s.code==="EPERM"||s.code==="ENOTSUP"?sB(n,e,i,r):r(s):Ml.unlink(n,r))}}function sB(n,e,t,r){Ml.stat(n,(i,o)=>{if(i)return r(i);o.isDirectory()?aB(n,e,t,r):lae(n,e,t,r)})}function lae(n,e,t,r){let i=t?"w":"wx",o=Ml.createReadStream(n),s=Ml.createWriteStream(e,{flags:i});o.on("error",l=>{o.destroy(),s.destroy(),s.removeListener("close",a),Ml.unlink(e,()=>{l.code==="EISDIR"||l.code==="EPERM"?aB(n,e,t,r):r(l)})}),s.on("error",l=>{o.destroy(),s.destroy(),s.removeListener("close",a),r(l)}),s.once("close",a),o.pipe(s);function a(){Ml.unlink(n,r)}}function aB(n,e,t,r){let i={overwrite:!1};t?xx(e,s=>{if(s)return r(s);o()}):o();function o(){sae(n,e,i,s=>{if(s)return r(s);xx(n,r)})}}function cae(n,e,t){Ml.stat(n,(r,i)=>{if(r)return t(r);if(i.isDirectory()){let o=e.split(Em.dirname(n)+Em.sep)[1];if(o){let s=o.split(Em.sep)[0];return s?t(null,n!==e&&e.indexOf(n)>-1&&s===Em.basename(n)):t(null,!1)}return t(null,!1)}return t(null,!1)})}lB.exports={move:oae(CM)}});var mB=O((T_e,pB)=>{"use strict";var go=xn(),wm=require("path"),uae=IM().copySync,EM=AC().removeSync,dae=Vo().mkdirsSync,pae=yM();function dB(n,e,t){t=t||{};let r=t.overwrite||t.clobber||!1;if(n=wm.resolve(n),e=wm.resolve(e),n===e)return go.accessSync(n);if(hae(n,e))throw new Error(`Cannot move '${n}' into itself '${e}'.`);dae(wm.dirname(e)),i();function i(){if(r)try{return go.renameSync(n,e)}catch(o){if(o.code==="ENOTEMPTY"||o.code==="EEXIST"||o.code==="EPERM")return EM(e),t.overwrite=!1,dB(n,e,t);if(o.code!=="EXDEV")throw o;return uB(n,e,r)}else try{return go.linkSync(n,e),go.unlinkSync(n)}catch(o){if(o.code==="EXDEV"||o.code==="EISDIR"||o.code==="EPERM"||o.code==="ENOTSUP")return uB(n,e,r);throw o}}}function uB(n,e,t){return go.statSync(n).isDirectory()?fae(n,e,t):mae(n,e,t)}function mae(n,e,t){let i=pae(65536),o=t?"w":"wx",s=go.openSync(n,"r"),a=go.fstatSync(s),l=go.openSync(e,o,a.mode),c=1,u=0;for(;c>0;)c=go.readSync(s,i,0,65536,u),go.writeSync(l,i,0,c),u+=c;return go.closeSync(s),go.closeSync(l),go.unlinkSync(n)}function fae(n,e,t){let r={overwrite:!1};t&&EM(e),i();function i(){return uae(n,e,r),EM(n)}}function hae(n,e){try{return go.statSync(n).isDirectory()&&n!==e&&e.indexOf(n)>-1&&e.split(wm.dirname(n)+wm.sep)[1].split(wm.sep)[0]===wm.basename(n)}catch{return!1}}pB.exports={moveSync:dB}});var SB=O((R_e,IB)=>{"use strict";var gae=ho().fromCallback,gB=require("fs"),vB=require("path"),yB=Vo(),bB=AC(),fB=gae(function(e,t){t=t||function(){},gB.readdir(e,(r,i)=>{if(r)return yB.mkdirs(e,t);i=i.map(s=>vB.join(e,s)),o();function o(){let s=i.pop();if(!s)return t();bB.remove(s,a=>{if(a)return t(a);o()})}})});function hB(n){let e;try{e=gB.readdirSync(n)}catch{return yB.mkdirsSync(n)}e.forEach(t=>{t=vB.join(n,t),bB.removeSync(t)})}IB.exports={emptyDirSync:hB,emptydirSync:hB,emptyDir:fB,emptydir:fB}});var PB=O((A_e,wB)=>{"use strict";var vae=ho().fromCallback,CB=require("path"),NC=xn(),EB=Vo(),yae=Fc().pathExists;function bae(n,e){function t(){NC.writeFile(n,"",r=>{if(r)return e(r);e()})}NC.stat(n,(r,i)=>{if(!r&&i.isFile())return e();let o=CB.dirname(n);yae(o,(s,a)=>{if(s)return e(s);if(a)return t();EB.mkdirs(o,l=>{if(l)return e(l);t()})})})}function Iae(n){let e;try{e=NC.statSync(n)}catch{}if(e&&e.isFile())return;let t=CB.dirname(n);NC.existsSync(t)||EB.mkdirsSync(t),NC.writeFileSync(n,"")}wB.exports={createFile:vae(bae),createFileSync:Iae}});var TB=O((N_e,_B)=>{"use strict";var Sae=ho().fromCallback,xB=require("path"),Pm=xn(),DB=Vo(),kB=Fc().pathExists;function Cae(n,e,t){function r(i,o){Pm.link(i,o,s=>{if(s)return t(s);t(null)})}kB(e,(i,o)=>{if(i)return t(i);if(o)return t(null);Pm.lstat(n,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),t(s);let l=xB.dirname(e);kB(l,(c,u)=>{if(c)return t(c);if(u)return r(n,e);DB.mkdirs(l,d=>{if(d)return t(d);r(n,e)})})})})}function Eae(n,e,t){if(Pm.existsSync(e))return;try{Pm.lstatSync(n)}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let i=xB.dirname(e);return Pm.existsSync(i)||DB.mkdirsSync(i),Pm.linkSync(n,e)}_B.exports={createLink:Sae(Cae),createLinkSync:Eae}});var AB=O((M_e,RB)=>{"use strict";var Md=require("path"),MC=xn(),wae=Fc().pathExists;function Pae(n,e,t){if(Md.isAbsolute(n))return MC.lstat(n,(r,i)=>r?(r.message=r.message.replace("lstat","ensureSymlink"),t(r)):t(null,{toCwd:n,toDst:n}));{let r=Md.dirname(e),i=Md.join(r,n);return wae(i,(o,s)=>o?t(o):s?t(null,{toCwd:i,toDst:n}):MC.lstat(n,(a,l)=>a?(a.message=a.message.replace("lstat","ensureSymlink"),t(a)):t(null,{toCwd:n,toDst:Md.relative(r,n)})))}}function kae(n,e){let t;if(Md.isAbsolute(n)){if(t=MC.existsSync(n),!t)throw new Error("absolute srcpath does not exist");return{toCwd:n,toDst:n}}else{let r=Md.dirname(e),i=Md.join(r,n);if(t=MC.existsSync(i),t)return{toCwd:i,toDst:n};if(t=MC.existsSync(n),!t)throw new Error("relative srcpath does not exist");return{toCwd:n,toDst:Md.relative(r,n)}}}RB.exports={symlinkPaths:Pae,symlinkPathsSync:kae}});var KB=O((K_e,MB)=>{"use strict";var NB=xn();function xae(n,e,t){if(t=typeof e=="function"?e:t,e=typeof e=="function"?!1:e,e)return t(null,e);NB.lstat(n,(r,i)=>{if(r)return t(null,"file");e=i&&i.isDirectory()?"dir":"file",t(null,e)})}function Dae(n,e){let t;if(e)return e;try{t=NB.lstatSync(n)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}MB.exports={symlinkType:xae,symlinkTypeSync:Dae}});var jB=O((O_e,VB)=>{"use strict";var _ae=ho().fromCallback,FB=require("path"),Vg=xn(),LB=Vo(),Tae=LB.mkdirs,Rae=LB.mkdirsSync,UB=AB(),Aae=UB.symlinkPaths,Nae=UB.symlinkPathsSync,WB=KB(),Mae=WB.symlinkType,Kae=WB.symlinkTypeSync,OB=Fc().pathExists;function Oae(n,e,t,r){r=typeof t=="function"?t:r,t=typeof t=="function"?!1:t,OB(e,(i,o)=>{if(i)return r(i);if(o)return r(null);Aae(n,e,(s,a)=>{if(s)return r(s);n=a.toDst,Mae(a.toCwd,t,(l,c)=>{if(l)return r(l);let u=FB.dirname(e);OB(u,(d,f)=>{if(d)return r(d);if(f)return Vg.symlink(n,e,c,r);Tae(u,g=>{if(g)return r(g);Vg.symlink(n,e,c,r)})})})})})}function Fae(n,e,t,r){if(r=typeof t=="function"?t:r,t=typeof t=="function"?!1:t,Vg.existsSync(e))return;let o=Nae(n,e);n=o.toDst,t=Kae(o.toCwd,t);let s=FB.dirname(e);return Vg.existsSync(s)||Rae(s),Vg.symlinkSync(n,e,t)}VB.exports={createSymlink:_ae(Oae),createSymlinkSync:Fae}});var BB=O((F_e,JB)=>{"use strict";var Dx=PB(),_x=TB(),Tx=jB();JB.exports={createFile:Dx.createFile,createFileSync:Dx.createFileSync,ensureFile:Dx.createFile,ensureFileSync:Dx.createFileSync,createLink:_x.createLink,createLinkSync:_x.createLinkSync,ensureLink:_x.createLink,ensureLinkSync:_x.createLinkSync,createSymlink:Tx.createSymlink,createSymlinkSync:Tx.createSymlinkSync,ensureSymlink:Tx.createSymlink,ensureSymlinkSync:Tx.createSymlinkSync}});var GB=O((L_e,HB)=>{"use strict";var Lae=ho().fromCallback,km=xn(),$B=require("path"),qB=Vo(),Uae=Fc().pathExists;function Wae(n,e,t,r){typeof t=="function"&&(r=t,t="utf8");let i=$B.dirname(n);Uae(i,(o,s)=>{if(o)return r(o);if(s)return km.writeFile(n,e,t,r);qB.mkdirs(i,a=>{if(a)return r(a);km.writeFile(n,e,t,r)})})}function Vae(n,e,t){let r=$B.dirname(n);if(km.existsSync(r))return km.writeFileSync.apply(km,arguments);qB.mkdirsSync(r),km.writeFileSync.apply(km,arguments)}HB.exports={outputFile:Lae(Wae),outputFileSync:Vae}});var Jo=O((U_e,zB)=>{"use strict";var xs=Y9(),jo={};xs(jo,lM());xs(jo,PJ());xs(jo,IM());xs(jo,Vo());xs(jo,AC());xs(jo,oB());xs(jo,cB());xs(jo,mB());xs(jo,SB());xs(jo,BB());xs(jo,GB());xs(jo,Fc());zB.exports=jo});var jx=O((K1e,OM)=>{"use strict";function Yae(n){var e=void 0;typeof n=="string"?e=[n]:e=n.raw;for(var t="",r=0;r<e.length;r++)t+=e[r].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`"),r<(arguments.length<=1?0:arguments.length-1)&&(t+=arguments.length<=r+1?void 0:arguments[r+1]);var i=t.split(`
`),o=null;return i.forEach(function(s){var a=s.match(/^(\s+)\S+/);if(a){var l=a[1].length;o?o=Math.min(o,l):o=l}}),o!==null&&(t=i.map(function(s){return s[0]===" "?s.slice(o):s}).join(`
`)),t=t.trim(),t.replace(/\\n/g,`
`)}typeof OM<"u"&&(OM.exports=Yae)});var v6=O((OKe,g6)=>{g6.exports=function(n,e){for(var t=[],r=0;r<n.length;r++){var i=e(n[r],r);ule(i)?t.push.apply(t,i):t.push(i)}return t};var ule=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"}});var C6=O((FKe,S6)=>{"use strict";S6.exports=b6;function b6(n,e,t){n instanceof RegExp&&(n=y6(n,t)),e instanceof RegExp&&(e=y6(e,t));var r=I6(n,e,t);return r&&{start:r[0],end:r[1],pre:t.slice(0,r[0]),body:t.slice(r[0]+n.length,r[1]),post:t.slice(r[1]+e.length)}}function y6(n,e){var t=e.match(n);return t?t[0]:null}b6.range=I6;function I6(n,e,t){var r,i,o,s,a,l=t.indexOf(n),c=t.indexOf(e,l+1),u=l;if(l>=0&&c>0){if(n===e)return[l,c];for(r=[],o=t.length;u>=0&&!a;)u==l?(r.push(u),l=t.indexOf(n,u+1)):r.length==1?a=[r.pop(),c]:(i=r.pop(),i<o&&(o=i,s=c),c=t.indexOf(e,u+1)),u=l<c&&l>=0?l:c;r.length&&(a=[o,s])}return a}});var T6=O((LKe,_6)=>{var dle=v6(),E6=C6();_6.exports=fle;var w6="\0SLASH"+Math.random()+"\0",P6="\0OPEN"+Math.random()+"\0",eK="\0CLOSE"+Math.random()+"\0",k6="\0COMMA"+Math.random()+"\0",x6="\0PERIOD"+Math.random()+"\0";function ZM(n){return parseInt(n,10)==n?parseInt(n,10):n.charCodeAt(0)}function ple(n){return n.split("\\\\").join(w6).split("\\{").join(P6).split("\\}").join(eK).split("\\,").join(k6).split("\\.").join(x6)}function mle(n){return n.split(w6).join("\\").split(P6).join("{").split(eK).join("}").split(k6).join(",").split(x6).join(".")}function D6(n){if(!n)return[""];var e=[],t=E6("{","}",n);if(!t)return n.split(",");var r=t.pre,i=t.body,o=t.post,s=r.split(",");s[s.length-1]+="{"+i+"}";var a=D6(o);return o.length&&(s[s.length-1]+=a.shift(),s.push.apply(s,a)),e.push.apply(e,s),e}function fle(n){return n?(n.substr(0,2)==="{}"&&(n="\\{\\}"+n.substr(2)),mv(ple(n),!0).map(mle)):[]}function hle(n){return"{"+n+"}"}function gle(n){return/^-?0\d/.test(n)}function vle(n,e){return n<=e}function yle(n,e){return n>=e}function mv(n,e){var t=[],r=E6("{","}",n);if(!r||/\$$/.test(r.pre))return[n];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),s=i||o,a=r.body.indexOf(",")>=0;if(!s&&!a)return r.post.match(/,.*\}/)?(n=r.pre+"{"+r.body+eK+r.post,mv(n)):[n];var l;if(s)l=r.body.split(/\.\./);else if(l=D6(r.body),l.length===1&&(l=mv(l[0],!1).map(hle),l.length===1)){var u=r.post.length?mv(r.post,!1):[""];return u.map(function(Oe){return r.pre+l[0]+Oe})}var c=r.pre,u=r.post.length?mv(r.post,!1):[""],d;if(s){var f=ZM(l[0]),g=ZM(l[1]),b=Math.max(l[0].length,l[1].length),I=l.length==3?Math.abs(ZM(l[2])):1,w=vle,D=g<f;D&&(I*=-1,w=yle);var A=l.some(gle);d=[];for(var T=f;w(T,g);T+=I){var $;if(o)$=String.fromCharCode(T),$==="\\"&&($="");else if($=String(T),A){var ne=b-$.length;if(ne>0){var H=new Array(ne+1).join("0");T<0?$="-"+H+$.slice(1):$=H+$}}d.push($)}}else d=dle(l,function(Ie){return mv(Ie,!1)});for(var oe=0;oe<d.length;oe++)for(var ae=0;ae<u.length;ae++){var Y=c+d[oe]+u[ae];(!e||s||Y)&&t.push(Y)}return t}});var qC=O((UKe,K6)=>{K6.exports=$o;$o.Minimatch=oi;var $C=function(){try{return require("path")}catch{}}()||{sep:"/"};$o.sep=$C.sep;var nK=$o.GLOBSTAR=oi.GLOBSTAR={},ble=T6(),R6={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},tK="[^/]",rK=tK+"*?",Ile="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Sle="(?:(?!(?:\\/|^)\\.).)*?",A6=Cle("().*{}+?[]^$\\!");function Cle(n){return n.split("").reduce(function(e,t){return e[t]=!0,e},{})}var N6=/\/+/;$o.filter=Ele;function Ele(n,e){return e=e||{},function(t,r,i){return $o(t,n,e)}}function Vd(n,e){e=e||{};var t={};return Object.keys(n).forEach(function(r){t[r]=n[r]}),Object.keys(e).forEach(function(r){t[r]=e[r]}),t}$o.defaults=function(n){if(!n||typeof n!="object"||!Object.keys(n).length)return $o;var e=$o,t=function(i,o,s){return e(i,o,Vd(n,s))};return t.Minimatch=function(i,o){return new e.Minimatch(i,Vd(n,o))},t.Minimatch.defaults=function(i){return e.defaults(Vd(n,i)).Minimatch},t.filter=function(i,o){return e.filter(i,Vd(n,o))},t.defaults=function(i){return e.defaults(Vd(n,i))},t.makeRe=function(i,o){return e.makeRe(i,Vd(n,o))},t.braceExpand=function(i,o){return e.braceExpand(i,Vd(n,o))},t.match=function(r,i,o){return e.match(r,i,Vd(n,o))},t};oi.defaults=function(n){return $o.defaults(n).Minimatch};function $o(n,e,t){return pD(e),t||(t={}),!t.nocomment&&e.charAt(0)==="#"?!1:new oi(e,t).match(n)}function oi(n,e){if(!(this instanceof oi))return new oi(n,e);pD(n),e||(e={}),n=n.trim(),!e.allowWindowsEscape&&$C.sep!=="/"&&(n=n.split($C.sep).join("/")),this.options=e,this.set=[],this.pattern=n,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.make()}oi.prototype.debug=function(){};oi.prototype.make=wle;function wle(){var n=this.pattern,e=this.options;if(!e.nocomment&&n.charAt(0)==="#"){this.comment=!0;return}if(!n){this.empty=!0;return}this.parseNegate();var t=this.globSet=this.braceExpand();e.debug&&(this.debug=function(){console.error.apply(console,arguments)}),this.debug(this.pattern,t),t=this.globParts=t.map(function(r){return r.split(N6)}),this.debug(this.pattern,t),t=t.map(function(r,i,o){return r.map(this.parse,this)},this),this.debug(this.pattern,t),t=t.filter(function(r){return r.indexOf(!1)===-1}),this.debug(this.pattern,t),this.set=t}oi.prototype.parseNegate=Ple;function Ple(){var n=this.pattern,e=!1,t=this.options,r=0;if(!t.nonegate){for(var i=0,o=n.length;i<o&&n.charAt(i)==="!";i++)e=!e,r++;r&&(this.pattern=n.substr(r)),this.negate=e}}$o.braceExpand=function(n,e){return M6(n,e)};oi.prototype.braceExpand=M6;function M6(n,e){return e||(this instanceof oi?e=this.options:e={}),n=typeof n>"u"?this.pattern:n,pD(n),e.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:ble(n)}var kle=1024*64,pD=function(n){if(typeof n!="string")throw new TypeError("invalid pattern");if(n.length>kle)throw new TypeError("pattern is too long")};oi.prototype.parse=xle;var dD={};function xle(n,e){pD(n);var t=this.options;if(n==="**")if(t.noglobstar)n="*";else return nK;if(n==="")return"";var r="",i=!!t.nocase,o=!1,s=[],a=[],l,c=!1,u=-1,d=-1,f=n.charAt(0)==="."?"":t.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=this;function b(){if(l){switch(l){case"*":r+=rK,i=!0;break;case"?":r+=tK,i=!0;break;default:r+="\\"+l;break}g.debug("clearStateChar %j %j",l,r),l=!1}}for(var I=0,w=n.length,D;I<w&&(D=n.charAt(I));I++){if(this.debug("%s	%s %s %j",n,I,r,D),o&&A6[D]){r+="\\"+D,o=!1;continue}switch(D){case"/":return!1;case"\\":b(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",n,I,r,D),c){this.debug("  in class"),D==="!"&&I===d+1&&(D="^"),r+=D;continue}g.debug("call clearStateChar %j",l),b(),l=D,t.noext&&b();continue;case"(":if(c){r+="(";continue}if(!l){r+="\\(";continue}s.push({type:l,start:I-1,reStart:r.length,open:R6[l].open,close:R6[l].close}),r+=l==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",l,r),l=!1;continue;case")":if(c||!s.length){r+="\\)";continue}b(),i=!0;var A=s.pop();r+=A.close,A.type==="!"&&a.push(A),A.reEnd=r.length;continue;case"|":if(c||!s.length||o){r+="\\|",o=!1;continue}b(),r+="|";continue;case"[":if(b(),c){r+="\\"+D;continue}c=!0,d=I,u=r.length,r+=D;continue;case"]":if(I===d+1||!c){r+="\\"+D,o=!1;continue}var T=n.substring(d+1,I);try{RegExp("["+T+"]")}catch{var $=this.parse(T,dD);r=r.substr(0,u)+"\\["+$[0]+"\\]",i=i||$[1],c=!1;continue}i=!0,c=!1,r+=D;continue;default:b(),o?o=!1:A6[D]&&!(D==="^"&&c)&&(r+="\\"),r+=D}}for(c&&(T=n.substr(d+1),$=this.parse(T,dD),r=r.substr(0,u)+"\\["+$[0],i=i||$[1]),A=s.pop();A;A=s.pop()){var ne=r.slice(A.reStart+A.open.length);this.debug("setting tail",r,A),ne=ne.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(Oi,sr,fi){return fi||(fi="\\"),sr+sr+fi+"|"}),this.debug(`tail=%j
   %s`,ne,ne,A,r);var H=A.type==="*"?rK:A.type==="?"?tK:"\\"+A.type;i=!0,r=r.slice(0,A.reStart)+H+"\\("+ne}b(),o&&(r+="\\\\");var oe=!1;switch(r.charAt(0)){case"[":case".":case"(":oe=!0}for(var ae=a.length-1;ae>-1;ae--){var Y=a[ae],Ie=r.slice(0,Y.reStart),Oe=r.slice(Y.reStart,Y.reEnd-8),pt=r.slice(Y.reEnd-8,Y.reEnd),mt=r.slice(Y.reEnd);pt+=mt;var kt=Ie.split("(").length-1,ee=mt;for(I=0;I<kt;I++)ee=ee.replace(/\)[+*?]?/,"");mt=ee;var Pe="";mt===""&&e!==dD&&(Pe="$");var _e=Ie+Oe+mt+Pe+pt;r=_e}if(r!==""&&i&&(r="(?=.)"+r),oe&&(r=f+r),e===dD)return[r,i];if(!i)return _le(n);var he=t.nocase?"i":"";try{var gt=new RegExp("^"+r+"$",he)}catch{return new RegExp("$.")}return gt._glob=n,gt._src=r,gt}$o.makeRe=function(n,e){return new oi(n,e||{}).makeRe()};oi.prototype.makeRe=Dle;function Dle(){if(this.regexp||this.regexp===!1)return this.regexp;var n=this.set;if(!n.length)return this.regexp=!1,this.regexp;var e=this.options,t=e.noglobstar?rK:e.dot?Ile:Sle,r=e.nocase?"i":"",i=n.map(function(o){return o.map(function(s){return s===nK?t:typeof s=="string"?Tle(s):s._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,r)}catch{this.regexp=!1}return this.regexp}$o.match=function(n,e,t){t=t||{};var r=new oi(e,t);return n=n.filter(function(i){return r.match(i)}),r.options.nonull&&!n.length&&n.push(e),n};oi.prototype.match=function(e,t){if(typeof t>"u"&&(t=this.partial),this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var r=this.options;$C.sep!=="/"&&(e=e.split($C.sep).join("/")),e=e.split(N6),this.debug(this.pattern,"split",e);var i=this.set;this.debug(this.pattern,"set",i);var o,s;for(s=e.length-1;s>=0&&(o=e[s],!o);s--);for(s=0;s<i.length;s++){var a=i[s],l=e;r.matchBase&&a.length===1&&(l=[o]);var c=this.matchOne(l,a,t);if(c)return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate};oi.prototype.matchOne=function(n,e,t){var r=this.options;this.debug("matchOne",{this:this,file:n,pattern:e}),this.debug("matchOne",n.length,e.length);for(var i=0,o=0,s=n.length,a=e.length;i<s&&o<a;i++,o++){this.debug("matchOne loop");var l=e[o],c=n[i];if(this.debug(e,l,c),l===!1)return!1;if(l===nK){this.debug("GLOBSTAR",[e,l,c]);var u=i,d=o+1;if(d===a){for(this.debug("** at the end");i<s;i++)if(n[i]==="."||n[i]===".."||!r.dot&&n[i].charAt(0)===".")return!1;return!0}for(;u<s;){var f=n[u];if(this.debug(`
globstar while`,n,u,e,d,f),this.matchOne(n.slice(u),e.slice(d),t))return this.debug("globstar found match!",u,s,f),!0;if(f==="."||f===".."||!r.dot&&f.charAt(0)==="."){this.debug("dot detected!",n,u,e,d);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(t&&(this.debug(`
>>> no match, partial?`,n,u,e,d),u===s))}var g;if(typeof l=="string"?(g=c===l,this.debug("string match",l,c,g)):(g=c.match(l),this.debug("pattern match",l,c,g)),!g)return!1}if(i===s&&o===a)return!0;if(i===s)return t;if(o===a)return i===s-1&&n[i]==="";throw new Error("wtf?")};function _le(n){return n.replace(/\\(.)/g,"$1")}function Tle(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var J6=O(aK=>{var Nm=require("path"),Jd=process.platform==="win32",jd=require("fs"),Nle=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function Mle(){var n;if(Nle){var e=new Error;n=t}else n=r;return n;function t(i){i&&(e.message=i.message,i=e,r(i))}function r(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var o="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(o):console.error(o)}}}}function Kle(n){return typeof n=="function"?n:Mle()}var PFe=Nm.normalize;Jd?Bc=/(.*?)(?:[\/\\]+|$)/g:Bc=/(.*?)(?:[\/]+|$)/g;var Bc;Jd?QC=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:QC=/^[\/]*/;var QC;aK.realpathSync=function(e,t){if(e=Nm.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var r=e,i={},o={},s,a,l,c;u();function u(){var w=QC.exec(e);s=w[0].length,a=w[0],l=w[0],c="",Jd&&!o[l]&&(jd.lstatSync(l),o[l]=!0)}for(;s<e.length;){Bc.lastIndex=s;var d=Bc.exec(e);if(c=a,a+=d[0],l=c+d[1],s=Bc.lastIndex,!(o[l]||t&&t[l]===l)){var f;if(t&&Object.prototype.hasOwnProperty.call(t,l))f=t[l];else{var g=jd.lstatSync(l);if(!g.isSymbolicLink()){o[l]=!0,t&&(t[l]=l);continue}var b=null;if(!Jd){var I=g.dev.toString(32)+":"+g.ino.toString(32);i.hasOwnProperty(I)&&(b=i[I])}b===null&&(jd.statSync(l),b=jd.readlinkSync(l)),f=Nm.resolve(c,b),t&&(t[l]=f),Jd||(i[I]=b)}e=Nm.resolve(f,e.slice(s)),u()}}return t&&(t[r]=e),e};aK.realpath=function(e,t,r){if(typeof r!="function"&&(r=Kle(t),t=null),e=Nm.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(r.bind(null,null,t[e]));var i=e,o={},s={},a,l,c,u;d();function d(){var w=QC.exec(e);a=w[0].length,l=w[0],c=w[0],u="",Jd&&!s[c]?jd.lstat(c,function(D){if(D)return r(D);s[c]=!0,f()}):process.nextTick(f)}function f(){if(a>=e.length)return t&&(t[i]=e),r(null,e);Bc.lastIndex=a;var w=Bc.exec(e);return u=l,l+=w[0],c=u+w[1],a=Bc.lastIndex,s[c]||t&&t[c]===c?process.nextTick(f):t&&Object.prototype.hasOwnProperty.call(t,c)?I(t[c]):jd.lstat(c,g)}function g(w,D){if(w)return r(w);if(!D.isSymbolicLink())return s[c]=!0,t&&(t[c]=c),process.nextTick(f);if(!Jd){var A=D.dev.toString(32)+":"+D.ino.toString(32);if(o.hasOwnProperty(A))return b(null,o[A],c)}jd.stat(c,function(T){if(T)return r(T);jd.readlink(c,function($,ne){Jd||(o[A]=ne),b($,ne)})})}function b(w,D,A){if(w)return r(w);var T=Nm.resolve(u,D);t&&(t[A]=T),I(T)}function I(w){e=Nm.resolve(w,e.slice(a)),d()}}});var dK=O((xFe,H6)=>{H6.exports=Bd;Bd.realpath=Bd;Bd.sync=uK;Bd.realpathSync=uK;Bd.monkeypatch=Fle;Bd.unmonkeypatch=Lle;var wv=require("fs"),lK=wv.realpath,cK=wv.realpathSync,Ole=process.version,B6=/^v[0-5]\./.test(Ole),$6=J6();function q6(n){return n&&n.syscall==="realpath"&&(n.code==="ELOOP"||n.code==="ENOMEM"||n.code==="ENAMETOOLONG")}function Bd(n,e,t){if(B6)return lK(n,e,t);typeof e=="function"&&(t=e,e=null),lK(n,e,function(r,i){q6(r)?$6.realpath(n,e,t):t(r,i)})}function uK(n,e){if(B6)return cK(n,e);try{return cK(n,e)}catch(t){if(q6(t))return $6.realpathSync(n,e);throw t}}function Fle(){wv.realpath=Bd,wv.realpathSync=uK}function Lle(){wv.realpath=lK,wv.realpathSync=cK}});var G6=O((DFe,pK)=>{typeof Object.create=="function"?pK.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:pK.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}});var z6=O((_Fe,fK)=>{try{if(mK=require("util"),typeof mK.inherits!="function")throw"";fK.exports=mK.inherits}catch{fK.exports=G6()}var mK});var hD=O((TFe,fD)=>{"use strict";function Q6(n){return n.charAt(0)==="/"}function Y6(n){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,t=e.exec(n),r=t[1]||"",i=!!(r&&r.charAt(1)!==":");return!!(t[2]||i)}fD.exports=process.platform==="win32"?Y6:Q6;fD.exports.posix=Q6;fD.exports.win32=Y6});var gK=O($d=>{$d.setopts=Ble;$d.ownProp=X6;$d.makeAbs=YC;$d.finish=$le;$d.mark=qle;$d.isIgnored=e$;$d.childrenIgnored=Hle;function X6(n,e){return Object.prototype.hasOwnProperty.call(n,e)}var Ule=require("fs"),Pv=require("path"),Wle=qC(),Z6=hD(),hK=Wle.Minimatch;function Vle(n,e){return n.localeCompare(e,"en")}function jle(n,e){n.ignore=e.ignore||[],Array.isArray(n.ignore)||(n.ignore=[n.ignore]),n.ignore.length&&(n.ignore=n.ignore.map(Jle))}function Jle(n){var e=null;if(n.slice(-3)==="/**"){var t=n.replace(/(\/\*\*)+$/,"");e=new hK(t,{dot:!0})}return{matcher:new hK(n,{dot:!0}),gmatcher:e}}function Ble(n,e,t){if(t||(t={}),t.matchBase&&e.indexOf("/")===-1){if(t.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}n.silent=!!t.silent,n.pattern=e,n.strict=t.strict!==!1,n.realpath=!!t.realpath,n.realpathCache=t.realpathCache||Object.create(null),n.follow=!!t.follow,n.dot=!!t.dot,n.mark=!!t.mark,n.nodir=!!t.nodir,n.nodir&&(n.mark=!0),n.sync=!!t.sync,n.nounique=!!t.nounique,n.nonull=!!t.nonull,n.nosort=!!t.nosort,n.nocase=!!t.nocase,n.stat=!!t.stat,n.noprocess=!!t.noprocess,n.absolute=!!t.absolute,n.fs=t.fs||Ule,n.maxLength=t.maxLength||1/0,n.cache=t.cache||Object.create(null),n.statCache=t.statCache||Object.create(null),n.symlinks=t.symlinks||Object.create(null),jle(n,t),n.changedCwd=!1;var r=process.cwd();X6(t,"cwd")?(n.cwd=Pv.resolve(t.cwd),n.changedCwd=n.cwd!==r):n.cwd=r,n.root=t.root||Pv.resolve(n.cwd,"/"),n.root=Pv.resolve(n.root),process.platform==="win32"&&(n.root=n.root.replace(/\\/g,"/")),n.cwdAbs=Z6(n.cwd)?n.cwd:YC(n,n.cwd),process.platform==="win32"&&(n.cwdAbs=n.cwdAbs.replace(/\\/g,"/")),n.nomount=!!t.nomount,t.nonegate=!0,t.nocomment=!0,n.minimatch=new hK(e,t),n.options=n.minimatch.options}function $le(n){for(var e=n.nounique,t=e?[]:Object.create(null),r=0,i=n.matches.length;r<i;r++){var o=n.matches[r];if(!o||Object.keys(o).length===0){if(n.nonull){var s=n.minimatch.globSet[r];e?t.push(s):t[s]=!0}}else{var a=Object.keys(o);e?t.push.apply(t,a):a.forEach(function(l){t[l]=!0})}}if(e||(t=Object.keys(t)),n.nosort||(t=t.sort(Vle)),n.mark){for(var r=0;r<t.length;r++)t[r]=n._mark(t[r]);n.nodir&&(t=t.filter(function(l){var c=!/\/$/.test(l),u=n.cache[l]||n.cache[YC(n,l)];return c&&u&&(c=u!=="DIR"&&!Array.isArray(u)),c}))}n.ignore.length&&(t=t.filter(function(l){return!e$(n,l)})),n.found=t}function qle(n,e){var t=YC(n,e),r=n.cache[t],i=e;if(r){var o=r==="DIR"||Array.isArray(r),s=e.slice(-1)==="/";if(o&&!s?i+="/":!o&&s&&(i=i.slice(0,-1)),i!==e){var a=YC(n,i);n.statCache[a]=n.statCache[t],n.cache[a]=n.cache[t]}}return i}function YC(n,e){var t=e;return e.charAt(0)==="/"?t=Pv.join(n.root,e):Z6(e)||e===""?t=e:n.changedCwd?t=Pv.resolve(n.cwd,e):t=Pv.resolve(e),process.platform==="win32"&&(t=t.replace(/\\/g,"/")),t}function e$(n,e){return n.ignore.length?n.ignore.some(function(t){return t.matcher.match(e)||!!(t.gmatcher&&t.gmatcher.match(e))}):!1}function Hle(n,e){return n.ignore.length?n.ignore.some(function(t){return!!(t.gmatcher&&t.gmatcher.match(e))}):!1}});var o$=O((KFe,i$)=>{i$.exports=n$;n$.GlobSync=Nn;var Gle=dK(),t$=qC(),AFe=t$.Minimatch,NFe=bK().Glob,MFe=require("util"),vK=require("path"),r$=require("assert"),gD=hD(),Mm=gK(),zle=Mm.setopts,yK=Mm.ownProp,Qle=Mm.childrenIgnored,Yle=Mm.isIgnored;function n$(n,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new Nn(n,e).found}function Nn(n,e){if(!n)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof Nn))return new Nn(n,e);if(zle(this,n,e),this.noprocess)return this;var t=this.minimatch.set.length;this.matches=new Array(t);for(var r=0;r<t;r++)this._process(this.minimatch.set[r],r,!1);this._finish()}Nn.prototype._finish=function(){if(r$(this instanceof Nn),this.realpath){var n=this;this.matches.forEach(function(e,t){var r=n.matches[t]=Object.create(null);for(var i in e)try{i=n._makeAbs(i);var o=Gle.realpathSync(i,n.realpathCache);r[o]=!0}catch(s){if(s.syscall==="stat")r[n._makeAbs(i)]=!0;else throw s}})}Mm.finish(this)};Nn.prototype._process=function(n,e,t){r$(this instanceof Nn);for(var r=0;typeof n[r]=="string";)r++;var i;switch(r){case n.length:this._processSimple(n.join("/"),e);return;case 0:i=null;break;default:i=n.slice(0,r).join("/");break}var o=n.slice(r),s;i===null?s=".":((gD(i)||gD(n.join("/")))&&(!i||!gD(i))&&(i="/"+i),s=i);var a=this._makeAbs(s);if(!Qle(this,s)){var l=o[0]===t$.GLOBSTAR;l?this._processGlobStar(i,s,a,o,e,t):this._processReaddir(i,s,a,o,e,t)}};Nn.prototype._processReaddir=function(n,e,t,r,i,o){var s=this._readdir(t,o);if(s){for(var a=r[0],l=!!this.minimatch.negate,c=a._glob,u=this.dot||c.charAt(0)===".",d=[],f=0;f<s.length;f++){var g=s[f];if(g.charAt(0)!=="."||u){var b;l&&!n?b=!g.match(a):b=g.match(a),b&&d.push(g)}}var I=d.length;if(I!==0){if(r.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var f=0;f<I;f++){var g=d[f];n&&(n.slice(-1)!=="/"?g=n+"/"+g:g=n+g),g.charAt(0)==="/"&&!this.nomount&&(g=vK.join(this.root,g)),this._emitMatch(i,g)}return}r.shift();for(var f=0;f<I;f++){var g=d[f],w;n?w=[n,g]:w=[g],this._process(w.concat(r),i,o)}}}};Nn.prototype._emitMatch=function(n,e){if(!Yle(this,e)){var t=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[n][e]){if(this.nodir){var r=this.cache[t];if(r==="DIR"||Array.isArray(r))return}this.matches[n][e]=!0,this.stat&&this._stat(e)}}};Nn.prototype._readdirInGlobStar=function(n){if(this.follow)return this._readdir(n,!1);var e,t,r;try{t=this.fs.lstatSync(n)}catch(o){if(o.code==="ENOENT")return null}var i=t&&t.isSymbolicLink();return this.symlinks[n]=i,!i&&t&&!t.isDirectory()?this.cache[n]="FILE":e=this._readdir(n,!1),e};Nn.prototype._readdir=function(n,e){var t;if(e&&!yK(this.symlinks,n))return this._readdirInGlobStar(n);if(yK(this.cache,n)){var r=this.cache[n];if(!r||r==="FILE")return null;if(Array.isArray(r))return r}try{return this._readdirEntries(n,this.fs.readdirSync(n))}catch(i){return this._readdirError(n,i),null}};Nn.prototype._readdirEntries=function(n,e){if(!this.mark&&!this.stat)for(var t=0;t<e.length;t++){var r=e[t];n==="/"?r=n+r:r=n+"/"+r,this.cache[r]=!0}return this.cache[n]=e,e};Nn.prototype._readdirError=function(n,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var t=this._makeAbs(n);if(this.cache[t]="FILE",t===this.cwdAbs){var r=new Error(e.code+" invalid cwd "+this.cwd);throw r.path=this.cwd,r.code=e.code,r}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(n)]=!1;break;default:if(this.cache[this._makeAbs(n)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};Nn.prototype._processGlobStar=function(n,e,t,r,i,o){var s=this._readdir(t,o);if(s){var a=r.slice(1),l=n?[n]:[],c=l.concat(a);this._process(c,i,!1);var u=s.length,d=this.symlinks[t];if(!(d&&o))for(var f=0;f<u;f++){var g=s[f];if(!(g.charAt(0)==="."&&!this.dot)){var b=l.concat(s[f],a);this._process(b,i,!0);var I=l.concat(s[f],r);this._process(I,i,!0)}}}};Nn.prototype._processSimple=function(n,e){var t=this._stat(n);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!t){if(n&&gD(n)&&!this.nomount){var r=/[\/\\]$/.test(n);n.charAt(0)==="/"?n=vK.join(this.root,n):(n=vK.resolve(this.root,n),r&&(n+="/"))}process.platform==="win32"&&(n=n.replace(/\\/g,"/")),this._emitMatch(e,n)}};Nn.prototype._stat=function(n){var e=this._makeAbs(n),t=n.slice(-1)==="/";if(n.length>this.maxLength)return!1;if(!this.stat&&yK(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!t||s==="DIR")return s;if(t&&s==="FILE")return!1}var r,i=this.statCache[e];if(!i){var o;try{o=this.fs.lstatSync(e)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(o&&o.isSymbolicLink())try{i=this.fs.statSync(e)}catch{i=o}else i=o}this.statCache[e]=i;var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,t&&s==="FILE"?!1:s};Nn.prototype._mark=function(n){return Mm.mark(this,n)};Nn.prototype._makeAbs=function(n){return Mm.makeAbs(this,n)}});var IK=O((OFe,a$)=>{a$.exports=s$;function s$(n,e){if(n&&e)return s$(n)(e);if(typeof n!="function")throw new TypeError("need wrapper function");return Object.keys(n).forEach(function(r){t[r]=n[r]}),t;function t(){for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];var o=n.apply(this,r),s=r[r.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(a){o[a]=s[a]}),o}}});var CK=O((FFe,SK)=>{var l$=IK();SK.exports=l$(vD);SK.exports.strict=l$(c$);vD.proto=vD(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return vD(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return c$(this)},configurable:!0})});function vD(n){var e=function(){return e.called?e.value:(e.called=!0,e.value=n.apply(this,arguments))};return e.called=!1,e}function c$(n){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=n.apply(this,arguments)},t=n.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}});var d$=O((LFe,u$)=>{var Xle=IK(),XC=Object.create(null),Zle=CK();u$.exports=Xle(ece);function ece(n,e){return XC[n]?(XC[n].push(e),null):(XC[n]=[e],tce(n))}function tce(n){return Zle(function e(){var t=XC[n],r=t.length,i=rce(arguments);try{for(var o=0;o<r;o++)t[o].apply(null,i)}finally{t.length>r?(t.splice(0,r),process.nextTick(function(){e.apply(null,i)})):delete XC[n]}})}function rce(n){for(var e=n.length,t=[],r=0;r<e;r++)t[r]=n[r];return t}});var bK=O((VFe,m$)=>{m$.exports=Km;var nce=dK(),p$=qC(),UFe=p$.Minimatch,ice=z6(),oce=require("events").EventEmitter,EK=require("path"),wK=require("assert"),ZC=hD(),kK=o$(),Om=gK(),sce=Om.setopts,PK=Om.ownProp,xK=d$(),WFe=require("util"),ace=Om.childrenIgnored,lce=Om.isIgnored,cce=CK();function Km(n,e,t){if(typeof e=="function"&&(t=e,e={}),e||(e={}),e.sync){if(t)throw new TypeError("callback provided to sync glob");return kK(n,e)}return new pr(n,e,t)}Km.sync=kK;var uce=Km.GlobSync=kK.GlobSync;Km.glob=Km;function dce(n,e){if(e===null||typeof e!="object")return n;for(var t=Object.keys(e),r=t.length;r--;)n[t[r]]=e[t[r]];return n}Km.hasMagic=function(n,e){var t=dce({},e);t.noprocess=!0;var r=new pr(n,t),i=r.minimatch.set;if(!n)return!1;if(i.length>1)return!0;for(var o=0;o<i[0].length;o++)if(typeof i[0][o]!="string")return!0;return!1};Km.Glob=pr;ice(pr,oce);function pr(n,e,t){if(typeof e=="function"&&(t=e,e=null),e&&e.sync){if(t)throw new TypeError("callback provided to sync glob");return new uce(n,e)}if(!(this instanceof pr))return new pr(n,e,t);sce(this,n,e),this._didRealPath=!1;var r=this.minimatch.set.length;this.matches=new Array(r),typeof t=="function"&&(t=cce(t),this.on("error",t),this.on("end",function(l){t(null,l)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(r===0)return a();for(var o=!0,s=0;s<r;s++)this._process(this.minimatch.set[s],s,!1,a);o=!1;function a(){--i._processing,i._processing<=0&&(o?process.nextTick(function(){i._finish()}):i._finish())}}pr.prototype._finish=function(){if(wK(this instanceof pr),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();Om.finish(this),this.emit("end",this.found)}};pr.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var n=this.matches.length;if(n===0)return this._finish();for(var e=this,t=0;t<this.matches.length;t++)this._realpathSet(t,r);function r(){--n===0&&e._finish()}};pr.prototype._realpathSet=function(n,e){var t=this.matches[n];if(!t)return e();var r=Object.keys(t),i=this,o=r.length;if(o===0)return e();var s=this.matches[n]=Object.create(null);r.forEach(function(a,l){a=i._makeAbs(a),nce.realpath(a,i.realpathCache,function(c,u){c?c.syscall==="stat"?s[a]=!0:i.emit("error",c):s[u]=!0,--o===0&&(i.matches[n]=s,e())})})};pr.prototype._mark=function(n){return Om.mark(this,n)};pr.prototype._makeAbs=function(n){return Om.makeAbs(this,n)};pr.prototype.abort=function(){this.aborted=!0,this.emit("abort")};pr.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};pr.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var n=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<n.length;e++){var t=n[e];this._emitMatch(t[0],t[1])}}if(this._processQueue.length){var r=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<r.length;e++){var i=r[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};pr.prototype._process=function(n,e,t,r){if(wK(this instanceof pr),wK(typeof r=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([n,e,t,r]);return}for(var i=0;typeof n[i]=="string";)i++;var o;switch(i){case n.length:this._processSimple(n.join("/"),e,r);return;case 0:o=null;break;default:o=n.slice(0,i).join("/");break}var s=n.slice(i),a;o===null?a=".":((ZC(o)||ZC(n.join("/")))&&(!o||!ZC(o))&&(o="/"+o),a=o);var l=this._makeAbs(a);if(ace(this,a))return r();var c=s[0]===p$.GLOBSTAR;c?this._processGlobStar(o,a,l,s,e,t,r):this._processReaddir(o,a,l,s,e,t,r)}};pr.prototype._processReaddir=function(n,e,t,r,i,o,s){var a=this;this._readdir(t,o,function(l,c){return a._processReaddir2(n,e,t,r,i,o,c,s)})};pr.prototype._processReaddir2=function(n,e,t,r,i,o,s,a){if(!s)return a();for(var l=r[0],c=!!this.minimatch.negate,u=l._glob,d=this.dot||u.charAt(0)===".",f=[],g=0;g<s.length;g++){var b=s[g];if(b.charAt(0)!=="."||d){var I;c&&!n?I=!b.match(l):I=b.match(l),I&&f.push(b)}}var w=f.length;if(w===0)return a();if(r.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var g=0;g<w;g++){var b=f[g];n&&(n!=="/"?b=n+"/"+b:b=n+b),b.charAt(0)==="/"&&!this.nomount&&(b=EK.join(this.root,b)),this._emitMatch(i,b)}return a()}r.shift();for(var g=0;g<w;g++){var b=f[g],D;n&&(n!=="/"?b=n+"/"+b:b=n+b),this._process([b].concat(r),i,o,a)}a()};pr.prototype._emitMatch=function(n,e){if(!this.aborted&&!lce(this,e)){if(this.paused){this._emitQueue.push([n,e]);return}var t=ZC(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[n][e]){if(this.nodir){var r=this.cache[t];if(r==="DIR"||Array.isArray(r))return}this.matches[n][e]=!0;var i=this.statCache[t];i&&this.emit("stat",e,i),this.emit("match",e)}}};pr.prototype._readdirInGlobStar=function(n,e){if(this.aborted)return;if(this.follow)return this._readdir(n,!1,e);var t="lstat\0"+n,r=this,i=xK(t,o);i&&r.fs.lstat(n,i);function o(s,a){if(s&&s.code==="ENOENT")return e();var l=a&&a.isSymbolicLink();r.symlinks[n]=l,!l&&a&&!a.isDirectory()?(r.cache[n]="FILE",e()):r._readdir(n,!1,e)}};pr.prototype._readdir=function(n,e,t){if(!this.aborted&&(t=xK("readdir\0"+n+"\0"+e,t),!!t)){if(e&&!PK(this.symlinks,n))return this._readdirInGlobStar(n,t);if(PK(this.cache,n)){var r=this.cache[n];if(!r||r==="FILE")return t();if(Array.isArray(r))return t(null,r)}var i=this;i.fs.readdir(n,pce(this,n,t))}};function pce(n,e,t){return function(r,i){r?n._readdirError(e,r,t):n._readdirEntries(e,i,t)}}pr.prototype._readdirEntries=function(n,e,t){if(!this.aborted){if(!this.mark&&!this.stat)for(var r=0;r<e.length;r++){var i=e[r];n==="/"?i=n+i:i=n+"/"+i,this.cache[i]=!0}return this.cache[n]=e,t(null,e)}};pr.prototype._readdirError=function(n,e,t){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(n);if(this.cache[r]="FILE",r===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(n)]=!1;break;default:this.cache[this._makeAbs(n)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return t()}};pr.prototype._processGlobStar=function(n,e,t,r,i,o,s){var a=this;this._readdir(t,o,function(l,c){a._processGlobStar2(n,e,t,r,i,o,c,s)})};pr.prototype._processGlobStar2=function(n,e,t,r,i,o,s,a){if(!s)return a();var l=r.slice(1),c=n?[n]:[],u=c.concat(l);this._process(u,i,!1,a);var d=this.symlinks[t],f=s.length;if(d&&o)return a();for(var g=0;g<f;g++){var b=s[g];if(!(b.charAt(0)==="."&&!this.dot)){var I=c.concat(s[g],l);this._process(I,i,!0,a);var w=c.concat(s[g],r);this._process(w,i,!0,a)}}a()};pr.prototype._processSimple=function(n,e,t){var r=this;this._stat(n,function(i,o){r._processSimple2(n,e,i,o,t)})};pr.prototype._processSimple2=function(n,e,t,r,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!r)return i();if(n&&ZC(n)&&!this.nomount){var o=/[\/\\]$/.test(n);n.charAt(0)==="/"?n=EK.join(this.root,n):(n=EK.resolve(this.root,n),o&&(n+="/"))}process.platform==="win32"&&(n=n.replace(/\\/g,"/")),this._emitMatch(e,n),i()};pr.prototype._stat=function(n,e){var t=this._makeAbs(n),r=n.slice(-1)==="/";if(n.length>this.maxLength)return e();if(!this.stat&&PK(this.cache,t)){var i=this.cache[t];if(Array.isArray(i)&&(i="DIR"),!r||i==="DIR")return e(null,i);if(r&&i==="FILE")return e()}var o,s=this.statCache[t];if(s!==void 0){if(s===!1)return e(null,s);var a=s.isDirectory()?"DIR":"FILE";return r&&a==="FILE"?e():e(null,a,s)}var l=this,c=xK("stat\0"+t,u);c&&l.fs.lstat(t,c);function u(d,f){if(f&&f.isSymbolicLink())return l.fs.stat(t,function(g,b){g?l._stat2(n,t,null,f,e):l._stat2(n,t,g,b,e)});l._stat2(n,t,d,f,e)}};pr.prototype._stat2=function(n,e,t,r,i){if(t&&(t.code==="ENOENT"||t.code==="ENOTDIR"))return this.statCache[e]=!1,i();var o=n.slice(-1)==="/";if(this.statCache[e]=r,e.slice(-1)==="/"&&r&&!r.isDirectory())return i(null,!1,r);var s=!0;return r&&(s=r.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&s==="FILE"?i():i(null,s,r)}});var g$=O((jFe,h$)=>{"use strict";var f$=process.platform==="win32",mce=f$?/[^:]\\$/:/.\/$/;h$.exports=function(){var n;return f$?n=process.env.TEMP||process.env.TMP||(process.env.SystemRoot||process.env.windir)+"\\temp":n=process.env.TMPDIR||process.env.TMP||process.env.TEMP||"/tmp",mce.test(n)&&(n=n.slice(0,-1)),n}});var T$=O((JFe,$c)=>{var bo=require("fs"),DK=require("path"),v$=require("crypto"),fce=g$(),eE=require("constants"),_K=fce(),y$="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",TK=/XXXXXX/,I$=3,S$=eE.O_CREAT|eE.O_EXCL|eE.O_RDWR,C$=448,E$=384,kv=[],w$=!1,RK=!1;function b$(n){var e=[],t=null;try{t=v$.randomBytes(n)}catch{t=v$.pseudoRandomBytes(n)}for(var r=0;r<n;r++)e.push(y$[t[r]%y$.length]);return e.join("")}function hce(n){return typeof n>"u"}function xv(n,e){if(typeof n=="function"){var t=n;n=e||{},e=t}else typeof n>"u"&&(n={});return[n,e]}function P$(n){if(n.name)return DK.join(n.dir||_K,n.name);if(n.template)return n.template.replace(TK,b$(6));var e=[n.prefix||"tmp-",process.pid,b$(12),n.postfix||""].join("");return DK.join(n.dir||_K,e)}function AK(n,e){var t=xv(n,e),r=t[0],i=t[1],o=r.tries||I$;if(isNaN(o)||o<0)return i(new Error("Invalid tries"));if(r.template&&!r.template.match(TK))return i(new Error("Invalid template provided"));(function s(){var a=P$(r);bo.stat(a,function(l){if(!l)return o-- >0?s():i(new Error("Could not get a unique tmp filename, max tries reached "+a));i(null,a)})})()}function NK(n){var e=xv(n),t=e[0],r=t.tries||I$;if(isNaN(r)||r<0)throw new Error("Invalid tries");if(t.template&&!t.template.match(TK))throw new Error("Invalid template provided");do{var i=P$(t);try{bo.statSync(i)}catch{return i}}while(r-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function gce(n,e){var t=xv(n,e),r=t[0],i=t[1];r.postfix=hce(r.postfix)?".tmp":r.postfix,AK(r,function(s,a){if(s)return i(s);bo.open(a,S$,r.mode||E$,function(c,u){if(c)return i(c);i(null,a,u,k$(a,u,r))})})}function vce(n){var e=xv(n),t=e[0];t.postfix=t.postfix||".tmp";var r=NK(t),i=bo.openSync(r,S$,t.mode||E$);return{name:r,fd:i,removeCallback:k$(r,i,t)}}function yce(n){var e=[n];do{for(var t=e.pop(),r=!1,i=bo.readdirSync(t),o=0,s=i.length;o<s;o++){var a=DK.join(t,i[o]),l=bo.lstatSync(a);l.isDirectory()?(r||(r=!0,e.push(t)),e.push(a)):bo.unlinkSync(a)}r||bo.rmdirSync(t)}while(e.length!==0)}function bce(n,e){var t=xv(n,e),r=t[0],i=t[1];AK(r,function(s,a){if(s)return i(s);bo.mkdir(a,r.mode||C$,function(c){if(c)return i(c);i(null,a,x$(a,r))})})}function Ice(n){var e=xv(n),t=e[0],r=NK(t);return bo.mkdirSync(r,t.mode||C$),{name:r,removeCallback:x$(r,t)}}function k$(n,e,t){var r=D$(function(o){try{bo.closeSync(o[0])}catch(s){if(s.errno!=-eE.EBADF&&s.errno!=-eE.ENOENT)throw s}bo.unlinkSync(o[1])},[e,n]);return t.keep||kv.unshift(r),r}function x$(n,e){var t=e.unsafeCleanup?yce:bo.rmdirSync.bind(bo),r=D$(t,n);return e.keep||kv.unshift(r),r}function D$(n,e){var t=!1;return function r(){if(!t){var i=kv.indexOf(r);i>=0&&kv.splice(i,1),t=!0,n(e)}}}function _$(){if(!(RK&&!w$))for(var n=0,e=kv.length;n<e;n++)try{kv[n].call(null)}catch{}}function Sce(){w$=!0}var yD=process.versions.node.split(".").map(function(n){return parseInt(n,10)});yD[0]===0&&(yD[1]<9||yD[1]===9&&yD[2]<5)&&process.addListener("uncaughtException",function(e){throw RK=!0,_$(),e});process.addListener("exit",function(e){e&&(RK=!0),_$()});$c.exports.tmpdir=_K;$c.exports.dir=bce;$c.exports.dirSync=Ice;$c.exports.file=gce;$c.exports.fileSync=vce;$c.exports.tmpName=AK;$c.exports.tmpNameSync=NK;$c.exports.setGracefulCleanup=Sce});var A$=O((Fm,R$)=>{var tE=require("node-fetch"),Cce=tE.default||tE,bD=function(n,e){return/^\/\//.test(n)&&(n="https:"+n),Cce.call(this,n,e)};bD.ponyfill=!0;R$.exports=Fm=bD;Fm.fetch=bD;Fm.Headers=tE.Headers;Fm.Request=tE.Request;Fm.Response=tE.Response;Fm.default=bD});var b7=O((kJe,y7)=>{var Kce=require("crypto");y7.exports=function(){return Kce.randomBytes(16)}});var C7=O((xJe,S7)=>{var I7=[];for(pE=0;pE<256;++pE)I7[pE]=(pE+256).toString(16).substr(1);var pE;function Oce(n,e){var t=e||0,r=I7;return[r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]]].join("")}S7.exports=Oce});var So=O((DJe,E7)=>{var Fce=b7(),Lce=C7();function Uce(n,e,t){var r=e&&t||0;typeof n=="string"&&(e=n==="binary"?new Array(16):null,n=null),n=n||{};var i=n.random||(n.rng||Fce)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var o=0;o<16;++o)e[r+o]=i[o];return e||Lce(i)}E7.exports=Uce});var _7=O((R3e,D7)=>{"use strict";function Ym(n){if(!(this instanceof Ym))return new Ym(n);n=n||{},this.concurrency=n.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=jce.bind(this)}var Vce=["push","unshift","splice"];Vce.forEach(function(n){Ym.prototype[n]=function(){var e=Array.prototype[n].apply(this.jobs,arguments);return this._run(),e}});Object.defineProperty(Ym.prototype,"length",{get:function(){return this.pending+this.jobs.length}});Ym.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var n=this.jobs.shift();this.pending++,n(this._done),this._run()}if(this.pending===0)for(;this.cbs.length!==0;){var e=this.cbs.pop();process.nextTick(e)}}};Ym.prototype.onDone=function(n){typeof n=="function"&&(this.cbs.push(n),this._run())};function jce(){this.pending--,this._run()}D7.exports=Ym});var Xm=O((A3e,T7)=>{"use strict";T7.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}});var q7=O((N3e,$7)=>{var M7=require("fs"),Yc=require("path"),K7=require("os"),O7=typeof __webpack_require__=="function"?__non_webpack_require__:require,Jce=process.config&&process.config.variables||{},Bce=!!process.env.PREBUILDS_ONLY,R7=process.versions.modules,$K=Hce()?"electron":qce()?"node-webkit":"node",qK=process.env.npm_config_arch||K7.arch(),HK=process.env.npm_config_platform||K7.platform(),F7=process.env.LIBC||(Gce(HK)?"musl":"glibc"),GK=process.env.ARM_VERSION||(qK==="arm64"?"8":Jce.arm_version)||"",L7=(process.versions.uv||"").split(".")[0];$7.exports=$l;function $l(n){return O7($l.resolve(n))}$l.resolve=$l.path=function(n){n=Yc.resolve(n||".");try{var e=O7(Yc.join(n,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(n=process.env[e+"_PREBUILD"])}catch{}if(!Bce){var t=A7(Yc.join(n,"build/Release"),N7);if(t)return t;var r=A7(Yc.join(n,"build/Debug"),N7);if(r)return r}var i=a(n);if(i)return i;var o=a(Yc.dirname(process.execPath));if(o)return o;var s=["platform="+HK,"arch="+qK,"runtime="+$K,"abi="+R7,"uv="+L7,GK?"armv="+GK:"","libc="+F7,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+s+`
    loaded from: `+n+`
`);function a(l){var c=zK(Yc.join(l,"prebuilds")).map(U7),u=c.filter(W7(HK,qK)).sort(V7)[0];if(u){var d=Yc.join(l,"prebuilds",u.name),f=zK(d).map(j7),g=f.filter(J7($K,R7)),b=g.sort(B7($K))[0];if(b)return Yc.join(d,b.file)}}};function zK(n){try{return M7.readdirSync(n)}catch{return[]}}function A7(n,e){var t=zK(n).filter(e);return t[0]&&Yc.join(n,t[0])}function N7(n){return/\.node$/.test(n)}function U7(n){var e=n.split("-");if(e.length===2){var t=e[0],r=e[1].split("+");if(t&&r.length&&r.every(Boolean))return{name:n,platform:t,architectures:r}}}function W7(n,e){return function(t){return t==null||t.platform!==n?!1:t.architectures.includes(e)}}function V7(n,e){return n.architectures.length-e.architectures.length}function j7(n){var e=n.split("."),t=e.pop(),r={file:n,specificity:0};if(t==="node"){for(var i=0;i<e.length;i++){var o=e[i];if(o==="node"||o==="electron"||o==="node-webkit")r.runtime=o;else if(o==="napi")r.napi=!0;else if(o.slice(0,3)==="abi")r.abi=o.slice(3);else if(o.slice(0,2)==="uv")r.uv=o.slice(2);else if(o.slice(0,4)==="armv")r.armv=o.slice(4);else if(o==="glibc"||o==="musl")r.libc=o;else continue;r.specificity++}return r}}function J7(n,e){return function(t){return!(t==null||t.runtime!==n&&!$ce(t)||t.abi!==e&&!t.napi||t.uv&&t.uv!==L7||t.armv&&t.armv!==GK||t.libc&&t.libc!==F7)}}function $ce(n){return n.runtime==="node"&&n.napi}function B7(n){return function(e,t){return e.runtime!==t.runtime?e.runtime===n?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function qce(){return!!(process.versions&&process.versions.nw)}function Hce(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function Gce(n){return n==="linux"&&M7.existsSync("/etc/alpine-release")}$l.parseTags=j7;$l.matchTags=J7;$l.compareTags=B7;$l.parseTuple=U7;$l.matchTuple=W7;$l.compareTuples=V7});var YK=O((M3e,QK)=>{typeof process.addon=="function"?QK.exports=process.addon.bind(process):QK.exports=q7()});var G7=O((K3e,H7)=>{"use strict";var zce=(n,e,t,r,i)=>{for(var o=0;o<i;o++)t[r+o]=n[o]^e[o&3]},Qce=(n,e)=>{let t=n.length;for(var r=0;r<t;r++)n[r]^=e[r&3]};H7.exports={mask:zce,unmask:Qce}});var z7=O((O3e,XK)=>{"use strict";try{XK.exports=YK()(__dirname)}catch{XK.exports=G7()}});var QD=O((F3e,ZK)=>{"use strict";var{EMPTY_BUFFER:Yce}=Xm();function Q7(n,e){if(n.length===0)return Yce;if(n.length===1)return n[0];let t=Buffer.allocUnsafe(e);for(var r=0,i=0;i<n.length;i++){let o=n[i];o.copy(t,r),r+=o.length}return t}function Y7(n,e,t,r,i){for(var o=0;o<i;o++)t[r+o]=n[o]^e[o&3]}function X7(n,e){let t=n.length;for(var r=0;r<t;r++)n[r]^=e[r&3]}function Z7(n){return n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}function zD(n){if(zD.readOnly=!0,Buffer.isBuffer(n))return n;var e;return n instanceof ArrayBuffer?e=Buffer.from(n):ArrayBuffer.isView(n)?e=Xce(n):(e=Buffer.from(n),zD.readOnly=!1),e}function Xce(n){let e=Buffer.from(n.buffer);return n.byteLength!==n.buffer.byteLength?e.slice(n.byteOffset,n.byteOffset+n.byteLength):e}try{let n=z7(),e=n.BufferUtil||n;ZK.exports={concat:Q7,mask(t,r,i,o,s){s<48?Y7(t,r,i,o,s):e.mask(t,r,i,o,s)},toArrayBuffer:Z7,toBuffer:zD,unmask(t,r){t.length<32?X7(t,r):e.unmask(t,r)}}}catch{ZK.exports={concat:Q7,mask:Y7,toArrayBuffer:Z7,toBuffer:zD,unmask:X7}}});var gE=O((L3e,i8)=>{"use strict";var Zce=_7(),hE=require("zlib"),e8=QD(),{kStatusCode:t8,NOOP:eue}=Xm(),tue=Buffer.from([0,0,255,255]),rue=Buffer.from([0]),XD=Symbol("permessage-deflate"),Xc=Symbol("total-length"),r8=Symbol("callback"),ep=Symbol("buffers"),eO=Symbol("error"),YD,tO=class{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!YD){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;YD=new Zce({concurrency:i})}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(e){let t=this._options,r=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{var i=t[r];if(i.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(i=i[0],r==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else if(r==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=i})}),e}decompress(e,t,r){YD.push(i=>{this._decompress(e,t,(o,s)=>{i(),r(o,s)})})}compress(e,t,r){YD.push(i=>{this._compress(e,t,(o,s)=>{i(),r(o,s)})})}_decompress(e,t,r){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?hE.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=hE.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:s})),this._inflate[XD]=this,this._inflate[Xc]=0,this._inflate[ep]=[],this._inflate.on("error",iue),this._inflate.on("data",n8)}this._inflate[r8]=r,this._inflate.write(e),t&&this._inflate.write(tue),this._inflate.flush(()=>{let o=this._inflate[eO];if(o){this._inflate.close(),this._inflate=null,r(o);return}let s=e8.concat(this._inflate[ep],this._inflate[Xc]);t&&this.params[`${i}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[Xc]=0,this._inflate[ep]=[]),r(null,s)})}_compress(e,t,r){if(!e||e.length===0){process.nextTick(r,null,rue);return}let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?hE.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=hE.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:s})),this._deflate[Xc]=0,this._deflate[ep]=[],this._deflate.on("error",eue),this._deflate.on("data",nue)}this._deflate.write(e),this._deflate.flush(hE.Z_SYNC_FLUSH,()=>{if(this._deflate){var o=e8.concat(this._deflate[ep],this._deflate[Xc]);t&&(o=o.slice(0,o.length-4)),t&&this.params[`${i}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[Xc]=0,this._deflate[ep]=[]),r(null,o)}})}};i8.exports=tO;function nue(n){this[ep].push(n),this[Xc]+=n.length}function n8(n){if(this[Xc]+=n.length,this[XD]._maxPayload<1||this[Xc]<=this[XD]._maxPayload){this[ep].push(n);return}this[eO]=new RangeError("Max payload size exceeded"),this[eO][t8]=1009,this.removeListener("data",n8),this.reset()}function iue(n){this[XD]._inflate=null,n[t8]=1007,this[r8](n)}});var s8=O((U3e,o8)=>{"use strict";var ly=class{constructor(e,t){this.target=t,this.type=e}},rO=class extends ly{constructor(e,t){super("message",t),this.data=e}},nO=class extends ly{constructor(e,t,r){super("close",r),this.wasClean=r._closeFrameReceived&&r._closeFrameSent,this.reason=t,this.code=e}},iO=class extends ly{constructor(e){super("open",e)}},oO=class extends ly{constructor(e,t){super("error",t),this.message=e.message,this.error=e}},oue={addEventListener(n,e){if(typeof e!="function")return;function t(s){e.call(this,new rO(s,this))}function r(s,a){e.call(this,new nO(s,a,this))}function i(s){e.call(this,new oO(s,this))}function o(){e.call(this,new iO(this))}n==="message"?(t._listener=e,this.on(n,t)):n==="close"?(r._listener=e,this.on(n,r)):n==="error"?(i._listener=e,this.on(n,i)):n==="open"?(o._listener=e,this.on(n,o)):this.on(n,e)},removeEventListener(n,e){let t=this.listeners(n);for(var r=0;r<t.length;r++)(t[r]===e||t[r]._listener===e)&&this.removeListener(n,t[r])}};o8.exports=oue});var sO=O((W3e,a8)=>{"use strict";var vE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function ql(n,e,t){Object.prototype.hasOwnProperty.call(n,e)?n[e].push(t):n[e]=[t]}function sue(n){let e={};if(n===void 0||n==="")return e;for(var t={},r=!1,i=!1,o=!1,s,a,l=-1,c=-1,u=0;u<n.length;u++){let g=n.charCodeAt(u);if(s===void 0)if(c===-1&&vE[g]===1)l===-1&&(l=u);else if(g===32||g===9)c===-1&&l!==-1&&(c=u);else if(g===59||g===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);let b=n.slice(l,c);g===44?(ql(e,b,t),t={}):s=b,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(c===-1&&vE[g]===1)l===-1&&(l=u);else if(g===32||g===9)c===-1&&l!==-1&&(c=u);else if(g===59||g===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u),ql(t,n.slice(l,c),!0),g===44&&(ql(e,s,t),t={},s=void 0),l=c=-1}else if(g===61&&l!==-1&&c===-1)a=n.slice(l,u),l=c=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(i){if(vE[g]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1?l=u:r||(r=!0),i=!1}else if(o)if(vE[g]===1)l===-1&&(l=u);else if(g===34&&l!==-1)o=!1,c=u;else if(g===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(g===34&&n.charCodeAt(u-1)===61)o=!0;else if(c===-1&&vE[g]===1)l===-1&&(l=u);else if(l!==-1&&(g===32||g===9))c===-1&&(c=u);else if(g===59||g===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);var d=n.slice(l,c);r&&(d=d.replace(/\\/g,""),r=!1),ql(t,a,d),g===44&&(ql(e,s,t),t={},s=void 0),a=void 0,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`)}if(l===-1||o)throw new SyntaxError("Unexpected end of input");c===-1&&(c=u);let f=n.slice(l,c);return s===void 0?ql(e,f,{}):(a===void 0?ql(t,f,!0):r?ql(t,a,f.replace(/\\/g,"")):ql(t,a,f),ql(e,s,t)),e}function aue(n){return Object.keys(n).map(e=>{var t=n[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(i=>{var o=r[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}a8.exports={format:aue,parse:sue}});var c8=O((V3e,l8)=>{"use strict";function lue(n){let e=n.length,t=0;for(;t<e;)if(!(n[t]&128))t++;else if((n[t]&224)===192){if(t+1===e||(n[t+1]&192)!==128||(n[t]&254)===192)return!1;t+=2}else if((n[t]&240)===224){if(t+2>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||n[t]===224&&(n[t+1]&224)===128||n[t]===237&&(n[t+1]&224)===160)return!1;t+=3}else if((n[t]&248)===240){if(t+3>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||(n[t+3]&192)!==128||n[t]===240&&(n[t+1]&240)===128||n[t]===244&&n[t+1]>143||n[t]>244)return!1;t+=4}else return!1;return!0}l8.exports=lue});var u8=O((j3e,aO)=>{"use strict";try{aO.exports=YK()(__dirname)}catch{aO.exports=c8()}});var lO=O(ZD=>{"use strict";try{let n=u8();ZD.isValidUTF8=typeof n=="object"?n.Validation.isValidUTF8:n}catch{ZD.isValidUTF8=()=>!0}ZD.isValidStatusCode=n=>n>=1e3&&n<=1013&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999});var pO=O((B3e,g8)=>{"use strict";var{Writable:cue}=require("stream"),d8=gE(),{BINARY_TYPES:uue,EMPTY_BUFFER:due,kStatusCode:pue,kWebSocket:mue}=Xm(),{concat:cO,toArrayBuffer:fue,unmask:hue}=QD(),{isValidStatusCode:gue,isValidUTF8:p8}=lO(),yE=0,m8=1,f8=2,h8=3,uO=4,vue=5,dO=class extends cue{constructor(e,t,r){super(),this._binaryType=e||uue[0],this[mue]=void 0,this._extensions=t||{},this._maxPayload=r|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=yE,this._loop=!1}_write(e,t,r){if(this._opcode===8&&this._state==yE)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=r.slice(e),r.slice(0,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0];e>=r.length?this._buffers.shift().copy(t,t.length-e):(r.copy(t,t.length-e,0,e),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do switch(this._state){case yE:t=this.getInfo();break;case m8:t=this.getPayloadLength16();break;case f8:t=this.getPayloadLength64();break;case h8:this.getMask();break;case uO:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,li(RangeError,"RSV2 and RSV3 must be clear",!0,1002);let t=(e[0]&64)===64;if(t&&!this._extensions[d8.extensionName])return this._loop=!1,li(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,li(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,li(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,li(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,li(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,li(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,li(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}else return this._loop=!1,li(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._payloadLength===126)this._state=m8;else if(this._payloadLength===127)this._state=f8;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,53-32)-1?(this._loop=!1,li(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,li(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=h8:this._state=uO}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=uO}getData(e){var t=due;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&hue(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=vue,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[d8.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(li(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(o)}let s=this.dataMessage();if(s)return t(s);this.startLoop(t)})}dataMessage(){if(this._fin){let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){var e;this._binaryType==="nodebuffer"?e=cO(r,t):this._binaryType==="arraybuffer"?e=fue(cO(r,t)):e=r,this.emit("message",e)}else{let i=cO(r,t);if(!p8(i))return this._loop=!1,li(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",i.toString())}}this._state=yE}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,""),this.end();else{if(e.length===1)return li(RangeError,"invalid payload length 1",!0,1002);{let t=e.readUInt16BE(0);if(!gue(t))return li(RangeError,`invalid status code ${t}`,!0,1002);let r=e.slice(2);if(!p8(r))return li(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,r.toString()),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=yE}};g8.exports=dO;function li(n,e,t,r){let i=new n(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,li),i[pue]=r,i}});var fO=O(($3e,b8)=>{"use strict";var{randomBytes:yue}=require("crypto"),v8=gE(),{EMPTY_BUFFER:bue}=Xm(),{isValidStatusCode:Iue}=lO(),{mask:y8,toBuffer:Zc}=QD(),mO=class n{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r=t.mask&&t.readOnly;var i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);let s=Buffer.allocUnsafe(r?e.length+i:i);if(s[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(s[0]|=64),s[1]=o,o===126?s.writeUInt16BE(e.length,2):o===127&&(s.writeUInt32BE(0,2),s.writeUInt32BE(e.length,6)),!t.mask)return[s,e];let a=yue(4);return s[1]|=128,s[i-4]=a[0],s[i-3]=a[1],s[i-2]=a[2],s[i-1]=a[3],r?(y8(e,a,s,i,e.length),[s]):(y8(e,a,e,0,e.length),[s,e])}close(e,t,r,i){var o;if(e===void 0)o=bue;else{if(typeof e!="number"||!Iue(e))throw new TypeError("First argument must be a valid error code number");t===void 0||t===""?(o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)):(o=Buffer.allocUnsafe(2+Buffer.byteLength(t)),o.writeUInt16BE(e,0),o.write(t,2))}this._deflating?this.enqueue([this.doClose,o,r,i]):this.doClose(o,r,i)}doClose(e,t,r){this.sendFrame(n.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),r)}ping(e,t,r){let i=Zc(e);this._deflating?this.enqueue([this.doPing,i,t,Zc.readOnly,r]):this.doPing(i,t,Zc.readOnly,r)}doPing(e,t,r,i){this.sendFrame(n.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:r}),i)}pong(e,t,r){let i=Zc(e);this._deflating?this.enqueue([this.doPong,i,t,Zc.readOnly,r]):this.doPong(i,t,Zc.readOnly,r)}doPong(e,t,r,i){this.sendFrame(n.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:r}),i)}send(e,t,r){let i=Zc(e),o=this._extensions[v8.extensionName];var s=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=i.length>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0),o){let l={fin:t.fin,rsv1:a,opcode:s,mask:t.mask,readOnly:Zc.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,l,r]):this.dispatch(i,this._compress,l,r)}else this.sendFrame(n.frame(i,{fin:t.fin,rsv1:!1,opcode:s,mask:t.mask,readOnly:Zc.readOnly}),r)}dispatch(e,t,r,i){if(!t){this.sendFrame(n.frame(e,r),i);return}let o=this._extensions[v8.extensionName];this._deflating=!0,o.compress(e,r.fin,(s,a)=>{this._deflating=!1,r.readOnly=!1,this.sendFrame(n.frame(a,r),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};b8.exports=mO});var vO=O((q3e,T8)=>{"use strict";var Sue=require("events"),I8=require("crypto"),Cue=require("https"),Eue=require("http"),wue=require("net"),Pue=require("tls"),cy=require("url"),tp=gE(),w8=s8(),S8=sO(),kue=pO(),xue=fO(),{BINARY_TYPES:C8,EMPTY_BUFFER:hO,GUID:Due,kStatusCode:_ue,kWebSocket:Co,NOOP:P8}=Xm(),e_=["CONNECTING","OPEN","CLOSING","CLOSED"],gO=[8,13],Tue=30*1e3,Eo=class n extends Sue{constructor(e,t,r){super(),this.readyState=n.CONNECTING,this.protocol="",this._binaryType=C8[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):typeof t=="object"&&t!==null&&(r=t,t=void 0),k8(this,e,t,r)):this._isServer=!0}get CONNECTING(){return n.CONNECTING}get CLOSING(){return n.CLOSING}get CLOSED(){return n.CLOSED}get OPEN(){return n.OPEN}get binaryType(){return this._binaryType}set binaryType(e){C8.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,r){let i=new kue(this._binaryType,this._extensions,r);this._sender=new xue(e,this._extensions),this._receiver=i,this._socket=e,i[Co]=this,e[Co]=this,i.on("conclude",Nue),i.on("drain",Mue),i.on("error",Kue),i.on("message",Oue),i.on("ping",Fue),i.on("pong",Lue),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",x8),e.on("data",t_),e.on("end",D8),e.on("error",_8),this.readyState=n.OPEN,this.emit("open")}emitClose(){if(this.readyState=n.CLOSED,!this._socket){this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[tp.extensionName]&&this._extensions[tp.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){let r="WebSocket was closed before the connection was established";return eu(this,this._req,r)}if(this.readyState===n.CLOSING){this._closeFrameSent&&this._closeFrameReceived&&this._socket.end();return}this.readyState=n.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Tue)}}ping(e,t,r){if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),this.readyState!==n.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${e_[this.readyState]})`);if(r)return r(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.ping(e||hO,t,r)}pong(e,t,r){if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),this.readyState!==n.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${e_[this.readyState]})`);if(r)return r(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.pong(e||hO,t,r)}send(e,t,r){if(typeof t=="function"&&(r=t,t={}),this.readyState!==n.OPEN){let o=new Error(`WebSocket is not open: readyState ${this.readyState} (${e_[this.readyState]})`);if(r)return r(o);throw o}typeof e=="number"&&(e=e.toString());let i=Object.assign({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[tp.extensionName]||(i.compress=!1),this._sender.send(e||hO,i,r)}terminate(){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){let e="WebSocket was closed before the connection was established";return eu(this,this._req,e)}this._socket&&(this.readyState=n.CLOSING,this._socket.destroy())}}};e_.forEach((n,e)=>{Eo[n]=e});["open","error","close","message"].forEach(n=>{Object.defineProperty(Eo.prototype,`on${n}`,{get(){let e=this.listeners(n);for(var t=0;t<e.length;t++)if(e[t]._listener)return e[t]._listener},set(e){let t=this.listeners(n);for(var r=0;r<t.length;r++)t[r]._listener&&this.removeListener(n,t[r]);this.addEventListener(n,e)}})});Eo.prototype.addEventListener=w8.addEventListener;Eo.prototype.removeEventListener=w8.removeEventListener;T8.exports=Eo;function k8(n,e,t,r){let i=Object.assign({protocolVersion:gO[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},r,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0});if(!gO.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${gO.join(", ")})`);var o;typeof e=="object"&&e.href!==void 0?(o=e,n.url=e.href):(o=cy.URL?new cy.URL(e):cy.parse(e),n.url=e);let s=o.protocol==="ws+unix:";if(!o.host&&(!s||!o.pathname))throw new Error(`Invalid URL: ${n.url}`);let a=o.protocol==="wss:"||o.protocol==="https:",l=a?443:80,c=I8.randomBytes(16).toString("base64"),u=a?Cue.get:Eue.get,d=o.search?`${o.pathname||"/"}${o.search}`:o.pathname||"/";var f;if(i.createConnection=a?Aue:Rue,i.defaultPort=i.defaultPort||l,i.port=o.port||l,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers=Object.assign({"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket"},i.headers),i.path=d,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(f=new tp(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=S8.format({[tp.extensionName]:f.offer()})),t&&(i.headers["Sec-WebSocket-Protocol"]=t),i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),o.auth?i.auth=o.auth:(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),s){let b=d.split(":");i.socketPath=b[0],i.path=b[1]}var g=n._req=u(i);i.timeout&&g.on("timeout",()=>{eu(n,g,"Opening handshake has timed out")}),g.on("error",b=>{n._req.aborted||(g=n._req=null,n.readyState=Eo.CLOSING,n.emit("error",b),n.emitClose())}),g.on("response",b=>{let I=b.headers.location,w=b.statusCode;if(I&&i.followRedirects&&w>=300&&w<400){if(++n._redirects>i.maxRedirects){eu(n,g,"Maximum redirects exceeded");return}g.abort();let D=cy.URL?new cy.URL(I,e):cy.resolve(e,I);k8(n,D,t,r)}else n.emit("unexpected-response",g,b)||eu(n,g,`Unexpected server response: ${b.statusCode}`)}),g.on("upgrade",(b,I,w)=>{if(n.emit("upgrade",b),n.readyState!==Eo.CONNECTING)return;g=n._req=null;let D=I8.createHash("sha1").update(c+Due).digest("base64");if(b.headers["sec-websocket-accept"]!==D){eu(n,I,"Invalid Sec-WebSocket-Accept header");return}let A=b.headers["sec-websocket-protocol"],T=(t||"").split(/, */);var $;if(!t&&A?$="Server sent a subprotocol but none was requested":t&&!A?$="Server sent no subprotocol":A&&!T.includes(A)&&($="Server sent an invalid subprotocol"),$){eu(n,I,$);return}if(A&&(n.protocol=A),f)try{let ne=S8.parse(b.headers["sec-websocket-extensions"]);ne[tp.extensionName]&&(f.accept(ne[tp.extensionName]),n._extensions[tp.extensionName]=f)}catch{eu(n,I,"Invalid Sec-WebSocket-Extensions header");return}n.setSocket(I,w,i.maxPayload)})}function Rue(n){return n.protocolVersion&&(n.path=n.socketPath),wue.connect(n)}function Aue(n){return n.path=void 0,n.servername=n.servername||n.host,Pue.connect(n)}function eu(n,e,t){n.readyState=Eo.CLOSING;let r=new Error(t);Error.captureStackTrace(r,eu),e.setHeader?(e.abort(),e.once("abort",n.emitClose.bind(n)),n.emit("error",r)):(e.destroy(r),e.once("error",n.emit.bind(n,"error")),e.once("close",n.emitClose.bind(n)))}function Nue(n,e){let t=this[Co];t._socket.removeListener("data",t_),t._socket.resume(),t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=n,n===1005?t.close():t.close(n,e)}function Mue(){this[Co]._socket.resume()}function Kue(n){let e=this[Co];e._socket.removeListener("data",t_),e.readyState=Eo.CLOSING,e._closeCode=n[_ue],e.emit("error",n),e._socket.destroy()}function E8(){this[Co].emitClose()}function Oue(n){this[Co].emit("message",n)}function Fue(n){let e=this[Co];e.pong(n,!e._isServer,P8),e.emit("ping",n)}function Lue(n){this[Co].emit("pong",n)}function x8(){let n=this[Co];this.removeListener("close",x8),this.removeListener("end",D8),n.readyState=Eo.CLOSING,n._socket.read(),n._receiver.end(),this.removeListener("data",t_),this[Co]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",E8),n._receiver.on("finish",E8))}function t_(n){this[Co]._receiver.write(n)||this.pause()}function D8(){let n=this[Co];n.readyState=Eo.CLOSING,n._receiver.end(),this.end()}function _8(){let n=this[Co];this.removeListener("error",_8),this.on("error",P8),n.readyState=Eo.CLOSING,this.destroy()}});var N8=O((H3e,A8)=>{"use strict";var Uue=require("events"),Wue=require("crypto"),n_=require("http"),Zm=gE(),R8=sO(),Vue=vO(),{GUID:jue}=Xm(),Jue=/^[+/0-9A-Za-z]{22}==$/,yO=class extends Uue{constructor(e,t){if(super(),e=Object.assign({maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e),e.port==null&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');e.port!=null?(this._server=n_.createServer((r,i)=>{let o=n_.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=Bue(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(r,i,o)=>{this.handleUpgrade(r,i,o,s=>{this.emit("connection",s,r)})}})),e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(let r of this.clients)r.terminate();let t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,this.options.port!=null)){t.close(()=>this.emit("close"));return}process.nextTick($ue,this)}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,i){t.on("error",bO);let o=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"].trim():!1,s=e.headers.upgrade,a=+e.headers["sec-websocket-version"],l={};if(e.method!=="GET"||s===void 0||s.toLowerCase()!=="websocket"||!o||!Jue.test(o)||a!==8&&a!==13||!this.shouldHandle(e))return r_(t,400);if(this.options.perMessageDeflate){let c=new Zm(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let u=R8.parse(e.headers["sec-websocket-extensions"]);u[Zm.extensionName]&&(c.accept(u[Zm.extensionName]),l[Zm.extensionName]=c)}catch{return r_(t,400)}}if(this.options.verifyClient){let c={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.connection.authorized||e.connection.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(c,(u,d,f,g)=>{if(!u)return r_(t,d||401,f,g);this.completeUpgrade(o,l,e,t,r,i)});return}if(!this.options.verifyClient(c))return r_(t,401)}this.completeUpgrade(o,l,e,t,r,i)}completeUpgrade(e,t,r,i,o,s){if(!i.readable||!i.writable)return i.destroy();let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Wue.createHash("sha1").update(e+jue).digest("base64")}`],c=new Vue(null);var u=r.headers["sec-websocket-protocol"];if(u&&(u=u.split(",").map(que),this.options.handleProtocols?u=this.options.handleProtocols(u,r):u=u[0],u&&(l.push(`Sec-WebSocket-Protocol: ${u}`),c.protocol=u)),t[Zm.extensionName]){let d=t[Zm.extensionName].params,f=R8.format({[Zm.extensionName]:[d]});l.push(`Sec-WebSocket-Extensions: ${f}`),c._extensions=t}this.emit("headers",l,r),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",bO),c.setSocket(i,o,this.options.maxPayload),this.clients&&(this.clients.add(c),c.on("close",()=>this.clients.delete(c))),s(c)}};A8.exports=yO;function Bue(n,e){for(let t of Object.keys(e))n.on(t,e[t]);return function(){for(let r of Object.keys(e))n.removeListener(r,e[r])}}function $ue(n){n.emit("close")}function bO(){this.destroy()}function r_(n,e,t,r){n.writable&&(t=t||n_.STATUS_CODES[e],r=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(t)},r),n.write(`HTTP/1.1 ${e} ${n_.STATUS_CODES[e]}\r
`+Object.keys(r).map(i=>`${i}: ${r[i]}`).join(`\r
`)+`\r
\r
`+t)),n.removeListener("error",bO),n.destroy()}function que(n){return n.trim()}});var K8=O((G3e,M8)=>{"use strict";var i_=vO();i_.Server=N8();i_.Receiver=pO();i_.Sender=fO();M8.exports=i_});var F8=O((z3e,O8)=>{"use strict";O8.exports=K8()});var B8=O((c_,J8)=>{(function(n,e){typeof c_=="object"&&typeof J8<"u"?e(c_):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.lumino_algorithm={}))})(c_,function(n){"use strict";n.ArrayExt=void 0,function(F){function W(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q===0)return-1;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;j<V?Ce=j+1+(Q-V):Ce=j-V+1;for(var Ne=0;Ne<Ce;++Ne){var ar=(V+Ne)%Q;if(Z[ar]===ce)return ar}return-1}F.firstIndexOf=W;function pe(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q=Z.length;if(Q===0)return-1;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;V<j?Ce=V+1+(Q-j):Ce=V-j+1;for(var Ne=0;Ne<Ce;++Ne){var ar=(V-Ne+Q)%Q;if(Z[ar]===ce)return ar}return-1}F.lastIndexOf=pe;function Te(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q===0)return-1;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;j<V?Ce=j+1+(Q-V):Ce=j-V+1;for(var Ne=0;Ne<Ce;++Ne){var ar=(V+Ne)%Q;if(ce(Z[ar],ar))return ar}return-1}F.findFirstIndex=Te;function ze(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q=Z.length;if(Q===0)return-1;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;V<j?Ce=V+1+(Q-j):Ce=V-j+1;for(var Ne=0;Ne<Ce;++Ne){var ar=(V-Ne+Q)%Q;if(ce(Z[ar],ar))return ar}return-1}F.findLastIndex=ze;function Zr(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Te(Z,ce,V,j);return Q!==-1?Z[Q]:void 0}F.findFirstValue=Zr;function Ut(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q=ze(Z,ce,V,j);return Q!==-1?Z[Q]:void 0}F.findLastValue=Ut;function At(Z,ce,V,j,Q){j===void 0&&(j=0),Q===void 0&&(Q=-1);var Ce=Z.length;if(Ce===0)return 0;j<0?j=Math.max(0,j+Ce):j=Math.min(j,Ce-1),Q<0?Q=Math.max(0,Q+Ce):Q=Math.min(Q,Ce-1);for(var Ne=j,ar=Q-j+1;ar>0;){var hi=ar>>1,Sc=Ne+hi;V(Z[Sc],ce)<0?(Ne=Sc+1,ar-=hi+1):ar=hi}return Ne}F.lowerBound=At;function Dt(Z,ce,V,j,Q){j===void 0&&(j=0),Q===void 0&&(Q=-1);var Ce=Z.length;if(Ce===0)return 0;j<0?j=Math.max(0,j+Ce):j=Math.min(j,Ce-1),Q<0?Q=Math.max(0,Q+Ce):Q=Math.min(Q,Ce-1);for(var Ne=j,ar=Q-j+1;ar>0;){var hi=ar>>1,Sc=Ne+hi;V(Z[Sc],ce)>0?ar=hi:(Ne=Sc+1,ar-=hi+1)}return Ne}F.upperBound=Dt;function Er(Z,ce,V){if(Z===ce)return!0;if(Z.length!==ce.length)return!1;for(var j=0,Q=Z.length;j<Q;++j)if(V?!V(Z[j],ce[j]):Z[j]!==ce[j])return!1;return!0}F.shallowEqual=Er;function Vr(Z,ce){ce===void 0&&(ce={});var V=ce.start,j=ce.stop,Q=ce.step;if(Q===void 0&&(Q=1),Q===0)throw new Error("Slice `step` cannot be zero.");var Ce=Z.length;V===void 0?V=Q<0?Ce-1:0:V<0?V=Math.max(V+Ce,Q<0?-1:0):V>=Ce&&(V=Q<0?Ce-1:Ce),j===void 0?j=Q<0?-1:Ce:j<0?j=Math.max(j+Ce,Q<0?-1:0):j>=Ce&&(j=Q<0?Ce-1:Ce);var Ne;Q<0&&j>=V||Q>0&&V>=j?Ne=0:Q<0?Ne=Math.floor((j-V+1)/Q+1):Ne=Math.floor((j-V-1)/Q+1);for(var ar=[],hi=0;hi<Ne;++hi)ar[hi]=Z[V+hi*Q];return ar}F.slice=Vr;function Pr(Z,ce,V){var j=Z.length;if(!(j<=1)&&(ce<0?ce=Math.max(0,ce+j):ce=Math.min(ce,j-1),V<0?V=Math.max(0,V+j):V=Math.min(V,j-1),ce!==V)){for(var Q=Z[ce],Ce=ce<V?1:-1,Ne=ce;Ne!==V;Ne+=Ce)Z[Ne]=Z[Ne+Ce];Z[V]=Q}}F.move=Pr;function en(Z,ce,V){ce===void 0&&(ce=0),V===void 0&&(V=-1);var j=Z.length;if(!(j<=1))for(ce<0?ce=Math.max(0,ce+j):ce=Math.min(ce,j-1),V<0?V=Math.max(0,V+j):V=Math.min(V,j-1);ce<V;){var Q=Z[ce],Ce=Z[V];Z[ce++]=Ce,Z[V--]=Q}}F.reverse=en;function B(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(!(Q<=1)&&(V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1),!(V>=j))){var Ce=j-V+1;if(ce>0?ce=ce%Ce:ce<0&&(ce=(ce%Ce+Ce)%Ce),ce!==0){var Ne=V+ce;en(Z,V,Ne-1),en(Z,Ne,j),en(Z,V,j)}}}F.rotate=B;function X(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q!==0){V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;j<V?Ce=j+1+(Q-V):Ce=j-V+1;for(var Ne=0;Ne<Ce;++Ne)Z[(V+Ne)%Q]=ce}}F.fill=X;function de(Z,ce,V){var j=Z.length;ce<0?ce=Math.max(0,ce+j):ce=Math.min(ce,j);for(var Q=j;Q>ce;--Q)Z[Q]=Z[Q-1];Z[ce]=V}F.insert=de;function ye(Z,ce){var V=Z.length;if(ce<0&&(ce+=V),!(ce<0||ce>=V)){for(var j=Z[ce],Q=ce+1;Q<V;++Q)Z[Q-1]=Z[Q];return Z.length=V-1,j}}F.removeAt=ye;function Be(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=W(Z,ce,V,j);return Q!==-1&&ye(Z,Q),Q}F.removeFirstOf=Be;function tn(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q=pe(Z,ce,V,j);return Q!==-1&&ye(Z,Q),Q}F.removeLastOf=tn;function yt(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q===0)return 0;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);for(var Ce=0,Ne=0;Ne<Q;++Ne)V<=j&&Ne>=V&&Ne<=j&&Z[Ne]===ce||j<V&&(Ne<=j||Ne>=V)&&Z[Ne]===ce?Ce++:Ce>0&&(Z[Ne-Ce]=Z[Ne]);return Ce>0&&(Z.length=Q-Ce),Ce}F.removeAllOf=yt;function wt(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q,Ce=Te(Z,ce,V,j);return Ce!==-1&&(Q=ye(Z,Ce)),{index:Ce,value:Q}}F.removeFirstWhere=wt;function Qe(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q,Ce=ze(Z,ce,V,j);return Ce!==-1&&(Q=ye(Z,Ce)),{index:Ce,value:Q}}F.removeLastWhere=Qe;function Tt(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q===0)return 0;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);for(var Ce=0,Ne=0;Ne<Q;++Ne)V<=j&&Ne>=V&&Ne<=j&&ce(Z[Ne],Ne)||j<V&&(Ne<=j||Ne>=V)&&ce(Z[Ne],Ne)?Ce++:Ce>0&&(Z[Ne-Ce]=Z[Ne]);return Ce>0&&(Z.length=Q-Ce),Ce}F.removeAllWhere=Tt}(n.ArrayExt||(n.ArrayExt={}));function e(F){var W;return typeof F.iter=="function"?W=F.iter():W=new d(F),W}function t(F){return new f(F)}function r(F){return new g(F)}function i(F){return new b(F)}function o(F){return new I(F)}function s(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(W(ze,pe++)===!1)return}function a(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(!W(ze,pe++))return!1;return!0}function l(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(W(ze,pe++))return!0;return!1}function c(F){for(var W=0,pe=[],Te=e(F),ze;(ze=Te.next())!==void 0;)pe[W++]=ze;return pe}function u(F){for(var W=e(F),pe,Te={};(pe=W.next())!==void 0;)Te[pe[0]]=pe[1];return Te}var d=function(){function F(W){this._index=0,this._source=W}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._source.length))return this._source[this._index++]},F}(),f=function(){function F(W,pe){pe===void 0&&(pe=Object.keys(W)),this._index=0,this._source=W,this._keys=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source,this._keys);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?W:this.next()}},F}(),g=function(){function F(W,pe){pe===void 0&&(pe=Object.keys(W)),this._index=0,this._source=W,this._keys=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source,this._keys);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?this._source[W]:this.next()}},F}(),b=function(){function F(W,pe){pe===void 0&&(pe=Object.keys(W)),this._index=0,this._source=W,this._keys=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source,this._keys);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?[W,this._source[W]]:this.next()}},F}(),I=function(){function F(W){this._fn=W}return F.prototype.iter=function(){return this},F.prototype.clone=function(){throw new Error("An `FnIterator` cannot be cloned.")},F.prototype.next=function(){return this._fn.call(void 0)},F}();function w(){for(var F=[],W=0;W<arguments.length;W++)F[W]=arguments[W];return new D(e(F.map(e)))}var D=function(){function F(W){this._cloned=!1,this._source=W,this._active=void 0}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source.clone());return W._active=this._active&&this._active.clone(),W._cloned=!0,this._cloned=!0,W},F.prototype.next=function(){if(this._active===void 0){var W=this._source.next();if(W===void 0)return;this._active=this._cloned?W.clone():W}var pe=this._active.next();return pe!==void 0?pe:(this._active=void 0,this.next())},F}();function A(){return new T}var T=function(){function F(){}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F},F.prototype.next=function(){},F}();function $(F,W){return W===void 0&&(W=0),new ne(e(F),W)}var ne=function(){function F(W,pe){this._source=W,this._index=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.clone(),this._index)},F.prototype.next=function(){var W=this._source.next();if(W!==void 0)return[this._index++,W]},F}();function H(F,W){return new oe(e(F),W)}var oe=function(){function F(W,pe){this._index=0,this._source=W,this._fn=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source.clone(),this._fn);return W._index=this._index,W},F.prototype.next=function(){for(var W=this._fn,pe=this._source,Te;(Te=pe.next())!==void 0;)if(W(Te,this._index++))return Te},F}();function ae(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(W(ze,pe++))return ze}function Y(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(W(ze,pe++))return pe-1;return-1}function Ie(F,W){var pe=e(F),Te=pe.next();if(Te!==void 0){for(var ze=Te;(Te=pe.next())!==void 0;)W(Te,ze)<0&&(ze=Te);return ze}}function Oe(F,W){var pe=e(F),Te=pe.next();if(Te!==void 0){for(var ze=Te;(Te=pe.next())!==void 0;)W(Te,ze)>0&&(ze=Te);return ze}}function pt(F,W){var pe=e(F),Te=pe.next();if(Te!==void 0){for(var ze=Te,Zr=Te;(Te=pe.next())!==void 0;)W(Te,ze)<0?ze=Te:W(Te,Zr)>0&&(Zr=Te);return[ze,Zr]}}function mt(F,W){return new kt(e(F),W)}var kt=function(){function F(W,pe){this._index=0,this._source=W,this._fn=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source.clone(),this._fn);return W._index=this._index,W},F.prototype.next=function(){var W=this._source.next();if(W!==void 0)return this._fn.call(void 0,W,this._index++)},F}();function ee(F,W,pe){return W===void 0?new Pe(0,F,1):pe===void 0?new Pe(F,W,1):new Pe(F,W,pe)}var Pe=function(){function F(W,pe,Te){this._index=0,this._start=W,this._stop=pe,this._step=Te,this._length=_e.rangeLength(W,pe,Te)}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._start,this._stop,this._step);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._length))return this._start+this._step*this._index++},F}(),_e;(function(F){function W(pe,Te,ze){return ze===0?1/0:pe>Te&&ze>0||pe<Te&&ze<0?0:Math.ceil((Te-pe)/ze)}F.rangeLength=W})(_e||(_e={}));function he(F,W,pe){var Te=0,ze=e(F),Zr=ze.next();if(Zr===void 0&&pe===void 0)throw new TypeError("Reduce of empty iterable with no initial value.");if(Zr===void 0)return pe;var Ut=ze.next();if(Ut===void 0&&pe===void 0)return Zr;if(Ut===void 0)return W(pe,Zr,Te++);var At;pe===void 0?At=W(Zr,Ut,Te++):At=W(W(pe,Zr,Te++),Ut,Te++);for(var Dt;(Dt=ze.next())!==void 0;)At=W(At,Dt,Te++);return At}function gt(F,W){return new sr(F,W)}function Oi(F){return new sr(F,1)}var sr=function(){function F(W,pe){this._value=W,this._count=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._value,this._count)},F.prototype.next=function(){if(!(this._count<=0))return this._count--,this._value},F}();function fi(F){var W;return typeof F.retro=="function"?W=F.retro():W=new Lu(F),W}var Lu=function(){function F(W){this._source=W,this._index=W.length-1}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index<0||this._index>=this._source.length))return this._source[this._index--]},F}();function Wr(F){var W=[],pe=new Set,Te=new Map;return s(F,ze),Te.forEach(function(Ut,At){Zr(At)}),W;function ze(Ut){var At=Ut[0],Dt=Ut[1],Er=Te.get(Dt);Er?Er.push(At):Te.set(Dt,[At])}function Zr(Ut){if(!pe.has(Ut)){pe.add(Ut);var At=Te.get(Ut);At&&At.forEach(Zr),W.push(Ut)}}}function zs(F,W){return new Ja(e(F),W)}var Ja=function(){function F(W,pe){this._source=W,this._step=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.clone(),this._step)},F.prototype.next=function(){for(var W=this._source.next(),pe=this._step-1;pe>0;--pe)this._source.next();return W},F}();n.StringExt=void 0,function(F){function W(Ut,At,Dt){Dt===void 0&&(Dt=0);for(var Er=new Array(At.length),Vr=0,Pr=Dt,en=At.length;Vr<en;++Vr,++Pr){if(Pr=Ut.indexOf(At[Vr],Pr),Pr===-1)return null;Er[Vr]=Pr}return Er}F.findIndices=W;function pe(Ut,At,Dt){Dt===void 0&&(Dt=0);var Er=W(Ut,At,Dt);if(!Er)return null;for(var Vr=0,Pr=0,en=Er.length;Pr<en;++Pr){var B=Er[Pr]-Dt;Vr+=B*B}return{score:Vr,indices:Er}}F.matchSumOfSquares=pe;function Te(Ut,At,Dt){Dt===void 0&&(Dt=0);var Er=W(Ut,At,Dt);if(!Er)return null;for(var Vr=0,Pr=Dt-1,en=0,B=Er.length;en<B;++en){var X=Er[en];Vr+=X-Pr-1,Pr=X}return{score:Vr,indices:Er}}F.matchSumOfDeltas=Te;function ze(Ut,At,Dt){for(var Er=[],Vr=0,Pr=0,en=At.length;Vr<en;){for(var B=At[Vr],X=At[Vr];++Vr<en&&At[Vr]===X+1;)X++;Pr<B&&Er.push(Ut.slice(Pr,B)),B<X+1&&Er.push(Dt(Ut.slice(B,X+1))),Pr=X+1}return Pr<Ut.length&&Er.push(Ut.slice(Pr)),Er}F.highlight=ze;function Zr(Ut,At){return Ut<At?-1:Ut>At?1:0}F.cmp=Zr}(n.StringExt||(n.StringExt={}));function Rt(F,W){return new Fi(e(F),W)}var Fi=function(){function F(W,pe){this._source=W,this._count=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.clone(),this._count)},F.prototype.next=function(){if(!(this._count<=0)){var W=this._source.next();if(W!==void 0)return this._count--,W}},F}();function Yn(){for(var F=[],W=0;W<arguments.length;W++)F[W]=arguments[W];return new Ic(F.map(e))}var Ic=function(){function F(W){this._source=W}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.map(function(W){return W.clone()}))},F.prototype.next=function(){for(var W=new Array(this._source.length),pe=0,Te=this._source.length;pe<Te;++pe){var ze=this._source[pe].next();if(ze===void 0)return;W[pe]=ze}return W},F}();n.ArrayIterator=d,n.ChainIterator=D,n.EmptyIterator=T,n.EnumerateIterator=ne,n.FilterIterator=oe,n.FnIterator=I,n.ItemIterator=b,n.KeyIterator=f,n.MapIterator=kt,n.RangeIterator=Pe,n.RepeatIterator=sr,n.RetroArrayIterator=Lu,n.StrideIterator=Ja,n.TakeIterator=Fi,n.ValueIterator=g,n.ZipIterator=Ic,n.chain=w,n.each=s,n.empty=A,n.enumerate=$,n.every=a,n.filter=H,n.find=ae,n.findIndex=Y,n.iter=e,n.iterFn=o,n.iterItems=i,n.iterKeys=t,n.iterValues=r,n.map=mt,n.max=Oe,n.min=Ie,n.minmax=pt,n.once=Oi,n.range=ee,n.reduce=he,n.repeat=gt,n.retro=fi,n.some=l,n.stride=zs,n.take=Rt,n.toArray=c,n.toObject=u,n.topologicSort=Wr,n.zip=Yn,Object.defineProperty(n,"__esModule",{value:!0})})});var q8=O((u_,$8)=>{(function(n,e){typeof u_=="object"&&typeof $8<"u"?e(u_):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.lumino_properties={}))})(u_,function(n){"use strict";n.AttachedProperty=function(){function t(r){this._pid=e.nextPID(),this.name=r.name,this._create=r.create,this._coerce=r.coerce||null,this._compare=r.compare||null,this._changed=r.changed||null}return t.prototype.get=function(r){var i,o=e.ensureMap(r);return this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(r),i},t.prototype.set=function(r,i){var o,s=e.ensureMap(r);this._pid in s?o=s[this._pid]:o=s[this._pid]=this._createValue(r);var a=this._coerceValue(r,i);this._maybeNotify(r,o,s[this._pid]=a)},t.prototype.coerce=function(r){var i,o=e.ensureMap(r);this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(r);var s=this._coerceValue(r,i);this._maybeNotify(r,i,o[this._pid]=s)},t.prototype._createValue=function(r){var i=this._create;return i(r)},t.prototype._coerceValue=function(r,i){var o=this._coerce;return o?o(r,i):i},t.prototype._compareValue=function(r,i){var o=this._compare;return o?o(r,i):r===i},t.prototype._maybeNotify=function(r,i,o){var s=this._changed;s&&!this._compareValue(i,o)&&s(r,i,o)},t}(),function(t){function r(i){e.ownerData.delete(i)}t.clearData=r}(n.AttachedProperty||(n.AttachedProperty={}));var e;(function(t){t.ownerData=new WeakMap,t.nextPID=function(){var i=0;return function(){var o=Math.random(),s=(""+o).slice(2);return"pid-"+s+"-"+i++}}();function r(i){var o=t.ownerData.get(i);return o||(o=Object.create(null),t.ownerData.set(i,o),o)}t.ensureMap=r})(e||(e={})),Object.defineProperty(n,"__esModule",{value:!0})})});var p_=O((d_,H8)=>{(function(n,e){typeof d_=="object"&&typeof H8<"u"?e(d_,B8(),q8()):typeof define=="function"&&define.amd?define(["exports","@lumino/algorithm","@lumino/properties"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.lumino_signaling={},n.lumino_algorithm,n.lumino_properties))})(d_,function(n,e,t){"use strict";n.Signal=function(){function i(o){this._blockedCount=0,this.sender=o}return i.prototype.block=function(o){this._blockedCount++;try{o()}finally{this._blockedCount--}},i.prototype.connect=function(o,s){return r.connect(this,o,s)},i.prototype.disconnect=function(o,s){return r.disconnect(this,o,s)},i.prototype.emit=function(o){this._blockedCount||r.emit(this,o)},i}(),function(i){function o(g,b){var I=r.blockedProperty;I.set(g,I.get(g)+1);try{b()}finally{I.set(g,I.get(g)-1)}}i.blockAll=o;function s(g,b){r.disconnectBetween(g,b)}i.disconnectBetween=s;function a(g){r.disconnectSender(g)}i.disconnectSender=a;function l(g){r.disconnectReceiver(g)}i.disconnectReceiver=l;function c(g){r.disconnectAll(g)}i.disconnectAll=c;function u(g){r.disconnectAll(g)}i.clearData=u;function d(){return r.exceptionHandler}i.getExceptionHandler=d;function f(g){var b=r.exceptionHandler;return r.exceptionHandler=g,b}i.setExceptionHandler=f}(n.Signal||(n.Signal={}));var r;(function(i){i.exceptionHandler=function(H){console.error(H)};function o(H,oe,ae){ae=ae||void 0;var Y=f.get(H.sender);if(Y||(Y=[],f.set(H.sender,Y)),w(Y,H,oe,ae))return!1;var Ie=ae||oe,Oe=g.get(Ie);Oe||(Oe=[],g.set(Ie,Oe));var pt={signal:H,slot:oe,thisArg:ae};return Y.push(pt),Oe.push(pt),!0}i.connect=o;function s(H,oe,ae){ae=ae||void 0;var Y=f.get(H.sender);if(!Y||Y.length===0)return!1;var Ie=w(Y,H,oe,ae);if(!Ie)return!1;var Oe=ae||oe,pt=g.get(Oe);return Ie.signal=null,A(Y),A(pt),!0}i.disconnect=s;function a(H,oe){var ae=f.get(H);if(!(!ae||ae.length===0)){var Y=g.get(oe);!Y||Y.length===0||(e.each(Y,function(Ie){Ie.signal&&Ie.signal.sender===H&&(Ie.signal=null)}),A(ae),A(Y))}}i.disconnectBetween=a;function l(H){var oe=f.get(H);!oe||oe.length===0||(e.each(oe,function(ae){if(ae.signal){var Y=ae.thisArg||ae.slot;ae.signal=null,A(g.get(Y))}}),A(oe))}i.disconnectSender=l;function c(H){var oe=g.get(H);!oe||oe.length===0||(e.each(oe,function(ae){if(ae.signal){var Y=ae.signal.sender;ae.signal=null,A(f.get(Y))}}),A(oe))}i.disconnectReceiver=c;function u(H){l(H),c(H)}i.disconnectAll=u;function d(H,oe){if(!(i.blockedProperty.get(H.sender)>0)){var ae=f.get(H.sender);if(!(!ae||ae.length===0))for(var Y=0,Ie=ae.length;Y<Ie;++Y){var Oe=ae[Y];Oe.signal===H&&D(Oe,oe)}}}i.emit=d;var f=new WeakMap,g=new WeakMap,b=new Set,I=function(){var H=typeof requestAnimationFrame=="function";return H?requestAnimationFrame:setImmediate}();function w(H,oe,ae,Y){return e.find(H,function(Ie){return Ie.signal===oe&&Ie.slot===ae&&Ie.thisArg===Y})}function D(H,oe){var ae=H.signal,Y=H.slot,Ie=H.thisArg;try{Y.call(Ie,ae.sender,oe)}catch(Oe){i.exceptionHandler(Oe)}}function A(H){b.size===0&&I(T),b.add(H)}function T(){b.forEach($),b.clear()}function $(H){e.ArrayExt.removeAllWhere(H,ne)}function ne(H){return H.signal===null}i.blockedProperty=new t.AttachedProperty({name:"blocked",create:function(){return 0}})})(r||(r={})),Object.defineProperty(n,"__esModule",{value:!0})})});var AO=O((WQe,c5)=>{"use strict";var ode=require("child_process").spawn;function sde(n){if(n){n=n.trim();var e=/your \d+x\d+ screen size is bogus\. expect trouble/gi;return n=n.replace(e,""),n.trim()}}function ade(n,e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=!1,o=ode(n,e,t),s="",a="";o.stdout.on("data",function(l){s+=l.toString()}),o.stderr.on("data",function(l){a+=l.toString()}),o.on("error",function(l){i||(i=!0,r(new Error(l)))}),o.on("close",function(l){if(!i){if(i=!0,a=sde(a),a)return r(new Error(a));r(null,s,l)}})}c5.exports=ade});var d5=O((VQe,u5)=>{"use strict";var lde=require("os"),cde=AO();function ude(n){var e=["-A","-o","ppid,pid"];cde("ps",e,function(t,r,i){if(t)return n(t);if(i!==0)return n(new Error("pidtree ps command exited with code "+i));try{r=r.split(lde.EOL);for(var o=[],s=1;s<r.length;s++)r[s]=r[s].trim(),r[s]&&(r[s]=r[s].split(/\s+/),r[s][0]=parseInt(r[s][0],10),r[s][1]=parseInt(r[s][1],10),o.push(r[s]));n(null,o)}catch(a){n(a)}})}u5.exports=ude});var m5=O((jQe,p5)=>{"use strict";var dde=require("os"),pde=AO();function mde(n){var e=["PROCESS","get","ParentProcessId,ProcessId"],t={windowsHide:!0,windowsVerbatimArguments:!0};pde("wmic",e,t,function(r,i,o){if(r){n(r);return}if(o!==0){n(new Error("pidtree wmic command exited with code "+o));return}try{i=i.split(dde.EOL);for(var s=[],a=1;a<i.length;a++)i[a]=i[a].trim(),i[a]&&(i[a]=i[a].split(/\s+/),i[a][0]=parseInt(i[a][0],10),i[a][1]=parseInt(i[a][1],10),s.push(i[a]));n(null,s)}catch(l){n(l)}})}p5.exports=mde});var v5=O((JQe,g5)=>{"use strict";var h5=require("os"),fde={darwin:"ps",sunos:"ps",freebsd:"ps",netbsd:"ps",win:"wmic",linux:"ps",aix:"ps"},hde={ps:()=>d5(),wmic:()=>m5()},NO=h5.platform();NO.startsWith("win")&&(NO="win");var f5=fde[NO];function gde(n){f5===void 0&&n(new Error(h5.platform()+" is not supported yet, please open an issue (https://github.com/simonepri/pidtree)"));var e=hde[f5]();e(n)}g5.exports=gde});var b5=O((BQe,y5)=>{"use strict";var vde=v5();function yde(n,e,t){if(typeof e=="function"&&(t=e,e={}),typeof e!="object"&&(e={}),n=parseInt(n,10),isNaN(n)||n<-1){t(new TypeError("The pid provided is invalid"));return}vde(function(r,i){if(r){t(r);return}if(n===-1){for(var o=0;o<i.length;o++)i[o]=e.advanced?{ppid:i[o][0],pid:i[o][1]}:i[o]=i[o][1];t(null,i);return}for(var s,a=0;a<i.length;a++){if(i[a][1]===n){s=e.advanced?{ppid:i[a][0],pid:n}:n;break}i[a][0]===n&&(s=e.advanced?{pid:n}:n)}if(!s){t(new Error("No matching pid found"));return}for(var l={};i.length>0;){var c=i.pop();l[c[0]]?l[c[0]].push(c[1]):l[c[0]]=[c[1]]}for(var u=0,d=[s];u<d.length;){var f=e.advanced?d[u++].pid:d[u++];if(l[f]){for(var g=l[f].length,b=0;b<g;b++)d.push(e.advanced?{ppid:f,pid:l[f][b]}:l[f][b]);delete l[f]}}e.root||d.shift(),t(null,d)})}y5.exports=yde});var C5=O(($Qe,S5)=>{"use strict";function bde(n,e,t){return new Promise(function(r,i){n(e,t,function(o,s){if(o)return i(o);r(s)})})}String.prototype.startsWith||(String.prototype.startsWith=function(n){return this.substring(0,n.length)===n});var I5=b5();function Ide(n,e,t){if(typeof e=="function"&&(t=e,e=void 0),typeof t=="function"){I5(n,e,t);return}return bde(I5,n,e)}S5.exports=Ide});var T5=O((qQe,_5)=>{var E5=Array.prototype.slice,w5=typeof Object.keys=="function"?Object.keys:function(n){var e=[];for(var t in n)e.push(t);return e},P5=_5.exports=function(n,e){return n===0&&e===0?Sde(n,e):n===e?!0:n instanceof Date&&e instanceof Date?n.getTime()===e.getTime():D5(n)?D5(e):typeof n!="object"&&typeof e!="object"?n==e:Cde(n,e)};function k5(n){return n==null}function x5(n){return Object.prototype.toString.call(n)=="[object Arguments]"}function D5(n){return typeof n=="number"&&n!==n}function Sde(n,e){return 1/n===1/e}function Cde(n,e){if(k5(n)||k5(e)||n.prototype!==e.prototype)return!1;if(x5(n))return x5(e)?(n=E5.call(n),e=E5.call(e),P5(n,e)):!1;try{var t=w5(n),r=w5(e),i,o}catch{return!1}if(t.length!=r.length)return!1;for(t.sort(),r.sort(),o=t.length-1;o>=0;o--)if(t[o]!=r[o])return!1;for(o=t.length-1;o>=0;o--)if(i=t[o],!P5(n[i],e[i]))return!1;return!0}});var N5=O((HQe,A5)=>{"use strict";var R5="[a-fA-F\\d:]",ap=n=>n&&n.includeBoundaries?`(?:(?<=\\s|^)(?=${R5})|(?<=${R5})(?=\\s|$))`:"",wa="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Dn="[a-fA-F\\d]{1,4}",O_=`
(?:
(?:${Dn}:){7}(?:${Dn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Dn}:){6}(?:${wa}|:${Dn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Dn}:){5}(?::${wa}|(?::${Dn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Dn}:){4}(?:(?::${Dn}){0,1}:${wa}|(?::${Dn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Dn}:){3}(?:(?::${Dn}){0,2}:${wa}|(?::${Dn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Dn}:){2}(?:(?::${Dn}){0,3}:${wa}|(?::${Dn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Dn}:){1}(?:(?::${Dn}){0,4}:${wa}|(?::${Dn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Dn}){0,5}:${wa}|(?::${Dn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Ede=new RegExp(`(?:^${wa}$)|(?:^${O_}$)`),wde=new RegExp(`^${wa}$`),Pde=new RegExp(`^${O_}$`),MO=n=>n&&n.exact?Ede:new RegExp(`(?:${ap(n)}${wa}${ap(n)})|(?:${ap(n)}${O_}${ap(n)})`,"g");MO.v4=n=>n&&n.exact?wde:new RegExp(`${ap(n)}${wa}${ap(n)}`,"g");MO.v6=n=>n&&n.exact?Pde:new RegExp(`${ap(n)}${O_}${ap(n)}`,"g");A5.exports=MO});var M5=O((GQe,kde)=>{kde.exports={name:"is2",version:"2.0.7",description:"A type checking library where each exported function returns either true or false and does not throw. Also added tests.",license:"MIT",tags:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],keywords:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],author:"Enrico Marino <enrico.marino@email.com>",maintainers:"Edmond Meinfelder <edmond@stdarg.com>, Chris Oyler <christopher.oyler@gmail.com>",homepage:"http://github.com/stdarg/is2",repository:{type:"git",url:"git@github.com:stdarg/is2.git"},bugs:{url:"http://github.com/stdarg/is/issues"},main:"./index.js",scripts:{test:"./node_modules/.bin/mocha -C --reporter list tests.js"},engines:{node:">=v0.10.0"},dependencies:{"deep-is":"^0.1.3","ip-regex":"^4.1.0","is-url":"^1.2.4"},devDependencies:{mocha:"6.1.4",mongodb:"3.2.4"}}});var O5=O((zQe,K5)=>{K5.exports=Tde;var xde=/^(?:\w+:)?\/\/(\S+)$/,Dde=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,_de=/^[^\s\.]+\.\S{2,}$/;function Tde(n){if(typeof n!="string")return!1;var e=n.match(xde);if(!e)return!1;var t=e[1];return t?!!(Dde.test(t)||_de.test(t)):!1}});var U5=O(L5=>{"use strict";var F5={}.hasOwnProperty,hr={}.toString,C=L5,Rde=T5(),Ade=N5();C.version=M5().version;C.browser=function(){return!C.node()&&typeof window<"u"&&hr.call(window)==="[object global]"};C.defined=function(n){return typeof n<"u"};C.def=C.defined;C.nodejs=function(){return process&&process.hasOwnProperty("version")&&process.hasOwnProperty("versions")};C.node=C.nodejs;C.undefined=function(n){return n===void 0};C.udef=C.undef=C.undefined;C.array=function(n){return hr.call(n)==="[object Array]"};C.arr=C.ary=C.arry=C.array;C.arrayLike=function(n){return C.nullOrUndef(n)?!1:n!==void 0&&F5.call(n,"length")&&isFinite(n.length)};C.arrLike=C.arryLike=C.aryLike=C.arraylike=C.arrayLike;C.arguments=function(n){return hr.call(n)==="[object Arguments]"};C.args=C.arguments;C.boolean=function(n){return hr.call(n)==="[object Boolean]"};C.bool=C.boolean;C.buffer=function(n){return C.nodejs()&&Buffer&&Buffer.hasOwnProperty("isBuffer")&&Buffer.isBuffer(n)};C.buff=C.buf=C.buffer;C.date=function(n){return hr.call(n)==="[object Date]"};C.error=function(n){return hr.call(n)==="[object Error]"};C.err=C.error;C.false=function(n){return n===!1};C.function=function(n){return C.syncFunction(n)||C.asyncFunction(n)};C.fun=C.func=C.function;C.asyncFunction=function(n){return hr.call(n)==="[object AsyncFunction]"};C.asyncFun=C.asyncFunc=C.asyncFunction;C.syncFunction=function(n){return hr.call(n)==="[object Function]"};C.syncFun=C.syncFunc=C.syncFunction;C.null=function(n){return n===null};C.nullOrUndefined=function(n){return n===null||typeof n>"u"};C.nullOrUndef=C.nullOrUndefined;C.number=function(n){return hr.call(n)==="[object Number]"};C.num=C.number;C.object=function(n){return hr.call(n)==="[object Object]"};C.obj=C.object;C.regExp=function(n){return hr.call(n)==="[object RegExp]"};C.re=C.regexp=C.regExp;C.string=function(n){return hr.call(n)==="[object String]"};C.str=C.string;C.true=function(n){return n===!0};var Nde=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}","i");C.uuid=function(n){return Nde.test(n)};C.equal=function(n,e){var t=hr.call(n);return typeof n!=typeof e||t!==hr.call(e)?!1:t==="[object Object]"||t==="[object Array]"?Rde(n,e):t==="[object Function]"?n.prototype===e.prototype:t==="[object Date]"?n.getTime()===e.getTime():n===e};C.objEquals=C.eq=C.equal;var Mde={boolean:1,number:1,string:1,undefined:1};C.hosted=function(n,e){if(C.nullOrUndef(n))return!1;var t=typeof e[n];return t==="object"?!!e[n]:!Mde[t]};C.instanceOf=function(n,e){return C.nullOrUndef(n)||C.nullOrUndef(e)?!1:n instanceof e};C.instOf=C.instanceof=C.instanceOf;C.objectInstanceOf=function(n,e){try{return hr.call(n)==="[object Object]"&&n instanceof e}catch{return!1}};C.instOf=C.instanceOf=C.objInstOf=C.objectInstanceOf;C.type=function(n,e){return typeof n===e};C.a=C.type;C.empty=function(n){var e=hr.call(n);if(e==="[object Array]"||e==="[object Arguments]")return n.length===0;if(e==="[object Object]"){for(var t in n)if(F5.call(n,t))return!1;return!0}return e==="[object String]"?n==="":!1};C.emptyArguments=function(n){return hr.call(n)==="[object Arguments]"&&n.length===0};C.noArgs=C.emptyArgs=C.emptyArguments;C.emptyArray=function(n){return hr.call(n)==="[object Array]"&&n.length===0};C.emptyArry=C.emptyAry=C.emptyArray;C.emptyArrayLike=function(n){return n.length===0};C.emptyArrLike=C.emptyArrayLike;C.emptyString=function(n){return C.string(n)&&n.length===0};C.emptyStr=C.emptyString;C.nonEmptyArray=function(n){return hr.call(n)==="[object Array]"&&n.length>0};C.nonEmptyArr=C.nonEmptyArry=C.nonEmptyAry=C.nonEmptyArray;C.nonEmptyObject=function(n){return hr.call(n)==="[object Object]"&&Object.keys(n).length>0};C.nonEmptyObj=C.nonEmptyObject;C.emptyObject=function(n){return hr.call(n)==="[object Object]"&&Object.keys(n).length===0};C.emptyObj=C.emptyObject;C.nonEmptyString=function(n){return C.string(n)&&n.length>0};C.nonEmptyStr=C.nonEmptyString;C.even=function(n){return hr.call(n)==="[object Number]"&&n%2===0};C.decimal=function(n){return hr.call(n)==="[object Number]"&&n%1!==0};C.dec=C.decNum=C.decimal;C.integer=function(n){return hr.call(n)==="[object Number]"&&n%1===0};C.int=C.integer;C.notANumber=function(n){return!C.num(n)||n!==n};C.nan=C.notANum=C.notANumber;C.odd=function(n){return!C.decimal(n)&&hr.call(n)==="[object Number]"&&n%2!==0};C.oddNumber=C.oddNum=C.odd;C.positiveNumber=function(n){return hr.call(n)==="[object Number]"&&n>0};C.pos=C.positive=C.posNum=C.positiveNum=C.positiveNumber;C.negativeNumber=function(n){return hr.call(n)==="[object Number]"&&n<0};C.neg=C.negNum=C.negativeNum=C.negativeNumber;C.negativeInteger=function(n){return hr.call(n)==="[object Number]"&&n%1===0&&n<0};C.negativeInt=C.negInt=C.negativeInteger;C.positiveInteger=function(n){return hr.call(n)==="[object Number]"&&n%1===0&&n>0};C.posInt=C.positiveInt=C.positiveInteger;C.divisibleBy=function(n,e){return n===0?!1:hr.call(n)==="[object Number]"&&e!==0&&n%e===0};C.divBy=C.divisBy=C.divisibleBy;C.greaterOrEqualTo=function(n,e){return n>=e};C.greaterOrEqual=C.ge=C.greaterOrEqualTo;C.greaterThan=function(n,e){return n>e};C.gt=C.greaterThan;C.lessThanOrEqualTo=function(n,e){return n<=e};C.lessThanOrEq=C.lessThanOrEqual=C.le=C.lessThanOrEqualTo;C.lessThan=function(n,e){return n<e};C.lt=C.lessThan;C.maximum=function(n,e){if(!C.arrayLike(e)||!C.number(n))return!1;for(var t=e.length;--t>-1;)if(n<e[t])return!1;return!0};C.max=C.maximum;C.minimum=function(n,e){if(!C.arrayLike(e)||!C.number(n))return!1;for(var t=e.length;--t>-1;)if(n>e[t])return!1;return!0};C.min=C.minimum;C.within=function(n,e,t){return n>=e&&n<=t};C.withIn=C.within;C.prettyClose=function(n,e,t){return!C.number(n)||!C.number(e)||C.defined(t)&&!C.posInt(t)?!1:(C.undefined(t)&&(t=2),n.toFixed(t)===e.toFixed(t))};C.closish=C.near=C.prettyClose;C.dnsAddress=function(n){return!(!C.nonEmptyStr(n)||n.length>255||Ode.test(n)||!Kde.test(n))};C.dnsAddr=C.dns=C.dnsAddress;var Kde=/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/,Ode=/^([0-9]|[0-9][0-9\-]{0,61}[0-9])(\.([0-9]|[0-9][0-9\-]{0,61}[0-9]))*$/;C.emailAddress=function(n){return C.nonEmptyStr(n)?Fde.test(n):!1};C.email=C.emailAddr=C.emailAddress;var Fde=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;C.ipv4Address=function(n){if(!C.nonEmptyStr(n)||n.length>15)return!1;var e=n.split(".");if(!C.array(e)||e.length!==4)return!1;for(var t=0;t<e.length;t++){var r=parseInt(e[t],10);if(isNaN(r)||r<0||r>255)return!1}return!0};C.ipv4=C.ipv4Addr=C.ipv4Address;C.ipv6Address=function(n){return C.nonEmptyStr(n)?Ade.v6({extract:!0}).test(n):!1};C.ipv6=C.ipv6Addr=C.ipv6Address;C.ipAddress=function(n){return C.nonEmptyStr(n)?C.ipv4Address(n)||C.ipv6Address(n):!1};C.ip=C.ipAddr=C.ipAddress;C.hostAddress=function(n){return C.nonEmptyStr(n)?C.dns(n)||C.ipv4(n)||C.ipv6(n):!1};C.host=C.hostIp=C.hostAddr=C.hostAddress;C.port=function(n){return!(!C.num(n)||C.negativeInt(n)||n>65535)};C.systemPort=function(n){return!!(C.port(n)&&n<1024)};C.sysPort=C.systemPort;C.userPort=function(n){return!!(C.port(n)&&n>1023)};C.creditCardNumber=function(n){if(!C.str(n))return!1;var e=n.split(""),t,r;for(t=e.length-1,r=1;t>-1;t--,r++)r%2===0&&(e[t]*=2);n=e.join("");var i=0;for(t=0;t<n.length;t++)i+=Math.floor(n[t]);return i%10===0};C.creditCard=C.creditCardNum=C.creditCardNumber;C.americanExpressCardNumber=function(n){if(!C.str(n)||n.length!==15)return!1;var e=Math.floor(n.slice(0,2));return!(e!==34&&e!==37||!C.creditCardNumber(n))};C.amexCard=C.amexCardNum=C.americanExpressCardNumber;C.chinaUnionPayCardNumber=function(n){if(!C.str(n)||n.length<16&&n.length>19)return!1;var e=Math.floor(n.slice(0,2));return!(e!==62&&e!==88)};C.chinaUnion=C.chinaUnionPayCard=C.chinaUnionPayCardNumber;C.dinersClubCarteBlancheCardNumber=function(n){if(!C.str(n)||n.length!==14)return!1;var e=Math.floor(n.slice(0,3));return!(e<300||e>305||!C.creditCardNumber(n))};C.dinersClubCB=C.dinersClubCarteBlancheCard=C.dinersClubCarteBlancheCardNumber;C.dinersClubInternationalCardNumber=function(n){if(!C.str(n)||n.length!==14)return!1;var e=Math.floor(n.slice(0,3)),t=Math.floor(n.slice(0,2));return!((e<300||e>305)&&e!==309&&t!==36&&(t<38||t>39)||!C.creditCardNumber(n))};C.dinersClubInt=C.dinersClubInternationalCard=C.dinersClubInternationalCardNumber;C.dinersClubUSACanadaCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,2));return!(e!==54&&e!==55||!C.creditCardNumber(n))};C.dinersClub=C.dinersClubUSACanCard=C.dinersClubUSACanadaCardNumber;C.discoverCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,6)),t=Math.floor(n.slice(0,3));return!(n.slice(0,4)!=="6011"&&(e<622126||e>622925)&&(t<644||t>649)&&n.slice(0,2)!=="65"||!C.creditCardNumber(n))};C.discover=C.discoverCard=C.discoverCardNumber;C.instaPaymentCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,3));return!(e<637||e>639||!C.creditCardNumber(n))};C.instaPayment=C.instaPaymentCardNumber;C.jcbCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,4));return!(e<3528||e>3589||!C.creditCardNumber(n))};C.jcb=C.jcbCard=C.jcbCardNumber;C.laserCardNumber=function(n){if(!C.str(n)||n.length<16&&n.length>19)return!1;var e=Math.floor(n.slice(0,4)),t=[6304,6706,6771,6709];return!(t.indexOf(e)===-1||!C.creditCardNumber(n))};C.laser=C.laserCard=C.laserCardNumber;C.maestroCardNumber=function(n){if(!C.str(n)||n.length<12||n.length>19)return!1;var e=n.slice(0,4),t=["5018","5020","5038","5612","5893","6304","6759","6761","6762","6763","0604","6390"];return!(t.indexOf(e)===-1||!C.creditCardNumber(n))};C.maestro=C.maestroCard=C.maestroCardNumber;C.dankortCardNumber=function(n){return!(!C.str(n)||n.length!==16||n.slice(0,4)!=="5019"||!C.creditCardNumber(n))};C.dankort=C.dankortCard=C.dankortCardNumber;C.masterCardCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,2));return!(e<50||e>55||!C.creditCardNumber(n))};C.masterCard=C.masterCardCard=C.masterCardCardNumber;C.visaCardNumber=function(n){return!(!C.str(n)||n.length!==13&&n.length!==16||n.slice(0,1)!=="4"||!C.creditCardNumber(n))};C.visa=C.visaCard=C.visaCardNumber;C.visaElectronCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,4)),t=[4026,4405,4508,4844,4913,4917];return n.slice(0,6)!=="417500"&&t.indexOf(e)===-1||!C.creditCardNumber(n),!1};C.visaElectron=C.visaElectronCard=C.visaElectronCardNumber;var Lde=/^[0-9a-fA-F]{24}$/;C.mongoId=C.objectId=C.objId=function(n){return!!n&&!Array.isArray(n)&&Lde.test(String(n))};C.matching=C.match=C.inArgs=function(n){if(arguments.length<2)return!1;for(var e=!1,t=1;t<arguments.length;t++){var r=C.equal(n,arguments[t]);e=e||r}return e};C.streetAddress=function(n){if(!C.str(n))return!1;var e=/\b\d+[\s](?:[A-Za-z0-9.-]+[\s]+)+\b(ALLEY|ALY|AVENUE|AVE|BEND|BND|BLUFFS?|BLFS?|BOULEVARD|BLVD|BRANCH|BR|CENTERS?|CTRS?|CIRCLES?|CIRS?|CLIFFS?|CLFS?|COURTS?|CTS?|COVES?|CVS?|CREEK|CRK|CRESCENT|CRES|CREST|CRST|CROSSING|XING|DRIVES?|DRS?|EXPRESSWAY|EXPY|FREEWAY|FWY|HEIGHTS|HTS|HIGHWAY|HWY|HILLS?|HLS?|LANE|LN|LOOP|MANORS?|MNRS?|MOTORWAY|MTWY|MOUNT|MT|PARKS?|PARKWAYS?|PKWY|PASS|PLACE|PL|PLAZA|PLZ|POINTS?|PTS?|RIDGES?|RDGS?|ROADS?|RDS?|ROUTE|RTE?|SHOALS?|SHLS?|SHORES?|SHRS?|SPRINGS?|SPGS?|SPURS?|STREETS?|STS?|SUMMIT|SMT|TERRACE|TER|THROUGHWAY|TRWY|TRAFFICWAY|TRFY|TRAIL|TRL|TURNPIKE|TPKE|VALLEYS?|VLYS?|WAYS?)+(?:[\.\-\s\,]?)*((APARTMENT|APT|APPT|#|NUMBER|NUM|FLOOR|FL|\s)?(\d)*)\b/ig;return e.test(n)};C.street=C.address=C.streetAddress;C.zipCode=function(n){if(C.undefined(n)||!(C.string(n)||C.number(n)))return!1;var e=/^\d{5}(?:-\d{4})?$/;return e.test(n)};C.zip=C.zipCode;C.phoneNumber=function(n){if(!C.string(n))return!1;var e=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:(\(?)(?:(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\)?)\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})/g;return e.test(n)};C.phone=C.phoneNumber;var Ude=O5();C.url=function(n){return Ude(n)};C.uri=C.url;C.enumerator=function(n,e){var t=!1;if(!C.defined(n)||!C.defined(e)||!C.arrayLike(e))return t;for(var r=0,i=e.length;r<i;r++)if(C.equal(n,e[r])){t=!0;break}return t};C.enum=C.inArray=C.enumerator});var KO=O((YQe,W5)=>{var Ay=1e3,Ny=Ay*60,My=Ny*60,lf=My*24,Wde=lf*7,Vde=lf*365.25;W5.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return jde(n);if(t==="number"&&isFinite(n))return e.long?Bde(n):Jde(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function jde(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*Vde;case"weeks":case"week":case"w":return t*Wde;case"days":case"day":case"d":return t*lf;case"hours":case"hour":case"hrs":case"hr":case"h":return t*My;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ny;case"seconds":case"second":case"secs":case"sec":case"s":return t*Ay;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Jde(n){var e=Math.abs(n);return e>=lf?Math.round(n/lf)+"d":e>=My?Math.round(n/My)+"h":e>=Ny?Math.round(n/Ny)+"m":e>=Ay?Math.round(n/Ay)+"s":n+"ms"}function Bde(n){var e=Math.abs(n);return e>=lf?F_(n,e,lf,"day"):e>=My?F_(n,e,My,"hour"):e>=Ny?F_(n,e,Ny,"minute"):e>=Ay?F_(n,e,Ay,"second"):n+" ms"}function F_(n,e,t,r){var i=e>=t*1.5;return Math.round(n/t)+" "+r+(i?"s":"")}});var OO=O((XQe,V5)=>{function $de(n){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=i,t.enabled=s,t.humanize=KO(),t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,f=null;function g(...b){if(!g.enabled)return;let I=g,w=Number(new Date),D=w-(d||w);I.diff=D,I.prev=d,I.curr=w,d=w,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let A=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,($,ne)=>{if($==="%%")return"%";A++;let H=t.formatters[ne];if(typeof H=="function"){let oe=b[A];$=H.call(I,oe),b.splice(A,1),A--}return $}),t.formatArgs.call(I,b),(I.log||t.log).apply(I,b)}return g.namespace=u,g.useColors=t.useColors(),g.color=t.selectColor(u),g.extend=r,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>f===null?t.enabled(u):f,set:b=>{f=b}}),typeof t.init=="function"&&t.init(g),g}function r(u,d){let f=t(this.namespace+(typeof d>"u"?":":d)+u);return f.log=this.log,f}function i(u){t.save(u),t.names=[],t.skips=[];let d,f=(typeof u=="string"?u:"").split(/[\s,]+/),g=f.length;for(d=0;d<g;d++)f[d]&&(u=f[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,f;for(d=0,f=t.skips.length;d<f;d++)if(t.skips[d].test(u))return!1;for(d=0,f=t.names.length;d<f;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}V5.exports=$de});var j5=O((Zo,L_)=>{Zo.formatArgs=Hde;Zo.save=Gde;Zo.load=zde;Zo.useColors=qde;Zo.storage=Qde();Zo.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Zo.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function qde(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Hde(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+L_.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(r=t))}),n.splice(r,0,e)}Zo.log=console.debug||console.log||(()=>{});function Gde(n){try{n?Zo.storage.setItem("debug",n):Zo.storage.removeItem("debug")}catch{}}function zde(){let n;try{n=Zo.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function Qde(){try{return localStorage}catch{}}L_.exports=OO()(Zo);var{formatters:Yde}=L_.exports;Yde.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var B5=O((ZQe,J5)=>{"use strict";J5.exports=(n,e)=>{e=e||process.argv;let t=n.startsWith("-")?"":n.length===1?"-":"--",r=e.indexOf(t+n),i=e.indexOf("--");return r!==-1&&(i===-1?!0:r<i)}});var LO=O((eYe,$5)=>{"use strict";var Xde=require("os"),Pa=B5(),Ni=process.env,Ky;Pa("no-color")||Pa("no-colors")||Pa("color=false")?Ky=!1:(Pa("color")||Pa("colors")||Pa("color=true")||Pa("color=always"))&&(Ky=!0);"FORCE_COLOR"in Ni&&(Ky=Ni.FORCE_COLOR.length===0||parseInt(Ni.FORCE_COLOR,10)!==0);function Zde(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function epe(n){if(Ky===!1)return 0;if(Pa("color=16m")||Pa("color=full")||Pa("color=truecolor"))return 3;if(Pa("color=256"))return 2;if(n&&!n.isTTY&&Ky!==!0)return 0;let e=Ky?1:0;if(process.platform==="win32"){let t=Xde.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in Ni)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Ni)||Ni.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in Ni)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Ni.TEAMCITY_VERSION)?1:0;if(Ni.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Ni){let t=parseInt((Ni.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Ni.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Ni.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Ni.TERM)||"COLORTERM"in Ni?1:(Ni.TERM==="dumb",e)}function FO(n){let e=epe(n);return Zde(e)}$5.exports={supportsColor:FO,stdout:FO(process.stdout),stderr:FO(process.stderr)}});var H5=O((di,W_)=>{var tpe=require("tty"),U_=require("util");di.init=lpe;di.log=ope;di.formatArgs=npe;di.save=spe;di.load=ape;di.useColors=rpe;di.destroy=U_.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");di.colors=[6,2,3,4,5,1];try{let n=LO();n&&(n.stderr||n).level>=2&&(di.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}di.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function rpe(){return"colors"in di.inspectOpts?!!di.inspectOpts.colors:tpe.isatty(process.stderr.fd)}function npe(n){let{namespace:e,useColors:t}=this;if(t){let r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),o=`  ${i};1m${e} \x1B[0m`;n[0]=o+n[0].split(`
`).join(`
`+o),n.push(i+"m+"+W_.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=ipe()+e+" "+n[0]}function ipe(){return di.inspectOpts.hideDate?"":new Date().toISOString()+" "}function ope(...n){return process.stderr.write(U_.format(...n)+`
`)}function spe(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function ape(){return process.env.DEBUG}function lpe(n){n.inspectOpts={};let e=Object.keys(di.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=di.inspectOpts[e[t]]}W_.exports=OO()(di);var{formatters:q5}=W_.exports;q5.o=function(n){return this.inspectOpts.colors=this.useColors,U_.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};q5.O=function(n){return this.inspectOpts.colors=this.useColors,U_.inspect(n,this.inspectOpts)}});var G5=O((tYe,UO)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?UO.exports=j5():UO.exports=H5()});var WO=O(cf=>{"use strict";cf.check=Z5;cf.waitUntilFreeOnHost=upe;cf.waitUntilFree=dpe;cf.waitUntilUsedOnHost=eq;cf.waitUntilUsed=ppe;cf.waitForStatus=j_;var ka=U5(),cpe=require("net"),z5=require("util"),V_=G5()("tcp-port-used"),Q5=2e3,Y5=250;function X5(){var n,e,t=new Promise(function(r,i){n=r,e=i});return{resolve:n,reject:e,promise:t}}function Oy(n,e,t,r,i){var o={};return o.port=n,o.host=e,o.inUse=t,o.retryTimeMs=r,o.timeOutMs=i,o}function Z5(n,e){var t=X5(),r=!0,i,o;if(ka.obj(n)?o=n:o=Oy(n,e),!ka.port(o.port))return V_("Error invalid port: "+z5.inspect(o.port)),t.reject(new Error("invalid port: "+z5.inspect(o.port))),t.promise;ka.nullOrUndefined(o.host)&&(V_("set host address to default 127.0.0.1"),o.host="127.0.0.1");function s(){i&&(i.removeAllListeners("connect"),i.removeAllListeners("error"),i.end(),i.destroy(),i.unref())}function a(){t.resolve(r),s()}function l(c){c.code!=="ECONNREFUSED"?t.reject(c):(r=!1,t.resolve(r)),s()}return i=new cpe.Socket,i.once("connect",a),i.once("error",l),i.connect({port:o.port,host:o.host},function(){}),t.promise}function j_(n,e,t,r,i){var o=X5(),s,a=!1,l,c;if(ka.obj(n)?c=n:c=Oy(n,e,t,r,i),!ka.bool(c.inUse))return o.reject(new Error("inUse must be a boolean")),o.promise;ka.positiveInt(c.retryTimeMs)||(c.retryTimeMs=Y5,V_("set retryTime to default "+Y5+"ms")),ka.positiveInt(c.timeOutMs)||(c.timeOutMs=Q5,V_("set timeOutMs to default "+Q5+"ms"));function u(){s&&clearTimeout(s),l&&clearTimeout(l)}function d(){a=!0,u(),o.reject(new Error("timeout"))}s=setTimeout(d,c.timeOutMs);function f(){Z5(c.port,c.host).then(function(g){if(!a)if(g===c.inUse){o.resolve(),u();return}else{l=setTimeout(function(){f()},c.retryTimeMs);return}},function(g){a||(o.reject(g),u())})}return f(),o.promise}function upe(n,e,t,r){var i;return ka.obj(n)?(i=n,i.inUse=!1):i=Oy(n,e,!1,t,r),j_(i)}function dpe(n,e,t){var r;return ka.obj(n)?(r=n,r.host="127.0.0.1",r.inUse=!1):r=Oy(n,"127.0.0.1",!1,e,t),j_(r)}function eq(n,e,t,r){var i;return ka.obj(n)?(i=n,i.inUse=!0):i=Oy(n,e,!0,t,r),j_(i)}function ppe(n,e,t){var r;return ka.obj(n)?(r=n,r.host="127.0.0.1",r.inUse=!0):r=Oy(n,"127.0.0.1",!0,e,t),eq(r)}});var sq=O((B_,Yl)=>{(function(n,e){typeof B_=="object"&&typeof Yl<"u"?e(B_):typeof define=="function"&&define.amd?define(["exports"],e):e(n.async=n.async||{})})(B_,function(n){"use strict";function e(S,P){P=P|0;for(var _=Math.max(S.length-P,0),K=Array(_),G=0;G<_;G++)K[G]=S[P+G];return K}var t=function(S){var P=e(arguments,1);return function(){var _=e(arguments);return S.apply(null,P.concat(_))}},r=function(S){return function(){var P=e(arguments),_=P.pop();S.call(this,P,_)}};function i(S){var P=typeof S;return S!=null&&(P=="object"||P=="function")}var o=typeof setImmediate=="function"&&setImmediate,s=typeof process=="object"&&typeof process.nextTick=="function";function a(S){setTimeout(S,0)}function l(S){return function(P){var _=e(arguments,1);S(function(){P.apply(null,_)})}}var c;o?c=setImmediate:s?c=process.nextTick:c=a;var u=l(c);function d(S){return r(function(P,_){var K;try{K=S.apply(this,P)}catch(G){return _(G)}i(K)&&typeof K.then=="function"?K.then(function(G){f(_,null,G)},function(G){f(_,G.message?G:new Error(G))}):_(null,K)})}function f(S,P,_){try{S(P,_)}catch(K){u(g,K)}}function g(S){throw S}var b=typeof Symbol=="function";function I(S){return b&&S[Symbol.toStringTag]==="AsyncFunction"}function w(S){return I(S)?d(S):S}function D(S){return function(P){var _=e(arguments,1),K=r(function(G,q){var te=this;return S(P,function(se,Ee){w(se).apply(te,G.concat(Ee))},q)});return _.length?K.apply(this,_):K}}var A=typeof global=="object"&&global&&global.Object===Object&&global,T=typeof self=="object"&&self&&self.Object===Object&&self,$=A||T||Function("return this")(),ne=$.Symbol,H=Object.prototype,oe=H.hasOwnProperty,ae=H.toString,Y=ne?ne.toStringTag:void 0;function Ie(S){var P=oe.call(S,Y),_=S[Y];try{S[Y]=void 0;var K=!0}catch{}var G=ae.call(S);return K&&(P?S[Y]=_:delete S[Y]),G}var Oe=Object.prototype,pt=Oe.toString;function mt(S){return pt.call(S)}var kt="[object Null]",ee="[object Undefined]",Pe=ne?ne.toStringTag:void 0;function _e(S){return S==null?S===void 0?ee:kt:Pe&&Pe in Object(S)?Ie(S):mt(S)}var he="[object AsyncFunction]",gt="[object Function]",Oi="[object GeneratorFunction]",sr="[object Proxy]";function fi(S){if(!i(S))return!1;var P=_e(S);return P==gt||P==Oi||P==he||P==sr}var Lu=9007199254740991;function Wr(S){return typeof S=="number"&&S>-1&&S%1==0&&S<=Lu}function zs(S){return S!=null&&Wr(S.length)&&!fi(S)}var Ja={};function Rt(){}function Fi(S){return function(){if(S!==null){var P=S;S=null,P.apply(this,arguments)}}}var Yn=typeof Symbol=="function"&&Symbol.iterator,Ic=function(S){return Yn&&S[Yn]&&S[Yn]()};function F(S,P){for(var _=-1,K=Array(S);++_<S;)K[_]=P(_);return K}function W(S){return S!=null&&typeof S=="object"}var pe="[object Arguments]";function Te(S){return W(S)&&_e(S)==pe}var ze=Object.prototype,Zr=ze.hasOwnProperty,Ut=ze.propertyIsEnumerable,At=Te(function(){return arguments}())?Te:function(S){return W(S)&&Zr.call(S,"callee")&&!Ut.call(S,"callee")},Dt=Array.isArray;function Er(){return!1}var Vr=typeof n=="object"&&n&&!n.nodeType&&n,Pr=Vr&&typeof Yl=="object"&&Yl&&!Yl.nodeType&&Yl,en=Pr&&Pr.exports===Vr,B=en?$.Buffer:void 0,X=B?B.isBuffer:void 0,de=X||Er,ye=9007199254740991,Be=/^(?:0|[1-9]\d*)$/;function tn(S,P){var _=typeof S;return P=P??ye,!!P&&(_=="number"||_!="symbol"&&Be.test(S))&&S>-1&&S%1==0&&S<P}var yt="[object Arguments]",wt="[object Array]",Qe="[object Boolean]",Tt="[object Date]",Z="[object Error]",ce="[object Function]",V="[object Map]",j="[object Number]",Q="[object Object]",Ce="[object RegExp]",Ne="[object Set]",ar="[object String]",hi="[object WeakMap]",Sc="[object ArrayBuffer]",be="[object DataView]",ZF="[object Float32Array]",eL="[object Float64Array]",tL="[object Int8Array]",rL="[object Int16Array]",nL="[object Int32Array]",iL="[object Uint8Array]",oL="[object Uint8ClampedArray]",sL="[object Uint16Array]",aL="[object Uint32Array]",Nr={};Nr[ZF]=Nr[eL]=Nr[tL]=Nr[rL]=Nr[nL]=Nr[iL]=Nr[oL]=Nr[sL]=Nr[aL]=!0,Nr[yt]=Nr[wt]=Nr[Sc]=Nr[Qe]=Nr[be]=Nr[Tt]=Nr[Z]=Nr[ce]=Nr[V]=Nr[j]=Nr[Q]=Nr[Ce]=Nr[Ne]=Nr[ar]=Nr[hi]=!1;function lL(S){return W(S)&&Wr(S.length)&&!!Nr[_e(S)]}function cL(S){return function(P){return S(P)}}var O1=typeof n=="object"&&n&&!n.nodeType&&n,Xf=O1&&typeof Yl=="object"&&Yl&&!Yl.nodeType&&Yl,uL=Xf&&Xf.exports===O1,yw=uL&&A.process,F1=function(){try{var S=Xf&&Xf.require&&Xf.require("util").types;return S||yw&&yw.binding&&yw.binding("util")}catch{}}(),L1=F1&&F1.isTypedArray,dL=L1?cL(L1):lL,pL=Object.prototype,mL=pL.hasOwnProperty;function fL(S,P){var _=Dt(S),K=!_&&At(S),G=!_&&!K&&de(S),q=!_&&!K&&!G&&dL(S),te=_||K||G||q,se=te?F(S.length,String):[],Ee=se.length;for(var He in S)(P||mL.call(S,He))&&!(te&&(He=="length"||G&&(He=="offset"||He=="parent")||q&&(He=="buffer"||He=="byteLength"||He=="byteOffset")||tn(He,Ee)))&&se.push(He);return se}var hL=Object.prototype;function gL(S){var P=S&&S.constructor,_=typeof P=="function"&&P.prototype||hL;return S===_}function vL(S,P){return function(_){return S(P(_))}}var yL=vL(Object.keys,Object),bL=Object.prototype,IL=bL.hasOwnProperty;function SL(S){if(!gL(S))return yL(S);var P=[];for(var _ in Object(S))IL.call(S,_)&&_!="constructor"&&P.push(_);return P}function bw(S){return zs(S)?fL(S):SL(S)}function CL(S){var P=-1,_=S.length;return function(){return++P<_?{value:S[P],key:P}:null}}function EL(S){var P=-1;return function(){var K=S.next();return K.done?null:(P++,{value:K.value,key:P})}}function wL(S){var P=bw(S),_=-1,K=P.length;return function G(){var q=P[++_];return q==="__proto__"?G():_<K?{value:S[q],key:q}:null}}function PL(S){if(zs(S))return CL(S);var P=Ic(S);return P?EL(P):wL(S)}function Qs(S){return function(){if(S===null)throw new Error("Callback was already called.");var P=S;S=null,P.apply(this,arguments)}}function rS(S){return function(P,_,K){if(K=Fi(K||Rt),S<=0||!P)return K(null);var G=PL(P),q=!1,te=0,se=!1;function Ee(ke,vt){if(te-=1,ke)q=!0,K(ke);else{if(vt===Ja||q&&te<=0)return q=!0,K(null);se||He()}}function He(){for(se=!0;te<S&&!q;){var ke=G();if(ke===null){q=!0,te<=0&&K(null);return}te+=1,_(ke.value,ke.key,Qs(Ee))}se=!1}He()}}function Uu(S,P,_,K){rS(P)(S,w(_),K)}function Fn(S,P){return function(_,K,G){return S(_,P,K,G)}}function kL(S,P,_){_=Fi(_||Rt);var K=0,G=0,q=S.length;q===0&&_(null);function te(se,Ee){se?_(se):(++G===q||Ee===Ja)&&_(null)}for(;K<q;K++)P(S[K],K,Qs(te))}var xL=Fn(Uu,1/0),Cc=function(S,P,_){var K=zs(S)?kL:xL;K(S,w(P),_)};function Vp(S){return function(P,_,K){return S(Cc,P,w(_),K)}}function U1(S,P,_,K){K=K||Rt,P=P||[];var G=[],q=0,te=w(_);S(P,function(se,Ee,He){var ke=q++;te(se,function(vt,jr){G[ke]=jr,He(vt)})},function(se){K(se,G)})}var nS=Vp(U1),W1=D(nS);function jp(S){return function(P,_,K,G){return S(rS(_),P,w(K),G)}}var Jp=jp(U1),Iw=Fn(Jp,1),V1=D(Iw);function iS(S,P){for(var _=-1,K=S==null?0:S.length;++_<K&&P(S[_],_,S)!==!1;);return S}function DL(S){return function(P,_,K){for(var G=-1,q=Object(P),te=K(P),se=te.length;se--;){var Ee=te[S?se:++G];if(_(q[Ee],Ee,q)===!1)break}return P}}var _L=DL();function Zf(S,P){return S&&_L(S,P,bw)}function TL(S,P,_,K){for(var G=S.length,q=_+(K?1:-1);K?q--:++q<G;)if(P(S[q],q,S))return q;return-1}function RL(S){return S!==S}function AL(S,P,_){for(var K=_-1,G=S.length;++K<G;)if(S[K]===P)return K;return-1}function oS(S,P,_){return P===P?AL(S,P,_):TL(S,RL,_)}var Sw=function(S,P,_){typeof P=="function"&&(_=P,P=null),_=Fi(_||Rt);var K=bw(S),G=K.length;if(!G)return _(null);P||(P=G);var q={},te=0,se=!1,Ee=Object.create(null),He=[],ke=[],vt={};Zf(S,function($r,rn){if(!Dt($r)){jr(rn,[$r]),ke.push(rn);return}var Ln=$r.slice(0,$r.length-1),wc=Ln.length;if(wc===0){jr(rn,$r),ke.push(rn);return}vt[rn]=wc,iS(Ln,function(ah){if(!S[ah])throw new Error("async.auto task `"+rn+"` has a non-existent dependency `"+ah+"` in "+Ln.join(", "));Ba(ah,function(){wc--,wc===0&&jr(rn,$r)})})}),oz(),gi();function jr($r,rn){He.push(function(){$a($r,rn)})}function gi(){if(He.length===0&&te===0)return _(null,q);for(;He.length&&te<P;){var $r=He.shift();$r()}}function Ba($r,rn){var Ln=Ee[$r];Ln||(Ln=Ee[$r]=[]),Ln.push(rn)}function cs($r){var rn=Ee[$r]||[];iS(rn,function(Ln){Ln()}),gi()}function $a($r,rn){if(!se){var Ln=Qs(function(ah,FR){if(te--,arguments.length>2&&(FR=e(arguments,1)),ah){var LR={};Zf(q,function(az,lz){LR[lz]=az}),LR[$r]=FR,se=!0,Ee=Object.create(null),_(ah,LR)}else q[$r]=FR,cs($r)});te++;var wc=w(rn[rn.length-1]);rn.length>1?wc(q,Ln):wc(Ln)}}function oz(){for(var $r,rn=0;ke.length;)$r=ke.pop(),rn++,iS(sz($r),function(Ln){--vt[Ln]===0&&ke.push(Ln)});if(rn!==G)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function sz($r){var rn=[];return Zf(S,function(Ln,wc){Dt(Ln)&&oS(Ln,$r,0)>=0&&rn.push(wc)}),rn}};function Bp(S,P){for(var _=-1,K=S==null?0:S.length,G=Array(K);++_<K;)G[_]=P(S[_],_,S);return G}var NL="[object Symbol]";function ML(S){return typeof S=="symbol"||W(S)&&_e(S)==NL}var KL=1/0,j1=ne?ne.prototype:void 0,J1=j1?j1.toString:void 0;function Cw(S){if(typeof S=="string")return S;if(Dt(S))return Bp(S,Cw)+"";if(ML(S))return J1?J1.call(S):"";var P=S+"";return P=="0"&&1/S==-KL?"-0":P}function OL(S,P,_){var K=-1,G=S.length;P<0&&(P=-P>G?0:G+P),_=_>G?G:_,_<0&&(_+=G),G=P>_?0:_-P>>>0,P>>>=0;for(var q=Array(G);++K<G;)q[K]=S[K+P];return q}function FL(S,P,_){var K=S.length;return _=_===void 0?K:_,!P&&_>=K?S:OL(S,P,_)}function LL(S,P){for(var _=S.length;_--&&oS(P,S[_],0)>-1;);return _}function UL(S,P){for(var _=-1,K=S.length;++_<K&&oS(P,S[_],0)>-1;);return _}function WL(S){return S.split("")}var VL="\\ud800-\\udfff",jL="\\u0300-\\u036f",JL="\\ufe20-\\ufe2f",BL="\\u20d0-\\u20ff",$L=jL+JL+BL,qL="\\ufe0e\\ufe0f",HL="\\u200d",GL=RegExp("["+HL+VL+$L+qL+"]");function zL(S){return GL.test(S)}var B1="\\ud800-\\udfff",QL="\\u0300-\\u036f",YL="\\ufe20-\\ufe2f",XL="\\u20d0-\\u20ff",ZL=QL+YL+XL,eU="\\ufe0e\\ufe0f",tU="["+B1+"]",Ew="["+ZL+"]",ww="\\ud83c[\\udffb-\\udfff]",rU="(?:"+Ew+"|"+ww+")",$1="[^"+B1+"]",q1="(?:\\ud83c[\\udde6-\\uddff]){2}",H1="[\\ud800-\\udbff][\\udc00-\\udfff]",nU="\\u200d",G1=rU+"?",z1="["+eU+"]?",iU="(?:"+nU+"(?:"+[$1,q1,H1].join("|")+")"+z1+G1+")*",oU=z1+G1+iU,sU="(?:"+[$1+Ew+"?",Ew,q1,H1,tU].join("|")+")",aU=RegExp(ww+"(?="+ww+")|"+sU+oU,"g");function lU(S){return S.match(aU)||[]}function Q1(S){return zL(S)?lU(S):WL(S)}function cU(S){return S==null?"":Cw(S)}var uU=/^\s+|\s+$/g;function dU(S,P,_){if(S=cU(S),S&&(_||P===void 0))return S.replace(uU,"");if(!S||!(P=Cw(P)))return S;var K=Q1(S),G=Q1(P),q=UL(K,G),te=LL(K,G)+1;return FL(K,q,te).join("")}var pU=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,mU=/,/,fU=/(=.+)?(\s*)$/,hU=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;function gU(S){return S=S.toString().replace(hU,""),S=S.match(pU)[2].replace(" ",""),S=S?S.split(mU):[],S=S.map(function(P){return dU(P.replace(fU,""))}),S}function Y1(S,P){var _={};Zf(S,function(K,G){var q,te=I(K),se=!te&&K.length===1||te&&K.length===0;if(Dt(K))q=K.slice(0,-1),K=K[K.length-1],_[G]=q.concat(q.length>0?Ee:K);else if(se)_[G]=K;else{if(q=gU(K),K.length===0&&!te&&q.length===0)throw new Error("autoInject task functions require explicit parameters.");te||q.pop(),_[G]=q.concat(Ee)}function Ee(He,ke){var vt=Bp(q,function(jr){return He[jr]});vt.push(ke),w(K).apply(null,vt)}}),Sw(_,P)}function ls(){this.head=this.tail=null,this.length=0}function X1(S,P){S.length=1,S.head=S.tail=P}ls.prototype.removeLink=function(S){return S.prev?S.prev.next=S.next:this.head=S.next,S.next?S.next.prev=S.prev:this.tail=S.prev,S.prev=S.next=null,this.length-=1,S},ls.prototype.empty=function(){for(;this.head;)this.shift();return this},ls.prototype.insertAfter=function(S,P){P.prev=S,P.next=S.next,S.next?S.next.prev=P:this.tail=P,S.next=P,this.length+=1},ls.prototype.insertBefore=function(S,P){P.prev=S.prev,P.next=S,S.prev?S.prev.next=P:this.head=P,S.prev=P,this.length+=1},ls.prototype.unshift=function(S){this.head?this.insertBefore(this.head,S):X1(this,S)},ls.prototype.push=function(S){this.tail?this.insertAfter(this.tail,S):X1(this,S)},ls.prototype.shift=function(){return this.head&&this.removeLink(this.head)},ls.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},ls.prototype.toArray=function(){for(var S=Array(this.length),P=this.head,_=0;_<this.length;_++)S[_]=P.data,P=P.next;return S},ls.prototype.remove=function(S){for(var P=this.head;P;){var _=P.next;S(P)&&this.removeLink(P),P=_}return this};function Z1(S,P,_){if(P==null)P=1;else if(P===0)throw new Error("Concurrency must not be zero");var K=w(S),G=0,q=[],te=!1;function se(vt,jr,gi){if(gi!=null&&typeof gi!="function")throw new Error("task callback must be a function");if(ke.started=!0,Dt(vt)||(vt=[vt]),vt.length===0&&ke.idle())return u(function(){ke.drain()});for(var Ba=0,cs=vt.length;Ba<cs;Ba++){var $a={data:vt[Ba],callback:gi||Rt};jr?ke._tasks.unshift($a):ke._tasks.push($a)}te||(te=!0,u(function(){te=!1,ke.process()}))}function Ee(vt){return function(jr){G-=1;for(var gi=0,Ba=vt.length;gi<Ba;gi++){var cs=vt[gi],$a=oS(q,cs,0);$a===0?q.shift():$a>0&&q.splice($a,1),cs.callback.apply(cs,arguments),jr!=null&&ke.error(jr,cs.data)}G<=ke.concurrency-ke.buffer&&ke.unsaturated(),ke.idle()&&ke.drain(),ke.process()}}var He=!1,ke={_tasks:new ls,concurrency:P,payload:_,saturated:Rt,unsaturated:Rt,buffer:P/4,empty:Rt,drain:Rt,error:Rt,started:!1,paused:!1,push:function(vt,jr){se(vt,!1,jr)},kill:function(){ke.drain=Rt,ke._tasks.empty()},unshift:function(vt,jr){se(vt,!0,jr)},remove:function(vt){ke._tasks.remove(vt)},process:function(){if(!He){for(He=!0;!ke.paused&&G<ke.concurrency&&ke._tasks.length;){var vt=[],jr=[],gi=ke._tasks.length;ke.payload&&(gi=Math.min(gi,ke.payload));for(var Ba=0;Ba<gi;Ba++){var cs=ke._tasks.shift();vt.push(cs),q.push(cs),jr.push(cs.data)}G+=1,ke._tasks.length===0&&ke.empty(),G===ke.concurrency&&ke.saturated();var $a=Qs(Ee(vt));K(jr,$a)}He=!1}},length:function(){return ke._tasks.length},running:function(){return G},workersList:function(){return q},idle:function(){return ke._tasks.length+G===0},pause:function(){ke.paused=!0},resume:function(){ke.paused!==!1&&(ke.paused=!1,u(ke.process))}};return ke}function eR(S,P){return Z1(S,1,P)}var $p=Fn(Uu,1);function Ec(S,P,_,K){K=Fi(K||Rt);var G=w(_);$p(S,function(q,te,se){G(P,q,function(Ee,He){P=He,se(Ee)})},function(q){K(q,P)})}function Pw(){var S=Bp(arguments,w);return function(){var P=e(arguments),_=this,K=P[P.length-1];typeof K=="function"?P.pop():K=Rt,Ec(S,P,function(G,q,te){q.apply(_,G.concat(function(se){var Ee=e(arguments,1);te(se,Ee)}))},function(G,q){K.apply(_,[G].concat(q))})}}var tR=function(){return Pw.apply(null,e(arguments).reverse())},vU=Array.prototype.concat,sS=function(S,P,_,K){K=K||Rt;var G=w(_);Jp(S,P,function(q,te){G(q,function(se){return se?te(se):te(null,e(arguments,1))})},function(q,te){for(var se=[],Ee=0;Ee<te.length;Ee++)te[Ee]&&(se=vU.apply(se,te[Ee]));return K(q,se)})},rR=Fn(sS,1/0),nR=Fn(sS,1),iR=function(){var S=e(arguments),P=[null].concat(S);return function(){var _=arguments[arguments.length-1];return _.apply(this,P)}};function eh(S){return S}function qp(S,P){return function(_,K,G,q){q=q||Rt;var te=!1,se;_(K,function(Ee,He,ke){G(Ee,function(vt,jr){vt?ke(vt):S(jr)&&!se?(te=!0,se=P(!0,Ee),ke(null,Ja)):ke()})},function(Ee){Ee?q(Ee):q(null,te?se:P(!1))})}}function oR(S,P){return P}var aS=Vp(qp(eh,oR)),th=jp(qp(eh,oR)),lS=Fn(th,1);function sR(S){return function(P){var _=e(arguments,1);_.push(function(K){var G=e(arguments,1);typeof console=="object"&&(K?console.error&&console.error(K):console[S]&&iS(G,function(q){console[S](q)}))}),w(P).apply(null,_)}}var aR=sR("dir");function lR(S,P,_){_=Qs(_||Rt);var K=w(S),G=w(P);function q(se){if(se)return _(se);var Ee=e(arguments,1);Ee.push(te),G.apply(this,Ee)}function te(se,Ee){if(se)return _(se);if(!Ee)return _(null);K(q)}te(null,!0)}function kw(S,P,_){_=Qs(_||Rt);var K=w(S),G=function(q){if(q)return _(q);var te=e(arguments,1);if(P.apply(this,te))return K(G);_.apply(null,[null].concat(te))};K(G)}function cR(S,P,_){kw(S,function(){return!P.apply(this,arguments)},_)}function uR(S,P,_){_=Qs(_||Rt);var K=w(P),G=w(S);function q(se){if(se)return _(se);G(te)}function te(se,Ee){if(se)return _(se);if(!Ee)return _(null);K(q)}G(te)}function dR(S){return function(P,_,K){return S(P,K)}}function cS(S,P,_){Cc(S,dR(w(P)),_)}function rh(S,P,_,K){rS(P)(S,dR(w(_)),K)}var nh=Fn(rh,1);function xw(S){return I(S)?S:r(function(P,_){var K=!0;P.push(function(){var G=arguments;K?u(function(){_.apply(null,G)}):_.apply(null,G)}),S.apply(this,P),K=!1})}function uS(S){return!S}var dS=Vp(qp(uS,uS)),ih=jp(qp(uS,uS)),pS=Fn(ih,1);function pR(S){return function(P){return P?.[S]}}function yU(S,P,_,K){var G=new Array(P.length);S(P,function(q,te,se){_(q,function(Ee,He){G[te]=!!He,se(Ee)})},function(q){if(q)return K(q);for(var te=[],se=0;se<P.length;se++)G[se]&&te.push(P[se]);K(null,te)})}function bU(S,P,_,K){var G=[];S(P,function(q,te,se){_(q,function(Ee,He){Ee?se(Ee):(He&&G.push({index:te,value:q}),se())})},function(q){q?K(q):K(null,Bp(G.sort(function(te,se){return te.index-se.index}),pR("value")))})}function Dw(S,P,_,K){var G=zs(P)?yU:bU;G(S,P,w(_),K||Rt)}var mS=Vp(Dw),oh=jp(Dw),fS=Fn(oh,1);function mR(S,P){var _=Qs(P||Rt),K=w(xw(S));function G(q){if(q)return _(q);K(G)}G()}var hS=function(S,P,_,K){K=K||Rt;var G=w(_);Jp(S,P,function(q,te){G(q,function(se,Ee){return se?te(se):te(null,{key:Ee,val:q})})},function(q,te){for(var se={},Ee=Object.prototype.hasOwnProperty,He=0;He<te.length;He++)if(te[He]){var ke=te[He].key,vt=te[He].val;Ee.call(se,ke)?se[ke].push(vt):se[ke]=[vt]}return K(q,se)})},fR=Fn(hS,1/0),hR=Fn(hS,1),gR=sR("log");function gS(S,P,_,K){K=Fi(K||Rt);var G={},q=w(_);Uu(S,P,function(te,se,Ee){q(te,se,function(He,ke){if(He)return Ee(He);G[se]=ke,Ee()})},function(te){K(te,G)})}var vR=Fn(gS,1/0),yR=Fn(gS,1);function bR(S,P){return P in S}function IR(S,P){var _=Object.create(null),K=Object.create(null);P=P||eh;var G=w(S),q=r(function(se,Ee){var He=P.apply(null,se);bR(_,He)?u(function(){Ee.apply(null,_[He])}):bR(K,He)?K[He].push(Ee):(K[He]=[Ee],G.apply(null,se.concat(function(){var ke=e(arguments);_[He]=ke;var vt=K[He];delete K[He];for(var jr=0,gi=vt.length;jr<gi;jr++)vt[jr].apply(null,ke)})))});return q.memo=_,q.unmemoized=S,q}var vS;s?vS=process.nextTick:o?vS=setImmediate:vS=a;var SR=l(vS);function _w(S,P,_){_=_||Rt;var K=zs(P)?[]:{};S(P,function(G,q,te){w(G)(function(se,Ee){arguments.length>2&&(Ee=e(arguments,1)),K[q]=Ee,te(se)})},function(G){_(G,K)})}function CR(S,P){_w(Cc,S,P)}function ER(S,P,_){_w(rS(P),S,_)}var Tw=function(S,P){var _=w(S);return Z1(function(K,G){_(K[0],G)},P,1)},wR=function(S,P){var _=Tw(S,P);return _.push=function(K,G,q){if(q==null&&(q=Rt),typeof q!="function")throw new Error("task callback must be a function");if(_.started=!0,Dt(K)||(K=[K]),K.length===0)return u(function(){_.drain()});G=G||0;for(var te=_._tasks.head;te&&G>=te.priority;)te=te.next;for(var se=0,Ee=K.length;se<Ee;se++){var He={data:K[se],priority:G,callback:q};te?_._tasks.insertBefore(te,He):_._tasks.push(He)}u(_.process)},delete _.unshift,_};function PR(S,P){if(P=Fi(P||Rt),!Dt(S))return P(new TypeError("First argument to race must be an array of functions"));if(!S.length)return P();for(var _=0,K=S.length;_<K;_++)w(S[_])(P)}function yS(S,P,_,K){var G=e(S).reverse();Ec(G,P,_,K)}function bS(S){var P=w(S);return r(function(K,G){return K.push(function(te,se){if(te)G(null,{error:te});else{var Ee;arguments.length<=2?Ee=se:Ee=e(arguments,1),G(null,{value:Ee})}}),P.apply(this,K)})}function kR(S){var P;return Dt(S)?P=Bp(S,bS):(P={},Zf(S,function(_,K){P[K]=bS.call(this,_)})),P}function xR(S,P,_,K){Dw(S,P,function(G,q){_(G,function(te,se){q(te,!se)})},K)}var DR=Vp(xR),Rw=jp(xR),_R=Fn(Rw,1);function TR(S){return function(){return S}}function IS(S,P,_){var K=5,G=0,q={times:K,intervalFunc:TR(G)};function te(ke,vt){if(typeof vt=="object")ke.times=+vt.times||K,ke.intervalFunc=typeof vt.interval=="function"?vt.interval:TR(+vt.interval||G),ke.errorFilter=vt.errorFilter;else if(typeof vt=="number"||typeof vt=="string")ke.times=+vt||K;else throw new Error("Invalid arguments for async.retry")}if(arguments.length<3&&typeof S=="function"?(_=P||Rt,P=S):(te(q,S),_=_||Rt),typeof P!="function")throw new Error("Invalid arguments for async.retry");var se=w(P),Ee=1;function He(){se(function(ke){ke&&Ee++<q.times&&(typeof q.errorFilter!="function"||q.errorFilter(ke))?setTimeout(He,q.intervalFunc(Ee)):_.apply(null,arguments)})}He()}var RR=function(S,P){P||(P=S,S=null);var _=w(P);return r(function(K,G){function q(te){_.apply(null,K.concat(te))}S?IS(S,q,G):IS(q,G)})};function AR(S,P){_w($p,S,P)}var SS=Vp(qp(Boolean,eh)),sh=jp(qp(Boolean,eh)),CS=Fn(sh,1);function NR(S,P,_){var K=w(P);nS(S,function(q,te){K(q,function(se,Ee){if(se)return te(se);te(null,{value:q,criteria:Ee})})},function(q,te){if(q)return _(q);_(null,Bp(te.sort(G),pR("value")))});function G(q,te){var se=q.criteria,Ee=te.criteria;return se<Ee?-1:se>Ee?1:0}}function MR(S,P,_){var K=w(S);return r(function(G,q){var te=!1,se;function Ee(){var He=S.name||"anonymous",ke=new Error('Callback function "'+He+'" timed out.');ke.code="ETIMEDOUT",_&&(ke.info=_),te=!0,q(ke)}G.push(function(){te||(q.apply(null,arguments),clearTimeout(se))}),se=setTimeout(Ee,P),K.apply(null,G)})}var IU=Math.ceil,SU=Math.max;function CU(S,P,_,K){for(var G=-1,q=SU(IU((P-S)/(_||1)),0),te=Array(q);q--;)te[K?q:++G]=S,S+=_;return te}function ES(S,P,_,K){var G=w(_);Jp(CU(0,S,1),P,G,K)}var KR=Fn(ES,1/0),OR=Fn(ES,1);function x(S,P,_,K){arguments.length<=3&&(K=_,_=P,P=Dt(S)?[]:{}),K=Fi(K||Rt);var G=w(_);Cc(S,function(q,te,se){G(P,q,te,se)},function(q){K(q,P)})}function L(S,P){var _=null,K;P=P||Rt,nh(S,function(G,q){w(G)(function(te,se){arguments.length>2?K=e(arguments,1):K=se,_=te,q(!te)})},function(){P(_,K)})}function je(S){return function(){return(S.unmemoized||S).apply(null,arguments)}}function wS(S,P,_){_=Qs(_||Rt);var K=w(P);if(!S())return _(null);var G=function(q){if(q)return _(q);if(S())return K(G);var te=e(arguments,1);_.apply(null,[null].concat(te))};K(G)}function EU(S,P,_){wS(function(){return!S.apply(this,arguments)},P,_)}var wU=function(S,P){if(P=Fi(P||Rt),!Dt(S))return P(new Error("First argument to waterfall must be an array of functions"));if(!S.length)return P();var _=0;function K(q){var te=w(S[_++]);q.push(Qs(G)),te.apply(null,q)}function G(q){if(q||_===S.length)return P.apply(null,arguments);K(e(arguments,1))}K([])},iz={apply:t,applyEach:W1,applyEachSeries:V1,asyncify:d,auto:Sw,autoInject:Y1,cargo:eR,compose:tR,concat:rR,concatLimit:sS,concatSeries:nR,constant:iR,detect:aS,detectLimit:th,detectSeries:lS,dir:aR,doDuring:lR,doUntil:cR,doWhilst:kw,during:uR,each:cS,eachLimit:rh,eachOf:Cc,eachOfLimit:Uu,eachOfSeries:$p,eachSeries:nh,ensureAsync:xw,every:dS,everyLimit:ih,everySeries:pS,filter:mS,filterLimit:oh,filterSeries:fS,forever:mR,groupBy:fR,groupByLimit:hS,groupBySeries:hR,log:gR,map:nS,mapLimit:Jp,mapSeries:Iw,mapValues:vR,mapValuesLimit:gS,mapValuesSeries:yR,memoize:IR,nextTick:SR,parallel:CR,parallelLimit:ER,priorityQueue:wR,queue:Tw,race:PR,reduce:Ec,reduceRight:yS,reflect:bS,reflectAll:kR,reject:DR,rejectLimit:Rw,rejectSeries:_R,retry:IS,retryable:RR,seq:Pw,series:AR,setImmediate:u,some:SS,someLimit:sh,someSeries:CS,sortBy:NR,timeout:MR,times:KR,timesLimit:ES,timesSeries:OR,transform:x,tryEach:L,unmemoize:je,until:EU,waterfall:wU,whilst:wS,all:dS,allLimit:ih,allSeries:pS,any:SS,anyLimit:sh,anySeries:CS,find:aS,findLimit:th,findSeries:lS,forEach:cS,forEachSeries:nh,forEachLimit:rh,forEachOf:Cc,forEachOfSeries:$p,forEachOfLimit:Uu,inject:Ec,foldl:Ec,foldr:yS,select:mS,selectLimit:oh,selectSeries:fS,wrapSync:d};n.default=iz,n.apply=t,n.applyEach=W1,n.applyEachSeries=V1,n.asyncify=d,n.auto=Sw,n.autoInject=Y1,n.cargo=eR,n.compose=tR,n.concat=rR,n.concatLimit=sS,n.concatSeries=nR,n.constant=iR,n.detect=aS,n.detectLimit=th,n.detectSeries=lS,n.dir=aR,n.doDuring=lR,n.doUntil=cR,n.doWhilst=kw,n.during=uR,n.each=cS,n.eachLimit=rh,n.eachOf=Cc,n.eachOfLimit=Uu,n.eachOfSeries=$p,n.eachSeries=nh,n.ensureAsync=xw,n.every=dS,n.everyLimit=ih,n.everySeries=pS,n.filter=mS,n.filterLimit=oh,n.filterSeries=fS,n.forever=mR,n.groupBy=fR,n.groupByLimit=hS,n.groupBySeries=hR,n.log=gR,n.map=nS,n.mapLimit=Jp,n.mapSeries=Iw,n.mapValues=vR,n.mapValuesLimit=gS,n.mapValuesSeries=yR,n.memoize=IR,n.nextTick=SR,n.parallel=CR,n.parallelLimit=ER,n.priorityQueue=wR,n.queue=Tw,n.race=PR,n.reduce=Ec,n.reduceRight=yS,n.reflect=bS,n.reflectAll=kR,n.reject=DR,n.rejectLimit=Rw,n.rejectSeries=_R,n.retry=IS,n.retryable=RR,n.seq=Pw,n.series=AR,n.setImmediate=u,n.some=SS,n.someLimit=sh,n.someSeries=CS,n.sortBy=NR,n.timeout=MR,n.times=KR,n.timesLimit=ES,n.timesSeries=OR,n.transform=x,n.tryEach=L,n.unmemoize=je,n.until=EU,n.waterfall=wU,n.whilst=wS,n.all=dS,n.allLimit=ih,n.allSeries=pS,n.any=SS,n.anyLimit=sh,n.anySeries=CS,n.find=aS,n.findLimit=th,n.findSeries=lS,n.forEach=cS,n.forEachSeries=nh,n.forEachLimit=rh,n.forEachOf=Cc,n.forEachOfSeries=$p,n.forEachOfLimit=Uu,n.inject=Ec,n.foldl=Ec,n.foldr=yS,n.select=mS,n.selectLimit=oh,n.selectSeries=fS,n.wrapSync=d,Object.defineProperty(n,"__esModule",{value:!0})})});var JO=O((RYe,aq)=>{"use strict";function mpe(n){t.debug=t,t.default=t,t.coerce=l,t.disable=s,t.enable=o,t.enabled=a,t.humanize=KO(),Object.keys(n).forEach(function(c){t[c]=n[c]}),t.instances=[],t.names=[],t.skips=[],t.formatters={};function e(c){for(var u=0,d=0;d<c.length;d++)u=(u<<5)-u+c.charCodeAt(d),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(c){var u;function d(){if(d.enabled){for(var f=arguments.length,g=new Array(f),b=0;b<f;b++)g[b]=arguments[b];var I=d,w=Number(new Date),D=w-(u||w);I.diff=D,I.prev=u,I.curr=w,u=w,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");var A=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,function($,ne){if($==="%%")return $;A++;var H=t.formatters[ne];if(typeof H=="function"){var oe=g[A];$=H.call(I,oe),g.splice(A,1),A--}return $}),t.formatArgs.call(I,g);var T=I.log||t.log;T.apply(I,g)}}return d.namespace=c,d.enabled=t.enabled(c),d.useColors=t.useColors(),d.color=e(c),d.destroy=r,d.extend=i,typeof t.init=="function"&&t.init(d),t.instances.push(d),d}function r(){var c=t.instances.indexOf(this);return c!==-1?(t.instances.splice(c,1),!0):!1}function i(c,u){return t(this.namespace+(typeof u>"u"?":":u)+c)}function o(c){t.save(c),t.names=[],t.skips=[];var u,d=(typeof c=="string"?c:"").split(/[\s,]+/),f=d.length;for(u=0;u<f;u++)d[u]&&(c=d[u].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.substr(1)+"$")):t.names.push(new RegExp("^"+c+"$")));for(u=0;u<t.instances.length;u++){var g=t.instances[u];g.enabled=t.enabled(g.namespace)}}function s(){t.enable("")}function a(c){if(c[c.length-1]==="*")return!0;var u,d;for(u=0,d=t.skips.length;u<d;u++)if(t.skips[u].test(c))return!1;for(u=0,d=t.names.length;u<d;u++)if(t.names[u].test(c))return!0;return!1}function l(c){return c instanceof Error?c.stack||c.message:c}return t.enable(t.load()),t}aq.exports=mpe});var lq=O((Ls,q_)=>{"use strict";function $_(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?$_=function(t){return typeof t}:$_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$_(n)}Ls.log=gpe;Ls.formatArgs=hpe;Ls.save=vpe;Ls.load=ype;Ls.useColors=fpe;Ls.storage=bpe();Ls.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function fpe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function hpe(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+q_.exports.humanize(this.diff),!!this.useColors){var e="color: "+this.color;n.splice(1,0,e,"color: inherit");var t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,function(i){i!=="%%"&&(t++,i==="%c"&&(r=t))}),n.splice(r,0,e)}}function gpe(){var n;return(typeof console>"u"?"undefined":$_(console))==="object"&&console.log&&(n=console).log.apply(n,arguments)}function vpe(n){try{n?Ls.storage.setItem("debug",n):Ls.storage.removeItem("debug")}catch{}}function ype(){var n;try{n=Ls.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function bpe(){try{return localStorage}catch{}}q_.exports=JO()(Ls);var Ipe=q_.exports.formatters;Ipe.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var uq=O((Mi,z_)=>{"use strict";var Spe=require("tty"),G_=require("util");Mi.init=Dpe;Mi.log=Ppe;Mi.formatArgs=Epe;Mi.save=kpe;Mi.load=xpe;Mi.useColors=Cpe;Mi.colors=[6,2,3,4,5,1];try{H_=LO(),H_&&(H_.stderr||H_).level>=2&&(Mi.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var H_;Mi.inspectOpts=Object.keys(process.env).filter(function(n){return/^debug_/i.test(n)}).reduce(function(n,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,o){return o.toUpperCase()}),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function Cpe(){return"colors"in Mi.inspectOpts?!!Mi.inspectOpts.colors:Spe.isatty(process.stderr.fd)}function Epe(n){var e=this.namespace,t=this.useColors;if(t){var r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),o="  ".concat(i,";1m").concat(e," \x1B[0m");n[0]=o+n[0].split(`
`).join(`
`+o),n.push(i+"m+"+z_.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=wpe()+e+" "+n[0]}function wpe(){return Mi.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Ppe(){return process.stderr.write(G_.format.apply(G_,arguments)+`
`)}function kpe(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function xpe(){return process.env.DEBUG}function Dpe(n){n.inspectOpts={};for(var e=Object.keys(Mi.inspectOpts),t=0;t<e.length;t++)n.inspectOpts[e[t]]=Mi.inspectOpts[e[t]]}z_.exports=JO()(Mi);var cq=z_.exports.formatters;cq.o=function(n){return this.inspectOpts.colors=this.useColors,G_.inspect(n,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};cq.O=function(n){return this.inspectOpts.colors=this.useColors,G_.inspect(n,this.inspectOpts)}});var dq=O((AYe,BO)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?BO.exports=lq():BO.exports=uq()});var hq=O((NYe,fq)=>{var RE=require("path"),pq=require("fs"),mq=parseInt("0777",8);fq.exports=Wy.mkdirp=Wy.mkdirP=Wy;function Wy(n,e,t,r){typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e});var i=e.mode,o=e.fs||pq;i===void 0&&(i=mq),r||(r=null);var s=t||function(){};n=RE.resolve(n),o.mkdir(n,i,function(a){if(!a)return r=r||n,s(null,r);switch(a.code){case"ENOENT":if(RE.dirname(n)===n)return s(a);Wy(RE.dirname(n),e,function(l,c){l?s(l,c):Wy(n,e,s,c)});break;default:o.stat(n,function(l,c){l||!c.isDirectory()?s(a,r):s(null,r)});break}})}Wy.sync=function n(e,t,r){(!t||typeof t!="object")&&(t={mode:t});var i=t.mode,o=t.fs||pq;i===void 0&&(i=mq),r||(r=null),e=RE.resolve(e);try{o.mkdirSync(e,i),r=r||e}catch(a){switch(a.code){case"ENOENT":r=n(RE.dirname(e),t,r),n(e,t,r);break;default:var s;try{s=o.statSync(e)}catch{throw a}if(!s.isDirectory())throw a;break}}return r}});var yq=O(Cr=>{"use strict";var gq=require("fs"),_pe=require("os"),Tpe=require("net"),Q_=require("path"),vq=sq(),HO=dq(),Rpe=hq().mkdirp,$O=HO("portfinder:testPort"),AE=HO("portfinder:getPort"),Ape=HO("portfinder:defaultHosts"),qO={};qO.testPort=function(n,e){e||(e=n,n={}),n.server=n.server||Tpe.createServer(function(){}),$O("entered testPort(): trying",n.host,"port",n.port);function t(){$O("done w/ testPort(): OK",n.host,"port",n.port),n.server.removeListener("error",r),n.server.close(),e(null,n.port)}function r(i){if($O("done w/ testPort(): failed",n.host,"w/ port",n.port,"with error",i.code),n.server.removeListener("listening",t),!(i.code=="EADDRINUSE"||i.code=="EACCES"))return e(i);var o=Cr.nextPort(n.port);if(o>Cr.highestPort)return e(new Error("No open ports available"));qO.testPort({port:o,host:n.host,server:n.server},e)}n.server.once("error",r),n.server.once("listening",t),n.host?n.server.listen(n.port,n.host):n.server.listen(n.port)};Cr.basePort=8e3;Cr.highestPort=65535;Cr.basePath="/tmp/portfinder";Cr.getPort=function(n,e){if(e||(e=n,n={}),n.port=Number(n.port)||Number(Cr.basePort),n.host=n.host||null,n.stopPort=Number(n.stopPort)||Number(Cr.highestPort),!n.startPort){if(n.startPort=Number(n.port),n.startPort<0)throw Error("Provided options.startPort("+n.startPort+") is less than 0, which are cannot be bound.");if(n.stopPort<n.startPort)throw Error("Provided options.stopPort("+n.stopPort+"is less than options.startPort ("+n.startPort+")")}if(n.host){for(var t,r=0;r<Cr._defaultHosts.length;r++)if(Cr._defaultHosts[r]===n.host){t=!0;break}t||Cr._defaultHosts.push(n.host)}var i=[],o;return vq.eachSeries(Cr._defaultHosts,function(s,a){return AE("in eachSeries() iteration callback: host is",s),qO.testPort({host:s,port:n.port},function(l,c){return l?(AE("in eachSeries() iteration callback testPort() callback","with an err:",l.code),o=s,a(l)):(AE("in eachSeries() iteration callback testPort() callback","with a success for port",c),i.push(c),a())})},function(s){if(s)if(AE("in eachSeries() result callback: err is",s),s.code==="EADDRNOTAVAIL"||s.code==="EINVAL")if(n.host===o){var a="Provided host "+n.host+" could NOT be bound. Please provide a different host address or hostname";return e(Error(a))}else{var l=Cr._defaultHosts.indexOf(o);return Cr._defaultHosts.splice(l,1),Cr.getPort(n,e)}else return e(s);if(i.sort(function(c,u){return c-u}),AE("in eachSeries() result callback: openPorts is",i),i[0]===i[i.length-1]){if(i[0]<=n.stopPort)return e(null,i[0]);var a="No open ports found in between "+n.startPort+" and "+n.stopPort;return e(Error(a))}else return Cr.getPort({port:i.pop(),host:n.host,startPort:n.startPort,stopPort:n.stopPort},e)})};Cr.getPortPromise=function(n){if(typeof Promise!="function")throw Error("Native promise support is not available in this version of node.Please install a polyfill and assign Promise to global.Promise before calling this method");return n||(n={}),new Promise(function(e,t){Cr.getPort(n,function(r,i){if(r)return t(r);e(i)})})};Cr.getPorts=function(n,e,t){t||(t=e,e={});var r=null;vq.timesSeries(n,function(i,o){r&&(e.port=Cr.nextPort(r)),Cr.getPort(e,function(s,a){s?o(s):(r=a,o(null,a))})},t)};Cr.getSocket=function(n,e){e||(e=n,n={}),n.mod=n.mod||parseInt(755,8),n.path=n.path||Cr.basePath+".sock";function t(){gq.stat(n.path,function(o){o?o.code=="ENOENT"?e(null,n.path):e(o):(n.path=Cr.nextSocket(n.path),Cr.getSocket(n,e))})}function r(o){Rpe(o,n.mod,function(s){if(s)return e(s);n.exists=!0,t()})}function i(){var o=Q_.dirname(n.path);gq.stat(o,function(s,a){if(s||!a.isDirectory())return r(o);n.exists=!0,t()})}return n.exists?t():i()};Cr.nextPort=function(n){return n+1};Cr.nextSocket=function(n){var e=Q_.dirname(n),t=Q_.basename(n,".sock"),r=t.match(/^([a-zA-z]+)(\d*)$/i),i=parseInt(r[2]),o=r[1];return isNaN(i)&&(i=0),i+=1,Q_.join(e,o+i+".sock")};Cr._defaultHosts=function(){var n={};try{n=_pe.networkInterfaces()}catch(l){if(l.syscall!=="uv_interface_addresses")throw l}for(var e=Object.keys(n),t="0.0.0.0",r=[t],i=0;i<e.length;i++)for(var o=n[e[i]],s=0;s<o.length;s++){var a=o[s];r.push(a.address)}return r.push(null),Ape("exports._defaultHosts is: %o",r),r}()});var xq=O(Vy=>{"use strict";Object.defineProperty(Vy,"__esModule",{value:!0});Vy.encode=Vy.decode=void 0;var wq=require("crypto"),GO="<IDS|MSG>",Kpe=5;function Z_(n){return JSON.parse(n.toString())}function Pq(n){return Object.assign({},{header:{},parent_header:{},metadata:{},content:{},idents:[],buffers:[]},n)}function kq(n){let e=n;switch(n){case"hmac-sha256":e="sha256";break}return e}function Ope(n,e,t="sha256"){var r=0;let i=[];for(r=0;r<n.length;r++){var o=n[r];if(o.toString()===GO)break;i.push(o)}if(n.length-r<Kpe)throw new Error("Message Decoding: Not enough message frames");if(n[r].toString()!==GO)throw new Error("Message Decoding: Missing delimiter");if(e){let u=kq(t);var s=n[r+1].toString(),a=wq.createHmac(u,e);a.update(n[r+2]),a.update(n[r+3]),a.update(n[r+4]),a.update(n[r+5]);var l=a.digest("hex");if(l!==s)throw new Error(`Message Decoding: Incorrect;
Obtained "${s}"
Expected "${l}"`)}var c=Pq({idents:i,header:Z_(n[r+2]),parent_header:Z_(n[r+3]),content:Z_(n[r+5]),metadata:Z_(n[r+4]),buffers:Array.prototype.slice.apply(n,[r+6])});return c}Vy.decode=Ope;function Fpe(n,e,t="sha256"){let r=Pq(n),i=kq(t),o=r.idents,s=Buffer.from(JSON.stringify(r.header),"utf-8"),a=Buffer.from(JSON.stringify(r.parent_header),"utf-8"),l=Buffer.from(JSON.stringify(r.metadata),"utf-8"),c=Buffer.from(JSON.stringify(r.content),"utf-8"),u="";if(e){let f=wq.createHmac(i,e);f.update(s),f.update(a),f.update(l),f.update(c),u=f.digest("hex")}var d=o.concat([Buffer.from(GO),Buffer.from(u),s,a,l,c]).concat(r.buffers);return d}Vy.encode=Fpe});var Wq=O((Btt,Uq)=>{"use strict";Uq.exports=({onlyFirst:n=!1}={})=>{let e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,n?void 0:"g")}});var lH=O((Cat,aH)=>{"use strict";var rme=(n,e={})=>{let t=e.safe===!0||e.keepProtected===!0,r=!1,i=(o,s)=>{let a="",l,c;for(let u of o.nodes)switch(u.type){case"block":if(e.first&&r===!0){a+=i(u,o);break}if(e.preserveNewlines===!0){l=i(u,o),c=l.split(`
`),a+=`
`.repeat(c.length-1);break}if(t===!0&&u.protected===!0){a+=i(u,o);break}r=!0;break;case"line":if(e.first&&r===!0){a+=u.value;break}t===!0&&u.protected===!0&&(a+=u.value),r=!0;break;case"open":case"close":case"text":case"newline":default:{a+=u.value||"";break}}return a};return i(n)};aH.exports=rme});var uH=O((Eat,cH)=>{"use strict";var RT=class{constructor(e){this.type=e.type,e.value&&(this.value=e.value),e.match&&(this.match=e.match),this.newline=e.newline||""}get protected(){return!!this.match&&this.match[1]==="!"}},aF=class extends RT{constructor(e){super(e),this.nodes=e.nodes||[]}push(e){this.nodes.push(e)}get protected(){return this.nodes.length>0&&this.nodes[0].protected===!0}};cH.exports={Node:RT,Block:aF}});var pH=O(dH=>{"use strict";dH.javascript={BLOCK_OPEN_REGEX:/^\/\*\*?(!?)/,BLOCK_CLOSE_REGEX:/^\*\/(\n?)/,LINE_REGEX:/^\/\/(!?).*/}});var hH=O((Pat,fH)=>{"use strict";var{Node:hp,Block:mH}=uH(),nme=pH(),lF={ESCAPED_CHAR_REGEX:/^\\./,QUOTED_STRING_REGEX:/^(['"`])((?:\\.|[^\1])+?)(\1)/,NEWLINE_REGEX:/^\r*\n/},ime=(n,e={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");let t=new mH({type:"root",nodes:[]}),r=[t],i=(e.language||"javascript").toLowerCase(),o=nme[i];if(typeof o>"u")throw new Error(`Language "${i}" is not supported by strip-comments`);let{LINE_REGEX:s,BLOCK_OPEN_REGEX:a,BLOCK_CLOSE_REGEX:l}=o,c=t,u=n,d,f,g=[a,l].filter(Boolean),b=!1;g.every(T=>T.source==='^"""')&&(b=!0);let I=(T=u[0]||"")=>(u=u.slice(T.length),T),w=(T,$="text")=>{let ne=T.exec(u);if(ne)return I(ne[0]),{type:$,value:ne[0],match:ne}},D=T=>{if(f&&f.type==="text"&&T.type==="text"){f.value+=T.value;return}c.push(T),T.nodes&&(r.push(T),c=T),f=T},A=()=>{if(c.type==="root")throw new SyntaxError("Unclosed block comment");r.pop(),c=r[r.length-1]};for(;u!=="";){if(d=w(lF.ESCAPED_CHAR_REGEX,"text")){D(new hp(d));continue}if(c.type!=="block"&&(!f||!/\w$/.test(f.value))&&!(b&&u.startsWith('"""'))&&(d=w(lF.QUOTED_STRING_REGEX,"text"))){D(new hp(d));continue}if(d=w(lF.NEWLINE_REGEX,"newline")){D(new hp(d));continue}if(a&&e.block&&!(b&&c.type==="block")&&(d=w(a,"open"))){D(new mH({type:"block"})),D(new hp(d));continue}if(l&&c.type==="block"&&e.block&&(d=w(l,"close"))){d.newline=d.match[1]||"",D(new hp(d)),A();continue}if(s&&c.type!=="block"&&e.line&&(d=w(s,"line"))){D(new hp(d));continue}if(d=w(/^[a-zABD-Z0-9\t ]+/,"text")){D(new hp(d));continue}D(new hp({type:"text",value:I(u[0])}))}return t};fH.exports=ime});var vH=O((kat,gH)=>{"use strict";var AT=lH(),FE=hH(),NT=gH.exports=(n,e)=>{let t={...e,block:!0,line:!0};return AT(FE(n,t),t)};NT.block=(n,e)=>{let t={...e,block:!0};return AT(FE(n,t),t)};NT.line=(n,e)=>{let t={...e,line:!0};return AT(FE(n,t),t)};NT.first=(n,e)=>{let t={...e,block:!0,line:!0,first:!0};return AT(FE(n,t),t)};NT.parse=FE});var i4=O((tPt,n4)=>{var Ame=typeof global=="object"&&global&&global.Object===Object&&global;n4.exports=Ame});var s4=O((rPt,o4)=>{var Nme=i4(),Mme=typeof self=="object"&&self&&self.Object===Object&&self,Kme=Nme||Mme||Function("return this")();o4.exports=Kme});var k0=O((nPt,a4)=>{var Ome=s4(),Fme=Ome.Symbol;a4.exports=Fme});var c4=O((iPt,l4)=>{function Lme(n,e){for(var t=-1,r=n==null?0:n.length,i=Array(r);++t<r;)i[t]=e(n[t],t,n);return i}l4.exports=Lme});var d4=O((oPt,u4)=>{var Ume=Array.isArray;u4.exports=Ume});var h4=O((sPt,f4)=>{var p4=k0(),m4=Object.prototype,Wme=m4.hasOwnProperty,Vme=m4.toString,ZE=p4?p4.toStringTag:void 0;function jme(n){var e=Wme.call(n,ZE),t=n[ZE];try{n[ZE]=void 0;var r=!0}catch{}var i=Vme.call(n);return r&&(e?n[ZE]=t:delete n[ZE]),i}f4.exports=jme});var v4=O((aPt,g4)=>{var Jme=Object.prototype,Bme=Jme.toString;function $me(n){return Bme.call(n)}g4.exports=$me});var S4=O((lPt,I4)=>{var y4=k0(),qme=h4(),Hme=v4(),Gme="[object Null]",zme="[object Undefined]",b4=y4?y4.toStringTag:void 0;function Qme(n){return n==null?n===void 0?zme:Gme:b4&&b4 in Object(n)?qme(n):Hme(n)}I4.exports=Qme});var E4=O((cPt,C4)=>{function Yme(n){return n!=null&&typeof n=="object"}C4.exports=Yme});var P4=O((uPt,w4)=>{var Xme=S4(),Zme=E4(),efe="[object Symbol]";function tfe(n){return typeof n=="symbol"||Zme(n)&&Xme(n)==efe}w4.exports=tfe});var R4=O((dPt,T4)=>{var k4=k0(),rfe=c4(),nfe=d4(),ife=P4(),ofe=1/0,x4=k4?k4.prototype:void 0,D4=x4?x4.toString:void 0;function _4(n){if(typeof n=="string")return n;if(nfe(n))return rfe(n,_4)+"";if(ife(n))return D4?D4.call(n):"";var e=n+"";return e=="0"&&1/n==-ofe?"-0":e}T4.exports=_4});var N4=O((pPt,A4)=>{var sfe=R4();function afe(n){return n==null?"":sfe(n)}A4.exports=afe});var O4=O((mPt,K4)=>{var lfe=N4(),M4=/[\\^$.*+?()[\]{}|]/g,cfe=RegExp(M4.source);function ufe(n){return n=lfe(n),n&&cfe.test(n)?n.replace(M4,"\\$&"):n}K4.exports=ufe});var xhe={};kU(xhe,{activate:()=>She,deactivate:()=>Che});module.exports=DU(xhe);Reflect.metadata===void 0&&TU();var Zt=require("vscode");function lh(){try{return(AU(),DU(RU)).isPreRelesVersionOfJupyterExtension===!0}catch{return!0}}var kS={isExiting:!1},Aw="_builtin.JupyterServerSelectorForTesting",xS="_builtin.jupyterServerUrlProvider";var NU=!1;function MU(n){NU=n}function Hp(){return NU}var KU=!1;function OU(n){KU=n}function Mr(){return KU}var ge="python",DS="markdown",Ys="vscode-notebook-cell",hz={scheme:"untitled",language:ge},gz={scheme:"file",language:ge},Nw={language:ge},vz={scheme:Ys,language:ge},FU=[hz,gz,vz],ch="vscode-interactive-input",bt="jupyter-notebook",Yt="interactive";var qa="GitHub.codespaces",Ae="ms-toolsai.jupyter",Mw="ms-toolsai.datawrangler",Kw=["donjayamanne"],Ow="ms-toolsai.vscode-jupyter-powertoys",uh="ms-toolsai.jupyter-hub",LU="0c6ae279ed8443289764825290e4f9e2-1a736e7c-1324-4338-be46-fc2a58ae4d14-7255",Wu="STANDARD_OUTPUT_CHANNEL",_S;(t=>(t.PythonInteractiveHelpLink="https://aka.ms/pyaiinstall",t.JupyterDataRateHelpLink="https://aka.ms/AA5ggm0"))(_S||={});var Xn;(o=>(o.JupyterServerRemoteLaunchNameSeparator=`
`,o.JupyterServerRemoteLaunchService=Ae,o.JupyterServerUriListMax=10,o.IntellisenseTimeout=2e3,o.IntellisenseResolveTimeout=5e3))(Xn||={});var Un=!1;var yz=!1;function kr(){return yz||TS()}var bz=!1;function TS(){return bz}var Je;(I=>(I.GeneratedThemeName="ipython-theme",I.MatplotLibDefaultParams="_VSCode_defaultMatplotlib_Params",I.MatplotLibFigureFormats="_VSCode_matplotLib_FigureFormats",I.DefaultCodeCellMarker="# %%",I.DefaultCommTarget="jupyter.widget",I.ALL_VARIABLES="ALL_VARIABLES",I.KERNEL_VARIABLES="KERNEL_VARIABLES",I.DEBUGGER_VARIABLES="DEBUGGER_VARIABLES",I.PYTHON_VARIABLES_REQUESTER="PYTHON_VARIABLES_REQUESTER",I.MULTIPLEXING_DEBUGSERVICE="MULTIPLEXING_DEBUGSERVICE",I.RUN_BY_LINE_DEBUGSERVICE="RUN_BY_LINE_DEBUGSERVICE",I.REMOTE_URI="https://remote/",I.REMOTE_URI_ID_PARAM="id",I.REMOTE_URI_HANDLE_PARAM="uriHandle",I.REMOTE_URI_EXTENSION_ID_PARAM="extensionId"))(Je||={});var dh;(r=>(r.ImportIPython=`{0}
from IPython import get_ipython

{1}`,r.MatplotLibInit=`import matplotlib
%matplotlib inline
${Je.MatplotLibDefaultParams} = dict(matplotlib.rcParams)
`,r.DisableJedi="%config Completer.use_jedi = False"))(dh||={});var ph="JUPYTER_OUTPUT_CHANNEL",UR="Default Light+",Zn="ms-python.python",Vu="ms-toolsai.jupyter-renderers",Gp="ms-python.vscode-pylance",UU=["python","html","xml","javascript","markdown","latex","shellscript","bat","powershell","kusto","ruby","sql","perl","qsharp","raw"],WU=new Map([["bash","shellscript"],["c#","csharp"],["f#","fsharp"],["q#","qsharp"],["c++11","c++"],["c++12","c++"],["c++14","c++"]]),RS=["python","r","julia","c++","c#","f#","q#","powershell","java","scala","haskell","bash","cling","rust","sas","sos","ocaml"];var J;(be=>(be.RunAllCells="jupyter.runallcells",be.RunAllCellsAbove="jupyter.runallcellsabove",be.RunCellAndAllBelow="jupyter.runcellandallbelow",be.RunAllCellsAbovePalette="jupyter.runallcellsabove.palette",be.RunCellAndAllBelowPalette="jupyter.runcurrentcellandallbelow.palette",be.RunToLine="jupyter.runtoline",be.RunFromLine="jupyter.runfromline",be.RunCell="jupyter.runcell",be.RunCurrentCell="jupyter.runcurrentcell",be.RunCurrentCellAdvance="jupyter.runcurrentcelladvance",be.CreateNewInteractive="jupyter.createnewinteractive",be.ImportNotebook="jupyter.importnotebook",be.ImportNotebookFile="jupyter.importnotebookfile",be.ExportFileAsNotebook="jupyter.exportfileasnotebook",be.ExportFileAndOutputAsNotebook="jupyter.exportfileandoutputasnotebook",be.InterruptKernel="jupyter.interruptkernel",be.RestartKernel="jupyter.restartkernel",be.RestartKernelAndRunAllCells="jupyter.restartkernelandrunallcells",be.RestartKernelAndRunUpToSelectedCell="jupyter.restartkernelandrunuptoselectedcell",be.NotebookEditorRemoveAllCells="jupyter.notebookeditor.removeallcells",be.NotebookEditorRunAllCells="jupyter.notebookeditor.runallcells",be.NotebookEditorRunSelectedCell="jupyter.notebookeditor.runselectedcell",be.NotebookEditorAddCellBelow="jupyter.notebookeditor.addcellbelow",be.ExpandAllCells="jupyter.expandallcells",be.CollapseAllCells="jupyter.collapseallcells",be.ExportOutputAsNotebook="jupyter.exportoutputasnotebook",be.ExecSelectionInInteractiveWindow="jupyter.execSelectionInteractive",be.RunFileInInteractiveWindows="jupyter.runFileInteractive",be.DebugFileInInteractiveWindows="jupyter.debugFileInteractive",be.AddCellBelow="jupyter.addcellbelow",be.DebugCurrentCellPalette="jupyter.debugcurrentcell.palette",be.DebugCell="jupyter.debugcell",be.DebugStepOver="jupyter.debugstepover",be.DebugContinue="jupyter.debugcontinue",be.DebugStop="jupyter.debugstop",be.RunCurrentCellAndAddBelow="jupyter.runcurrentcellandaddbelow",be.InsertCellBelowPosition="jupyter.insertCellBelowPosition",be.InsertCellBelow="jupyter.insertCellBelow",be.InsertCellAbove="jupyter.insertCellAbove",be.DeleteCells="jupyter.deleteCells",be.SelectCell="jupyter.selectCell",be.SelectCellContents="jupyter.selectCellContents",be.ExtendSelectionByCellAbove="jupyter.extendSelectionByCellAbove",be.ExtendSelectionByCellBelow="jupyter.extendSelectionByCellBelow",be.MoveCellsUp="jupyter.moveCellsUp",be.MoveCellsDown="jupyter.moveCellsDown",be.ChangeCellToMarkdown="jupyter.changeCellToMarkdown",be.ChangeCellToCode="jupyter.changeCellToCode",be.GotoNextCellInFile="jupyter.gotoNextCellInFile",be.GotoPrevCellInFile="jupyter.gotoPrevCellInFile",be.ScrollToCell="jupyter.scrolltocell",be.CreateNewNotebook="jupyter.createnewnotebook",be.ViewJupyterOutput="jupyter.viewOutput",be.ExportAsPythonScript="jupyter.exportAsPythonScript",be.ExportToHTML="jupyter.exportToHTML",be.ExportToPDF="jupyter.exportToPDF",be.Export="jupyter.export",be.NativeNotebookExport="jupyter.notebookeditor.export",be.LatestExtension="jupyter.latestExtension",be.EnableLoadingWidgetsFrom3rdPartySource="jupyter.enableLoadingWidgetScriptsFromThirdPartySource",be.ShowDataViewer="jupyter.showDataViewer",be.ShowJupyterDataViewer="jupyter.showJupyterDataViewer",be.RefreshDataViewer="jupyter.refreshDataViewer",be.ClearSavedJupyterUris="jupyter.clearSavedJupyterUris",be.OpenVariableView="jupyter.openVariableView",be.OpenOutlineView="jupyter.openOutlineView",be.InteractiveClearAll="jupyter.interactive.clearAllCells",be.InteractiveGoToCode="jupyter.interactive.goToCode",be.InteractiveCopyCell="jupyter.interactive.copyCell",be.InteractiveExportAsNotebook="jupyter.interactive.exportasnotebook",be.InteractiveExportAs="jupyter.interactive.exportas",be.RunByLine="jupyter.runByLine",be.RunAndDebugCell="jupyter.runAndDebugCell",be.RunByLineNext="jupyter.runByLineNext",be.RunByLineStop="jupyter.runByLineStop",be.ReplayPylanceLog="jupyter.replayPylanceLog",be.ReplayPylanceLogStep="jupyter.replayPylanceLogStep",be.InstallPythonExtensionViaKernelPicker="jupyter.installPythonExtensionViaKernelPicker",be.InstallPythonViaKernelPicker="jupyter.installPythonViaKernelPicker",be.ContinueEditSessionInCodespace="jupyter.continueEditSessionInCodespace"))(J||={});var ju;(r=>(r.DefaultDesignLenses=[J.RunCurrentCell,J.RunAllCellsAbove,J.DebugCell],r.DefaultDebuggingLenses=[J.DebugContinue,J.DebugStop,J.DebugStepOver],r.DebuggerCommands=[J.DebugContinue,J.DebugStop,J.DebugStepOver]))(ju||={});var yr;(ae=>(ae.HasCodeCells="jupyter.hascodecells",ae.IsInteractiveActive="jupyter.isinteractiveactive",ae.OwnsSelection="jupyter.ownsSelection",ae.HaveNativeCells="jupyter.havenativecells",ae.HaveNative="jupyter.havenative",ae.IsNativeActive="jupyter.isnativeactive",ae.IsInteractiveOrNativeActive="jupyter.isinteractiveornativeactive",ae.IsPythonOrNativeActive="jupyter.ispythonornativeactive",ae.IsPythonOrInteractiveActive="jupyter.ispythonorinteractiveeactive",ae.IsPythonOrInteractiveOrNativeActive="jupyter.ispythonorinteractiveornativeeactive",ae.CanRestartNotebookKernel="jupyter.notebookeditor.canrestartNotebookkernel",ae.CanInterruptNotebookKernel="jupyter.notebookeditor.canInterruptNotebookKernel",ae.CanRestartInteractiveWindowKernel="jupyter.interactive.canRestartNotebookKernel",ae.CanInterruptInteractiveWindowKernel="jupyter.interactive.canInterruptNotebookKernel",ae.RunByLineCells="jupyter.notebookeditor.runByLineCells",ae.RunByLineDocuments="jupyter.notebookeditor.runByLineDocuments",ae.DebugDocuments="jupyter.notebookeditor.debugDocuments",ae.IsPythonNotebook="jupyter.ispythonnotebook",ae.IsJupyterKernelSelected="jupyter.kernel.isjupyter",ae.IsDataViewerActive="jupyter.dataViewerActive",ae.HasNativeNotebookOrInteractiveWindowOpen="jupyter.hasNativeNotebookOrInteractiveWindowOpen",ae.ZmqAvailable="jupyter.zmqavailable",ae.ReplayLogLoaded="jupyter.replayLogLoaded",ae.KernelSource="jupyter.kernelSource"))(yr||={});var zp;(l=>(l.PythonCellMarker=/^(#\s*%%|#\s*\<codecell\>|#\s*In\[\d*?\]|#\s*In\[ \])/,l.PythonMarkdownCellMarker=/^(#\s*%%\s*\[markdown\]|#\s*\<markdowncell\>)/,l.UrlPatternRegEx="(?<PREFIX>https?:\\/\\/)((\\(.+\\s+or\\s+(?<IP>.+)\\))|(?<LOCAL>[^\\s]+))(?<REST>:.+)",l.HttpPattern=/https?:\/\//,l.ShapeSplitterRegEx=/.*,\s*(\d+).*/,l.SvgHeightRegex=/(\<svg.*height=\")(.*?)\"/,l.SvgWidthRegex=/(\<svg.*width=\")(.*?)\"/,l.SvgSizeTagRegex=/\<svg.*tag=\"sizeTag=\{(.*),\s*(.*)\}\"/))(zp||={});var VU=Symbol("DataScienceStartupTime"),WR={major:4,minor:2},Li="application/vnd.jupyter.widget-view+json";var AS=7,mh="unknown";var MS=class{constructor(e,t){this._data=t;this.expiryTime=e+Date.now()}get expired(){let e=this.expiryTime<=Date.now();return e&&(this._data=void 0),e}get data(){return this.expired&&(this._data=void 0),this._data}},NS=new Map;function jU(){return NS}function JU(n,e){let t=e.map(r=>`${JSON.stringify(r)}`).join("-Arg-Separator-");return`KeyPrefix=${n}-Args=${t}`}var Qp=class{constructor(e,t=""){this.expiryDurationMs=e;this.cacheKey=t}get hasData(){let e=NS.get(this.cacheKey);return!!(e&&!e.expired)}get data(){return this.hasData?NS.get(this.cacheKey)?.data:void 0}set data(e){let t=new MS(this.expiryDurationMs,e);NS.set(this.cacheKey,t)}clear(){NS.delete(this.cacheKey)}};var BU=Symbol("MicrotaskDelay");async function vi(n){return new Promise(e=>{setTimeout(()=>e(n),n)})}async function Lw(n,e,t){return new Promise(r=>{let i,o=setTimeout(()=>i(!1),e),s=setInterval(()=>{n().then(a=>{a&&i(!0)}).catch(a=>i(!1))},t);i=a=>{clearTimeout(o),clearInterval(s),r(a)}})}function br(n,e,...t){let r=Fw(e)?void 0:e;Fw(e)&&t.push(e);let i,o=setTimeout(()=>i?.(r),n);return Promise.race([Promise.race(t).finally(()=>clearTimeout(o)),new Promise(s=>i=s)])}function hh(n,e,...t){let r,i=setTimeout(()=>r?.(e),n);return Promise.race([Promise.race(t).finally(()=>clearTimeout(i)),new Promise((o,s)=>r=s)])}function Ju(n){return typeof n?.then=="function"&&typeof n?.catch=="function"}function Fw(n){return typeof n?.then=="function"}var VR=class{constructor(e=null){this.scope=e;this._resolved=!1;this._rejected=!1;this._promise=new Promise((t,r)=>{this._resolve=t,this._reject=r})}get value(){return this._value}resolve(e){this._value=e,this._resolve.apply(this.scope?this.scope:this,arguments),this._resolved=!0}reject(e){this._reject.apply(this.scope?this.scope:this,arguments),this._rejected=!0}get promise(){return this._promise}get resolved(){return this._resolved}get rejected(){return this._rejected}get completed(){return this._rejected||this._resolved}};function re(n=null){return new VR(n)}function Xi(n){let e=re();return n.then(e.resolve.bind(e)).catch(e.reject.bind(e)),e}var fh=class{constructor(){this.currentPromise=Promise.resolve(void 0)}async chain(e){let t=re(),r=this.currentPromise;return this.currentPromise=this.currentPromise.then(async()=>{try{let i=await e();t.resolve(i)}catch(i){throw t.reject(i),i}}),await r,t.promise}chainFinally(e){let t=re();return this.currentPromise=this.currentPromise.finally(()=>e().then(r=>t.resolve(r)).catch(r=>t.reject(r))),t.promise}};var Iz=(n,e)=>{let t=!0,r=setTimeout(()=>{t=!1,e()},n);return{isTriggered:()=>t,dispose:()=>{clearTimeout(r),t=!1}}},Sz=n=>{let e=!0;return queueMicrotask(()=>{e&&(e=!1,n())}),{isTriggered:()=>e,dispose:()=>{e=!1}}},us=class{constructor(e){this.defaultDelay=e;this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}trigger(e,t=this.defaultDelay){this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((i,o)=>{this.doResolve=i,this.doReject=o}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){let i=this.task;return this.task=null,i()}}),this.completionPromise.catch(h));let r=()=>{this.deferred=null,this.doResolve?.(null)};return this.deferred=t===BU?Sz(r):Iz(t,r),this.completionPromise}isTriggered(){return!!this.deferred?.isTriggered()}cancel(){this.cancelTimeout(),this.completionPromise&&(this.doReject?.(new Error("Canceled")),this.completionPromise=null)}cancelTimeout(){this.deferred?.dispose(),this.deferred=null}dispose(){this.cancel()}};function h(){}function ei(n){try{let e=n();Ju(e)&&e.catch(h)}catch{}}function Bu(n){if(!n)return!0;let e=n;return typeof e.path=="string"&&typeof e.scheme=="string"}function Wn(n){if(!n)return!1;let e=n;return typeof e.path=="string"&&typeof e.scheme=="string"}function qU(n){let e=Wn(n)?n:n.uri;return e.scheme.includes(Ys)||e.path.endsWith(".interactive")}function Ha(){return process.platform.toString()==="web"}function $U(n,e){return Wn(e)?e.toString():e}function Xs(n,e){return n===e?!0:n&&!e||!n&&e?!1:JSON.stringify(n,$U)===JSON.stringify(e,$U)}var Fe=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}};var HU=jU();function jR(n){return function(e,t,r){let i=r.value,s=`Cache_Method_Output_${"constructor"in e&&e.constructor.name?e.constructor.name:""}.${t}`;r.value=async function(...a){if(kr())return i.apply(this,a);let l=JU(s,a),c=HU.get(l);if(c&&!c.expired)return p.debug(`Cached data exists ${l}`),Promise.resolve(c.data);let u=i.apply(this,a);return u.then(d=>HU.set(l,new MS(n,d))).catch(h),u}}}function qr(n){return function(e,t,r){let i=r.value,o=`Jupyter Extension (Error in ${n||t}, method:${t}):`;r.value=function(...s){try{let a=i.apply(this,s);if(a&&typeof a.then=="function"&&typeof a.catch=="function")return a.catch(l=>{kr()||p.error(o,l)})}catch(a){if(kr())return;p.error(o,a)}}}}function Cz(n,e,t){let r=new Fe;try{t&&n(void 0);let i=e();return Ju(i)?i.then(o=>(n({elapsed:r.elapsedTime,returnValue:o}),o)).catch(o=>{n({elapsed:r.elapsedTime,err:o})}):n({elapsed:r.elapsedTime,returnValue:i}),i}catch(i){throw n({elapsed:r.elapsedTime,err:i}),i}}function GU(n,e){return function(t,r,i){let o=i.value;return i.value=function(...s){let a={kind:"Class",name:t&&t.constructor?t.constructor.name:"",args:s,methodName:r,target:t},l=this;return Cz(c=>n(a,c),()=>o.apply(l,s),e)},i}}function gh(){return function(n,e,t){let r=t.value;return t.value=function(...i){if(!kr())throw new Error(`Function: ${e} can only be called from test code`);return r.apply(this,i)},t}}function JR(){return function(n,e,t){let r=t.value,i=`chainedPromiseFor_${e}`;return t.value=async function(...o){let s=this[i];s?s=s.then(()=>r.apply(this,o)):s=r.apply(this,o),this[i]=s;let a=s.then(l=>l).catch(l=>{throw this[i]=void 0,l});return a.catch(h),a},t}}function BR(n,e){if(Array.isArray(n))return n.map(t=>BR(t,e)).join(", ");if(n===void 0)return"undefined";if(n===null)return"null";try{return n&&n.path?`<Uri:${n.path}>`:JSON.stringify(n)}catch{return`<${e} cannot be serialized for logging>`}}function $R(n){if(!n)return"";try{return n.map((t,r)=>{let i=BR(t,"argument");return`Arg ${r+1}: ${i}`}).join(", ")}catch{return""}}function zU(n){return`Return Value: ${BR(n,"Return value")}`}function Uw(){let n=new Date,e=String(n.getHours()).padStart(2,"0"),t=String(n.getMinutes()).padStart(2,"0"),r=String(n.getSeconds()).padStart(2,"0"),i=String(n.getMilliseconds()).padStart(3,"0");return`${e}:${t}:${r}.${i}`}function Ue(n,e={removeEmptyEntries:!0,trim:!0}){n=n||"";let t=n.split(/\r?\n/g);return e&&e.trim&&(t=t.map(r=>r.trim())),e&&e.removeEmptyEntries&&(t=t.filter(r=>r.length>0)),t}function KS(n){return n&&(n.indexOf(" ")>=0&&!n.startsWith('"')&&!n.endsWith('"')?`"${n}"`:n.toString())}function OS(n){return n&&KS(n).replace(/\\/g,"/")}function Yp(n){return n&&n.replace(/(^['"])|(['"]$)/g,"")}function FS(n,...e){return n.replace(/{(\d+)}/g,(t,r)=>e[r]===void 0?t:e[r])}function vh(n){return n?n.replace(/\$\([a-z0-9\-]+?\)/gi,"").trim():n||""}function yh(n){let e=n.split(`
`),t=e.find(r=>r.trim().length>0&&!r.trim().startsWith("#"));if(t){let r=t.match(/^\s*/)[0];return e.map(i=>i.startsWith(r)?i.replace(r,""):i).join(`
`)}return n}var eA=require("vscode");var Vw="en",Jw=!1,Bw=!1,LS=!1,Ez=!1,wz=!1,HR=!1,Pz=!1,kz=!1,xz=!1,Ww,jw=Vw,Dz,qu,ds=typeof self=="object"?self:typeof global=="object"?global:{},Zi;typeof ds.vscode<"u"&&typeof ds.vscode.process<"u"?Zi=ds.vscode.process:typeof process<"u"&&(Zi=process);var QU=typeof Zi?.versions?.electron=="string",YU=QU&&Zi?.type==="renderer",Zhe=YU&&Zi?.sandboxed;if(typeof navigator=="object"&&!YU)qu=navigator.userAgent,Jw=qu.indexOf("Windows")>=0,Bw=qu.indexOf("Macintosh")>=0,kz=(qu.indexOf("Macintosh")>=0||qu.indexOf("iPad")>=0||qu.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,LS=qu.indexOf("Linux")>=0,HR=!0,Ww=navigator.language,jw=Ww;else if(typeof Zi=="object"){Jw=Zi.platform==="win32",Bw=Zi.platform==="darwin",LS=Zi.platform==="linux",Ez=LS&&!!Zi.env.SNAP&&!!Zi.env.SNAP_REVISION,Pz=QU,xz=!!Zi.env.CI||!!Zi.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Ww=Vw,jw=Vw;let n=Zi.env.VSCODE_NLS_CONFIG;if(n)try{let e=JSON.parse(n),t=e.availableLanguages["*"];Ww=e.locale,jw=t||Vw,Dz=e._translationsConfigFile}catch{}wz=!0}else console.error("Unable to resolve platform.");var qR=0;Bw?qR=1:Jw?qR=3:LS&&(qR=2);var US=Jw,XU=Bw,ZU=LS;var $w=HR,ege=HR&&typeof ds.importScripts=="function";var Ga=qu,$u=jw,_z;(r=>{function n(){return $u}r.value=n;function e(){return $u.length===2?$u==="en":$u.length>=3?$u[0]==="e"&&$u[1]==="n"&&$u[2]==="-":!1}r.isDefaultVariant=e;function t(){return $u==="en"}r.isDefault=t})(_z||={});var tge=(()=>{if(typeof ds.postMessage=="function"&&!ds.importScripts){let n=[];ds.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let r=0,i=n.length;r<i;r++){let o=n[r];if(o.id===t.data.vscodeScheduleAsyncWork){n.splice(r,1),o.callback();return}}});let e=0;return t=>{let r=++e;n.push({id:r,callback:t}),ds.postMessage({vscodeScheduleAsyncWork:r},"*")}}return n=>setTimeout(n)})();var Tz=!!(Ga&&Ga.indexOf("Chrome")>=0),rge=!!(Ga&&Ga.indexOf("Firefox")>=0),nge=!!(!Tz&&Ga&&Ga.indexOf("Safari")>=0),ige=!!(Ga&&Ga.indexOf("Edg/")>=0),oge=!!(Ga&&Ga.indexOf("Android")>=0);var Xp;if(typeof ds.vscode<"u"&&typeof ds.vscode.process<"u"){let n=ds.vscode.process;Xp={get platform(){return n.platform},get arch(){return n.arch},get env(){return n.env},cwd(){return n.cwd()}}}else typeof process<"u"?Xp={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:Xp={get platform(){return US?"win32":XU?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var qw=Xp.cwd,eW=Xp.env,eo=Xp.platform,cge=Xp.arch;var Az=65,Nz=97,Mz=90,Kz=122,zu=46,Vn=47,to=92,Hu=58,Oz=63,Hw=class extends Error{constructor(t,r,i){let o;typeof r=="string"&&r.indexOf("not ")===0?(o="must not be",r=r.replace(/^not /,"")):o="must be";let s=t.indexOf(".")!==-1?"property":"argument",a=`The "${t}" ${s} ${o} of type ${r}`;a+=`. Received type ${typeof i}`;super(a);this.code="ERR_INVALID_ARG_TYPE"}};function ln(n,e){if(typeof n!="string")throw new Hw(e,"string",n)}function _t(n){return n===Vn||n===to}function GR(n){return n===Vn}function Gu(n){return n>=Az&&n<=Mz||n>=Nz&&n<=Kz}function Gw(n,e,t,r){let i="",o=0,s=-1,a=0,l=0;for(let c=0;c<=n.length;++c){if(c<n.length)l=n.charCodeAt(c);else{if(r(l))break;l=Vn}if(r(l)){if(!(s===c-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==zu||i.charCodeAt(i.length-2)!==zu){if(i.length>2){let u=i.lastIndexOf(t);u===-1?(i="",o=0):(i=i.slice(0,u),o=i.length-1-i.lastIndexOf(t)),s=c,a=0;continue}else if(i.length!==0){i="",o=0,s=c,a=0;continue}}e&&(i+=i.length>0?`${t}..`:"..",o=2)}else i.length>0?i+=`${t}${n.slice(s+1,c)}`:i=n.slice(s+1,c),o=c-s-1;s=c,a=0}else l===zu&&a!==-1?++a:a=-1}return i}function tW(n,e){if(e===null||typeof e!="object")throw new Hw("pathObject","Object",e);let t=e.dir||e.root,r=e.base||`${e.name||""}${e.ext||""}`;return t?t===e.root?`${t}${r}`:`${t}${n}${r}`:r}var In={resolve(...n){let e="",t="",r=!1;for(let i=n.length-1;i>=-1;i--){let o;if(i>=0){if(o=n[i],ln(o,"path"),o.length===0)continue}else e.length===0?o=qw():(o=eW[`=${e}`]||qw(),(o===void 0||o.slice(0,2).toLowerCase()!==e.toLowerCase()&&o.charCodeAt(2)===to)&&(o=`${e}\\`));let s=o.length,a=0,l="",c=!1,u=o.charCodeAt(0);if(s===1)_t(u)&&(a=1,c=!0);else if(_t(u))if(c=!0,_t(o.charCodeAt(1))){let d=2,f=d;for(;d<s&&!_t(o.charCodeAt(d));)d++;if(d<s&&d!==f){let g=o.slice(f,d);for(f=d;d<s&&_t(o.charCodeAt(d));)d++;if(d<s&&d!==f){for(f=d;d<s&&!_t(o.charCodeAt(d));)d++;(d===s||d!==f)&&(l=`\\\\${g}\\${o.slice(f,d)}`,a=d)}}}else a=1;else Gu(u)&&o.charCodeAt(1)===Hu&&(l=o.slice(0,2),a=2,s>2&&_t(o.charCodeAt(2))&&(c=!0,a=3));if(l.length>0)if(e.length>0){if(l.toLowerCase()!==e.toLowerCase())continue}else e=l;if(r){if(e.length>0)break}else if(t=`${o.slice(a)}\\${t}`,r=c,c&&e.length>0)break}return t=Gw(t,!r,"\\",_t),r?`${e}\\${t}`:`${e}${t}`||"."},normalize(n){ln(n,"path");let e=n.length;if(e===0)return".";let t=0,r,i=!1,o=n.charCodeAt(0);if(e===1)return GR(o)?"\\":n;if(_t(o))if(i=!0,_t(n.charCodeAt(1))){let a=2,l=a;for(;a<e&&!_t(n.charCodeAt(a));)a++;if(a<e&&a!==l){let c=n.slice(l,a);for(l=a;a<e&&_t(n.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&!_t(n.charCodeAt(a));)a++;if(a===e)return`\\\\${c}\\${n.slice(l)}\\`;a!==l&&(r=`\\\\${c}\\${n.slice(l,a)}`,t=a)}}}else t=1;else Gu(o)&&n.charCodeAt(1)===Hu&&(r=n.slice(0,2),t=2,e>2&&_t(n.charCodeAt(2))&&(i=!0,t=3));let s=t<e?Gw(n.slice(t),!i,"\\",_t):"";return s.length===0&&!i&&(s="."),s.length>0&&_t(n.charCodeAt(e-1))&&(s+="\\"),r===void 0?i?`\\${s}`:s:i?`${r}\\${s}`:`${r}${s}`},isAbsolute(n){ln(n,"path");let e=n.length;if(e===0)return!1;let t=n.charCodeAt(0);return _t(t)||e>2&&Gu(t)&&n.charCodeAt(1)===Hu&&_t(n.charCodeAt(2))},join(...n){if(n.length===0)return".";let e,t;for(let o=0;o<n.length;++o){let s=n[o];ln(s,"path"),s.length>0&&(e===void 0?e=t=s:e+=`\\${s}`)}if(e===void 0)return".";let r=!0,i=0;if(typeof t=="string"&&_t(t.charCodeAt(0))){++i;let o=t.length;o>1&&_t(t.charCodeAt(1))&&(++i,o>2&&(_t(t.charCodeAt(2))?++i:r=!1))}if(r){for(;i<e.length&&_t(e.charCodeAt(i));)i++;i>=2&&(e=`\\${e.slice(i)}`)}return In.normalize(e)},relative(n,e){if(ln(n,"from"),ln(e,"to"),n===e)return"";let t=In.resolve(n),r=In.resolve(e);if(t===r||(n=t.toLowerCase(),e=r.toLowerCase(),n===e))return"";let i=0;for(;i<n.length&&n.charCodeAt(i)===to;)i++;let o=n.length;for(;o-1>i&&n.charCodeAt(o-1)===to;)o--;let s=o-i,a=0;for(;a<e.length&&e.charCodeAt(a)===to;)a++;let l=e.length;for(;l-1>a&&e.charCodeAt(l-1)===to;)l--;let c=l-a,u=s<c?s:c,d=-1,f=0;for(;f<u;f++){let b=n.charCodeAt(i+f);if(b!==e.charCodeAt(a+f))break;b===to&&(d=f)}if(f!==u){if(d===-1)return r}else{if(c>u){if(e.charCodeAt(a+f)===to)return r.slice(a+f+1);if(f===2)return r.slice(a+f)}s>u&&(n.charCodeAt(i+f)===to?d=f:f===2&&(d=3)),d===-1&&(d=0)}let g="";for(f=i+d+1;f<=o;++f)(f===o||n.charCodeAt(f)===to)&&(g+=g.length===0?"..":"\\..");return a+=d,g.length>0?`${g}${r.slice(a,l)}`:(r.charCodeAt(a)===to&&++a,r.slice(a,l))},toNamespacedPath(n){if(typeof n!="string")return n;if(n.length===0)return"";let e=In.resolve(n);if(e.length<=2)return n;if(e.charCodeAt(0)===to){if(e.charCodeAt(1)===to){let t=e.charCodeAt(2);if(t!==Oz&&t!==zu)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(Gu(e.charCodeAt(0))&&e.charCodeAt(1)===Hu&&e.charCodeAt(2)===to)return`\\\\?\\${e}`;return n},dirname(n){ln(n,"path");let e=n.length;if(e===0)return".";let t=-1,r=0,i=n.charCodeAt(0);if(e===1)return _t(i)?n:".";if(_t(i)){if(t=r=1,_t(n.charCodeAt(1))){let a=2,l=a;for(;a<e&&!_t(n.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&_t(n.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&!_t(n.charCodeAt(a));)a++;if(a===e)return n;a!==l&&(t=r=a+1)}}}}else Gu(i)&&n.charCodeAt(1)===Hu&&(t=e>2&&_t(n.charCodeAt(2))?3:2,r=t);let o=-1,s=!0;for(let a=e-1;a>=r;--a)if(_t(n.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(t===-1)return".";o=t}return n.slice(0,o)},basename(n,e){e!==void 0&&ln(e,"ext"),ln(n,"path");let t=0,r=-1,i=!0,o;if(n.length>=2&&Gu(n.charCodeAt(0))&&n.charCodeAt(1)===Hu&&(t=2),e!==void 0&&e.length>0&&e.length<=n.length){if(e===n)return"";let s=e.length-1,a=-1;for(o=n.length-1;o>=t;--o){let l=n.charCodeAt(o);if(_t(l)){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===e.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return t===r?r=a:r===-1&&(r=n.length),n.slice(t,r)}for(o=n.length-1;o>=t;--o)if(_t(n.charCodeAt(o))){if(!i){t=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(t,r)},extname(n){ln(n,"path");let e=0,t=-1,r=0,i=-1,o=!0,s=0;n.length>=2&&n.charCodeAt(1)===Hu&&Gu(n.charCodeAt(0))&&(e=r=2);for(let a=n.length-1;a>=e;--a){let l=n.charCodeAt(a);if(_t(l)){if(!o){r=a+1;break}continue}i===-1&&(o=!1,i=a+1),l===zu?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===r+1?"":n.slice(t,i)},format:tW.bind(null,"\\"),parse(n){ln(n,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return e;let t=n.length,r=0,i=n.charCodeAt(0);if(t===1)return _t(i)?(e.root=e.dir=n,e):(e.base=e.name=n,e);if(_t(i)){if(r=1,_t(n.charCodeAt(1))){let d=2,f=d;for(;d<t&&!_t(n.charCodeAt(d));)d++;if(d<t&&d!==f){for(f=d;d<t&&_t(n.charCodeAt(d));)d++;if(d<t&&d!==f){for(f=d;d<t&&!_t(n.charCodeAt(d));)d++;d===t?r=d:d!==f&&(r=d+1)}}}}else if(Gu(i)&&n.charCodeAt(1)===Hu){if(t<=2)return e.root=e.dir=n,e;if(r=2,_t(n.charCodeAt(2))){if(t===3)return e.root=e.dir=n,e;r=3}}r>0&&(e.root=n.slice(0,r));let o=-1,s=r,a=-1,l=!0,c=n.length-1,u=0;for(;c>=r;--c){if(i=n.charCodeAt(c),_t(i)){if(!l){s=c+1;break}continue}a===-1&&(l=!1,a=c+1),i===zu?o===-1?o=c:u!==1&&(u=1):o!==-1&&(u=-1)}return a!==-1&&(o===-1||u===0||u===1&&o===a-1&&o===s+1?e.base=e.name=n.slice(s,a):(e.name=n.slice(s,o),e.base=n.slice(s,a),e.ext=n.slice(o,a))),s>0&&s!==r?e.dir=n.slice(0,s-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},Ir={resolve(...n){let e="",t=!1;for(let r=n.length-1;r>=-1&&!t;r--){let i=r>=0?n[r]:qw();ln(i,"path"),i.length!==0&&(e=`${i}/${e}`,t=i.charCodeAt(0)===Vn)}return e=Gw(e,!t,"/",GR),t?`/${e}`:e.length>0?e:"."},normalize(n){if(ln(n,"path"),n.length===0)return".";let e=n.charCodeAt(0)===Vn,t=n.charCodeAt(n.length-1)===Vn;return n=Gw(n,!e,"/",GR),n.length===0?e?"/":t?"./":".":(t&&(n+="/"),e?`/${n}`:n)},isAbsolute(n){return ln(n,"path"),n.length>0&&n.charCodeAt(0)===Vn},join(...n){if(n.length===0)return".";let e;for(let t=0;t<n.length;++t){let r=n[t];ln(r,"path"),r.length>0&&(e===void 0?e=r:e+=`/${r}`)}return e===void 0?".":Ir.normalize(e)},relative(n,e){if(ln(n,"from"),ln(e,"to"),n===e||(n=Ir.resolve(n),e=Ir.resolve(e),n===e))return"";let t=1,r=n.length,i=r-t,o=1,s=e.length-o,a=i<s?i:s,l=-1,c=0;for(;c<a;c++){let d=n.charCodeAt(t+c);if(d!==e.charCodeAt(o+c))break;d===Vn&&(l=c)}if(c===a)if(s>a){if(e.charCodeAt(o+c)===Vn)return e.slice(o+c+1);if(c===0)return e.slice(o+c)}else i>a&&(n.charCodeAt(t+c)===Vn?l=c:c===0&&(l=0));let u="";for(c=t+l+1;c<=r;++c)(c===r||n.charCodeAt(c)===Vn)&&(u+=u.length===0?"..":"/..");return`${u}${e.slice(o+l)}`},toNamespacedPath(n){return n},dirname(n){if(ln(n,"path"),n.length===0)return".";let e=n.charCodeAt(0)===Vn,t=-1,r=!0;for(let i=n.length-1;i>=1;--i)if(n.charCodeAt(i)===Vn){if(!r){t=i;break}}else r=!1;return t===-1?e?"/":".":e&&t===1?"//":n.slice(0,t)},basename(n,e){e!==void 0&&ln(e,"ext"),ln(n,"path");let t=0,r=-1,i=!0,o;if(e!==void 0&&e.length>0&&e.length<=n.length){if(e===n)return"";let s=e.length-1,a=-1;for(o=n.length-1;o>=0;--o){let l=n.charCodeAt(o);if(l===Vn){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===e.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return t===r?r=a:r===-1&&(r=n.length),n.slice(t,r)}for(o=n.length-1;o>=0;--o)if(n.charCodeAt(o)===Vn){if(!i){t=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(t,r)},extname(n){ln(n,"path");let e=-1,t=0,r=-1,i=!0,o=0;for(let s=n.length-1;s>=0;--s){let a=n.charCodeAt(s);if(a===Vn){if(!i){t=s+1;break}continue}r===-1&&(i=!1,r=s+1),a===zu?e===-1?e=s:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||r===-1||o===0||o===1&&e===r-1&&e===t+1?"":n.slice(e,r)},format:tW.bind(null,"/"),parse(n){ln(n,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return e;let t=n.charCodeAt(0)===Vn,r;t?(e.root="/",r=1):r=0;let i=-1,o=0,s=-1,a=!0,l=n.length-1,c=0;for(;l>=r;--l){let u=n.charCodeAt(l);if(u===Vn){if(!a){o=l+1;break}continue}s===-1&&(a=!1,s=l+1),u===zu?i===-1?i=l:c!==1&&(c=1):i!==-1&&(c=-1)}if(s!==-1){let u=o===0&&t?1:o;i===-1||c===0||c===1&&i===s-1&&i===o+1?e.base=e.name=n.slice(u,s):(e.name=n.slice(u,i),e.base=n.slice(u,s),e.ext=n.slice(i,s))}return o>0?e.dir=n.slice(0,o-1):t&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};Ir.win32=In.win32=In;Ir.posix=In.posix=Ir;var cn=eo==="win32"?In.normalize:Ir.normalize,zw=eo==="win32"?In.isAbsolute:Ir.isAbsolute,We=eo==="win32"?In.join:Ir.join,rW=eo==="win32"?In.resolve:Ir.resolve,Qw=eo==="win32"?In.relative:Ir.relative,rt=eo==="win32"?In.dirname:Ir.dirname,Se=eo==="win32"?In.basename:Ir.basename,Ui=eo==="win32"?In.extname:Ir.extname,uge=eo==="win32"?In.format:Ir.format,nW=eo==="win32"?In.parse:Ir.parse,dge=eo==="win32"?In.toNamespacedPath:Ir.toNamespacedPath,hn=eo==="win32"?In.sep:Ir.sep,jn=eo==="win32"?In.delimiter:Ir.delimiter;var VS=require("vscode");var Fz=require("vscode");var Yw=class{constructor(e){this.computeFn=e;this.lastCache=void 0;this.lastArgKey=void 0}get(e){let t=JSON.stringify(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this.computeFn(e)),this.lastCache}};var WS=class n{constructor(e){this.executor=e;this._didRun=!1}hasValue(){return this._didRun}getValue(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}map(e){return new n(()=>e(this.getValue()))}};function lW(n,e){return n<e?-1:n>e?1:0}function Lz(n,e,t=0,r=n.length,i=0,o=e.length){for(;t<r&&i<o;t++,i++){let l=n.charCodeAt(t),c=e.charCodeAt(i);if(l<c)return-1;if(l>c)return 1}let s=r-t,a=o-i;return s<a?-1:s>a?1:0}function cW(n,e,t=0,r=n.length,i=0,o=e.length){for(;t<r&&i<o;t++,i++){let l=n.charCodeAt(t),c=e.charCodeAt(i);if(l===c)continue;if(l>=128||c>=128)return Lz(n.toLowerCase(),e.toLowerCase(),t,r,i,o);iW(l)&&(l-=32),iW(c)&&(c-=32);let u=l-c;if(u!==0)return u}let s=r-t,a=o-i;return s<a?-1:s>a?1:0}function iW(n){return n>=97&&n<=122}function uW(n,e){return n.length===e.length&&cW(n,e)===0}function dW(n,e){let t=e.length;return e.length>n.length?!1:cW(n,e,0,t)===0}var oW=class n{constructor(e){this.confusableDictionary=e}static{this.ambiguousCharacterData=new WS(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'))}static{this.cache=new Yw(e=>{function t(u){let d=new Map;for(let f=0;f<u.length;f+=2)d.set(u[f],u[f+1]);return d}function r(u,d){let f=new Map(u);for(let[g,b]of d)f.set(g,b);return f}function i(u,d){if(!u)return d;let f=new Map;for(let[g,b]of u)d.has(g)&&f.set(g,b);return f}let o=this.ambiguousCharacterData.getValue(),s=e.filter(u=>!u.startsWith("_")&&u in o);s.length===0&&(s=["_default"]);let a;for(let u of s){let d=t(o[u]);a=i(a,d)}let l=t(o._common),c=r(l,a);return new n(c)})}static getInstance(e){return n.cache.get(Array.from(e))}static{this._locales=new WS(()=>Object.keys(n.ambiguousCharacterData.getValue()).filter(e=>!e.startsWith("_")))}static getLocales(){return n._locales.getValue()}isAmbiguous(e){return this.confusableDictionary.has(e)}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},sW=class n{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static{this._data=void 0}static getData(){return this._data||(this._data=new Set(n.getRawData())),this._data}static isInvisibleCharacter(e){return n.getData().has(e)}static get codePoints(){return n.getData()}};function Qu(n){return n===47||n===92}function zR(n){return n.replace(/[\\/]/g,Ir.sep)}function pW(n){return n.indexOf("/")===-1&&(n=zR(n)),/^[a-zA-Z]:(\/|$)/.test(n)&&(n="/"+n),n}function QR(n,e=Ir.sep){if(!n)return"";let t=n.length,r=n.charCodeAt(0);if(Qu(r)){if(Qu(n.charCodeAt(1))&&!Qu(n.charCodeAt(2))){let o=3,s=o;for(;o<t&&!Qu(n.charCodeAt(o));o++);if(s!==o&&!Qu(n.charCodeAt(o+1))){for(o+=1;o<t;o++)if(Qu(n.charCodeAt(o)))return n.slice(0,o+1).replace(/[\\/]/g,e)}}return e}else if(Uz(r)&&n.charCodeAt(1)===58)return Qu(n.charCodeAt(2))?n.slice(0,2)+e:n.slice(0,2);let i=n.indexOf("://");if(i!==-1){for(i+=3;i<t;i++)if(Qu(n.charCodeAt(i)))return n.slice(0,i+1)}return""}function YR(n,e,t,r=hn){if(n===e)return!0;if(!n||!e||e.length>n.length)return!1;if(t){if(!dW(n,e))return!1;if(e.length===n.length)return!0;let o=e.length;return e.charAt(e.length-1)===r&&o--,n.charAt(o)===r}return e.charAt(e.length-1)!==r&&(e+=r),n.indexOf(e)===0}function Uz(n){return n>=65&&n<=90||n>=97&&n<=122}var za;(ee=>(ee.inMemory="inmemory",ee.vscode="vscode",ee.internal="private",ee.walkThrough="walkThrough",ee.walkThroughSnippet="walkThroughSnippet",ee.http="http",ee.https="https",ee.file="file",ee.mailto="mailto",ee.untitled="untitled",ee.data="data",ee.command="command",ee.vscodeRemote="vscode-remote",ee.vscodeRemoteResource="vscode-remote-resource",ee.vscodeUserData="vscode-userdata",ee.vscodeCustomEditor="vscode-custom-editor",ee.vscodeNotebook="vscode-notebook",ee.vscodeNotebookCell="vscode-notebook-cell",ee.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",ee.vscodeNotebookCellOutput="vscode-notebook-cell-output",ee.vscodeInteractive="vscode-interactive",ee.vscodeInteractiveInput="vscode-interactive-input",ee.vscodeSettings="vscode-settings",ee.vscodeWorkspaceTrust="vscode-workspace-trust",ee.vscodeTerminal="vscode-terminal",ee.webviewPanel="webview-panel",ee.vscodeWebview="vscode-webview",ee.extension="extension",ee.vscodeFileResource="vscode-file",ee.tmp="tmp",ee.vsls="vsls"))(za||={});function Zs(n){return $w?n?.path||"":n?.fsPath||""}var jS=class{constructor(e){this._ignorePathCasing=e}compare(e,t,r=!1){return e===t?0:lW(this.getComparisonKey(e,r),this.getComparisonKey(t,r))}isEqual(e,t,r=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,r)===this.getComparisonKey(t,r)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,r=!1,i=US?"\\":"/"){if(e.scheme===t.scheme){if(e.scheme===za.file)return YR(Zs(e),Zs(t),this._ignorePathCasing(e),i)&&e.query===t.query&&(r||e.fragment===t.fragment);if(mW(e.authority,t.authority))return YR(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(r||e.fragment===t.fragment)}return!1}joinPath(e,...t){return VS.Uri.joinPath(e,...t)}basenameOrAuthority(e){return dn(e)||e.authority}basename(e,t){return Ir.basename(e.path,t)}extname(e){return Ir.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===za.file?t=VS.Uri.file(rt(Zs(e))).path:(t=Ir.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===za.file?t=VS.Uri.file(cn(Zs(e))).path:t=Ir.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!mW(e.authority,t.authority))return;if(e.scheme===za.file){let o=Qw(Zs(e),Zs(t));return US?zR(o):o}let r=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){let o=0;for(let s=Math.min(r.length,i.length);o<s&&!(r.charCodeAt(o)!==i.charCodeAt(o)&&r.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);r=i.substr(0,o)+r.substr(o)}return Ir.relative(r,i)}resolvePath(e,t){if(e.scheme===za.file){let r=VS.Uri.file(rW(Zs(e),t));return e.with({authority:r.authority,path:r.path})}return t=pW(t),e.with({path:Ir.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&uW(e,t)}hasTrailingPathSeparator(e,t=hn){if(e.scheme===za.file){let r=Zs(e);return r.length>QR(r).length&&r[r.length-1]===t}else{let r=e.path;return r.length>1&&r.charCodeAt(r.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=hn){return fW(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=hn){let r=!1;if(e.scheme===za.file){let i=Zs(e);r=i!==void 0&&i.length===QR(i).length&&i[i.length-1]===t}else{t="/";let i=e.path;r=i.length===1&&i.charCodeAt(i.length-1)===47}return!r&&!fW(e,t)?e.with({path:e.path+"/"}):e}},Xt=new jS(()=>!1),_ge=new jS(n=>n.scheme===za.file?!ZU:!0),Tge=new jS(n=>!0),yi=Xt.isEqual.bind(Xt),bh=Xt.isEqualOrParent.bind(Xt),un=Xt.getComparisonKey.bind(Xt),Rge=Xt.basenameOrAuthority.bind(Xt),dn=Xt.basename.bind(Xt),Yu=Xt.extname.bind(Xt),bi=Xt.dirname.bind(Xt),zt=Xt.joinPath.bind(Xt),Age=Xt.normalizePath.bind(Xt),XR=Xt.relativePath.bind(Xt),Nge=Xt.resolvePath.bind(Xt),Mge=Xt.isAbsolutePath.bind(Xt),mW=Xt.isEqualAuthority.bind(Xt),fW=Xt.hasTrailingPathSeparator.bind(Xt),Kge=Xt.removeTrailingPathSeparator.bind(Xt),Oge=Xt.addTrailingPathSeparator.bind(Xt),Vz;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(u=>{let[d,f]=u.split(":");d&&f&&a.set(d,f)});let c=s.path.substring(0,s.path.indexOf(";"));return c&&a.set(o.META_DATA_MIME,c),a}o.parseMetaData=i})(Vz||={});function Kr(n=process.platform){return/^win/.test(n)?"Windows":/^darwin/.test(n)?"OSX":/^linux/.test(n)?"Linux":"Unknown"}function Ih(n,e){return n.replace(/^~(?=$|\/|\\)/,e)}function jz(){if(!Ha())return eA.Uri.file(require("os").homedir())}function Re(n){let e=Kr()==="Windows";if(n){let t=Zs(n);return t&&t.startsWith(hn)&&t.length>1&&t[1]!==hn&&e?t.slice(1):t||""}return""}function U(n,e=[],t){t=t||jz();let r;typeof n=="string"&&(r=eA.Uri.file(n)),typeof n!="string"&&(r=n);let i=ZR(r,void 0,t),o=e.find(l=>r&&bh(r,l.uri,!0));if(e.length>1&&o)return`${o.name}${hn}${ZR(r,o.uri,t)}`;let s=o?[ZR(r,o.uri,t)]:[],a=i;return[i,...s].forEach(l=>{l.length<a.length&&(a=l)}),a}function ZR(n,e,t){let r=Kr()==="Windows";if(n&&e&&bh(n,e,!0)){let i=XR(e,n);if(i)return r?i.replace(/\//g,"\\"):i}if(n&&t&&bh(n,t,!0)){let i=XR(t,n);if(i)return i=r?i.replace(/\//g,"\\"):i,`~${hn}${i}`}return Re(n)}var vW=k(hW());function Kt(n){let e=this,t=!1,r;return function(){return t||(t=!0,r=n.apply(e,arguments)),r}}var rA;(w=>{function n(D){return D&&typeof D=="object"&&typeof D[Symbol.iterator]=="function"}w.is=n;let e=Object.freeze([]);function t(){return e}w.empty=t;function*r(D){yield D}w.single=r;function i(D){return n(D)?D:r(D)}w.wrap=i;function o(D){return D||e}w.from=o;function s(D){return!D||D[Symbol.iterator]().next().done===!0}w.isEmpty=s;function a(D){return D[Symbol.iterator]().next().value}w.first=a;function l(D,A){for(let T of D)if(A(T))return!0;return!1}w.some=l;function c(D,A){for(let T of D)if(A(T))return T}w.find=c;function*u(D,A){for(let T of D)A(T)&&(yield T)}w.filter=u;function*d(D,A){let T=0;for(let $ of D)yield A($,T++)}w.map=d;function*f(...D){for(let A of D)for(let T of A)yield T}w.concat=f;function g(D,A,T){let $=T;for(let ne of D)$=A($,ne);return $}w.reduce=g;function*b(D,A,T=D.length){for(A<0&&(A+=D.length),T<0?T+=D.length:T>D.length&&(T=D.length);A<T;A++)yield D[A]}w.slice=b;function I(D,A=Number.POSITIVE_INFINITY){let T=[];if(A===0)return[T,D];let $=D[Symbol.iterator]();for(let ne=0;ne<A;ne++){let H=$.next();if(H.done)return[T,w.empty()];T.push(H.value)}return[T,{[Symbol.iterator](){return $}}]}w.consume=I})(rA||={});var yW;function bW(n){yW=n}function ea(n){return yW?.push(n),n}function z(n){if(rA.is(n)){for(let e of n)if(e)try{e.dispose()}catch(t){console.warn(`dispose() failed for ${e}`,t)}return Array.isArray(n)?[]:n}else if(n)return n.dispose(),n}var xr=class n{constructor(...e){this._toDispose=new Set;this._isDisposed=!1;e.forEach(t=>this.add(t)),ea(this)}static{this.DISABLE_DISPOSED_WARNING=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{z(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?n.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}},$t=class{constructor(...e){this._store=new xr;this._isDisposed=!1;e.forEach(t=>this._store.add(t)),ea(this)}get isDisposed(){return this._isDisposed}dispose(){this._store.dispose(),this._isDisposed=!0}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},Jn=class extends $t{constructor(){super();this._onDidDispose=new vW.EventEmitter,this.onDidDispose=this._onDidDispose.event}dispose(){super.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose()}};var gW=class{constructor(){this._store=new Map;this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{z(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get(e){return this._store.get(e)}set(e,t,r=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),r||this._store.get(e)?.dispose(),this._store.set(e,t)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var Xw=class{constructor(){this.references=new Map}acquire(e,...t){let r=this.references.get(e);r||(r={counter:0,object:this.createReferencedObject(e,...t)},this.references.set(e,r));let{object:i}=r,o=Kt(()=>{r&&--r.counter===0&&(this.destroyReferencedObject(e,r.object),this.references.delete(e))});return r.counter++,{object:i,dispose:o}}};var E=require("vscode");var Xe=require("vscode"),nA=60,iA=nA*60,JS=iA*24,IW=JS*7,SW=JS*30,CW=JS*365;function Sh(n,e,t,r){typeof n!="number"&&(n=n.getTime());let i=Math.round((new Date().getTime()-n)/1e3);if(i<-30)return Xe.l10n.t("in {0}",Sh(new Date().getTime()+i*1e3,!1));if(!r&&i<30)return Xe.l10n.t("now");let o;return i<nA?(o=i,e?o===1?t?Xe.l10n.t("{0} second ago",o):Xe.l10n.t("{0} sec ago",o):t?Xe.l10n.t("{0} seconds ago",o):Xe.l10n.t("{0} secs ago",o):o===1?t?Xe.l10n.t("{0} second",o):Xe.l10n.t("{0} sec",o):t?Xe.l10n.t("{0} seconds",o):Xe.l10n.t("{0} secs",o)):i<iA?(o=Math.floor(i/nA),e?o===1?t?Xe.l10n.t("{0} minute ago",o):Xe.l10n.t("{0} min ago",o):t?Xe.l10n.t("{0} minutes ago",o):Xe.l10n.t("{0} mins ago",o):o===1?t?Xe.l10n.t("{0} minute",o):Xe.l10n.t("{0} min",o):t?Xe.l10n.t("{0} minutes",o):Xe.l10n.t("{0} mins",o)):i<JS?(o=Math.floor(i/iA),e?o===1?t?Xe.l10n.t("{0} hour ago",o):Xe.l10n.t("{0} hr ago",o):t?Xe.l10n.t("{0} hours ago",o):Xe.l10n.t("{0} hrs ago",o):o===1?t?Xe.l10n.t("{0} hour",o):Xe.l10n.t("{0} hr",o):t?Xe.l10n.t("{0} hours",o):Xe.l10n.t("{0} hrs",o)):i<IW?(o=Math.floor(i/JS),e?o===1?Xe.l10n.t("{0} day ago",o):Xe.l10n.t("{0} days ago",o):o===1?Xe.l10n.t("{0} day",o):Xe.l10n.t("{0} days",o)):i<SW?(o=Math.floor(i/IW),e?o===1?t?Xe.l10n.t("{0} week ago",o):Xe.l10n.t("{0} wk ago",o):t?Xe.l10n.t("{0} weeks ago",o):Xe.l10n.t("{0} wks ago",o):o===1?t?Xe.l10n.t("{0} week",o):Xe.l10n.t("{0} wk",o):t?Xe.l10n.t("{0} weeks",o):Xe.l10n.t("{0} wks",o)):i<CW?(o=Math.floor(i/SW),e?o===1?t?Xe.l10n.t("{0} month ago",o):Xe.l10n.t("{0} mo ago",o):t?Xe.l10n.t("{0} months ago",o):Xe.l10n.t("{0} mos ago",o):o===1?t?Xe.l10n.t("{0} month",o):Xe.l10n.t("{0} mo",o):t?Xe.l10n.t("{0} months",o):Xe.l10n.t("{0} mos",o)):(o=Math.floor(i/CW),e?o===1?t?Xe.l10n.t("{0} year ago",o):Xe.l10n.t("{0} yr ago",o):t?Xe.l10n.t("{0} years ago",o):Xe.l10n.t("{0} yrs ago",o):o===1?t?Xe.l10n.t("{0} year",o):Xe.l10n.t("{0} yr",o):t?Xe.l10n.t("{0} years",o):Xe.l10n.t("{0} yrs",o))}var zV=k(N());var _h=class{async createHash(e,t="SHA-256"){return ia(e,t)}};_h=v([(0,zV.injectable)()],_h);var TP={},GV=!1,RP;typeof window=="object"?RP=window.crypto:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?RP=self.crypto:RP=require("node:crypto").webcrypto;async function ia(n,e){let t=n.includes("/")||n.includes("\\")||n.endsWith(".interactive");if(t&&TP[n])return TP[n];let r=await Tee(n,e);return t&&!GV&&(Object.keys(TP).length>1e4&&(GV=!0),TP[n]=r),r}async function Tee(n,e){let t=new TextEncoder().encode(n),r=await RP.subtle.digest({name:e},t);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}function ed(n){if(typeof n=="string")try{let[e,t,r]=`${n.trim()}...`.split(".").map(i=>parseInt(i,10));return isNaN(e)?"":isNaN(t)?e.toString():isNaN(r)?`${e}.${t}`:`${e}.${t}.${r}`}catch(e){return p.error(`Failed to parse version ${n}`,e),""}return n?`${n.major}.${n.minor}.${n.micro}`:""}async function ct(n){return ia(n,"SHA-256")}var AP=k(QV());var zS=require("vscode");function nn(n){let e=lr(n);if(Un&&p.ci(`Python Env Info for ${JSON.stringify(n)} is ${JSON.stringify(e)}`),e){let l=[];typeof e.version?.major=="number"&&(l.push(e.version.major.toString()),typeof e.version.minor=="number"&&(l.push(e.version.minor.toString()),typeof e.version.micro=="number"&&l.push(e.version.micro.toString())));let c=l.length?l.join("."):"",u=e.environment?.name||(e.environment?dn(e.environment?.folderUri):""),d=c?`Python ${c}`:"Python";return Jr(n)&&u?u:u?`${u} (${d})`:d}if(Object.keys(n).length===1&&n.id)return n.id;let t=ed(Ji(n)||"").trim(),r=Jr(n),i=t?`Python ${t}`:"Python",o=No(n);if(r&&o)return o;let s=[];o&&s.push(o);let a=Ve(n);return a&&a!=="Unknown"&&s.push(a),[i,s.length?`(${s.join(": ")})`:""].join(" ").trim()}function No(n){let e=lr(n),t=e?.environment?.name;return!t&&e?.environment?.folderUri&&Ve(n)==="Conda"&&(t=dn(e?.environment?.folderUri)),t}var Nee=["Unknown","Conda","PipEnv","Poetry","Pyenv","Venv","VirtualEnv","VirtualEnvWrapper"];function Ve(n){let e=lr(n);return e?Mee(e):"Unknown"}function Mee(n){if(n.environment?.type==="Conda")return"Conda";let e=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]];for(let[t,r]of e)if(n.tools.includes(t))return r;if(n.environment?.type==="VirtualEnvironment")return"VirtualEnv";for(let t of Nee)if(n.tools.some(r=>r.toLowerCase()===t.toLowerCase()))return t;return"Unknown"}async function FA(n){return n?.id?(await AP.PythonExtension.api()).environments.resolveEnvironment(n.id):void 0}var ji;function YV(n){ji=n}function Jr(n){if(!n||!ji)return!1;let e=lr(n);return e&&Ve(e)==="Conda"&&!e.executable.uri}function lr(n){if(n){if(!ji)throw new Error("Python API not initialized");return typeof n=="string"?ji.environments.known.find(e=>e.id===n||e.path===n||e.executable.uri?.fsPath===n):ji.environments.known.find(e=>e.id===n.id)}}async function oa(n){if(!n?.id)return;if(ji){let r=ji.environments.known.find(i=>i.id===n.id);if(r?.executable?.sysPrefix)return r.executable.sysPrefix}let t=await(await AP.PythonExtension.api()).environments.resolveEnvironment(n.id).then(r=>r?.executable?.sysPrefix);return t||p.warn(`Unable to find sysPrefix for interpreter ${U(n.id)}`),t}function Th(n){if(!n?.id)return;if(!ji)throw new Error("Python API not initialized");return ji.environments.known.find(t=>t.id===n.id)?.executable?.sysPrefix}async function rd(n,e=!1){if(!n?.id)return;if(ji&&!e){let i=ji.environments.known.find(o=>o.id===n.id);if(i?.version)return i.version}let r=await(await AP.PythonExtension.api()).environments.resolveEnvironment(n.id);return r?.version||p.warn(`Unable to find Version for interpreter ${U(n.id)}`),r?.version}function Ji(n){if(!n?.id)return;if(!ji)throw new Error("Python API not initialized");return ji.environments.known.find(t=>t.id===n.id)?.version}function oo(){return ji?ji.environments.known:[]}function wi(n){if(!n)return;let e,t=n.id;if(n.executable.uri)e=n.executable.uri;else if(Ve(n)==="Conda")e=Kr()==="Windows"?zS.Uri.joinPath(n.environment?.folderUri||zS.Uri.file(n.path),"python.exe"):zS.Uri.joinPath(n.environment?.folderUri||zS.Uri.file(n.path),"bin","python");else{p.warn(`Python environment ${U(n.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function Kee(n){return nn(n)}var le;(A=>(A.bannerLabelYes=E.l10n.t("Yes"),A.bannerLabelNo=E.l10n.t("No"),A.canceled=E.l10n.t("Canceled"),A.cancel=E.l10n.t("Cancel"),A.ok=E.l10n.t("Ok"),A.refresh=E.l10n.t("Refresh"),A.refreshing=E.l10n.t("Refreshing..."),A.install=E.l10n.t("Install"),A.downloadAndInstall=E.l10n.t("Download and Install"),A.loadingExtension=E.l10n.t("Jupyter Extension loading..."),A.handleExtensionActivationError=E.l10n.t("Extension activation failed, run the 'Developer: Toggle Developer Tools' command for more information."),A.doNotShowAgain=E.l10n.t("Do not show again"),A.reload=E.l10n.t("Reload"),A.moreInfo=E.l10n.t("More Info"),A.learnMore=E.l10n.t("Learn more"),A.and=E.l10n.t("and"),A.reportThisIssue=E.l10n.t("Report this issue"),A.clickHereForMoreInfoWithHtml=T=>E.l10n.t("Click <a href='{0}'>here</a> for more info.",T)))(le||={});var rm;(t=>(t.notInGroup=r=>E.l10n.t("User does not belong to experiment group '{0}'",r),t.inGroup=r=>E.l10n.t("User belongs to experiment group '{0}'",r)))(rm||={});var LA;(e=>e.jupyter=E.l10n.t("Jupyter"))(LA||={});var UA;(e=>e.currentWorkingDirectory="cwd:")(UA||={});var WA;(e=>e.bannerMessage=E.l10n.t("Would you like shift-enter to send code to the new Interactive Window experience?"))(WA||={});var VA;(e=>e.bannerMessage=E.l10n.t("Can you please take a minute to tell us about your notebooks experience in VS Code?"))(VA||={});var NP;(t=>(t.bannerLabelYes=E.l10n.t("Yes, take survey now"),t.bannerLabelNo=E.l10n.t("No, thanks")))(NP||={});var y;(x=>(x.warnWhenSelectingKernelWithUnSupportedPythonVersion=E.l10n.t("The version of Python associated with the selected kernel is no longer supported. Please consider selecting a different kernel."),x.installingPythonExtension=E.l10n.t("Installing Python extension and locating kernels."),x.pythonExtensionRequired=E.l10n.t("The Python Extension is required to perform that task. Click Yes to open Python Extension installation page."),x.rendererExtensionRequired=E.l10n.t("The Renderer Extension is required to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),x.rendererExtension1015Required=E.l10n.t("The installed version of the Renderer Extension is outdated and requires and update to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),x.pythonExtensionInstalled=E.l10n.t("Python Extension is now installed. Some features might not be available until a notebook or interactive window session is restarted."),x.unknownPackage=E.l10n.t("unknown"),x.interactiveWindowTitleFormat=L=>E.l10n.t("Interactive - {0}",L),x.interactiveWindowModeBannerTitle=E.l10n.t({message:"Do you want to open a new Interactive Window for this file? [More Information](command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D).",args:[],comment:'The string "command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D" should not be translated. It is a command that opens the settings page with the "jupyter.interactiveWindowMode" setting selected.'}),x.interactiveWindowModeBannerSwitchYes=E.l10n.t("Yes"),x.interactiveWindowModeBannerSwitchNo=E.l10n.t("No"),x.dataExplorerTitle=E.l10n.t("Data Viewer"),x.badWebPanelFormatString=L=>E.l10n.t({message:"<html><body><h1>{0} is not a valid file name</h1></body></html>",args:[L],comment:["Only translate the text within the HTML tags"]}),x.installingMissingDependencies=E.l10n.t("Installing missing dependencies"),x.validatingKernelDependencies=E.l10n.t("Validating kernel dependencies"),x.performingExport=E.l10n.t("Performing Export"),x.exportNotebookToPython=E.l10n.t("Exporting Notebook to Python"),x.sessionDisposed=E.l10n.t("Cannot execute code, session has been disposed. Please try restarting the Kernel."),x.passwordFailure=E.l10n.t("Failed to connect to password protected server. Check that password is correct."),x.incorrectPassword=E.l10n.t("Incorrect Password."),x.exportDialogFilter=E.l10n.t("Jupyter Notebooks"),x.exportDialogComplete=L=>E.l10n.t("Notebook written to {0}",L),x.exportDialogFailed=L=>E.l10n.t("Failed to export notebook. {0}",L),x.exportOpenQuestion1=E.l10n.t("Open in editor"),x.runCellLensCommandTitle=E.l10n.t("Run Cell"),x.importDialogTitle=E.l10n.t("Import Jupyter Notebook"),x.importDialogFilter="Jupyter Notebooks",x.notebookCheckForImportNo=E.l10n.t("Later"),x.libraryRequiredToLaunchJupyterNotInstalled=L=>E.l10n.t("Running cells requires {0} package.",L),x.librariesRequiredToLaunchJupyterNotInstalled=L=>E.l10n.t("Running cells requires {0} package.",L),x.libraryRequiredToLaunchJupyterNotInstalledInterpreter=(L,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",L,je),x.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter=(L,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",L,je),x.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate=(L,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package to be installed or requires an update.",L,je),x.librariesRequiredToLaunchJupyterNotInstalledInterpreter=(L,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",L,je),x.createANewPythonEnvironment=()=>E.l10n.t("[Create a Python Environment](command:jupyter.createPythonEnvAndSelectController) with the required packages."),x.installPackageInstructions=(L,je)=>E.l10n.t(`Install '{0}' into the Python environment. 
Command: '{1}'`,L,je),x.OrInstallPackageInstructions=(L,je)=>E.l10n.t("Or install '{0}' using the command: '{1}'",L,je),x.pythonCondaKernelsWithoutPython=E.l10n.t("The Python Runtime and IPyKernel will be automatically installed upon selecting this environment."),x.selectJupyterInterpreter=E.l10n.t("Select an Interpreter to start Jupyter"),x.jupyterInstall=E.l10n.t("Install"),x.currentlySelectedJupyterInterpreterForPlaceholder=L=>E.l10n.t("Selected Environment {0}",L),x.jupyterNotSupported=L=>E.l10n.t("Jupyter cannot be started. Error attempting to locate Jupyter: {0}",L),x.jupyterNotebookNotInstalledOrNotFound=L=>{if(L){let je=Kee(L);return E.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment '{0}'.",je)}else return E.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment.")},x.jupyterNotSupportedBecauseOfEnvironment=(L,je)=>E.l10n.t("Activating {0} to run Jupyter failed with {1}",L,je),x.jupyterNbConvertNotSupported=E.l10n.t("Jupyter nbconvert is not installed"),x.jupyterLaunchTimedOut=E.l10n.t("The Jupyter notebook server failed to launch in time"),x.jupyterLaunchNoURL=E.l10n.t("Failed to find the URL of the launched Jupyter notebook server"),x.jupyterSelfCertFail=L=>E.l10n.t(`The security certificate used by server {0} was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,L),x.jupyterExpiredCertFail=L=>E.l10n.t(`The security certificate used by server {0} has expired.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,L),x.jupyterSelfCertFailErrorMessageOnly=E.l10n.t(`The security certificate used by server was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.`),x.jupyterSelfCertExpiredErrorMessageOnly=E.l10n.t(`The security certificate used by server has expired.\r
This may indicate an attempt to steal your information.`),x.jupyterSelfCertEnable=E.l10n.t("Yes, connect anyways"),x.jupyterSelfCertClose=E.l10n.t("No, close the connection"),x.pythonInteractiveHelpLink=E.l10n.t("See <https://aka.ms/pyaiinstall> for help on installing Jupyter."),x.importingFormat=L=>E.l10n.t("Importing {0}",L),x.startingJupyter=E.l10n.t("Starting Jupyter Server"),x.connectingToKernel=L=>E.l10n.t("Connecting to kernel: {0}",L),x.connectingToJupyter=E.l10n.t("Connecting to Jupyter Server"),x.exportingFormat=L=>E.l10n.t("Exporting {0}",L),x.runAllCellsLensCommandTitle=E.l10n.t("Run All Cells"),x.runAllCellsAboveLensCommandTitle=E.l10n.t("Run Above"),x.runCellAndAllBelowLensCommandTitle=E.l10n.t("Run Below"),x.restartKernelMessage=E.l10n.t("Do you want to restart the Jupyter kernel? All variables will be lost."),x.restartKernelMessageYes=E.l10n.t("Restart"),x.restartKernelMessageDontAskAgain=E.l10n.t("Don't Ask Again"),x.automaticallyReconnectingToAKernelProgressMessage=L=>E.l10n.t("Reconnecting to the kernel {0}",L),x.restartingKernelStatus=L=>E.l10n.t("Restarting Kernel {0}",L),x.interruptingKernelFailed=E.l10n.t("Kernel interrupt failed. Jupyter Server is hung. Please reload VS Code."),x.sessionStartFailedWithKernel=L=>E.l10n.t({message:`Failed to start the Kernel '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.failedToStartJupyter=L=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.failedToStartJupyterWithErrorInfo=(L,je)=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
{1} 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L,je],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.failedToStartJupyterDueToOutdatedTraitlets=(L,je)=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}' possibly due to an outdated version of 'traitlets'. 
{1} 
Consider updating the 'traitlets' module to '5.1.1' or later. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L,je],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the text 'traitlets', that is a Python module name"]}),x.failedToStartKernel=E.l10n.t("Failed to start the Kernel."),x.failedToRestartKernel=E.l10n.t("Failed to restart the Kernel."),x.failedToInterruptKernel=E.l10n.t("Failed to interrupt the Kernel."),x.rawKernelStartFailedDueToTimeout=L=>E.l10n.t({message:`Unable to start Kernel '{0}' due to a connection timeout. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.rawKernelStartFailedDueToTimeoutWaitingForPort=L=>E.l10n.t({message:`Unable to start Kernel '{0}' due to a timeout waiting for the ports to get used. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.viewJupyterLogForFurtherInfo=E.l10n.t({message:"View Jupyter [log](command:jupyter.viewOutput) for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.kernelDied=L=>E.l10n.t({message:"The kernel died. Error: {0}... View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.kernelDiedWithoutError=L=>E.l10n.t({message:"The kernel '{0}' died. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),x.failedToStartAnUntrustedKernelSpec=(L,je)=>E.l10n.t({message:`The kernel '{0}' was not started as it is located in an insecure location '{1}'.  
Click [here](https://aka.ms/JupyterTrustedKernelPaths) for further details, optionally update the setting [jupyter.kernels.trusted](command:workbench.action.openSettings?["jupyter.kernels.trusted"]) to trust the kernel.`,args:[L,je],comment:['Do not translate the text "jupyter.kernels.trusted", that is a setting in VS Code','Do not translate the text command:workbench.action.openSettings?["jupyter.kernels.trusted"], that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/JupyterTrustedKernelPaths"]}),x.kernelDiedWithoutErrorAndAutoRestarting=L=>E.l10n.t({message:"The kernel '{0}' died and is being automatically restarted by Jupyter. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),x.kernelCrashedDueToCodeInCurrentOrPreviousCell=E.l10n.t({message:`The Kernel crashed while executing code in the current cell or a previous cell. 
Please review the code in the cell(s) to identify a possible cause of the failure. 
Click <a href='https://aka.ms/vscodeJupyterKernelCrash'>here</a> for more info. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),x.kernelDisconnected=L=>E.l10n.t("Unable to connect to the kernel '{0}', please verify the Jupyter Server connection. View Jupyter [log](command:jupyter.viewOutput) for further details.",L),x.cannotRunCellKernelIsDead=L=>E.l10n.t("Cannot run cells, as the kernel '{0}' is dead.",L),x.showJupyterLogs=E.l10n.t("Show Jupyter Logs."),x.restartKernel=E.l10n.t("Restart Kernel"),x.reloadRequired=E.l10n.t("Please reload the window for new settings to take effect."),x.restartedKernelHeader=L=>E.l10n.t("Restarted {0}",L),x.connectedKernelHeader=L=>E.l10n.t("Connected to {0}",L),x.restartingKernelCustomHeader=L=>E.l10n.t("_Restarting {0}..._",L),x.restartingKernelHeader=E.l10n.t("_Restarting kernel..._"),x.startingNewKernelHeader=E.l10n.t("_Connecting to kernel..._"),x.startingNewKernelCustomHeader=L=>E.l10n.t("_Connecting to {0}..._",L),x.noKernelConnected=E.l10n.t("No kernel connected"),x.jupyterSelectUriCommandLabel=E.l10n.t("Enter the URL of the running Jupyter Server..."),x.jupyterSelectUriInputTitle=E.l10n.t("Enter the URL of the running Jupyter Server"),x.jupyterSelectUriInputPlaceholder=E.l10n.t("Enter the URL of the running Jupyter Server"),x.connectToToTheJupyterServer=L=>E.l10n.t("Connect to the Jupyter Server {0}",L),x.enterOrSelectRemoteJupyterPlaceholder=E.l10n.t("Enter a remote URL, or select a remote server"),x.selectRemoteJupyterPlaceholder=E.l10n.t("Select a remote server"),x.jupyterServerLastConnectionForQuickPickDescription=L=>E.l10n.t("Last connected {0}",Sh(L,!0,!1,!1)),x.jupyterServerNotUsedBeforeQuickPickSeparatorTitle=E.l10n.t("Jupyter Servers"),x.jupyterSelectURIInvalidURI=E.l10n.t("Invalid URL specified"),x.jupyterSelectURIMustBeHttpOrHttps=E.l10n.t("Invalid protocol in URL specified, only HTTP or HTTPS are supported."),x.jupyterSelectLiveRemoteKernelDescription=(L,je)=>L?je===0?E.l10n.t("Last activity {0}",Sh(L,!0,!1,!1)):je===1?E.l10n.t("Last activity {0}, 1 connection",Sh(L,!0,!1,!1)):E.l10n.t("Last activity {0}, {1} connections",Sh(L,!0,!1,!1),je.toString()):je===0?"":je===1?E.l10n.t("1 connection"):E.l10n.t("{0} connections",je.toString()),x.installJupyterHub=E.l10n.t("Install the JupyterHub extension to connect to JupyterHub servers."),x.useJupyterHubExtension=E.l10n.t("Select 'Existing JupyterHub Server...' from the Kernel Picker"),x.useJupyterHubExtensionDetail=E.l10n.t("Use this option when connecting to JupyterHub servers"),x.installJupyterHubDetail=E.l10n.t("Once installed, open the Kernel Picker and select 'Existing JupyterHub Server...'"),x.jupyterSelectUserAndPasswordTitle=E.l10n.t("Enter your user name and password to connect to Jupyter Hub"),x.jupyterRenameServer=E.l10n.t("Change Server Display Name (Leave Blank To Use URL)"),x.jupyterServerUriDisplayNameInputPlaceholder=E.l10n.t("Enter a display name"),x.jupyterSelectUserPrompt=E.l10n.t("Enter your user name"),x.jupyterSelectPasswordPrompt=E.l10n.t("Enter your password"),x.jupyterSelectPasswordTitle=E.l10n.t("Enter your password for the Jupyter Server"),x.pythonNotInstalled=E.l10n.t(`Python is not installed. 
Please download and install Python in order to execute cells in this notebook. 
Once installed please reload VS Code.`),x.pleaseReloadVSCodeOncePythonHasBeenInstalled=E.l10n.t("Upon installing Python please reload VS Code."),x.jupyterNotebookFailure=L=>E.l10n.t(`Jupyter notebook failed to launch. \r
{0}`,L),x.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid=L=>E.l10n.t("The remote Jupyter Server contributed by the extension '{0}' is no longer available.",L),x.remoteJupyterConnectionFailedWithServerWithError=(L,je)=>E.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable. ({1}).",L,je),x.remoteJupyterConnectionFailedWithServer=L=>E.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable.",L),x.remoteJupyterConnectionFailedWithoutServerWithError=L=>E.l10n.t("Connection failure. Verify the server is running and reachable. ({0}).",L),x.remoteJupyterConnectionFailedWithoutServerWithErrorWeb=L=>E.l10n.t(`Connection failure. Verify the server is running and reachable from a browser. ({0}). 
When connecting from vscode.dev Jupyter servers must be started with specific options to connect. 
Click [here](https://aka.ms/vscjremoteweb) for more information.`,L),x.removeRemoteJupyterConnectionButtonText=E.l10n.t("Forget Connection"),x.jupyterNotebookRemoteConnectFailedWeb=L=>E.l10n.t(`Failed to connect to remote Jupyter Server.\r
Check that the Jupyter Server URL can be reached from a browser.\r
{0}. Click [here](https://aka.ms/vscjremoteweb) for more information.`,L),x.packageNotInstalledWindowsLongPathNotEnabledError=(L,je)=>E.l10n.t(`Support for Windows Long Path has not been enabled, hence the package {0} could not be installed into the Python Environment '{1}'.
Please ensure that support for Windows Long Path is enabled.
See [here](https://pip.pypa.io/warnings/enable-long-paths) for more information.`,L,je),x.changeRemoteJupyterConnectionButtonText=E.l10n.t("Manage Connections"),x.rawConnectionBrokenError=E.l10n.t("Direct kernel connection broken"),x.jupyterServerCrashed=L=>E.l10n.t(`Jupyter Server crashed. Unable to connect. \r
Error code from Jupyter: {0}`,L.toString()),x.jupyterKernelSpecModuleNotFound=L=>E.l10n.t(`'Kernelspec' module not installed in the selected interpreter ({0}).
 Please re-install or update 'jupyter'.`,L),x.interruptKernelStatus=L=>E.l10n.t("Interrupting Kernel {0}",L),x.exportPythonQuickPickLabel=E.l10n.t("Python Script"),x.exportHTMLQuickPickLabel=E.l10n.t("HTML"),x.exportPDFQuickPickLabel=E.l10n.t("PDF"),x.restartKernelAfterInterruptMessage=L=>E.l10n.t("Interrupting the kernel '{0}' timed out. Do you want to restart the kernel instead? All variables will be lost.",L),x.documentMismatch=L=>E.l10n.t("Cannot run cells, duplicate documents for {0} found.",L),x.jupyterGetVariablesBadResults=E.l10n.t("Failed to fetch variable info from the Jupyter Server."),E.l10n.t("Failure to create an 'Interactive' window. Try reinstalling the Python Extension."),x.jupyterGetVariablesExecutionError=L=>E.l10n.t(`Failure during variable extraction: \r
{0}`,L),x.selectKernel=E.l10n.t("Change Kernel"),x.selectDifferentKernel=E.l10n.t("Select a different Kernel"),x.kernelFilterPlaceholder=E.l10n.t("Choose the kernels that are available in the kernel picker."),x.recommendedItemCategoryInQuickPick=E.l10n.t("Recommended"),x.selectedKernelCategoryInQuickPick=E.l10n.t("Selected"),x.createPythonEnvironmentInQuickPick=E.l10n.t("Create Python Environment"),x.createPythonEnvironmentInQuickPickTooltip=E.l10n.t("Create an isolated Python Environment per workspace folder"),x.selectDifferentJupyterInterpreter=E.l10n.t("Change Interpreter"),x.pandasTooOldForViewingFormat=(L,je)=>E.l10n.t({message:"Python package 'pandas' is version {0}. Version {1} or greater is required for viewing data.",args:[L,je],comment:["Do not translate 'pandas' as that is a Python module name"]}),x.pandasRequiredForViewing=L=>E.l10n.t({message:"Python package 'pandas' version {0} (or above) is required for viewing data.",args:[L],comment:["Do not translate 'pandas' as that is a Python module name"]}),x.tooManyColumnsMessage=E.l10n.t("Variables with over a 1000 columns may take a long time to display. Are you sure you wish to continue?"),x.tooManyColumnsYes=E.l10n.t("Yes"),x.tooManyColumnsNo=E.l10n.t("No"),x.tooManyColumnsDontAskAgain=E.l10n.t("Don't Ask Again"),x.plotViewerTitle=E.l10n.t("Plots"),x.exportPlotTitle=E.l10n.t("Save plot image"),x.pdfFilter="PDF",x.pngFilter="PNG",x.svgFilter="SVG",x.exportImageFailed=L=>E.l10n.t("Error exporting image: {0}",L),x.jupyterDataRateExceeded=E.l10n.t({message:"Cannot view variable because data rate exceeded. Please restart your server with a higher data rate limit. For example, --NotebookApp.iopub_data_rate_limit=10000000000.0",comment:["Do not translate the text --NotebookApp.iopub_data_rate_limit=10000000000.0 as that is a command argument."]}),x.addCellBelowCommandTitle=E.l10n.t("Add cell"),x.debugCellCommandTitle=E.l10n.t("Debug Cell"),x.debugStepOverCommandTitle=E.l10n.t("Step over"),x.debugContinueCommandTitle=E.l10n.t("Continue"),x.debugStopCommandTitle=E.l10n.t("Stop"),x.runCurrentCellAndAddBelow=E.l10n.t("Run current cell and add empty cell below"),x.jupyterDebuggerNotInstalledError=L=>E.l10n.t("Pip module {0} is required for debugging cells. You will need to install it to debug cells.",L),x.jupyterDebuggerOutputParseError=L=>E.l10n.t("Unable to parse {0} output, please log an issue with https://github.com/microsoft/vscode-jupyter",L),x.cellStopOnErrorMessage=E.l10n.t("Cell was canceled due to an error in a previous cell."),x.scrollToCellTitleFormatMessage=L=>E.l10n.t("Go to [{0}]",L.toString()),x.instructionComments=L=>E.l10n.t(`# To add a new cell, type '{0}'
# To add a new markdown cell, type '{0} [markdown]'
`,L),x.exportButtonTitle=E.l10n.t("Export"),x.exportAsQuickPickPlaceholder=E.l10n.t("Export As..."),x.openExportedFileMessage=E.l10n.t("Would you like to open the exported file?"),x.openExportFileYes=E.l10n.t("Yes"),x.openExportFileNo=E.l10n.t("No"),x.exportFailedGeneralMessage=E.l10n.t({message:"Please check the 'Jupyter' [output](command:jupyter.viewOutput) panel for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.exportToPDFDependencyMessage=E.l10n.t(`If you have not installed xelatex (TeX), you will need to do so before you can export to PDF. For further instructions, please see https://nbconvert.readthedocs.io/en/latest/install.html#installing-tex. \r
To avoid installing xelatex (TeX), you might want to try exporting to HTML and using your browser's "Print to PDF" feature.`),x.failedExportMessage=E.l10n.t("Export failed."),x.startingJupyterLogMessage=(L,je)=>E.l10n.t("Starting Jupyter from {0} with arguments {1}",L,je),x.waitingForJupyterSessionToBeIdle=E.l10n.t("Waiting for Jupyter Session to be idle"),x.gettingListOfKernelsForRemoteConnection=E.l10n.t("Fetching Kernels"),x.gettingListOfKernelSpecs=E.l10n.t("Fetching Kernel specs"),x.startingJupyterNotebook=E.l10n.t("Starting Jupyter Notebook"),x.registeringKernel=E.l10n.t("Registering Kernel"),x.jupyterCommandLineReloadQuestion=E.l10n.t("Please reload the window when changing the Jupyter command line."),x.jupyterCommandLineReloadAnswer=E.l10n.t("Reload"),x.createdNewKernel=(L,je)=>E.l10n.t("{0}: Kernel started: {1}",L,je),x.kernelInvalid=L=>E.l10n.t("Kernel {0} is not usable. Check the Jupyter output tab for more information.",L),x.removeRemoteJupyterServerEntryInQuickPick=E.l10n.t("Remove"),x.loadClassFailedWithNoInternet=(L,je)=>E.l10n.t("Error loading {0}:{1}. Internet connection required for loading 3rd party widgets.",L,je),x.useCDNForWidgetsNoInformation=E.l10n.t("Widgets require us to download supporting files from a 3rd party website."),x.enableCDNForWidgetsSetting=(L,je)=>E.l10n.t("Widgets require us to download supporting files from a 3rd party website. (Error loading {0}:{1}).",L,je),x.enableCDNForWidgetsButton=E.l10n.t("Enable Downloads"),x.unhandledMessage=(L,je)=>E.l10n.t("Unhandled kernel message from a widget: {0} : {1}",L,je),x.cdnWidgetScriptNotAccessibleWarningMessage=(L,je)=>E.l10n.t("Unable to download widget '{0}' from 3rd party website {1}, due to network access. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",L,je),x.widgetScriptNotFoundOnCDNWidgetMightNotWork=(L,je,wS)=>E.l10n.t("Unable to find widget '{0}' version '{1}' from configured widget sources {2}. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",L,je,wS),x.insecureSessionMessage=E.l10n.t("Connecting over HTTP without a token may be an insecure connection. Do you want to connect to a possibly insecure server?"),x.insecureSessionDenied=E.l10n.t("Denied connection to insecure server."),x.selectKernelForEditor=E.l10n.t("[Select a kernel](command:_notebook.selectKernel) to run cells."),x.needIpykernel6=E.l10n.t("Ipykernel setup required for this feature"),x.setup=E.l10n.t("Setup"),x.showDataViewerFail=E.l10n.t("Failed to create the Data Viewer. Check the Jupyter tab of the Output window for more info."),x.defaultNotebookName=E.l10n.t("default"),x.recommendExtensionForNotebookLanguage=(L,je)=>E.l10n.t("The {0} extension is recommended for notebooks targeting the language '{1}'",L,je),x.kernelWasNotStarted=E.l10n.t("Kernel was not started. A kernel session is needed to start debugging."),x.noNotebookToDebug=E.l10n.t("No active notebook document to debug."),x.cantStartDebugging=E.l10n.t("Can't start debugging."),x.restartNotSupported=E.l10n.t("Restarting is not supported in the interactive window."),x.importingIpynb=E.l10n.t("Importing notebook file"),x.exportingToFormat=L=>E.l10n.t("Exporting to {0}",L),x.kernelCategoryForJupyterSession=E.l10n.t("Jupyter Session"),x.kernelDefaultRemoteDisplayName=E.l10n.t("Remote"),x.kernelCategoryForJupyterKernel=E.l10n.t("Jupyter Kernel"),x.kernelCategoryForRemoteJupyterKernel=E.l10n.t("Jupyter Kernel"),x.kernelCategoryForConda=E.l10n.t("Conda Env"),x.kernelCategoryForCondaWithoutPython=E.l10n.t("Conda Env Without Python"),x.kernelCategoryForPoetry=E.l10n.t("Poetry Env"),x.kernelCategoryForPipEnv=E.l10n.t("Pipenv Env"),x.kernelCategoryForPyEnv=E.l10n.t("PyEnv Env"),x.kernelCategoryForGlobal=E.l10n.t("Global Env"),x.kernelCategoryForVirtual=E.l10n.t("Virtual Env"),x.fileSeemsToBeInterferingWithKernelStartup=L=>E.l10n.t("The file '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the file and starting the kernel again.",L),x.moduleSeemsToBeInterferingWithKernelStartup=L=>E.l10n.t("The module '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the folder and starting the kernel again.",L),x.pipCondaInstallHoverWarning=(L,je)=>E.l10n.t("'!{0} install' could install packages into the wrong environment. [More info]({1})",L,je),x.percentPipCondaInstallInsteadOfBang=L=>E.l10n.t({message:"Use '%{0} install' instead of '!{0} install'",args:[L],comment:['Do not translate the string within quotes, such as "%{0} install" and "!{0} install" as that is a Jupyter Shell Magic command']}),x.replacePipCondaInstallCodeAction=L=>E.l10n.t("Replace with '%{0} install'",L),x.failedToStartKernelDueToMissingModule=L=>E.l10n.t("The kernel failed to start due to the missing module '{0}'. Consider installing this module.",L),x.failedToStartKernelDueToImportFailure=L=>E.l10n.t("The kernel failed to start as the module '{0}' could not be imported.",L),x.failedToStartKernelDueToImportFailureFromFile=(L,je)=>E.l10n.t("The kernel failed to start as '{0}' could not be imported from '{1}'.",L,je),x.failedToStartKernelDueToUnknownDllLoadFailure=E.l10n.t("The kernel failed to start as a dll could not be loaded."),x.failedToStartKernelDueToDllLoadFailure=L=>E.l10n.t("The kernel failed to start as the dll '{0}' could not be loaded.",L),x.failedToStartKernelDueToWin32APIFailure=E.l10n.t("The kernel failed to start due to an error with the Win32api module. Consider (re) installing this module."),x.failedToStartKernelDueToPyZmqFailure=E.l10n.t({message:"The kernel failed to start due to an error with the 'pyzmq' module. Consider re-installing this module.",comment:['Do not translate the string "pyzmq" as that is a Python module.']}),x.failedToStartKernelDueToOldIPython=E.l10n.t("The kernel failed to start due to an outdated version of IPython. Consider updating this module to the latest version."),x.failedToStartKernelDueToOldIPyKernel=E.l10n.t("The kernel failed to start due to an outdated version of IPyKernel. Consider updating this module to the latest version."),x.failedToStartKernelDueToMissingPythonEnv=L=>E.l10n.t("The kernel failed to start as the Python Environment '{0}' is no longer available. Consider selecting another kernel or refreshing the list of Python Environments.",L),x.matplotlibWidgetInsteadOfOther=E.l10n.t("'%matplotlib' widget works best inside of VS Code"),x.matplotlibWidgetCodeActionTitle=E.l10n.t("More info"),x.allowExtensionToUseJupyterKernelApi=(L,je)=>E.l10n.t("Do you want to give the extension '{0}' access to the Jupyter Kernels? Clicking '{1}' would allow this extension to execute code against the Jupyter Kernels.",L,je),x.thanksForUsingJupyterKernelApiPleaseRegisterWithUs=L=>E.l10n.t("Thank you for trying the Jupyter API. Please file an issue on our repo to allow the extension {0} to use this API in production. This would prevent us from breaking your extension when updating the API (as it is still a work in progress).",L),x.activatingPythonEnvironment=L=>E.l10n.t("Activating Python Environment '{0}'",L),x.runningKernelStartupHooksFor=L=>E.l10n.t("Running Kernel startup hooks in '{0}'",L),x.cellAtFormat=(L,je)=>E.l10n.t("{0} Cell {1}",L,je),x.jupyterServerConsoleOutputChannel=E.l10n.t("Jupyter Server Console"),x.kernelConsoleOutputChannel=L=>E.l10n.t("{0} Kernel Console Output",L),x.webNotSupported=E.l10n.t("Operation not supported in web version of Jupyter Extension."),x.failedToInstallPythonExtension=E.l10n.t("Failed to install the Python Extension."),x.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting=L=>E.l10n.t("Some of the following files found in the working directory may have prevented the Kernel from starting. Consider renaming them.",L),x.listOfFilesWithLinksThatMightNeedToBeRenamed=L=>E.l10n.t("File(s): {0} might need to be renamed.",L),x.failedToGetVersionOfPandas=E.l10n.t("Failed to get version of Pandas to use the Data Viewer."),x.failedToInstallPandas=E.l10n.t("Failed to install Pandas to use the Data Viewer."),x.localKernelSpecs=E.l10n.t("Jupyter Kernel..."),x.localPythonEnvironments=E.l10n.t("Python Environments..."),x.quickPickTitleForSelectionOfJupyterServer=E.l10n.t("Select a Jupyter Server"),x.UserJupyterServerUrlProviderDisplayName=E.l10n.t("Existing Jupyter Server..."),x.UserJupyterServerUrlProviderDetail=E.l10n.t("Connect to an existing Jupyter Server"),x.kernelPickerSelectKernelTitle=E.l10n.t("Select Kernel"),x.kernelPickerSelectLocalKernelSpecTitle=E.l10n.t("Select a Jupyter Kernel"),x.quickPickSelectPythonEnvironmentTitle=E.l10n.t("Select a Python Environment"),x.kernelPickerSelectKernelFromRemoteTitle=L=>E.l10n.t("Select a Kernel from {0}",L),x.kernelPickerSelectKernelFromRemoteTitleWithoutName=E.l10n.t("Select a Jupyter Kernel"),x.installPythonExtensionViaKernelPickerTitle=E.l10n.t("Install Python Extension"),x.installPythonExtensionViaKernelPickerToolTip=E.l10n.t("Python Extension is required to detect and use Python environments for the execution of code cells."),x.installPythonQuickPickTitle=E.l10n.t("Install Python"),x.installPythonQuickPickToolTip=E.l10n.t("Python Environments not detected. Upon installation reload VS Code or refresh the list of Kernels."),x.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel=E.l10n.t({message:"$(error) Unable to connect to the remote server",comment:"Do not translate the string $(error) as that is a VS Code icon."}),x.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail=E.l10n.t("Ensure the server is running and reachable."),x.dataViewerDeprecationMessage=E.l10n.t("The built-in data viewer will be deprecated soon. Please install other data viewing extensions to keep the ability to inspect data."),x.dataViewerDeprecationRecommendationActionMessage=E.l10n.t("See Recommended Extensions"),x.dataViewerExtensionRequired=E.l10n.t("A Data Viewer Extension is required to view data frames. Click Yes to see recommended extensions."),x.selectExternalDataViewer=E.l10n.t("Select DataFrame Viewer")))(y||={});var Nt;(he=>(he.collapseSingle=E.l10n.t("Collapse"),he.expandSingle=E.l10n.t("Expand"),he.noRowsInDataViewer=E.l10n.t("No rows match current filter"),he.sliceIndexError=E.l10n.t({message:"Index {0} out of range for axis {1} with {2} elements",comment:["Do not translate the strings {0}, {1} and {2} as they are variable names and will be replaced later"]}),he.sliceMismatchedAxesError=E.l10n.t({message:"Expected {0} axes, got {1} in slice expression",comment:["Do not translate the strings {0} and {2} as they are variable names and will be replaced later"]}),he.fetchingDataViewer=E.l10n.t("Fetching data ..."),he.dataViewerHideFilters=E.l10n.t("Hide filters"),he.dataViewerShowFilters=E.l10n.t("Show filters"),he.refreshDataViewer=E.l10n.t("Refresh data viewer"),he.sliceSummaryTitle=E.l10n.t("SLICING"),he.sliceData=E.l10n.t("Slice Data"),he.sliceSubmitButton=E.l10n.t("Apply"),he.sliceDropdownAxisLabel=E.l10n.t("Axis"),he.sliceDropdownIndexLabel=E.l10n.t("Index"),he.variableExplorerNameColumn=E.l10n.t("Name"),he.variableExplorerTypeColumn=E.l10n.t("Type"),he.variableExplorerCountColumn=E.l10n.t("Size"),he.variableExplorerValueColumn=E.l10n.t("Value"),he.collapseVariableExplorerLabel=E.l10n.t("Variables"),he.variableLoadingValue=E.l10n.t("Loading..."),he.showDataExplorerTooltip=E.l10n.t("Show variable snapshot in data viewer"),he.noRowsInVariableExplorer=E.l10n.t("No variables defined"),he.loadingRowsInVariableExplorer=E.l10n.t("Loading variables"),he.previousPlot=E.l10n.t("Previous"),he.nextPlot=E.l10n.t("Next"),he.panPlot=E.l10n.t("Pan"),he.zoomInPlot=E.l10n.t("Zoom in"),he.zoomOutPlot=E.l10n.t("Zoom out"),he.exportPlot=E.l10n.t("Export to different formats"),he.deletePlot=E.l10n.t("Remove"),he.selectedImageListLabel=E.l10n.t("Selected Image"),he.selectedImageLabel=E.l10n.t("Image"),he.errorOutputExceedsLinkToOpenFormatString=E.l10n.t({message:"Output exceeds the <a href={0}>size limit</a>. Open the full output data <a href={1}>in a text editor</a>",comment:['Do not translate the the Hyperlink text "<a href={0}>size limit</a>" and "<a href={1}>in a text editor</a>". However the text inside those tags can be translated']}),he.dvDeprecationWarning=E.l10n.t('The built-in data viewer will be deprecated and no longer usable starting with Visual Studio Code 1.92. Please <a href="command:workbench.extensions.search?%22@tag:jupyterVariableViewers%22">install other data viewing extensions</a> to continue inspecting data')))(Nt||={});var QS;(r=>(r.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE=E.l10n.t({message:"The setting 'python.formatting.formatOnSave' is deprecated, please use 'editor.formatOnSave'.",comment:['Do not translate the string "python.formatting.formatOnSave" as that is a setting in VS Code','Do not translate the string "editor.formatOnSave" as that is a setting in VS Code']}),r.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE=E.l10n.t({message:"The setting 'python.linting.lintOnTextChange' is deprecated, please enable 'python.linting.lintOnSave' and 'files.autoSave'.",comment:['Do not translate the string "python.linting.lintOnTextChange" as that is a setting in VS Code','Do not translate the string "python.linting.lintOnSave" as that is a setting in VS Code']}),r.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES=E.l10n.t({message:"The setting 'python.autoComplete.preloadModules' is deprecated, please consider using Pylance Language Server ('python.languageServer' setting).",comment:['Do not translate the string "python.autoComplete.preloadModules" as that is a setting in VS Code','Do not translate the string "python.languageServer" as that is a setting in VS Code']})))(QS||={});var Rh;(r=>(r.noCondaOrPipInstaller=E.l10n.t("There is no Conda or Pip installer available in the selected environment."),r.noPipInstaller=E.l10n.t("There is no Pip installer available in the selected environment."),r.searchForHelp=E.l10n.t("Search for help")))(Rh||={});var jA;(e=>e.installingModule=t=>E.l10n.t("Installing {0}",t))(jA||={});var ZV=JA(),MP=class{constructor(e,t,r){this.channel=e;this.homeReplaceRegEx=t,this.userNameReplaceRegEx=r}format(e,t,...r){let i=e?`${Uw()} [${e}] ${ZV(t,...r)}`:ZV(t,...r);return this.homeReplaceRegEx&&(i=i.replace(this.homeReplaceRegEx,"~")),this.userNameReplaceRegEx&&(i=i.replace(this.userNameReplaceRegEx,"<username>")),i}error(e,...t){this.channel.appendLine(this.format("error",e,...t))}warn(e,...t){this.channel.appendLine(this.format("warn",e,...t))}info(e,...t){this.channel.appendLine(this.format("info",e,...t))}debug(e,...t){this.channel.appendLine(this.format("debug",e,...t))}trace(e,...t){this.channel.appendLine(this.format("trace",e,...t))}ci(e,...t){}};var e2=JA();function YS(n,e,...t){let i=[...t].length===0?e2(e):e2(e,...t);return n?`${n} ${Uw()}: ${i}`:i}var KP=class{constructor(e){this.prefix=e}error(e,...t){console.error(YS("error",`${this.prefix||""} ${e}`,...t))}warn(e,...t){console.warn(YS("warn",`${this.prefix||""} ${e}`,...t))}info(e,...t){console.info(YS("info",`${this.prefix||""} ${e}`,...t))}debug(e,...t){console.log(YS("debug",`${this.prefix||""} ${e}`,...t))}trace(e,...t){console.trace(YS("trace",`${this.prefix||""} ${e}`,...t))}ci(e,...t){}};var FP="",i2=3,nd=[],id=Zt.LogLevel.Info,p={error:(n,...e)=>Oee(n,...e),warn:(n,...e)=>l2(n,...e),info:(n,...e)=>Fee(n,...e),debug:(n,...e)=>Lee(n,...e),trace:(n,...e)=>Uee(n,...e),ci:(n,...e)=>{e&&Array.isArray(e)?n2(n,...e):n2(n)}};function o2(n){id=r2(),ea(Zt.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.logging")&&(id=r2())}));let e=Zt.window.createOutputChannel(LA.jupyter,"log");return t2(new MP(e,n?.userNameRegEx,n?.homePathRegEx)),n.addConsoleLogger&&t2(new KP(Un?void 0:"Jupyter Extension:")),e}function t2(n){return nd.push(n),{dispose:()=>{nd=nd.filter(e=>e!==n)}}}function r2(){try{let{level:n}=Zt.workspace.getConfiguration("jupyter").get("logging",{level:"Info"});switch(n){case"debug":case"Debug":return Zt.LogLevel.Debug;case"warn":case"Warn":case"warning":case"Warning":return Zt.LogLevel.Warning;case"Off":case"off":return Zt.LogLevel.Off;case"Error":case"error":return Zt.LogLevel.Error;case"Trace":case"trace":return Zt.LogLevel.Trace;default:return Zt.LogLevel.Info}}catch(n){return console.error("Failed to get logging level from configuration",n),Zt.LogLevel.Info}}function s2(n){FP=n.toLowerCase()}function a2(...n){return id<=Zt.LogLevel.Debug?n:n.map(t=>{if(!(t instanceof Error)||!("isJupyterError"in t))return t;let r=[`${t.name}: ${t.message}`.trim()];if("kernelConnectionMetadata"in t&&t.kernelConnectionMetadata&&typeof t.kernelConnectionMetadata=="object"&&"id"in t.kernelConnectionMetadata&&(r.push(`Kernel Id = ${t.kernelConnectionMetadata.id}`),"interpreter"in t.kernelConnectionMetadata&&t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter=="object"&&"id"in t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter.id=="string"&&r.push(`Interpreter Id = ${U(t.kernelConnectionMetadata.interpreter.id)}`)),t.stack){let o=Ue(t.stack),s=o.find(a=>a.indexOf("at ")===0);o.length===1||(o.length===1?r.push(o[0]):o.length>1&&s?.length?r.push(s):r.push(o[0]))}let i=["stack","message","name","kernelConnectionMetadata","category","exitCode","isJupyterError"];return Object.keys(t).filter(o=>i.indexOf(o)===-1).forEach(o=>r.push(`${o} = ${String(t[o]).trim()}`)),r.filter(o=>o.trim().length).map((o,s)=>s===0?o:`    > ${o}`).join(`
`)})}function Oee(n,...e){id<=Zt.LogLevel.Error&&(e=a2(...e),nd.forEach(t=>t.error(n,...e)))}function l2(n,...e){id<=Zt.LogLevel.Warning&&(e=a2(...e),nd.forEach(t=>t.warn(n,...e)))}function Fee(n,...e){id<=Zt.LogLevel.Info&&nd.forEach(t=>t.info(n,...e))}function Lee(n,...e){id<=Zt.LogLevel.Debug&&nd.forEach(t=>t.debug(n,...e))}function Uee(n,...e){id<=Zt.LogLevel.Trace&&nd.forEach(t=>t.trace(n,...e))}function n2(n,...e){if(Un)if(typeof n=="function"){let r=n(),i="",o=[];typeof r=="string"?i=r:(i=r.shift(),o=r),p.info(i,...o)}else p.info(n,...e)}function ti(n,e=i2){return c2({message:n,opts:e,level:Zt.LogLevel.Debug})}function Nh(n){return c2({message:n,opts:i2,level:Zt.LogLevel.Error})}var xc=new WeakMap;function Dc(n){return(e,t,r)=>{xc.has(e)||xc.set(e,new Map);let i=xc.get(e);i||xc.set(e,i=new Map),i.has(t)||i.set(t,[]),i.get(t).push({parameterIndex:r,propertyOfParameterToLog:n})}}function od(){return(n,e,t)=>{xc.has(n)||xc.set(n,new Map);let r=xc.get(n);r||xc.set(n,r=new Map),r.has(e)||r.set(e,[]),r.get(e).push({parameterIndex:t,ignore:!0})}}function c2(n){return GU((e,t)=>Bee(n,t,e),(n.opts&4)>0)}function Wee(n){let{kind:e,name:t,args:r}=n;return(!e||e==="")&&(e="Function"),(!t||t==="")&&(t="<anon>"),r||(r=[]),{kind:e,name:t,args:r,methodName:n.methodName||"",target:n.target||void 0}}function Vee(n){if(!n)return!1;let e=n;return typeof e.path=="string"&&typeof e.scheme=="string"}function BA(n){let e=FP?n.toLowerCase().indexOf(FP):-1;return e===-1?n:`~${n.substring(e+FP.length)}`}function jee(n,e,t,r){if(Vee(t))return BA(t.path);if(!t)return t;let o=xc.get(n)?.get(e)?.find(a=>a.parameterIndex===r);if(!o)return typeof t=="string"?BA(t):t;if("ignore"in o&&o.ignore)return"";let s=t;return"propertyOfParameterToLog"in o&&o.propertyOfParameterToLog&&(s=t[o.propertyOfParameterToLog]),typeof s=="string"?BA(s):s}function Jee(n,e,t){t=Wee(t);let r=[n.message];return r.push(`${t.kind} name = ${t.name}`.trim()),e?(r.push(`completed in ${e.elapsed}ms`),r.push(`has a ${e.returnValue?"truthy":"falsy"} return value`)):r[r.length-1]=`${r[r.length-1]} (started execution)`,(n.opts&1)===1&&(n.level===Zt.LogLevel.Debug?r.push($R(t.args.map((i,o)=>t?jee(t.target,t.methodName,i,o):i))):r.push($R(t.args))),e&&(n.opts&2)===2&&r.push(zU(e.returnValue)),r.join(", ")}function Bee(n,e,t){let r=Jee(n,e,t);e?e.err===void 0?n.level&&n.level===Zt.LogLevel.Error||(n.level?OP(n.level,r):OP(Zt.LogLevel.Info,r)):OP(Zt.LogLevel.Error,r,e.err):n.level&&n.level!==Zt.LogLevel.Error&&OP(n.level,r)}function OP(n,e,...t){switch(n){case Zt.LogLevel.Error:p.error(e,...t);break;case Zt.LogLevel.Warning:l2(e,...t);break;case Zt.LogLevel.Info:p.info(e,...t);break;case Zt.LogLevel.Debug:case Zt.LogLevel.Trace:p.debug(e,...t);break;default:break}}var ja=require("vscode");var ON=require("vscode");var u2=Symbol("IsDevMode"),Mo=Symbol("IOutputChannel"),d2=Symbol("IS_WINDOWS"),M=Symbol("IDisposableRegistry"),Le=Symbol("IGlobalMemento"),ut=Symbol("IGlobalMemento"),ri=Symbol("IWorkspaceMemento");var ml=Symbol("IPersistentStateFactory"),Lye=Symbol("IRandom"),ie=Symbol("IConfigurationService"),Ze=Symbol("ExtensionContext"),sa=Symbol("IExtensions"),p2=Symbol("IJupyterExtensionBanner"),LP=Symbol("IFeaturesManager"),Mh=Symbol("ICryptoUtils"),aa=Symbol("IAsyncDisposableRegistry");var sd=Symbol("IExperimentService"),Kh=Symbol("IDataScienceCommandListener"),Oh=Symbol("IVariableScriptGenerator"),Fh=Symbol("IDataFrameScriptGenerator");var Lk=require("vscode");var m2=require("events"),XS=k(N());try{(0,XS.decorate)((0,XS.injectable)(),m2.EventEmitter)}catch(n){p.warn("Failed to decorate EventEmitter for DI (possibly already decorated by another Extension)",n)}var ve=class{constructor(e){this.container=e;ve._instance=this}static get instance(){return ve._instance}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}};ve=v([(0,XS.injectable)()],ve);var ht=require("vscode");var Qt=Symbol("IPythonApi"),$e=Symbol("IPythonExtensionChecker");var Ss=k(N());var ZS="Python Kernel Debug Adapter",eC="Python Interactive Window Debug Adapter";var VP=require("node-fetch"),nC=k(f2());var Lh=require("vscode");var qe=class extends Error{constructor(t,r){super(r);this.category=t;this.isJupyterError=!0}},Gr=class n extends qe{constructor(t,r,i){super(i||$A(r),t);this.originalException=r;r&&(this.stack=`${new Error("").stack}

${r.stack}`)}static from(t,r){return r instanceof qe?r:new n(t,r)}static unwrap(t){return t&&(t instanceof n&&t.originalException&&t.originalException instanceof qe&&(t=t.originalException),t)}};function $A(n){return n&&n instanceof qe?n.category:"unknown"}var gs=class extends qe{constructor(t,r,i){super("jupyterconnection",t+(r?`
${r}`:""));this.interpreter=i}};var pn=class extends qe{constructor(){super("sessionDisposed",y.sessionDisposed)}};var UP=class{static outputHasModuleNotInstalledError(e,t){return!!(t&&(t.indexOf(`No module named ${e}`)>0||t.indexOf(`No module named '${e}'`)>0))}};function Uh(n=""){if(!n)return;let e=/\S+Error: /g,t=`${n.trim()}: `.split(`
`).filter(s=>s.trim().length).reverse();if(t.length===0)return;let r=t[0],o=((r.match(e)?r:void 0)||"").split(":");return o.length&&o[0].endsWith("Error")?o[0]:void 0}function WP(n=""){let e=g2(n);return e?e[1]:void 0}function g2(n=""){if(!n)return;let e=n.trim().split(`
`).map(t=>t.trim()).filter(t=>t.trim().length).reverse();if(e.length!==0&&e[0].includes("Error"))return[e.length>1?e[1]:"",e[0]]}function v2(n){if(!n)return;let t=(Array.isArray(n)?n[0]:n).split(`
`).map(l=>l.trim().toLowerCase()).filter(l=>l.length).reverse().find(l=>l.startsWith("file ")&&l.includes(", line ")&&l.includes(".py")&&l.includes(".py"));if(!t)return;let i=(t.substring(0,t.lastIndexOf(".py"))+".py").replace(/\\/g,"/").split("/"),o=i.indexOf("site-packages"),s=o>=0&&i.length>o+1?i[o+1]:"",a=i.reverse();if(!(a.length<2))return{fileName:a[0],folderName:a[1],packageName:s}}function nm(n,e,t,r="",i=[]){let o=e instanceof qe?e.stdErr||e.stack||"":e.toString(),s=g2(o),a=o.toLowerCase();if(e instanceof pn)return{reason:"sessionDisposed",message:y.sessionDisposed,moreInfoLink:"https://aka.ms/kernelDisposedCannotRunCell",telemetrySafeTags:["deadSession"]};if(a.includes("ImportError: No module named 'win32api'".toLowerCase()))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())&&a.includes("win32api"))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["dll.load.failed","win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())){let u=s&&s[0].toLowerCase().startsWith("import")?s[0].substring(6).trim():void 0;return{reason:"dllLoadFailure",moduleName:u,message:u?y.failedToStartKernelDueToDllLoadFailure(u):y.failedToStartKernelDueToUnknownDllLoadFailure,moreInfoLink:"https://aka.ms/kernelFailuresDllLoad",telemetrySafeTags:["dll.load.failed"]}}if(a.includes("AssertionError: Couldn't find Class NSProcessInfo".toLowerCase()))return{reason:"oldIPythonFailure",message:y.failedToStartKernelDueToOldIPython,moreInfoLink:"https://aka.ms/kernelFailuresOldIPython",telemetrySafeTags:["oldipython"]};if(a.includes("NotImplementedError".toLowerCase())&&a.includes("asyncio".toLowerCase())&&a.includes("events.py".toLowerCase()))return{reason:"oldIPyKernelFailure",message:y.failedToStartKernelDueToOldIPyKernel,moreInfoLink:"https://aka.ms/kernelFailuresOldIPyKernel",telemetrySafeTags:["oldipykernel"]};{let u=[];if(a.includes("ImportError: cannot import name".toLowerCase())&&a.includes("from partially initialized module".toLowerCase())&&a.includes("zmq.backend.cython".toLowerCase())&&u.push("zmq.backend.cython"),a.includes("zmq".toLowerCase())&&a.includes("cython".toLowerCase())&&a.includes("__init__.py".toLowerCase())&&u.push("zmq.cython"),a.includes("zmq.error.ZMQError")&&u.push("zmq.error"),u.length)return{reason:"zmqModuleFailure",message:y.failedToStartKernelDueToPyZmqFailure,moreInfoLink:"https://aka.ms/kernelFailuresPyzmq",telemetrySafeTags:u}}if(s&&s[1].toLowerCase().startsWith("importerror")){let u=h2(s[1]);if(u&&r){let d=Hee(u.moduleName,u.fileName,n,r);return d||{reason:"importFailure",moduleName:u.moduleName,fileName:u.fileName,message:u.fileName?y.failedToStartKernelDueToImportFailureFromFile(u.moduleName,u.fileName):y.failedToStartKernelDueToImportFailure(u.moduleName),moreInfoLink:u.fileName?"https://aka.ms/kernelFailuresModuleImportErrFromFile":"https://aka.ms/kernelFailuresModuleImportErr",telemetrySafeTags:["import.error"]}}}let l="No module named".toLowerCase(),c="is not a package".toLowerCase();if(a.includes(l)&&!c){let u=Ue(o).map(f=>f.trim()).filter(f=>f.length).find(f=>f.toLowerCase().includes(l)),d=u?u.substring(u.toLowerCase().indexOf(l)+l.length).trim():"";if(u)return{reason:"moduleNotFound",moduleName:d,message:y.failedToStartKernelDueToMissingModule(d),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(a.includes(l)&&c){let u=Ue(o).map(I=>I.trim()).filter(I=>I.length).find(I=>I.toLowerCase().includes(l)),d=u?u.substring(u.toLowerCase().indexOf(l)+l.length).trim():"",f="",g="";d.split("'").length>2&&(f=d.split("'").slice(-2)[0]||"",f=f?`${f}.py`:"",g=f||"",d=d.split("'")[1]||d);let b=i.filter(I=>dn(I).toLowerCase()==="__init__.py").map(I=>dn(bi(I)));return d&&f&&d!==f&&i.some(I=>dn(I).toLowerCase()===f.toLowerCase())?{reason:"overridingBuiltinModules",fileName:f,moduleName:d,message:y.fileSeemsToBeInterferingWithKernelStartup(f),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:d&&b&&d!==g&&b.some(I=>I.toLowerCase()===g.toLowerCase())?{reason:"overridingBuiltinModules",folderName:g,moduleName:d,message:y.moduleSeemsToBeInterferingWithKernelStartup(g),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:{reason:"moduleNotFound",moduleName:d,message:y.failedToStartKernelDueToMissingModule(d),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(e instanceof qe&&e.category==="invalidkernel"&&i.length){let u=dn(i[0]);return{reason:"overridingBuiltinModules",fileName:u,moduleName:dn(i[0],".py"),message:y.fileSeemsToBeInterferingWithKernelStartup(u),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}else if(s&&s[1].toLowerCase().startsWith("ModuleNotFoundError".toLowerCase())){let u=h2(s[1]);if(u)return{reason:"moduleNotFound",moduleName:u.moduleName,message:y.failedToStartKernelDueToMissingModule(u.moduleName),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}if(e instanceof gs){let u=Ue(o).map(w=>w.trim()).reverse().find(w=>w.toLowerCase().includes("error: ")),d="AttributeError: 'Namespace' object has no attribute '_flags'",f=["jupyter.startup.failure"],g,b="jupyterStartFailure",I=Ue(e.message,{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: "));if(I=I||Ue(e.stdErr||"",{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: ")),a.includes(d.toLowerCase())?(b="jupyterStartFailureOutdatedTraitlets",u=y.failedToStartJupyterDueToOutdatedTraitlets(t||"",I||""),f.push("outdated.traitlets"),g="https://aka.ms/kernelFailuresJupyterTrailtletsOutdated"):(u=I?y.failedToStartJupyterWithErrorInfo(t||"",I):y.failedToStartJupyter(t||""),g=void 0),u)return{reason:b,message:u,pythonError:I,moreInfoLink:g,telemetrySafeTags:f}}}function h2(n){n=n.replace(/"/g,"'");let e=n.match(/'[^\\']*(\\'[^\\']*)*'/g),t=n.match(/\((.*?)\)/g),r,i;return e&&e[0].length>2&&(r=e[0],r=r.substring(1,r.length-1)),t&&t[0].length>2&&(i=t[0],i=i.substring(1,i.length-1)),r?{moduleName:r,fileName:i}:void 0}function Hee(n,e,t,r){if(r&&t.length!==0&&e&&!e.toLowerCase().startsWith(r)&&t.some(i=>e.toLowerCase().startsWith(i.uri.fsPath.toLowerCase())))return{reason:"overridingBuiltinModules",fileName:e,moduleName:n,message:y.fileSeemsToBeInterferingWithKernelStartup(U(Lh.Uri.file(e),t||[])),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}function Wh(n){if(!n)return;let e=/\[([^\[\]]*)\]\((.*?)\)/gm,t;for(;(t=e.exec(n))!==null;)t.length===3&&(n=n.replace(t[0],`<a href='${t[2]}'>${t[1]}</a>`));let r=Ue(n,{removeEmptyEntries:!1,trim:!1}).map(i=>`\x1B[1;31m${i}`).join(`
`);return new Lh.NotebookCellOutput([Lh.NotebookCellOutputItem.error({message:"",name:"",stack:r})])}var Gee=[zee,Qee];function y2(n){let e=[],t=Array.isArray(n)?n[0].toLowerCase():n.toLowerCase();Gee.forEach(i=>i(t,e));let r=nm([],t,void 0);return r?.telemetrySafeTags.length&&e.push(...r.telemetrySafeTags),Array.from(new Set(e)).join(",")}function zee(n,e=[]){n.includes("ChildProcess.exithandler".toLowerCase())&&e.push("childproc.exit")}function Qee(n,e=[]){n.includes("KernelRestarter: restart failed".toLowerCase())&&e.push("KernelRestarter.failed")}function b2(){return(new Error().stack||"").split(`
`).filter(n=>n.includes(Ae))}async function I2(n,e){n.failed=!0,n.failureCategory=n.failureCategory||$A(e);let t=!VP.FetchError&&e?.name==="TypeError"&&e?.message==="Failed to fetch",i=(t||VP.FetchError!==void 0)&&Zee(e,t?TypeError:VP.FetchError);n.failureCategory==="unknown"&&i&&(n.failureCategory="fetcherror"),n.stackTrace=Yee(e),typeof e=="string"&&(n.failureSubCategory="errorisstring");let o=e.stdErr?e.stdErr:e.stack||"";if(!o)return;n.failureSubCategory=n.failureSubCategory||y2(o);let s=v2(o);s&&([n.pythonErrorFile,n.pythonErrorFolder,n.pythonErrorPackage]=await Promise.all([Promise.resolve(n.pythonErrorFile||ct(s.fileName)),Promise.resolve(n.pythonErrorFolder||ct(s.folderName)),Promise.resolve(n.pythonErrorPackage||ct(s.packageName))]))}function qA(n){if(n.stack&&Array.isArray(n.stack)){let e={...n,stack:n.stack.join(`
`)};return nC.parse.call(nC,e)}return nC.parse.call(nC,n)}function Yee(n){let e="";for(let t of qA(n)){let r=t.getFileName();if(r){let i=t.getLineNumber(),o=t.getColumnNumber();e+=`
	at ${Xee(t)} ${r}:${i}:${o}`}else e+=`
	at <anonymous>`}return e.trim().replace(/\\/g,"/")}function Xee(n){let e=[];return typeof n.getTypeName()=="string"&&n.getTypeName().length>0&&e.push(n.getTypeName()),typeof n.getMethodName()=="string"&&n.getMethodName().length>0&&e.push(n.getMethodName()),typeof n.getFunctionName()=="string"&&n.getFunctionName().length>0&&(e.length!==2||e.join(".")!==n.getFunctionName())&&e.push(n.getFunctionName()),e.join(".")}function Zee(n,e){return e?n instanceof e||n instanceof Gr&&n.originalException instanceof e:(console.error("Error type is not defined",n),!1)}var jP=require("vscode");function ete(){try{return require("vscode")===void 0?!1:E2()!==void 0}catch{return!1}}function BP(){return jP.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1}function $P(n){return jP.workspace.onDidChangeConfiguration(e=>{if(!e.affectsConfiguration("telemetry"))return;let r=jP.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1;n(r)})}var JP={};function Vh(n,e){let t=n;TS()&&t.startsWith("ds_")||(e===void 0?delete JP[t]:JP[t]=e)}var HA;function E2(){if(HA)return HA;let n=require("@vscode/extension-telemetry").default;return HA=new n(LU)}function S2(n,e){let t={};return Object.getOwnPropertyNames(e).forEach(r=>{if(!(e[r]===void 0||e[r]===null))try{t[r]=typeof e[r]=="string"?e[r]:typeof e[r]=="object"?"object":e[r].toString()}catch(i){p.error(`Failed to serialize ${r} for ${n}`,i)}}),t}function R(n,e,t,r){!w2(n.toString())&&(kr()||!ete())||tte(n,e,t,r)}function w2(n){return n==="DATASCIENCE.JUPYTER_NOTEBOOK_EDIT_PERFORMANCE"||n==="DATASCIENCE.JUPYTER_JUPYTER_NOTEBOOK_EXEC_PERFORMANCE"||n==="DATASCIENCE.JUPYTER_NOTEBOOK_EXEC_PERFORMANCE"}function tte(n,e,t,r){let i=E2(),o={},s=n;r?(o={},Object.assign(o,JP),Object.assign(o,t||{}),I2(o,r).then(()=>{o=S2(s,o),i.sendTelemetryEvent(s,o,e)}).catch(h)):(t&&(o=S2(s,t)),Object.assign(o,JP),w2(s)?i.sendDangerousTelemetryEvent(s,o,e):i.sendTelemetryEvent(s,o,e))}var C2=new Set;function cr(n,e){return function(t,r,i){let o=i.value;return i.value=function(...s){let a=e||{},l=new Fe,c=`${n.toString()}${JSON.stringify(a)}`,u=!C2.has(c);C2.add(c);let d=o.apply(this,s);return d&&typeof d.then=="function"&&typeof d.catch=="function"?d.then(f=>{let g={...a};return u&&(g.firstTime=u),R(n,l?{duration:l?.elapsedTime}:void 0,g),f}).catch(f=>{let g={...a};g.failed=!0,R(n,l?{duration:l?.elapsedTime}:{},g,f)}):R(n,l?{duration:l?.elapsedTime}:void 0,a),d},i}}function zr(n,e){return function(t,r,i){let o=i.value;return i.value=function(...s){return R(n,void 0,e),o.apply(this,s)},i}}function rte(){return{isInsiderExtension:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether this is the Insider version of the Jupyter extension or not. Common to all events."},isPythonExtensionInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether Python extension is installed or not. Common to all events."},rawKernelSupported:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether the raw kernel is supported or not. Common to all events."}}}function ft(){return{duration:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth",isMeasurement:!0}}}function so(){return{resourceType:{classification:"PublicNonPersonalData",comment:"",purpose:"FeatureInsight"}}}function _c(){return{failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureSubCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFile:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFolder:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorPackage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},stackTrace:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}}function Pi(){return{properties:{actionSource:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},disableUI:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},userExecutedCell:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},pythonEnvironmentVersion:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPath:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPackages:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSessionId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelLanguage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelConnectionType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},isUsingActiveInterpreter:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},capturedEnvVars:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},newKernelPicker:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},...so()}}}var Mbe={...ft(),..._c(),...rte()};var nte,ite,ote,ste,ate,lte,cte,ute,dte,pte,mte,fte,hte,gte,vte,yte,bte,Ite,Ste,Cte,Ete,wte,Pte,kte,xte,Dte,_te,Tte,Rte,Ate,Nte,Mte,Kte,Ote,Fte,Lte,Ute,Wte,Vte,jte,Jte,Bte,$te,qte,Hte,Gte,zte,Qte,Yte,Xte,Zte,ere,tre,rre,nre,ire,ore,sre,are,lre,cre,ure,dre,pre,mre,fre,hre,gre,vre,yre,bre,Ire,Sre,Cre,Ere,wre,Pre,kre,xre,Dre,_re,Tre,Rre,Are,Nre,Mre,Kre,Ore,Fre,Lre,Ure,Wre,Vre,jre,Jre,Bre,$re,qre,Hre,Gre,zre,Qre,Yre,Xre,Zre,ene,tne,rne,nne,ine,one,sne,ane,lne,cne,une,dne,pne,mne,fne,hne,gne,vne,yne,bne,Ine,Sne,Cne,Ene,wne,Pne,kne,xne,Dne,_ne,Tne,Rne,Ane,Nne,Mne,Kne,One,Fne,Lne,Une,Wne,Vne,jne,Jne,Bne,$ne,qne,Hne,Gne,zne,Qne,Yne,Xne,Zne,eie,tie,rie,nie,P2=class{constructor(){this[nte]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{totalActivateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},codeLoadingTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},workspaceFolderCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[ite]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:ft()};this[ote]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[ste]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[ate]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{hashedNamev2:{classification:"SystemMetaData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...so()}};this[lte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{firstTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:ft()};this[cte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{mimeType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...so()}};this[ute]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:ft()};this[dte]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[pte]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer","VariableViewer"]};this[mte]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[fte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:ft()};this[hte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:ft()};this[gte]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:{codeLensUpdateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},maxCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[vte]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[yte]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[bte]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Ite]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Ste]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Cte]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{..._c(),failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Reason for failure to fetch kernel specs"},sessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},specsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSpecsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:ft()};this[Ete]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},serverIdHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},providerExtensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},baseUrlHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelId:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelLanguage:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},isArgv0SameAsInterpreter:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[wte]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{serverIdHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},baseUrlHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isLocalHost:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isJupyterHub:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},reason:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[Pte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[kte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[xte]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:Pi().properties,measures:{...ft()}};this[Dte]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[_te]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[Tte]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Rte]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"},cancelled:{classification:"SystemMetaData",purpose:"FeatureInsight"},successful:{classification:"SystemMetaData",purpose:"FeatureInsight"},opened:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ate]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{scope:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Nte]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Mte]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Kte]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Ote]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Fte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},info:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Lte]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Ute]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Wte]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Vte]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[jte]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{nbformat:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"},nbformat_minor:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"}}};this[Jte]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"User Action"};this[Bte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[$te]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[qte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Hte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Gte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[zte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Qte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Yte]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Xte]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Zte]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[ere]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[tre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[rre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[nre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[ire]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[ore]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[sre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[are]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[lre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[cre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[ure]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[dre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[pre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[mre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ft()};this[fre]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[hre]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[gre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[vre]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[yre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[bre]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Ire]={owner:"IanMatthewHuff",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Sre]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Cre]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ere]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"},isModulePresent:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pythonEnvType:{classification:"SystemMetaData",purpose:"FeatureInsight"},resourceHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},...so()},measures:ft()};this[wre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Pre]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",measures:ft()};this[kre]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rows:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0},columns:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[xre]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rowsTimer:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Dre]={owner:"amunger",feature:["DataFrameViewer","VariableViewer"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"},fromVariableView:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[_re]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action"};this[Tre]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Rre]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},errorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},fallbackErrorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},zmqBinaries:{classification:"CallstackOrException",purpose:"FeatureInsight"}}};this[Are]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:ft()};this[Nre]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:{variableCount:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Mre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{kind:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},usesShell:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Kre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{..._c(),...so()},measures:{...ft()}};this[Ore]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonPathDefined:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonEnvFound:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},isCreatedByUs:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Fre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Lre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",properties:{hasKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the kernel was known at the time of creation"},hasOwner:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the window was created for a text file"},mode:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Creation mode: multiple, perfile or single"},restored:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Was the window restored from a previous session"}},measures:{windowCount:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Number of active interactive windows the user has open",isMeasurement:!0}}};this[Ure]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{cdnSearched:{classification:"SystemMetaData",purpose:"FeatureInsight"},hashedName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},modelName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Wre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{type:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:ft()};this[Vre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[jre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Jre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isOnline:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Bre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[$re]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[qre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{selection:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Hre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Gre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{msg_type:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[zre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:{...ft(),attempts:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...Pi().properties,timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Qre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:ft()};this[Yre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],measures:{...ft()},properties:{...Pi().properties,..._c()}};this[Xre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Code Execution"],measures:ft(),properties:{...Pi().properties,..._c(),extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Zre]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],properties:{...Pi().properties,..._c()}};this[ene]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],properties:{...Pi().properties,..._c()}};this[tne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:Pi().properties};this[rne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{result:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},...so(),..._c(),...Pi().properties},measures:{...ft()}};this[nne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...so(),..._c(),...Pi().properties},measures:ft()};this[ine]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...so(),...Pi().properties},measures:{reason:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}}};this[one]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{exitReason:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...so(),...Pi().properties},measures:{exitCode:{classification:"CallstackOrException",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[sne]={owner:"donjayamanne",feature:["Notebook"],source:"N/A",properties:{...so(),...Pi().properties,manuallySelectedKernel:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasAlreadyOpen:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:{...ft(),computeCwd:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},duration:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},envVars:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},executeCell:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},getConnection:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},interruptHandle:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelIdle:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInfo:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelReady:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},portUsage:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},postKernelStart:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},preExecuteCellTelemetry:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},pythonEnvVars:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},sessionTelemetry:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},spawn:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},startKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},startupCode:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},updateConnection:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},codeCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},mdCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},codeCellCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},mdCellCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},outputCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},outputsByteSize:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},attachmentCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},attachmentCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[ane]={owner:"donjayamanne",feature:["Notebook"],source:"N/A",properties:{...so(),...Pi().properties,wasAlreadyOpen:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:{...ft(),callPythonApi:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},activatePython:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},discoverEnv:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},createController:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},selectController:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[lne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{isRequestToShutdownRestartSession:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...so(),...Pi().properties}};this[cne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...so(),...Pi().properties}};this[une]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[dne]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{kernelSpecCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInterpreterCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelLiveCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},localKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},remoteKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[pne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{outputType:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[mne]={owner:"IanMatthewHuff",feature:["InteractiveWindow"],tags:["IntelliSense"],source:"N/A",measures:ft(),properties:{isResultNull:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[fne]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:ft()};this[hne]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[gne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:ft()};this[vne]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"N/A",measures:ft()};this[yne]={owner:"amunger",feature:"N/A",source:"N/A",properties:{command:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[bne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{newState:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ine]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:{numberOfDimensions:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Sne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{source:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Cne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},dependenciesInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ene]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[wne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Pne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[kne]={owner:"roblourens",feature:["Debugger"],properties:{status:{classification:"SystemMetaData",purpose:"FeatureInsight"}},source:"N/A"};this[xne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Dne]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[_ne]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[Tne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Rne]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[Ane]={owner:"roblourens",feature:["Debugger"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Nne]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...ft(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},timesExceededTimeout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},completionItems:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Mne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Kne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[One]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"}},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Fne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{accessAllowed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Lne]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},cancelledAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestAcknowledgedAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestSentAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},...ft()},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},mimeTypes:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}};this[Une]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:ft(),properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Wne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{clientExtId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Vne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},allowed:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[jne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},providerId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}},measures:ft()};this[Jne]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[Bne]={owner:"roblourens",feature:["InteractiveWindow","Debugger"],source:"N/A"};this[$ne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...Pi().properties,...so()}};this[qne]={owner:"donjayamanne",source:"N/A",feature:["KernelPicker"]};this[Hne]={owner:"donjayamanne",source:"User Action",feature:["KernelPicker"]};this[Gne]={owner:"amunger",feature:"N/A",source:"N/A",properties:{testName:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},testResult:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},perfWarmup:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},commitHash:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},timedCheckpoints:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[zne]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{matchedReason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Qne]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{requireEntryPointCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}},properties:{failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},failure:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},patternUsedToRegisterRequireConfig:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},widgetFolderNameHash:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Yne]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:ft()};this[Xne]={owner:"donjayamanne",feature:["DataFrameViewer"],source:"N/A"};this[Zne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[eie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[tie]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{...ft(),codeCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of code cells.",isMeasurement:!0},markdownCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of markdown cells.",isMeasurement:!0},preExecuteDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total time spent in VS Code before starting execution.",isMeasurement:!0},executeDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total time spent executing cells.",isMeasurement:!0},postExecuteDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total time spent in VS Code after executing cells.",isMeasurement:!0}},properties:{outputType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",comment:"The kind of outputs generated in the notebook, text, html or images."}}};this[rie]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{...ft(),codeCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of code cells.",isMeasurement:!0},markdownCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of markdown cells.",isMeasurement:!0}},properties:{outputType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",comment:"The kind of outputs generated in the notebook, text, html or images."}}};this[nie]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{...ft(),codeCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of code cells.",isMeasurement:!0},markdownCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of markdown cells.",isMeasurement:!0}}}}static{nte="EXTENSION.LOAD",ite="DS_INTERNAL.EXPERIMENT_LOAD",ote="ENVFILE_VARIABLE_SUBSTITUTION",ste="ENVFILE_WORKSPACE",ate="HASHED_PACKAGE_NAME",lte="DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",cte="DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",ute="DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",dte="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX",pte="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",mte="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX",fte="DATASCIENCE.ADD_CELL_BELOW",hte="DS_INTERNAL.CODE_LENS_ACQ_TIME",gte="DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",vte="DATASCIENCE.DEBUG_CONTINUE",yte="DATASCIENCE.DEBUG_CURRENT_CELL",bte="DATASCIENCE.DEBUG_STEP_OVER",Ite="DATASCIENCE.DEBUG_STOP",Ste="DATASCIENCE.DEBUG_FILE_INTERACTIVE",Cte="DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",Ete="DS_INTERNAL.JUPYTER_KERNEL_SPEC",wte="DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",Pte="DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER",kte="DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER",xte="DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",Dte="DATASCIENCE.EXPORT_PYTHON_FILE",_te="DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT",Tte="DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",Rte="DATASCIENCE.EXPORT_NOTEBOOK_AS",Ate="DATASCIENCE.IMPORT_NOTEBOOK",Nte="DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",Mte="DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",Kte="DS_INTERNAL.GET_PASSWORD_FAILURE",Ote="DS_INTERNAL.GET_PASSWORD_SUCCESS",Fte="DS_INTERNAL.JUPYTER_HUB_PASSWORD",Lte="DS_INTERNAL.SHOW_DATA_NO_PANDAS",Ute="DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD",Wte="DS_INTERNAL.SHOW_DATA_PANDAS_OK",Vte="DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED",jte="DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",Jte="DATASCIENCE.OPEN_PLOT_VIEWER",Bte="DATASCIENCE.RUN_ALL_CELLS",$te="DATASCIENCE.RUN_SELECTION_OR_LINE",qte="DATASCIENCE.RUN_CURRENT_CELL",Hte="DATASCIENCE.RUN_ALL_CELLS_ABOVE",Gte="DATASCIENCE.RUN_CELL_AND_ALL_BELOW",zte="DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE",Qte="DATASCIENCE.RUN_FILE_INTERACTIVE",Yte="DATASCIENCE.RUN_TO_LINE",Xte="DATASCIENCE.RUN_FROM_LINE",Zte="DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION",ere="DATASCIENCE.RUN_INSERT_CELL_BELOW",tre="DATASCIENCE.RUN_INSERT_CELL_ABOVE",rre="DATASCIENCE.RUN_DELETE_CELLS",nre="DATASCIENCE.RUN_SELECT_CELL",ire="DATASCIENCE.RUN_SELECT_CELL_CONTENTS",ore="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE",sre="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW",are="DATASCIENCE.RUN_MOVE_CELLS_UP",lre="DATASCIENCE.RUN_MOVE_CELLS_DOWN",cre="DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN",ure="DATASCIENCE.RUN_CHANGE_CELL_TO_CODE",dre="DATASCIENCE.GOTO_NEXT_CELL_IN_FILE",pre="DATASCIENCE.GOTO_PREV_CELL_IN_FILE",mre="DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW",fre="DATASCIENCE.SELFCERTSMESSAGECLOSE",hre="DATASCIENCE.SELFCERTSMESSAGEENABLED",gre="DATASCIENCE.USER_INSTALLED_JUPYTER",vre="DATASCIENCE.USER_INSTALLED_PANDAS",yre="DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER",bre="DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS",Ire="DS_INTERNAL.PYTHON_NOT_INSTALLED",Sre="DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",Cre="DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",Ere="DS_INTERNAL.PYTHON_MODULE_INSTALL",wre="DS_INTERNAL.SHIFTENTER_BANNER_SHOWN",Pre="DATASCIENCE.START_SHOW_DATA_EXPLORER",kre="DATASCIENCE.SHOW_DATA_EXPLORER",xre="DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",Dre="DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",_re="DATASCIENCE.REFRESH_DATA_VIEWER",Tre="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",Rre="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",Are="DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME",Nre="DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",Mre="DATASCIENCE.KERNEL_SPEC_LANGUAGE",Kre="DS_INTERNAL.KERNEL_LAUNCHER_PERF",Ore="GLOBAL_PYTHON_KERNELSPEC",Fre="DS_INTERNAL.NEW_FILE_USED_IN_INTERACTIVE",Lre="DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",Ure="DS_INTERNAL.IPYWIDGET_USED_BY_USER",Wre="DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",Vre="DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED",jre="DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",Jre="DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",Bre="DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",$re="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN",qre="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",Hre="DS_INTERNAL.IPYWIDGET_RENDER_FAILURE",Gre="DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",zre="DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",Qre="DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH",Yre="DATASCIENCE.EXECUTE_CELL",Xre="DATASCIENCE.EXECUTE_CODE",Zre="DATASCIENCE.RESUME_EXECUTE_CELL",ene="DATASCIENCE.NOTEBOOK_START",tne="DS_INTERNAL.SWITCH_KERNEL",rne="DATASCIENCE.NOTEBOOK_INTERRUPT",nne="DATASCIENCE.NOTEBOOK_RESTART",ine="DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",one="DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",sne="DATASCIENCE.NOTEBOOK_FIRST_START_BREAKDOWN",ane="DATASCIENCE.NOTEBOOK_FIRST_KERNEL_AUTO_SELECTION_BREAKDOWN",lne="DS_INTERNAL.RAWKERNEL_SESSION_SHUTDOWN",cne="DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",une="DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER",dne="DS_INTERNAL.KERNEL_COUNT",pne="DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",mne="DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",fne="DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED",hne="DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE",gne="DATAVIEWER.WEBVIEW_LOADED",vne="PLOTVIEWER.WEBVIEW_LOADED",yne="DS_INTERNAL.COMMAND_EXECUTED",bne="DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",Ine="DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",Sne="DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",Cne="DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",Ene="DATASCIENCE.RECOMMENT_EXTENSION",wne="DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP",Pne="DATASCIENCE.DEBUGGING.CLOSED_MODAL",kne="DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",xne="DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE",Dne="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE",_ne="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_IW_JUPYTER",Tne="DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL",Rne="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL",Ane="DATASCIENCE.DEBUGGING.ENDED_SESSION",Nne="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",Mne="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",Kne="DATASCIENCE.JUPYTER_KERNEL_API_USAGE",One="DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",Fne="DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",Lne="DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",Une="DATASCIENCE.JUPYTER_NEW_KERNEL_API_KERNEL_STARTUP_WAIT_UNTIL",Wne="DATASCIENCE.JUPYTER_API_USAGE",Vne="DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",jne="DATASCIENCE.JUPYTER_KERNEL_STARTUP_HOOK",Jne="DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE",Bne="DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE",$ne="DATASCIENCE.KERNEL_CRASH",qne="DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER",Hne="DATASCIENCE.JUPYTER_KERNEL_FILTER_USED",Gne="DS_INTERNAL.RUNTEST",zne="DS_INTERNAL.PREFERRED_KERNEL_EXACT_MATCH",Qne="DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",Yne="DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",Xne="DATASCIENCE.NO_ACTIVE_KERNEL_SESSION",Zne="DATAVIEWER.USING_INTERPRETER",eie="DATAVIEWER.USING_KERNEL",tie="DATASCIENCE.JUPYTER_NOTEBOOK_EXEC_PERFORMANCE",rie="DATASCIENCE.JUPYTER_JUPYTER_NOTEBOOK_EXEC_PERFORMANCE",nie="DATASCIENCE.JUPYTER_NOTEBOOK_EDIT_PERFORMANCE"}};var ad=require("vscode");function hl(n){let e=fl(n.uri);return ct(e.path)}function Ko(n=ad.Uri.file(""),e=ad.Uri.file(""),t=Kr(),r=!1){let i=fl(n,t,t=="Windows"||r),o=fl(e,t,t=="Windows"||r);return i===o||yi(i,o,!0)}function fl(n=ad.Uri.file(""),e=Kr(),t=!1){let r=Re(n);return t&&(r=r.toLowerCase()),r.endsWith("/bin/python")?["Linux","OSX"].includes(e)?r.endsWith("/bin/python")&&r.split("/").length>4?ad.Uri.file(r.replace("/bin/python","/python")):ad.Uri.file(r):ad.Uri.file(r):ad.Uri.file(r)}var k2=require("vscode");var ao=class{constructor(){this.promises=new Set;this._onStateChange=new k2.EventEmitter;this.onStateChange=this._onStateChange.event}get isComplete(){return this.promises.size===0}dispose(){this._onStateChange.dispose()}push(e){this.promises.add(e),this._onStateChange.fire(),e.finally(()=>{this.promises.delete(e),this.isComplete&&this._onStateChange.fire()}).catch(h)}};var qP=class extends Gr{constructor(e){super("Python Extension failed to activate",e,"pythonExtension")}};var HP=class extends qe{constructor(){super("pythonExtension","Python Extension API not exported")}};var sj=k(lm());var cm=require("vscode");var nk=class{};function ys(n,e=""){let t=n?cm.workspace.getWorkspaceFolder(n):cm.workspace.workspaceFolders?cm.workspace.workspaceFolders[0]:void 0;return t?cn(Kr()==="Windows"?t.uri.path.toUpperCase():t.uri.path):e}function vl(){return(Array.isArray(cm.workspace.workspaceFolders)&&cm.workspace.workspaceFolders.length>0?cm.workspace.workspaceFolders[0]:void 0)?.uri}var mm=require("vscode");var B2=k(lm());var dm=require("vscode");var J2=require("vscode");function la(n){return(e,t=null,r)=>{let i=!1,o;return o=n(s=>{if(!i)return o?o.dispose():i=!0,e.call(t,s)},null,r),i&&o.dispose(),o}}function uC(n,e=null,t){return new Promise(r=>la(n)(r,e,t))}var um=class{constructor(){this._listeners=new Set}get event(){return this._event||(this._event=(e,t,r)=>{this._listeners.add(t?e.bind(t):e);let i=new J2.Disposable(()=>this._listeners.delete(e));return r?.push(i),i}),this._event}async fireAsync(e,t){if(this._listeners){this._asyncDeliveryQueue||(this._asyncDeliveryQueue=[]);for(let r of this._listeners)this._asyncDeliveryQueue.push([r,e]);for(;this._asyncDeliveryQueue.length>0&&!t.isCancellationRequested;){let[r,i]=this._asyncDeliveryQueue.shift(),o=[],s={...i,token:t,waitUntil:a=>{if(Object.isFrozen(o))throw new Error("waitUntil can NOT be called asynchronous");o.push(a)}};try{r(s)}catch(a){console.error(a);continue}Object.freeze(o),await Promise.allSettled(o).then(a=>{for(let l of a)l.status==="rejected"&&console.error(l.reason)})}}}dispose(){this._listeners.clear()}};var Wie={output_type:"stream",name:"stdout",text:""},Vie={output_type:"error",ename:"",evalue:"",traceback:[""]},jie={output_type:"display_data",data:{},metadata:{}},Jie={output_type:"execute_result",execution_count:0,data:{},metadata:{}},cIe={stream:new Set(Object.keys(Wie)),error:new Set(Object.keys(Vie)),display_data:new Set(Object.keys(jie)),execute_result:new Set(Object.keys(Jie))};function $i(n){return n&&Yu(n).toLowerCase().endsWith("ipynb")?"notebook":"interactive"}function yl(n){return n=n.toLowerCase(),n.length===2&&n.endsWith("#")?`${n.substring(0,1)}sharp`:WU.get(n)||n}function Pt(n){return typeof n=="string"?n===bt||n===Yt:n.notebookType===bt||n.notebookType===Yt}function lo(n){let e=n.metadata;return JSON.parse(JSON.stringify(e?.metadata||{}))}function $2(n){let e=n.metadata;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}async function q2(n,e){let t=new dm.WorkspaceEdit;t.set(n.uri,[dm.NotebookEdit.updateNotebookMetadata(mN({...n.metadata||{},metadata:e}))]),await dm.workspace.applyEdit(t)}function zh(n){return dm.workspace.notebookDocuments.find(e=>Pt(e)&&e.getCells().some(t=>t.document===n))}function bs(n){if(Array.isArray(n)){let e="";for(let t=0;t<n.length;t+=1){let r=n[t];t<n.length-1&&!r.endsWith(`
`)?e=e.concat(`${r}
`):e=e.concat(r)}return e}return n.toString()}function Qh(n){if(Array.isArray(n))return n;let e=n.toString();if(e.length>0){let t=e.split(`
`);return t.map((r,i)=>i<t.length-1?`${r}
`:r).filter(r=>r.length>0)}return[]}function Bie(n){let e=n;do n=e,e=n.replace(/[^\n]\x08/gm,"");while(e.length<n.length);return n}function $ie(n){for(n=n.replace(/\r+\n/gm,`
`);n.search(/\r[^$]/g)>-1;){var e=n.match(/^(.*)\r+/m)[1],t=n.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),n=n.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return n}function H2(n){return $ie(Bie(n))}var ik="'''",ok='"""';function pm(n,e,t){let r,i,o=0;for(let s of n){let a=s.trim(),l=a.startsWith(ik)?ik:a.startsWith(ok)?ok:void 0,c=a.includes(ik)?ik:a.includes(ok)?ok:void 0;if(i)i===c&&(i=void 0),t(s,o);else if(r)r===l&&(r=void 0),r&&e(s,o);else if(c&&!l){let u=a.indexOf(c);i=a.lastIndexOf(c)!==u?void 0:c,t(s,o)}else if(l){let u=a.indexOf(l,3);r=u>=0?void 0:l,a.length>3&&e(a.slice(3,u>=0?u:void 0),o)}else a.startsWith("#")?e(a.slice(1),o):t(s,o);o+=1}}function Yh(n,e=`
`,t){return n.map((r,i)=>{let o=t?t(r):r;return i===n.length-1?`${o}`:`${o}${e}`})}function qie(n){let e=[];return pm(n,t=>e.push(t),t=>{}),e}function sk(n){return Yh(qie(n.slice(n.length>1?1:0)))}function G2(n){let e=n.length,t=-1;return n.forEach((r,i)=>{r.trim()&&(e=i,t<0&&(t=i))}),t>=0?n.slice(t,e+1):[]}function ak(n){let e=/^\s*(\d+)\.(\d+)\.(.+)\s*$/.exec(n);if(e&&e.length>2){let t=parseInt(e[1],10),r=parseInt(e[2],10),i=parseInt(e[3],10);return(0,B2.parse)(`${t}.${r}.${i}`,!0)??void 0}}function ld(n){let e=JSON.parse(JSON.stringify(n.metadata||{}))||{metadata:{}};return e.metadata=e.metadata||{},e}function mN(n){return Hie(n)}function Hie(n){return Array.isArray(n)?n.map(mN):n!=null&&typeof n=="object"&&Object.keys(n).length>0?Object.keys(n).sort().reduce((e,t)=>(e[t]=mN(n[t]),e),{}):n}async function Is(n,e=[]){let t=uC(n.onDidDispose,void 0,e);n.dispose(),await t}var lk=new Map,hN=new Map,fN;function z2(n){fN=n}function gN(n,e){if(!n.pythonEnvironmentPath)return;let t=re();Gie({interpreterHash:n.pythonEnvironmentPath}).then(r=>{n.pythonEnvironmentPackages=r||n.pythonEnvironmentPackages,e&&(e.pythonEnvironmentPackages=r||e.pythonEnvironmentPackages)}).catch(()=>{}).finally(()=>{t.resolve()})}async function Gie(n){if(!fN)return p.error("Python package provider is not initialized."),"{}";let e;if("interpreter"in n?e=n.interpreter:e=hN.get(n.interpreterHash),!e)return"{}";let t=await fN(e);return!t||t.size===0?"{}":JSON.stringify(Object.fromEntries(t))}async function Q2(n){if(!n)return{};let e=lk.get(un(n)),t=$i(n);if(!e&&t)return{resourceType:t,resourceHash:n?await ct(n.toString()):void 0};if(!e)return{};let r=JSON.parse(JSON.stringify(e[0]));return gN(e[0],r),r}function It(n,e,t,r,i){Q2(n).then(o=>{Object.assign(o,r||{}),R(e,t,o,i)}).catch(h)}var wn=!1,Xh=new WeakMap,ck=new Map,Zh,X2=0;function Pn(n){if(!n)return;if(Wn(n)&&!ck.has(n.toString())){let t=mm.workspace.notebookDocuments.find(r=>r.uri.toString()===n.toString());t&&ck.set(n.toString(),new WeakRef(t))}let e=Wn(n)?ck.get(n.toString())?.deref():n;if(e)return Xh.get(e)?.tracker}function Z2(n){let e=new xr;return Zh=n,X2=n.elapsedTime,mm.workspace.notebookDocuments.forEach(t=>Xh.set(t,Y2(t,!0,n))),e.add(mm.workspace.onDidOpenNotebookDocument(t=>{!Xh.has(t)&&!wn&&Xh.set(t,Y2(t,!1,n))})),e.add(mm.workspace.onDidCloseNotebookDocument(t=>{Xh.delete(t),ck.delete(t.uri.toString())})),e}function ej(n){Xh.get(n)?.tracker.kernelManuallySelected()}var uk={starAfter:-1,completedAfter:-1},vN=new Map,tj=new Map,zie=new Map,rj=Kt(()=>(uk.starAfter=Zh?.elapsedTime,{stop:Kt(()=>{uk.completedAfter=Zh.elapsedTime})}));function nj(n,e){vN.set(n,Zh?.elapsedTime),zie.set(n,e||"")}function ij(n){n.executable.uri&&tj.set(n.id,Zh?.elapsedTime)}function Y2(n,e,t){let r=Zh.elapsedTime,i=t.elapsedTime,o={openedAfter:i},s=c=>(c==="executeCell"&&(wn=!0),o[`${c}StartedAfter`]=t.elapsedTime,{stop:Kt(()=>{o[`${c}CompletedAfter`]=t.elapsedTime})}),a={wasAlreadyOpen:e},l=()=>{};return{measures:o,info:a,tracker:{kernelSelected:Kt((c,u)=>{let d=vN.get(c);typeof d=="number"&&(a.wasAlreadyOpen?o.controllerCreatedAfter=vN.get(c):o.controllerCreatedAfter=r-d),o.interpreterDiscoveredAfter=tj.get(u||""),o.kernelSelectedAfter=t.elapsedTime,a.manuallySelectedKernel||Xie(n,{wasAlreadyOpen:a.wasAlreadyOpen},{controllerCreatedAfter:o.controllerCreatedAfter,kernelSelectedAfter:o.kernelSelectedAfter,openedAfter:i,interpreterDiscoveredAfter:o.interpreterDiscoveredAfter})}),kernelManuallySelected:Kt(()=>a.manuallySelectedKernel=!0),cellExecutionCount:wn?l:Kt(c=>o.executeCellCount=c),preExecuteCellTelemetry:wn?l:Kt(()=>s("preExecuteCellTelemetry")),startKernel:wn?l:Kt(()=>s("startKernel")),executeCell:wn?l:Kt(()=>s("executeCell")),executeCellAcknowledged:wn?l:Kt(()=>{o.executeCellAcknowledgedAfter=t.elapsedTime,Qie(n,a,o)}),jupyterSessionTelemetry:wn?l:Kt(()=>s("sessionTelemetry")),postKernelStartup:wn?l:Kt(()=>s("postKernelStart")),computeCwd:wn?l:Kt(()=>s("computeCwd")),getConnection:wn?l:Kt(()=>s("getConnection")),updateConnection:wn?l:Kt(()=>s("updateConnection")),kernelReady:wn?l:Kt(()=>s("kernelReady")),portUsage:wn?l:Kt(()=>s("portUsage")),spawn:wn?l:Kt(()=>s("spawn")),pythonEnvVars:wn?l:Kt(()=>s("pythonEnvVars")),envVars:wn?l:Kt(()=>s("envVars")),interruptHandle:wn?l:Kt(()=>s("interruptHandle")),kernelInfo:wn?l:Kt(()=>s("kernelInfo")),kernelIdle:wn?l:Kt(()=>s("kernelIdle"))}}}var Qie=Kt(function(n,e,t){if(typeof t.preExecuteCellTelemetryStartedAfter!="number"||typeof t.preExecuteCellTelemetryCompletedAfter!="number"||typeof t.executeCellAcknowledgedAfter!="number"||typeof t.startKernelStartedAfter!="number"||typeof t.startKernelCompletedAfter!="number"||typeof t.executeCellStartedAfter!="number"||typeof t.sessionTelemetryStartedAfter!="number"||typeof t.sessionTelemetryCompletedAfter!="number"||typeof t.postKernelStartStartedAfter!="number"||typeof t.postKernelStartCompletedAfter!="number"||typeof t.kernelInfoStartedAfter!="number"||typeof t.kernelInfoCompletedAfter!="number"||typeof t.kernelIdleStartedAfter!="number"||typeof t.kernelIdleCompletedAfter!="number"||typeof t.computeCwdStartedAfter!="number"||typeof t.computeCwdCompletedAfter!="number"||typeof t.kernelReadyStartedAfter!="number"||typeof t.kernelReadyCompletedAfter!="number"||typeof t.getConnectionStartedAfter!="number"||typeof t.getConnectionCompletedAfter!="number"||typeof t.updateConnectionStartedAfter!="number"||typeof t.updateConnectionCompletedAfter!="number"||typeof t.portUsageStartedAfter!="number"||typeof t.portUsageCompletedAfter!="number"||typeof t.spawnStartedAfter!="number"||typeof t.spawnCompletedAfter!="number"||typeof t.pythonEnvVarsStartedAfter!="number"||typeof t.pythonEnvVarsCompletedAfter!="number"||typeof t.envVarsStartedAfter!="number"||typeof t.envVarsCompletedAfter!="number")return;let r={duration:0,preExecuteCellTelemetry:0,startKernel:0,executeCell:0};{let c=[{name:"preExecuteCellTelemetry",start:t.preExecuteCellTelemetryStartedAfter,end:t.preExecuteCellTelemetryCompletedAfter},{name:"startKernel",start:t.startKernelStartedAfter,end:t.startKernelCompletedAfter},{name:"executeCell",start:t.executeCellStartedAfter,end:t.executeCellAcknowledgedAfter}],u=t.executeCellAcknowledgedAfter-t.preExecuteCellTelemetryStartedAfter;r.duration=u,dC(r,c,u,t.openedAfter)}let i={sessionTelemetry:0,postKernelStart:0,computeCwd:0,getConnection:0,updateConnection:0,kernelReady:0,portUsage:0,spawn:0};{let c=[{name:"sessionTelemetry",start:t.sessionTelemetryStartedAfter,end:t.sessionTelemetryCompletedAfter},{name:"postKernelStart",start:t.postKernelStartStartedAfter,end:t.postKernelStartCompletedAfter},{name:"computeCwd",start:t.computeCwdStartedAfter,end:t.computeCwdCompletedAfter},{name:"getConnection",start:t.getConnectionStartedAfter,end:t.getConnectionCompletedAfter},{name:"updateConnection",start:t.updateConnectionStartedAfter,end:t.updateConnectionCompletedAfter},{name:"spawn",start:t.spawnStartedAfter,end:t.spawnCompletedAfter},{name:"portUsage",start:t.portUsageStartedAfter,end:t.portUsageCompletedAfter},{name:"kernelReady",start:t.kernelReadyStartedAfter,end:t.kernelReadyCompletedAfter}],u=t.startKernelCompletedAfter-t.startKernelStartedAfter;dC(i,c,u,t.openedAfter)}let o={startupCode:0,kernelInfo:0,kernelIdle:0};{let c=[{name:"startupCode",start:t.postKernelStartStartedAfter,end:t.kernelInfoStartedAfter},{name:"kernelInfo",start:t.kernelInfoStartedAfter,end:t.kernelInfoCompletedAfter},{name:"kernelIdle",start:t.kernelIdleStartedAfter,end:t.kernelIdleCompletedAfter}],u=t.postKernelStartCompletedAfter-t.postKernelStartStartedAfter;dC(o,c,u,t.openedAfter)}let s={pythonEnvVars:0,envVars:0,interruptHandle:0};{let c=[{name:"pythonEnvVars",start:t.pythonEnvVarsStartedAfter,end:t.pythonEnvVarsCompletedAfter},{name:"envVars",start:t.envVarsStartedAfter,end:t.envVarsCompletedAfter},{name:"interruptHandle",start:t.interruptHandleStartedAfter||0,end:t.interruptHandleCompletedAfter||0}],u=t.spawnCompletedAfter-t.spawnStartedAfter;dC(s,c,u,t.openedAfter)}let a=Yie(n),l={...r,...i,...o,...s,...a};It(n.uri,"DATASCIENCE.NOTEBOOK_FIRST_START_BREAKDOWN",l,e)});function Yie(n){let e={attachmentCharLength:0,attachmentCount:0,codeCellCharLength:0,codeCellCount:0,mdCellCharLength:0,mdCellCount:0,outputCount:0,outputsByteSize:0};return n.getCells().forEach(t=>{let r=t.document.lineAt(t.document.lineCount-1).range.end,i=t.document.offsetAt(r);if(t.kind===mm.NotebookCellKind.Markup){e.mdCellCount+=1,e.mdCellCharLength+=i;try{let s=ld(t).attachments||{};Object.keys(s).forEach(a=>{e.attachmentCount+=1;let l=s[a];typeof l=="object"&&Object.keys(l).forEach(c=>{let u=l[c];u&&typeof u=="string"&&(e.attachmentCharLength+=u.length)})})}catch(o){p.warn("Error parsing attachments in cell metadata",o)}}else e.codeCellCount+=1,e.codeCellCharLength+=i,e.outputCount+=t.outputs.length,e.outputsByteSize+=t.outputs.reduce((o,s)=>o+s.items.reduce((a,l)=>a+l.data.byteLength,0),0)}),e}var Xie=Kt(function(n,e,t){if(t.pythonExtensionActivationStartedAfter=uk.starAfter,t.pythonExtensionActivationCompletedAfter=uk.completedAfter,typeof t.controllerCreatedAfter>"u"||typeof t.interpreterDiscoveredAfter>"u"||typeof t.pythonExtensionActivationCompletedAfter>"u"||typeof t.pythonExtensionActivationStartedAfter>"u")return;let r=[{name:"callPythonApi",start:X2,end:t.pythonExtensionActivationStartedAfter},{name:"activatePython",start:t.pythonExtensionActivationStartedAfter,end:t.pythonExtensionActivationCompletedAfter},{name:"discoverEnv",start:t.pythonExtensionActivationCompletedAfter,end:t.interpreterDiscoveredAfter},{name:"createController",start:t.interpreterDiscoveredAfter,end:t.controllerCreatedAfter},{name:"selectController",start:t.controllerCreatedAfter,end:t.kernelSelectedAfter}],i=t.kernelSelectedAfter-t.openedAfter,o={duration:i};dC(o,r,i,t.openedAfter),It(n.uri,"DATASCIENCE.NOTEBOOK_FIRST_KERNEL_AUTO_SELECTION_BREAKDOWN",o,e)});function dC(n,e,t,r){e.sort((i,o)=>i.start-o.start).forEach(i=>{typeof r=="number"&&r>=i.start&&r<=i.end?n[i.name]=(i.end-r)*100/t:typeof r=="number"&&r>i.end?n[i.name]=0:(typeof r=="number"&&r<i.start||typeof r!="number")&&(n[i.name]=(i.end-i.start)*100/t)})}var dk=require("vscode");function cd(n){return Kr()==="Windows"?cn(n).toUpperCase():cn(n)}function ud(n,e){return cd(n)===cd(e)}function eg(n,e){return e.endsWith(hn)||(e+=hn),n.endsWith(hn)||(n+=hn),cd(n).startsWith(cd(e))}function oj(n,e,t,r){let i=Zie(n,e.environments.known.filter(o=>!t.isPythonEnvironmentExcluded(o)));return i||r.getPythonEnvironment(n.uri)}function Zie(n,e){let t=dk.workspace.getWorkspaceFolder(n.uri)?.uri||(dk.workspace.workspaceFolders?.length===1?dk.workspace.workspaceFolders[0].uri:void 0),r=pk(bi(n.uri),e);if(r)return r;if(t)return pk(t,e)}function pk(n,e){let t=e.filter(r=>eg(r.environment?.folderUri?.fsPath||r.executable.uri?.fsPath||r.path,n.fsPath));return t.find(r=>Ve(r)==="Venv"&&r.environment?.name?.toLowerCase()===".venv")||t.find(r=>Ve(r)==="Conda"&&r.environment?.name?.toLowerCase()===".conda")||t.find(r=>["VirtualEnv","VirtualEnvWrapper"].includes(Ve(r))&&r.environment?.name?.toLowerCase()===".venv")||t.find(r=>r.environment?.name?.toLowerCase()===".venv"||r.environment?.name?.toLowerCase()===".conda")||t.length?t[0]:void 0}function pC(n,e){if(n){let t={...n,uri:ht.Uri.file(n.path||""),id:e||n.id};return delete t.path,t}}function aj(n){let e,t=n.id;if(n.executable.uri)e=n.executable.uri;else if(Ve(n)==="Conda")e=Kr()==="Windows"?ht.Uri.joinPath(n.environment?.folderUri||ht.Uri.file(n.path),"python.exe"):ht.Uri.joinPath(n.environment?.folderUri||ht.Uri.file(n.path),"bin","python");else{p.warn(`Python environment ${U(n.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function fm(n){if(n){let e=Object.assign({},n,{path:Re(n.uri)});return delete e.uri,e}}var tg=class{constructor(e,t){this.disposables=e;this.extensionChecker=t;this.api=re();this.didActivatePython=new ht.EventEmitter;this._pythonExtensionHooked=re();this.extensionChecker.isPythonExtensionInstalled||ht.extensions.onDidChange(async()=>{this.extensionChecker.isPythonExtensionInstalled&&await this.registerHooks()},this,this.disposables),this.disposables.push(this.didActivatePython)}get onDidActivatePythonExtension(){return this.didActivatePython.event}get pythonExtensionHooked(){return this._pythonExtensionHooked.promise}get pythonExtensionVersion(){return this._pythonExtensionVersion}getApi(){return this.init().catch(h),this.api.promise}async getNewApi(){await this.init();let e=ht.extensions.getExtension(Zn);return e?.packageJSON?.version&&(this._pythonExtensionVersion=new sj.SemVer(e?.packageJSON?.version)),e?.exports&&(YV(e.exports),e.exports.environments.known.forEach(t=>{ij(t)})),e?.exports}setApi(e){this.api.resolved||!ht.workspace.isTrusted||this.api.resolve(e)}async init(){if(this.initialized)return;ht.extensions.getExtension(Zn)?await this.registerHooks():await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),this.initialized=!0}async registerHooks(){if(this.hooksRegistered)return;let e=ht.extensions.getExtension(Zn);if(!e)return;let t=!1;if(!e.isActive){let r=rj();try{let i=e.activate();i.then(()=>r.stop(),()=>r.stop()),await i,t=!0}catch(i){p.error("Failed activating the python extension: ",i),this.api.reject(new qP(i));return}}this.hooksRegistered||(this.hooksRegistered=!0,t&&this.didActivatePython.fire(),e.exports?.jupyter?e.exports.jupyter.registerHooks():(p.error("Python extension is not exporting the jupyter API"),this.api.reject(new HP)),this._pythonExtensionHooked.resolve())}};tg=v([(0,Ss.injectable)(),m(0,(0,Ss.inject)(M)),m(1,(0,Ss.inject)($e))],tg);var dd=class{constructor(e){this.disposables=e;this.pythonExtensionInstallationStatusChanged=new ht.EventEmitter;ht.extensions.onDidChange(this.extensionsChangeHandler.bind(this),this,this.disposables),this.previousInstallState=this.isPythonExtensionInstalled}get onPythonExtensionInstallationStatusChanged(){return this.pythonExtensionInstallationStatusChanged.event}get isPythonExtensionInstalled(){return ht.extensions.getExtension(Zn)!==void 0}get isPythonExtensionActive(){return ht.extensions.getExtension(Zn)?.isActive===!0}async directlyInstallPythonExtension(){return ht.commands.executeCommand("workbench.extensions.installExtension",Zn,{context:{skipWalkthrough:!0}})}async showPythonExtensionInstallRequiredPrompt(){if(!ht.workspace.isTrusted)return;dd.promptDisplayed=!0;let e=le.bannerLabelYes;R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"}),await ht.window.showInformationMessage(y.pythonExtensionRequired,{modal:!0},e)===e?(R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"download"}),await this.installPythonExtension()):R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtension(){ht.commands.executeCommand("extension.open",Zn).then(h,h)}async extensionsChangeHandler(){let e=this.isPythonExtensionInstalled;e!==this.previousInstallState&&(this.pythonExtensionInstallationStatusChanged.fire(e?"installed":"uninstalled"),this.previousInstallState=e)}};dd=v([(0,Ss.injectable)(),m(0,(0,Ss.inject)(M))],dd);var rg=class{constructor(e,t,r,i){this.apiProvider=e;this.extensionChecker=t;this.disposables=r;this.context=i;this.didChangeInterpreter=new ht.EventEmitter;this.didChangeInterpreters=new ht.EventEmitter;this._onDidEnvironmentVariablesChange=new ht.EventEmitter;this._onDidRemoveInterpreter=new ht.EventEmitter;this.onDidRemoveInterpreter=this._onDidRemoveInterpreter.event;this.onDidEnvironmentVariablesChange=this._onDidEnvironmentVariablesChange.event;this._status="idle";this._onDidChangeStatus=new ht.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshPromises=new ao;this.onResumeEnvDetection=new ht.EventEmitter;this.workspaceCachedActiveInterpreter=new Set;this.lastLoggedResourceAndInterpreterId="";this.pythonEnvHashes=new Map;this.loggedEnvsWithoutInterpreterPath=new Set;this.pendingInterpreterChangeEventTriggers=new Map;this.pendingInterpretersChangeEventTriggers=new Map;this.extensionChecker.isPythonExtensionInstalled&&!this.extensionChecker.isPythonExtensionActive&&this.apiProvider.onDidActivatePythonExtension(()=>{this.hookupOnDidChangeInterpreterEvent()},this,this.disposables),ht.workspace.onDidGrantWorkspaceTrust(()=>this.refreshInterpreters(!0),this,this.disposables),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this.refreshPromises),this.disposables.push(this.onResumeEnvDetection),this.refreshPromises.onStateChange(()=>{this.status=this.refreshPromises.isComplete?"idle":"refreshing"})}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}initialize(){this.hookupOnDidChangeInterpreterEvent()}async hasWorkspaceSpecificEnvironment(){if(!(ht.workspace.workspaceFolders||[]).length)return!1;let e=await this.getApi();return e?!!(ht.workspace.workspaceFolders||[]).some(t=>pk(t.uri,e.environments.known)):!1}async resolveEnvironment(e){return this.getApi().then(t=>{if(!t)return;let r=typeof e=="string"?t.environments.known.find(i=>i.id===e||i.path===e):e;return t.environments.resolveEnvironment(r||e)})}get onDidChangeInterpreter(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreter.event}get onDidChangeInterpreters(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreters.event}async refreshInterpreters(e=!1){let t=(async()=>{let r=await this.getApi();if(r)try{await r.environments.refreshEnvironments({forceRefresh:e}),this.hookupOnDidChangeInterpreterEvent(),p.debug("Refreshed Environments")}catch{p.error("Failed to refresh the list of interpreters")}})();this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>vi(1e3))),await t}async getActiveInterpreter(e){if(!ht.workspace.isTrusted)return;let t=new Fe;this.hookupOnDidChangeInterpreterEvent(),!e&&ht.workspace.workspaceFolders?.length===1&&(e=ht.workspace.workspaceFolders[0].uri),ht.workspace.workspaceFolders?.length&&(e=(e?ht.workspace.getWorkspaceFolder(e)?.uri:void 0)||ht.workspace.workspaceFolders[0].uri);let r=ys(e),i=this.getApi().then(async o=>{if(!o)return;let s=o.environments.getActiveEnvironmentPath(e),a=await o.environments.resolveEnvironment(s);return this.trackResolvedEnvironment(a)});return i.then(()=>{this.workspaceCachedActiveInterpreter.has(r)||(this.workspaceCachedActiveInterpreter.add(r),R("DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",{duration:t.elapsedTime},{firstTime:!0}))}).catch(o=>{p.warn(`Failed to get active interpreter from Python for workspace ${r}`,o)}),(Un||[ht.ExtensionMode.Development,ht.ExtensionMode.Test].includes(this.context.extensionMode))&&i.then(o=>{let s=`${U(e)}'-${U(o?.id)}`;if(this.lastLoggedResourceAndInterpreterId===s)return;this.lastLoggedResourceAndInterpreterId=s;let a=Ji(o);p.trace(`Active Interpreter ${e?`for '${U(e)}' `:""}is ${U(o?.id)} (${o&&Ve(o)}, '${o?No(o):""}', ${a?.major}.${a?.minor}.${a?.micro})`)}).catch(h),i}getInterpreterHash(e){return this.pythonEnvHashes.get(e)}async getInterpreterDetails(e,t){if(!ht.workspace.isTrusted)throw new Error("Unable to determine active Interpreter as Workspace is not trusted");this.hookupOnDidChangeInterpreterEvent();try{return await this.getApi().then(async r=>{if(!r||t?.isCancellationRequested)return;let i=r.environments.known.find(l=>Wn(e)?Ko(l.executable.uri,e):typeof e=="string"?l.id===e:Ko(ht.Uri.file(l.path),ht.Uri.file(e.path))),o=Wn(e)?U(e):typeof e=="string"?e:U(ht.Uri.file(e.path));if(i){let l=await r.environments.resolveEnvironment(i),c=this.trackResolvedEnvironment(l);return p.ci(`Interpreter details for ${o} from Python is ${JSON.stringify(l)} and our mapping is ${JSON.stringify(c)}`),c}let s=o;if(this.loggedEnvsWithoutInterpreterPath.has(s)||(this.loggedEnvsWithoutInterpreterPath.add(s),p.warn(`No interpreter with path ${o} found in Python API, will convert Uri path to string as Id ${o}`)),t?.isCancellationRequested)return;let a=await r.environments.resolveEnvironment(Wn(e)?e.fsPath:typeof e=="string"?e:e.path);return this.trackResolvedEnvironment(a)})}catch(r){p.warn(`Failed to get Python interpreter details from Python Extension API for ${typeof e=="string"?e:U(Wn(e)?e:ht.Uri.file(e.path))}`,r);return}}trackResolvedEnvironment(e){if(e){let t=wi(e);return t?(hl(t).then(r=>{this.pythonEnvHashes.set(t.id,r)}).catch(h),this.triggerEventIfAllowed("interpretersChangeEvent",t),t):void 0}}triggerEventIfAllowed(e,t){e==="interpreterChangeEvent"?this.pendingInterpreterChangeEventTriggers.set(t?.id||"",t):this.pendingInterpretersChangeEventTriggers.set(t?.id||"",t),this.triggerPendingEvents()}triggerPendingEvents(){this.pendingInterpreterChangeEventTriggers.forEach(t=>this.didChangeInterpreter.fire(t)),this.pendingInterpreterChangeEventTriggers.clear();let e=Array.from(this.pendingInterpretersChangeEventTriggers.values());if(e.length){let t=e.filter(r=>!!r);t.length!==e.length&&t.length===0?this.didChangeInterpreters.fire([]):this.didChangeInterpreters.fire(t)}this.pendingInterpretersChangeEventTriggers.clear()}async getApi(){if(this.extensionChecker.isPythonExtensionInstalled)return this.apiPromise||(this.apiPromise=this.apiProvider.getNewApi()),this.apiPromise}hookupOnDidChangeInterpreterEvent(){this.eventHandlerAdded||this.getApi().then(e=>{!this.eventHandlerAdded&&e&&(this.eventHandlerAdded=!0,e.environments.onDidEnvironmentVariablesChange(t=>{p.debug(`Detected changes to env file ${t.resource?.uri?.path} in PythonApi`),this._onDidEnvironmentVariablesChange.fire()},this,this.disposables),e.environments.onDidChangeActiveEnvironmentPath(()=>{p.trace("Detected change in Active Python environment via Python API"),this.workspaceCachedActiveInterpreter.clear(),this.triggerEventIfAllowed("interpreterChangeEvent",void 0)},this,this.disposables),e.environments.onDidChangeEnvironments(async t=>{if(p.trace(`Python API env change detected, ${t.type} => '${t.env.id}'`),t.type==="remove"){this.triggerEventIfAllowed("interpreterChangeEvent",void 0),this.triggerEventIfAllowed("interpretersChangeEvent",void 0),this._onDidRemoveInterpreter.fire({id:t.env.id});return}let r=wi(lr(t.env));r&&(this.triggerEventIfAllowed("interpreterChangeEvent",r),this.triggerEventIfAllowed("interpretersChangeEvent",r))},this,this.disposables),this.didChangeInterpreters.fire(oo().map(wi).filter(t=>!!t).map(t=>t)))}).catch(h)}};rg=v([(0,Ss.injectable)(),m(0,(0,Ss.inject)(Qt)),m(1,(0,Ss.inject)($e)),m(2,(0,Ss.inject)(M)),m(3,(0,Ss.inject)(Ze))],rg);var ng=require("vscode");function mk(n,e){let t=n.length>0?`?token=${n}`:"";return`${e}${t}`}function fk(n,e,t){return n?t.createSystemVariables(e).resolve(n):e?rt(Re(e)):process.cwd()}async function hk(n,e){let t=y.jupyterSelfCertEnable,r=y.jupyterSelfCertClose,i=await ng.window.showErrorMessage(y.jupyterSelfCertFail(e),{modal:!0},t,r);return i===t?(R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await n.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,ng.ConfigurationTarget.Workspace),!0):(i===r&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}async function gk(n,e){let t=y.jupyterSelfCertEnable,r=y.jupyterSelfCertClose,i=await ng.window.showErrorMessage(y.jupyterExpiredCertFail(e),{modal:!0},t,r);return i===t?(R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await n.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,ng.ConfigurationTarget.Workspace),!0):(i===r&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}function mC(n,e,t,r,i,o,s){let a=e.baseUrl,l=e.token,c=new URL(e.baseUrl).hostname,u=e.authorizationHeader&&Object.keys(e?.authorizationHeader??{}).length>0?e.authorizationHeader:void 0;l&&n.extensionId===Ae&&n.id===xS&&(u=u||{},u.Authorization=u.Authorization||`token ${l}`);let d=u?()=>u:void 0,f={baseUrl:a,appUrl:"",wsUrl:a.replace("http","ws"),fetch:e.fetch,WebSocket:e.WebSocket},g=t.getRequestInit();(!(l===""||l==="null")||d)&&(f={...f,token:l,appendToken:!0});let I=i.getSettings(void 0).allowUnauthorizedRemoteConnection;if(a.startsWith("https")&&I&&r){let A=r.createHttpRequestAgent();g={...g,agent:A}}let{ServerConnection:w}=require("@jupyterlab/services");return f={...f,init:g,WebSocket:e.WebSocket?t.wrapWebSocketCtor(e.WebSocket):t.getWebsocketCtor(void 0,I,d),fetch:e.fetch||t.getFetchMethod(),Request:t.getRequestCtor(void 0,I,d),Headers:t.getHeadersCtor()},{baseUrl:a,providerId:n.id,serverProviderHandle:n,token:l,hostName:c,displayName:e&&e.displayName?e.displayName:mk(l,a),dispose:()=>s?.dispose(),rootDirectory:o,getAuthHeader:d,settings:w.makeSettings(f)}}async function lj(n){let e=Mt(n);return ia(e,"SHA-256")}var eoe=new Set([Ae,"ms-toolsai.vscode-ai","GitHub.codespaces"].map(n=>n.toLowerCase()));function Mt(n){return eoe.has(n.extensionId.toLowerCase())?`${Je.REMOTE_URI}?${Je.REMOTE_URI_ID_PARAM}=${n.id}&${Je.REMOTE_URI_HANDLE_PARAM}=${encodeURI(n.handle)}`:`${Je.REMOTE_URI}?${Je.REMOTE_URI_ID_PARAM}=${n.id}&${Je.REMOTE_URI_HANDLE_PARAM}=${encodeURI(n.handle)}&${Je.REMOTE_URI_EXTENSION_ID_PARAM}=${encodeURI(n.extensionId)}`}async function vk(n){if(!Ha()&&n.interpreter?.uri){let e=n.interpreter.uri.fsPath,t=fl(n.interpreter.uri).fsPath,r=n.id.replace(e,t);return ct(r)}return ct(n.id)}var Cs=class{static fromJSON(e){let t=Object.assign(e,{});switch(t.interpreter&&(t.interpreter=pC(t.interpreter,"")),e.kind){case"startUsingLocalKernelSpec":return pd.create(t);case"connectToLiveRemoteKernel":return fC.create(t);case"startUsingRemoteKernelSpec":return hC.create(t);case"startUsingPythonInterpreter":return Oo.create(t);default:throw new Error(`Invalid object to be deserialized into a connection, kind = ${t.kind}`)}}},fC=class n{constructor(e){this.kind="connectToLiveRemoteKernel";this.kernelModel=e.kernelModel,this.interpreter=e.interpreter,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,bk(this)}static create(e){return new n(e)}updateModel(e){Object.assign(this.kernelModel,e)}getHashId(){return vk(this)}toJSON(){return{id:this.id,kind:this.kind,baseUrl:this.baseUrl,interpreter:fm(this.interpreter),kernelModel:this.kernelModel,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Cs.fromJSON(e)}},pd=class n{constructor(e){this.kind="startUsingLocalKernelSpec";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,bk(this)}static create(e){return new n(e)}getHashId(){return vk(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:fm(this.interpreter),kind:this.kind}}static fromJSON(e){return Cs.fromJSON(e)}},hC=class n{constructor(e){this.kind="startUsingRemoteKernelSpec";this.interpreter=e.interpreter,this.kernelSpec=e.kernelSpec,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,bk(this)}static create(e){return new n(e)}getHashId(){return vk(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:fm(this.interpreter),baseUrl:this.baseUrl,kind:this.kind,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Cs.fromJSON(e)}},Oo=class n{constructor(e){this.kind="startUsingPythonInterpreter";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,bk(this)}static create(e){return new n(e)}getHashId(){return vk(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:fm(this.interpreter),kind:this.kind}}updateInterpreter(e){Object.assign(this.interpreter,e)}static fromJSON(e){return Cs.fromJSON(e)}};function dt(n){return n.kind==="startUsingLocalKernelSpec"||n.kind==="startUsingPythonInterpreter"}function xt(n){return!dt(n)}var we=Symbol("IKernelProvider"),hm=Symbol("IThirdPartyKernelProvider");var yk=Symbol("IJupyterServerConnector"),gC=Symbol("IKernelSessionFactory");var Es=Symbol("IKernelDependencyService"),Dr=Symbol("IKernelFinder"),ig=Symbol("ITracebackFormatter");var Rc=Symbol("IStartupCodeProviders"),cj=new Set;function bk(n){if(cj.has(n.id))return;cj.add(n.id);let e="kernelSpec"in n?n.kernelSpec:void 0,t=e?.language||(n.kind==="startUsingPythonInterpreter"?ge:void 0),r="",i="",o="interpreter"in n?n.interpreter:void 0,s="<#>",a;e&&Array.isArray(e.argv)&&e.argv.length>0&&(r=e.argv[0],a=r.toLowerCase()===o?.uri?.fsPath?.toLowerCase(),Se(r)!==r&&(r=`<P>${Se(r)}`),i=e.argv.map(g=>g.includes("/")||g.includes("\\")?`<P>${Se(g)}`:g).join(s));let l="kernelSpec"in n&&n.kernelSpec.specFile?ct(n.kernelSpec.specFile):Promise.resolve(""),c=ct(n.id),u=xt(n)?ct(Mt(n.serverProviderHandle)):Promise.resolve(""),d=xt(n)?n.serverProviderHandle.extensionId:Ae,f=xt(n)?ct(n.baseUrl.toLowerCase()):Promise.resolve("");Promise.all([l,c,u,f]).then(([g,b,I,w])=>R("DS_INTERNAL.JUPYTER_KERNEL_SPEC",void 0,{kernelId:b,serverIdHash:I,kernelSpecHash:g,baseUrlHash:w,providerExtensionId:d,kernelConnectionType:n.kind,kernelLanguage:t,envType:o&&Ve(o),isArgv0SameAsInterpreter:a,argv0:r,argv:i})).catch(h)}var bm=require("vscode");var boe=k(Cj()),Nc=require("vscode");var md=class{constructor(e,t,r,i){this.specFile=t;this.interpreterPath=r;this.isRegisteredByVSC=i;this.name=e.name,this.argv=e.argv,this.language=e.language,this.executable=e.argv&&e.argv.length>0?e.argv[0]:"",this.display_name=e.display_name,this.metadata=e.metadata,this.env=e.env,this.interrupt_mode=e.interrupt_mode}};var Tn=require("vscode"),Tj=k(SN());var CN=class{constructor(e,t,r,i=!1){this._impl=e;this.controllerId=t;this._endCallback=r;this.clearOutputOnStartWithTime=i;this._started=!1}get started(){return this._started}get cell(){return this._impl.cell}get token(){return this._impl.token}get executionOrder(){return this._impl.executionOrder}set executionOrder(e){e&&Pn(this._impl.cell.notebook)?.executeCellAcknowledged(),this._impl.executionOrder=e}startIfNecessary(){this.started||this._impl.start()}start(e){this.started||(this._started=!0,this._impl.start(e),this._startTime=e,this.clearOutputOnStartWithTime?(p.trace(`Start cell ${this.cell.index} execution @ ${e} (clear output)`),this._impl.clearOutput().then(h,h)):p.trace(`Start cell ${this.cell.index} execution @ ${e}`))}end(e,t){if(this._endCallback)try{this._impl.end(e,t,this.errorInfo),p.trace(`Cell ${this.cell.index} completed in ${((t||0)-(this._startTime||0))/1e3}s (start: ${this._startTime}, end: ${t})`)}finally{this._endCallback(),this._endCallback=void 0}}clearOutput(e){return this.startIfNecessary(),this._impl.clearOutput(e)}replaceOutput(e,t){return this.startIfNecessary(),this._impl.replaceOutput(e,t)}appendOutput(e,t){return this.startIfNecessary(),this._impl.appendOutput(e,t)}replaceOutputItems(e,t){return this.startIfNecessary(),this._impl.replaceOutputItems(e,t)}appendOutputItems(e,t){return this.startIfNecessary(),this._impl.appendOutputItems(e,t)}},ki=class n{static{this._map=new WeakMap}static getOrCreate(e,t,r=!1){let i;if(i=this.get(e),!i)i=n.create(e,t,r);else if(i.controllerId!==t.id){let o=i;o.end(void 0),i=n.create(e,t,r),o.started&&i.start(new Date().getTime())}return i}static get(e){return n._map.get(e)}static create(e,t,r=!1){let i=new CN(t.createNotebookCellExecution(e),t.id,()=>{n._map.delete(e)},r);return n._map.set(e,i),i}};function og(n){return typeof Buffer<"u"&&typeof Buffer.from=="function"?Buffer.from(n,"base64"):Uint8Array.from(atob(n),e=>e.charCodeAt(0))}var moe=new TextDecoder;function Sk(n){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return Buffer.from(n).toString("base64");{let e=moe.decode(n);return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,r){return String.fromCharCode(Number.parseInt("0x"+r))}))}}var kj=["application/vnd.*","application/vdom.*","application/geo+json","application/x-nteract-model-debug+json","text/html","application/javascript","image/gif","text/latex","text/markdown","image/png","image/svg+xml","image/jpeg","application/json","text/plain"];function xj(n){if(n.mime.startsWith("application/vnd."))try{return new TextDecoder().decode(n.data).length===0}catch{}return!1}function foe(n){return n.sort((e,t)=>{let r=(s,a)=>(s.endsWith(".*")&&(s=s.substr(0,s.indexOf(".*"))),a.startsWith(s)),i=kj.findIndex(s=>r(s,e.mime)),o=kj.findIndex(s=>r(s,t.mime));return xj(e)&&(i=-1),xj(t)&&(o=-1),i=i==-1?100:i,o=o==-1?100:o,i-o})}var fd=class n{static{this.cellStates=new WeakMap}static getCellState(e){return n.cellStates.get(e)?.state}static getCellStatus(e){return(n.cellStates.get(e)?.stateTransition||[]).join(", ")||""}static setCellState(e,t){let r=n.cellStates.get(e)?.start||new Fe,i=n.cellStates.get(e)?.stateTransition||[];i.push(`${t} ${i.length===0?"@ start":`After ${r.elapsedTime}ms`}`),n.cellStates.set(e,{stateTransition:i,state:t,start:r})}};function at(n,e){let t=typeof e=="string"?()=>e:e;p.ci(()=>`Cell Index:${n.index}, of document ${dn(n.notebook.uri)} with state:${fd.getCellStatus(n)}, exec: ${n.executionSummary?.executionOrder}. ${t()}. called from ${b2()}`)}var ag=new Map;ag.set("display_data",Ek);ag.set("error",yoe);ag.set("execute_result",Ek);ag.set("stream",hoe);ag.set("update_display_data",Ek);function co(n){let e=ag.get(n.output_type),t;return e?t=e(n):(p.warn(`Unable to translate cell from ${n.output_type} to NotebookCellData for VS Code.`),t=Ek(n)),t}function EN(n){let e={outputType:n.output_type};switch(n.transient&&(e.transient=n.transient),n.output_type){case"display_data":case"execute_result":case"update_display_data":{e.executionCount=n.execution_count,e.metadata=n.metadata?JSON.parse(JSON.stringify(n.metadata)):{};break}default:break}return e}function gm(n){return n.metadata}function Ek(n){let e=EN(n);("image/svg+xml"in n.data||"image/png"in n.data)&&(e.__displayOpenPlotIcon=!0);let t=[];if(n.data)for(let r in n.data)t.push(voe(r,n.data[r]));return new Tn.NotebookCellOutput(foe(t),e)}function hoe(n){let e=bs(n.text),t=n.name==="stderr"?Tn.NotebookCellOutputItem.stderr:Tn.NotebookCellOutputItem.stdout;return new Tn.NotebookCellOutput([t(e)],EN(n))}function goe(n){if(n.items.length>0)return n.items[0].mime==="application/vnd.code.notebook.stderr"?"stderr":"stdout"}function Dj(n){let e=n.items[0];if(!e.data)return{output_type:"error",ename:"",evalue:"",traceback:[]};let t=n.metadata?.originalError,r=JSON.parse(new TextDecoder().decode(e.data));return{output_type:"error",ename:r.name,evalue:r.message,traceback:t?.traceback||Qh(r.stack||r.message||"")}}var sg=new TextDecoder,Rj=["text/plain","text/markdown","application/vnd.code.notebook.stderr","application/vnd.code.notebook.stdout"];function Ck(n,e){if(!e)return"";try{if(n==="application/vnd.code.notebook.error"){let t=sg.decode(e);return JSON.parse(t)}else if(n.startsWith("text/")||Rj.includes(n)){let t=sg.decode(e);return Qh(t)}else{if(n.startsWith("image/")&&n!=="image/svg+xml")return Sk(e);if(n.toLowerCase().startsWith("application/vnd.holoviews_load.v")&&n.toLowerCase().endsWith("+json")){let t=sg.decode(e);try{return t.length>0?JSON.parse(t):t}catch{return t}}else if(n.toLowerCase().includes("json")){let t=sg.decode(e);return t.length>0?JSON.parse(t):t}else return sg.decode(e)}}catch(t){return p.error(`Failed to convert ${n} output from a buffer ${typeof e}, ${e}`,t),""}}function voe(n,e){if(!e)return Tn.NotebookCellOutputItem.text("",n);try{if((n.startsWith("text/")||Rj.includes(n))&&(Array.isArray(e)||typeof e=="string")){let t=Array.isArray(e)?bs(e):e;return Tn.NotebookCellOutputItem.text(t,n)}else return n.startsWith("image/")&&typeof e=="string"&&n!=="image/svg+xml"?new Tn.NotebookCellOutputItem(og(e),n):typeof e=="object"&&e!==null&&!Array.isArray(e)?Tn.NotebookCellOutputItem.text(JSON.stringify(e),n):(e=Array.isArray(e)?bs(e):e,Tn.NotebookCellOutputItem.text(e,n))}catch(t){return p.error(`Failed to convert ${n} output to a buffer ${typeof e}, ${e}`,t),Tn.NotebookCellOutputItem.text("")}}function _j(n){let e=[];n.items.filter(r=>r.mime==="application/vnd.code.notebook.stderr"||r.mime==="application/vnd.code.notebook.stdout").map(r=>sg.decode(r.data)).forEach(r=>{let i=r.split(`
`);e.length&&i.length&&i[0].length>0&&(e[e.length-1]=`${e[e.length-1]}${i.shift()}`);for(let o of i)e.push(o)});for(let r=0;r<e.length-1;r++)e[r]=`${e[r]}
`;return e.length&&e[e.length-1].length===0&&e.pop(),{output_type:"stream",name:goe(n)||"stdout",text:e}}function wN(n){let e=n.metadata,t;switch(e?.outputType){case"error":{t=Dj(n);break}case"stream":{t=_j(n);break}case"display_data":{t={output_type:"display_data",data:n.items.reduce((i,o)=>(i[o.mime]=Ck(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}case"execute_result":{t={output_type:"execute_result",data:n.items.reduce((i,o)=>(i[o.mime]=Ck(o.mime,o.data),i),{}),metadata:e?.metadata||{},execution_count:typeof e?.executionCount=="number"?e?.executionCount:null};break}case"update_display_data":{t={output_type:"update_display_data",data:n.items.reduce((i,o)=>(i[o.mime]=Ck(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}default:{let i=n.items.length===1&&n.items.every(l=>l.mime==="application/vnd.code.notebook.error"),o=n.items.every(l=>l.mime==="application/vnd.code.notebook.stderr"||l.mime==="application/vnd.code.notebook.stdout");if(i)return Dj(n);let s=e?.outputType||(o?"stream":"display_data");R("DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",void 0,{outputType:s});let a;s==="stream"?a=_j(n):s==="display_data"?a={data:{},metadata:{},output_type:"display_data"}:a={output_type:s},e?.metadata&&(a.metadata=e.metadata),n.items.length>0&&(a.data=n.items.reduce((l,c)=>(l[c.mime]=Ck(c.mime,c.data),l),{})),t=a;break}}return t&&e&&e.transient&&(t.transient=e.transient),t}function yoe(n){return n=n||{output_type:"error",ename:"",evalue:"",traceback:[]},new Tn.NotebookCellOutput([Tn.NotebookCellOutputItem.error({name:n?.ename||"",message:n?.evalue||"",stack:(n?.traceback||[]).join(`
`)})],{...EN(n),originalError:n})}async function Aj(n,e,t){let r=!1,i;if(!n)return{changed:r,kernelId:i};n?.language_info?.name||(n.language_info=n.language_info||{name:""});let o;switch(e?.kind){case"connectToLiveRemoteKernel":o=e.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":o=e.kernelSpec.language;break;case"startUsingPythonInterpreter":o=ge;break;default:break}if(n.language_info.name!==o&&o&&(n.language_info.name=o,r=!0),t&&"language_info"in t&&t.language_info)(0,Tj.default)(n.language_info,t.language_info)||(n.language_info=JSON.parse(JSON.stringify(t.language_info)),r=!0);else{let a=nt(e),l=a?Mj(e):void 0,c=await rd(l),u=c?`${c.major}.${c.minor}.${c.micro}`:"";l&&c&&n&&n.language_info&&n.language_info.version!==u?(n.language_info.version=u,r=!0):!l&&n?.language_info&&a&&(n.language_info=void 0,r=!0)}let s=e&&lg(e)?e.kernelModel:e&&"kernelSpec"in e?e.kernelSpec:void 0;if(e?.kind==="startUsingPythonInterpreter"){let a=e.kernelSpec,l=a.display_name||lr(e.interpreter)?.environment?.name||"",c="";switch(Rn(a)){case"registeredByOldVersionOfExt":case"registeredByNewVersionOfExt":c="python3";break;case"registeredByNewVersionOfExtForCustomKernelSpec":{c=(a.metadata?.vscode?.originalSpecFile?Se(rt(a.metadata.vscode.originalSpecFile)):void 0)||a.name,l=a.metadata?.vscode?.originalDisplayName||l;break}default:c=a.name;break}(n.kernelspec?.name!==c||n.kernelspec?.display_name!==l)&&(r=!0,n.kernelspec={name:c,language:ge,display_name:l},"vscode"in n&&delete n.vscode,"interpreter"in n&&delete n.interpreter)}else if(s&&!n.kernelspec){let a=s.metadata?.vscode?.originalSpecFile?Se(rt(s.metadata.vscode.originalSpecFile)):void 0;n.kernelspec={name:a||s.name||s.display_name||"",display_name:s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||""},s.language&&(n.kernelspec.language=s.language),i=s.id,r=!0}else if(s&&n.kernelspec){let l=(s.metadata?.vscode?.originalSpecFile?Se(rt(s.metadata.vscode.originalSpecFile)):void 0)||s.name||s.display_name||"",c=s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||"",u=s.language||s.language||"";(n.kernelspec.name!==l||n.kernelspec.language!==u||n.kernelspec.display_name!==c||i!==s.id)&&(r=!0,n.kernelspec.name=l,n.kernelspec.display_name=c,n.kernelspec.language=u,i=s.id);try{delete n.kernelspec.metadata}catch{}}return{changed:r,kernelId:i}}async function Ac(n,e,t,r){let i=Wh(t);if(!i){let a=ki.get(n);r&&a?.started&&a.end(r?void 0:!1,n.executionSummary?.timing?.endTime);return}ki.get(n)||(r=!0);let o=ki.getOrCreate(n,e),s=o.executionOrder;o.started||(o.start(n.executionSummary?.timing?.startTime),o.executionOrder=n.executionSummary?.executionOrder||s),await o.appendOutput(i),o.end(r?void 0:!1,n.executionSummary?.timing?.endTime)}function Nj(n,e){let t=/Cell\s+In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,r=/Input\s+?In\s*\[(?<executionCount>\d+)\][^<]*<cell line:\s?(?<lineNumber>\d+)>.*/,i;for(let s of n){let a=s.replace(/(?:\u001b\[.+?m)/g,""),l=t.exec(a)??r.exec(a);if(l&&l.groups){i=parseInt(l.groups.lineNumber);break}}let o;if(i&&i>0&&i<=e.document.lineCount){let s=e.document.lineAt(i-1),a=s.text.split("#")[0].trimEnd().length;o=new Tn.Range(new Tn.Position(s.lineNumber,s.firstNonWhitespaceCharacterIndex),new Tn.Position(s.lineNumber,a))}return o}function vC(n){if(n.hasOwnProperty("text/html")){let e=n["text/html"];typeof e=="string"&&e.includes('<iframe id="tensorboard-frame-')&&(n["text/html"]=e.replace(/new URL\((.*), window.location\)/,'new URL("http://localhost")'))}return n}var vm="{connection_file}";function Kj(n){return n.argv.findIndex(e=>e.includes(vm))}var cg="-jvsc-",Ioe=/^python\d*.?\d*$/;async function ws(n,e){return Soe(await DN(n),n,e)}function Soe(n,e,t){let r=e?{path:Re(e.uri)}:{},i={name:n,language:"python",display_name:(e?lr(e)?.environment?.name:"")||"Python 3",metadata:{interpreter:r},argv:["python","-m","ipykernel_launcher","-f",vm],env:{},resources:{}},o=t&&i.name?zt(t,i.name,"kernel.json"):void 0;return new md(i,o?Re(o):void 0,Re(e?.uri),"registeredByNewVersionOfExt")}function Oj(n){let e=JSON.parse(JSON.stringify(n));return e.env&&Object.keys(e.env).forEach(r=>{if(e.env){let i=e.env[r];i!=null&&(e.env[r]=i.toString())}}),e}function wk(n){let e=n?.kernelspec;return n?.language_info?.name&&n.language_info.name!==ge?!1:e?.name?.includes(ge)?!0:e?.language===ge||n?.language_info?.name===ge}function bC(n){let e=n.metadata?.vscode?.originalSpecFile||n.metadata?.originalSpecFile,t=e?Se(rt(e)):n.name||"",r=n.metadata?.vscode?.originalDisplayName||n.display_name||"";return!!(t.toLowerCase().match(Ioe)||r.toLowerCase()==="python 3 (ipykernel)"||r.toLowerCase()==="python 3")}function Coe(n){if(n.includes(cg)){let e=/[a-f0-9]$/;if(n.substring(n.lastIndexOf(cg)+cg.length).search(e)!==-1){let t=n.substring(0,n.lastIndexOf(cg));return t.toLowerCase().endsWith(".ipynb")||t.toLowerCase().endsWith(".py")?t:`${t}.ipynb`}}return n}function Pk(n){return n.kind!=="connectToLiveRemoteKernel"}function lg(n){return n.kind==="connectToLiveRemoteKernel"}function xi(n,e,t){e=PN(n)?e:void 0;let r=n.name,i=Rn(n);if(i&&r.includes(yC)&&(r=r.substring(r.indexOf(yC)),i==="registeredByNewVersionOfExtForCustomKernelSpec")){let c=n.metadata?.vscode?.originalSpecFile||n.metadata?.originalSpecFile;c&&(r=`${r}#${Se(rt(c))}`)}let o="";PN(n)?o=n.argv.slice(1).filter(c=>!["-f","{connection_file}"].includes(c)).join("#").toLowerCase():o=n.argv.join("#").toLowerCase();let s=t?`${t}.`:"",a=Re(fl(n.interpreterPath?Nc.Uri.file(n.interpreterPath):Nc.Uri.file(n.executable))),l=Re(fl(e?.uri))||"";return`${s}${n.id||""}.${r}.${a}.${l}.${o}`}function ot(n){let e=Eoe(n);if(!n)return e;switch(n.kind){case"connectToLiveRemoteKernel":{let r=Coe(n.kernelModel?.notebook?.path||n.kernelModel?.model?.path||"");return r?`${e} (${r})`:e}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":if(n.interpreter&&Ve(n.interpreter)!=="Unknown"){let r=No(n.interpreter);if(n.kernelSpec.language===ge){let i=`Python ${ed(Ji(n.interpreter))||""}`.trim();return r?`${e} (${i})`:e}else return r?`${e} (${r})`:e}else return e;case"startUsingPythonInterpreter":let t=(ed(Ji(n.interpreter))||"").trim();if(n.interpreter&&Ve(n.interpreter)!=="Unknown"){if(n.kernelSpec.display_name&&Rn(n.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return n.kernelSpec.display_name;let r=Jr(n.interpreter),i=t.trim()?`Python ${t}`:"Python",o=No(n.interpreter);return r&&o?o:o?`${o} (${i})`:i}else return`Python ${t}`.trim()}return e}function Eoe(n){if(!n)return"";let e=n.kind==="connectToLiveRemoteKernel"?n.kernelModel.display_name:n.kernelSpec?.display_name,t=n.kind==="connectToLiveRemoteKernel"?n.kernelModel.name:n.kernelSpec?.name,r=n.kind==="startUsingPythonInterpreter"?nn(n.interpreter):void 0;return[e,t,r,""].find(i=>typeof i=="string"&&i.length>0)||""}function ug(n,e=""){return n?n.kind==="connectToLiveRemoteKernel"?n.kernelModel.name:n.kernelSpec?.name:e}function woe(n){if(!n)return;let e=lg(n)?n.kernelModel:void 0,t=Pk(n)?n.kernelSpec:void 0;if(n.kind==="startUsingPythonInterpreter"||(n.kind==="startUsingRemoteKernelSpec"||n.kind==="startUsingLocalKernelSpec")&&n.kernelSpec.language===ge){let r=t?.metadata?.interpreter?.path||t?.interpreterPath||t?.executable;if(r==="/python"||r==="python"){let i=lr(n.interpreter);return i?.environment?.folderUri||(i?Nc.Uri.file(i.path):void 0)}return r?Nc.Uri.file(r):void 0}else{let r=e?.executable||t?.executable||t?.metadata?.interpreter?.path||t?.interpreterPath;return r?Nc.Uri.file(r):void 0}}function kN(n,e=""){if(n?.kind==="connectToLiveRemoteKernel"){let t;if(typeof n.kernelModel.lastActivityTime=="string")try{t=new Date(n.kernelModel.lastActivityTime)}catch(r){p.debug(`Error parsing date ${r}`)}else t=n.kernelModel.lastActivityTime;return y.jupyterSelectLiveRemoteKernelDescription(t,n.kernelModel.numberOfConnections)}return e}function xN(n,e){if(n?.kind==="connectToLiveRemoteKernel")return;let t=woe(n),r=Nc.workspace.workspaceFolders?Nc.workspace.workspaceFolders:[];return t?U(t,r,e.homeDir):""}function Mj(n){if(!n)return;if(n.interpreter)return n.interpreter;let e=lg(n)?n.kernelModel:void 0;if(e?.metadata?.interpreter)return pC(e?.metadata?.interpreter,"");let t=Pk(n)?n.kernelSpec:void 0;return pC(t?.metadata?.interpreter,"")}function dg(n){return n.kind==="startUsingLocalKernelSpec"||n.kind==="startUsingPythonInterpreter"&&n.kernelSpec&&Rn(n.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec"}function nt(n){if(!n)return!1;if(n.kind==="startUsingPythonInterpreter")return!0;let e=lg(n)?n.kernelModel:void 0,t=Pk(n)?n.kernelSpec:void 0;return e?.language===ge||PN(t)}function PN(n){return(n?.language||"").toLowerCase()===ge}function uo(n){if(!n)return;if(n.kind==="startUsingPythonInterpreter")return ge;let e=lg(n)?n.kernelModel:void 0,t=Pk(n)?n.kernelSpec:void 0;return e?.language||Fj(t)}function kk(n){if(!n)return;let e=n.kernelspec;return Fj(e)||n.language_info?.name}function Fj(n){return n?.language}var yC="jvsc74a57bd0";async function DN(n){let t=(ed(Ji(n))||"3").replace(/\./g,""),r=n?`python${t}`:"";return n?`${r}${yC}${await hl(n)}`:"python3"}function Rn(n){if(n.isRegisteredByVSC)return n.isRegisteredByVSC;if(!n.name)return;let e=n.metadata?.vscode?.originalSpecFile||n.metadata?.originalSpecFile,t=e?Se(rt(e)):n.name,r=bC({...n,name:t})?Object.keys(n.env||{}).length>0:typeof e=="string"&&!e.includes(yC);if(n.name.includes(yC))return r?"registeredByNewVersionOfExtForCustomKernelSpec":"registeredByNewVersionOfExt";let i=/[a-f0-9]{32}$/;if(n.metadata?.interpreter&&n.name.toLowerCase().search(i)!==-1)return"registeredByOldVersionOfExt"}function Lj(n,e){return!n&&!e?!0:!n&&e||n&&!e?!1:n?.id===e?.id}async function mn(n,e,t){p.trace(`Executing silently Code (${n.status}) = ${Ue(e.substring(0,100)).join("\\n")}`);let r=require("@jupyterlab/services"),i=n.requestExecute({code:e.replace(/\r\n/g,`
`),silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!1},!0),o=[];i.onIOPub=a=>{if(r.KernelMessage.isStreamMsg(a))if(p.ci(`Got io pub message (stream), ${Ue(a.content.text.substr(0,100)).join("\\n")}`),o.length>0&&o[o.length-1].output_type==="stream"&&o[o.length-1].name===a.content.name){let l=o[o.length-1];l.text+=a.content.text}else{let l={name:a.content.name,text:a.content.text,output_type:"stream"};o.push(l)}else if(r.KernelMessage.isExecuteResultMsg(a)){p.ci("Got io pub message (execresult)}");let l={data:a.content.data,execution_count:a.content.execution_count,metadata:a.content.metadata,output_type:"execute_result"};o.push(l)}else if(r.KernelMessage.isDisplayDataMsg(a)){p.ci("Got io pub message (displaydata)}");let l={data:a.content.data,metadata:a.content.metadata,output_type:"display_data"};o.push(l)}else if(r.KernelMessage.isErrorMsg(a)){if(p.ci(`Got io pub message (error), ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join().substring(0,100)}}`),t?.traceErrors){let c=`${t.traceErrorsMessage||"Failed to execute (silent) code against the kernel"}, 
Code = ${e}
Error details: `;p.error(`${c} ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join()}`)}let l={ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback,output_type:"error"};o.push(l)}else p.ci(`Got io pub message (${a.header.msg_type})`)},await i.done;let s=Ue(e.substring(0,100)).join("\\n");return t&&Poe(o,t,s),p.trace(`Executing silently Code (completed) = ${s} with ${o.length} output(s)`),o}function Uj(n,e,t,r){e=e.replace(/\r\n/g,`
`);let i=require("@jupyterlab/services"),o=n.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!1,store_history:!1},!0),s=Kt(t);return o.onIOPub=a=>{s(),i.KernelMessage.isStreamMsg(a)?r(co({output_type:"stream",name:a.content.name,text:a.content.text})):i.KernelMessage.isExecuteResultMsg(a)?r(co({output_type:"execute_result",data:a.content.data,metadata:a.content.metadata,transient:a.content.transient,execution_count:a.content.execution_count})):i.KernelMessage.isDisplayDataMsg(a)?r(co({output_type:"display_data",data:vC(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isUpdateDisplayDataMsg(a)?r(co({output_type:"display_data",data:vC(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isErrorMsg(a)?r(co({output_type:"error",ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback})):i.KernelMessage.isExecuteInputMsg(a)||i.KernelMessage.isStatusMsg(a)||p.warn(`Got unexpected io pub message when executing code sillenty (${a.header.msg_type})`)},o}function Poe(n,e,t){n.filter(r=>r.output_type==="error").forEach(r=>{let i=r,o=`${i.ename}: ${i.evalue} 
 ${i.traceback.map(a=>`    ${a}`).join(`
`)}`,s=`${e.traceErrorsMessage||""} ${t} ${o}`;e.traceErrors?p.error(s):p.warn(s),e.telemetryName&&R(e.telemetryName)})}var xk="application/vnd.vscode.chat_message",Wj=`
def __VSCODE_inject_module():

    def __VSCODE_call_function(function, callback, data=None):
        __VSCODE_send_chat_message__(function, data, callback=callback)

    def __VSCODE_send_chat_message__(function, data, callback):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        import uuid as __VSCODE_send_chat_message__uuid
        import IPython.display as __VSCODE_send_chat_message__ipython_display

        id = str(__VSCODE_send_chat_message__uuid.uuid4())
        requests[id] = callback
        data_is_none = data is None
        __VSCODE_send_chat_message__ipython_display.display({"${xk}": data}, metadata={"id":id, "function": function, "dataIsNone": data_is_none}, raw=True)

        del __VSCODE_send_chat_message__ipython_display
        del __VSCODE_send_chat_message__uuid

    def __VSCODE_on_chat_message(id, data):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        if id in requests:
            requests[id](data)
            del requests[id]
        else:
            raise NotImplementedError(f"Callback not found for message {id}")

    import sys as __VSCODE_send_chat_message__sys
    import IPython as __VSCODE_send_chat_message__IPython
    chat = type(__VSCODE_send_chat_message__IPython)("chat")
    chat.send_message = __VSCODE_send_chat_message__
    chat.call_function = __VSCODE_call_function
    chat.__on_message = __VSCODE_on_chat_message
    __VSCODE_send_chat_message__sys.modules["vscode"] = type(__VSCODE_send_chat_message__IPython)("vscode")
    __VSCODE_send_chat_message__sys.modules["vscode"].chat = chat
    del __VSCODE_send_chat_message__sys
    del __VSCODE_send_chat_message__IPython


__VSCODE_inject_module()
del __VSCODE_inject_module
`,koe=[[new RegExp("\\\\","g"),"\\\\"],[new RegExp('"',"g"),'\\"'],[new RegExp("'","g"),"'"],[new RegExp("\\\b","g"),"\\b"],[new RegExp("\\f","g"),"\\f"],[new RegExp("\\n","g"),"\\n"],[new RegExp("\\r","g"),"\\r"],[new RegExp("\\t","g"),"\\t"]];function Vj(n,e){let t=IC(e),r=typeof t=="string"?`"${t}"`:"None";return`
import vscode as __vscode
try:
    __vscode.chat.__on_message('${n}', ${r})
finally:
    del __vscode
`}function IC(n){if(typeof n!="string")return n;for(let[e,t]of koe)n=n.replace(e,t);return n}var SC=new WeakMap;function Dk(n,e,t){let i=gm(t)?.transient?.display_id;if(t.metadata?.outputType!=="display_data"||!i)return;let o=SC.get(e)||new Map;SC.set(e,o);let s=o.get(n)||[];o.set(n,s),s.push(i),s.length>1e3&&s.shift()}function jj(n,e){let t=SC.get(n)||new Map;for(let r of t.values())if(r.includes(e))return!0;return!1}function Jj(n,e,t){return((SC.get(e)||new Map).get(n)||[]).includes(t)}function Bj(n,e){let t=SC.get(n)||new Map;for(let r of t.values()){let i=r.indexOf(e);i>=0&&r.splice(i,1)}}var gn=require("vscode");var pg=new Map,$j=new Set,Rk=new gn.EventEmitter;ea(Rk);function qj(n){return Rk.event(n)}async function Hj(n){if(!gn.workspace.isTrusted)return{accessAllowed:!1};if(n===Ae)return{accessAllowed:!0};let e=pg.get(n);return e||(e=xoe(n),pg.set(n,e),e.then(({result:t})=>{(t==="learnMore"||t==="cancelled")&&pg.get(n)===e&&(pg.delete(n),$j.add(n))})),e.then(({result:t})=>({accessAllowed:t==="allowed"}))}async function xoe(n){let e=await _N();if(e.get(n)===!0)return{result:"allowed"};if(e.get(n)===!1)return p.warn(`Kernel API access already revoked for extension ${n}`),{result:"denied"};let t=gn.extensions.getExtension(n)?.packageJSON?.displayName;if(!t)return p.error(`Kernel API access revoked, as extension ${n} does not exist!`),{result:"denied"};let r=gn.l10n.t("Allow"),i=gn.l10n.t("Deny"),o=await gn.window.showInformationMessage(gn.l10n.t("Do you want to grant Kernel access to the extension {0} ({1})?",t,n),{modal:!0,detail:gn.l10n.t("This allows the extension to execute code against Jupyter Kernels.")},r,le.learnMore,i);switch(o===le.learnMore?gn.env.openExternal(gn.Uri.parse("https://aka.ms/vscodeJupyterKernelApiAccess")).then(h,h):(o===r||o===i)&&await Doe(n,o===r),o){case r:return{result:"allowed"};case le.learnMore:return{result:"learnMore"};case i:return p.error(`Kernel API access revoked for extension ${n}`),{result:"denied"};default:return{result:"cancelled"}}}async function Gj(){let n=new Set,[e]=await Promise.all([_N().then(t=>new Map(t)),...Array.from(pg.entries()).map(async([t,r])=>{(await r).result!=="allowed"&&n.add(t)})]);return n.forEach(t=>e.set(t,!1)),$j.forEach(t=>e.set(t,e.get(t)===!0)),e}var _k="API.Access",hd;async function _N(n=!1){let e=ve.instance.get(Ze);if(e.extensionMode===gn.ExtensionMode.Test)return new Map;if(Kt(()=>{ve.instance.get(M).push(e.secrets.onDidChange(i=>{i.key===_k&&(hd=void 0)}))})(),hd&&!n)return hd;let t="";try{return t=await e.secrets.get(_k),!t||t.length===0?new Map:(hd=new Map(Object.entries(JSON.parse(t))),hd)}catch(r){return p.error(`Failed to parse API access information ${t}`,r),new Map}}var Tk=Promise.resolve();async function zj(n){return Tk=Tk.then(async()=>{await Promise.all(Array.from(pg.entries()).map(async([t,r])=>{let i=await r;i.result=n.includes(t)===!0?"allowed":"denied"})),hd=new Map(n.map(t=>[t,!0]));let e=ve.instance.get(Ze);if(e.extensionMode!==gn.ExtensionMode.Test)try{await e.secrets.store(_k,JSON.stringify(Object.fromEntries(hd))),Rk.fire()}catch(t){p.error(`Failed to update API access information ${JSON.stringify(Object.fromEntries(hd))}`,t)}})}async function Doe(n,e){return Tk=Tk.then(async()=>{let t=ve.instance.get(Ze);if(t.extensionMode===gn.ExtensionMode.Test)return;let r=await _N(!0);if(e!==r.get(n)){r.set(n,e);try{await t.secrets.store(_k,JSON.stringify(Object.fromEntries(r))),Rk.fire()}catch(i){p.error(`Failed to store API access information ${JSON.stringify(Object.fromEntries(r))}`,i)}}})}var Qj=" (Interactive)",it=Symbol("IControllerRegistration");var Ak=Symbol("IRemoteNotebookKernelSourceSelector"),Nk=Symbol("ILocalNotebookKernelSourceSelector"),ym=Symbol("ILocalPythonNotebookKernelSourceSelector"),gd=Symbol("IConnectionDisplayData");var po=require("vscode");var TN=class extends Xw{constructor(t,r){super();this.controller=t;this.notebook=r}dispose(){this.disposeExistingExecution()}createReferencedObject(t,...r){return this.existingExecutions||(this.existingExecutions=this.controller.createNotebookExecution(this.notebook),this.existingExecutions.start()),this.existingExecutions}destroyReferencedObject(t,r){this.disposeExistingExecution()}disposeExistingExecution(){try{this.existingExecutions?.end()}catch{}this.existingExecutions=void 0}},Mk=class n{constructor(e,t,r){this.extensionId=e;this.kernel=t;this.executionRefCountedDisposableFactory=r?new TN(r,t.notebook):void 0;let i=po.extensions.getExtension(e)?.packageJSON?.displayName||e;this.notebook=po.workspace.notebookDocuments.find(o=>o.uri.toString()===t.resourceUri?.toString()),this.controllerDisplayName=ot(t.kernelConnectionMetadata),this.title=po.l10n.t("Executing code in {0} from {1}",this.controllerDisplayName,i),this.eventHandler=po.window.onDidChangeVisibleNotebookEditors(this.showProgressImpl,this)}static{this.notificationsPerExtension=new WeakMap}dispose(){this.eventHandler.dispose(),this.disposable?.dispose(),this.executionRefCountedDisposableFactory?.dispose()}show(){let e;try{e=this.executionRefCountedDisposableFactory?.acquire("")}catch{}if(this.deferred&&!this.deferred.completed){let t=this.deferred;this.deferred=re(),t.resolve()}else this.deferred=re(),this.showProgress().catch(h);return this.disposable=new po.Disposable(()=>{e?.dispose(),this.deferred?.resolve()})}async showProgress(){await vi(1e3),!(!this.deferred||this.deferred.completed||this.displayInProgress)&&(this.shouldDisplayProgress=!0,await Promise.all([this.showProgressImpl(),this.waitUntilCompleted()]),this.shouldDisplayProgress=!1)}async showProgressImpl(){let e=n.notificationsPerExtension.get(this.kernel)||new Set;n.notificationsPerExtension.set(this.kernel,e),!e.has(this.extensionId)&&(e.add(this.extensionId),!(!this.notebook||!this.shouldDisplayProgress)&&po.window.visibleNotebookEditors.some(t=>t.notebook===this.notebook)&&(this.displayInProgress=!0,await po.window.withProgress({location:po.ProgressLocation.Notification,title:this.title},async()=>this.waitUntilCompleted()),this.displayInProgress=!1))}async waitUntilCompleted(){let e=this.deferred;for(;e&&!e.completed;)await e.promise,e=this.deferred}};var AN=class extends Error{constructor(){super(bm.l10n.t("Access to Jupyter Kernel has been revoked")),this.name="vscode.jupyter.apiAccessRevoked"}},NN=class n extends $t{constructor(t,r,i,o){super();this.extensionId=t;this.kernel=r;this.execution=i;this._onDidChangeStatus=this._register(new bm.EventEmitter);this._onDidReceiveDisplayUpdate=this._register(new bm.EventEmitter);this.progress=this._register(new Mk(t,r,o)),this._register(la(r.onDisposed)(()=>this.progress.dispose())),this.language=r.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?ge:r.kernelConnectionMetadata.kernelSpec.language||ge,this._register(this.kernel.onStatusChanged(()=>this._onDidChangeStatus.fire(this.kernel.status))),this._register(i.onDidReceiveDisplayUpdate(a=>{let l=this.kernel.session,c=gm(a);c?.outputType==="display_data"&&c?.transient?.display_id&&l&&Jj(this.extensionId,l,c?.transient?.display_id)&&this._onDidReceiveDisplayUpdate.fire(a)}));let s=this;this._api=Object.freeze({language:this.language,get status(){return s.kernel.status},onDidChangeStatus:s.onDidChangeStatus.bind(this),get onDidReceiveDisplayUpdate(){if(![Ae,Ow,Mw].includes(t)&&!Kw.includes(t.split(".")[0]))throw new Error(`Proposed API is not supported for extension ${t}`);return s.onDidReceiveDisplayUpdate.bind(this)},executeCode:(a,l)=>this.executeCode(a,l),executeChatCode:(a,l,c)=>this.executeChatCode(a,l,c)})}get status(){return this.kernel.status}get onDidChangeStatus(){return this._onDidChangeStatus.event}get onDidReceiveDisplayUpdate(){return this._onDidReceiveDisplayUpdate.event}static createApiKernel(t,r,i,o){let s=new n(t,r,i,o);return ve.instance.get(M).push(s),{api:s._api,progress:s.progress}}async checkAccess(){if(this.extensionId===Ae)return;if(this.accessAllowed||(this.accessAllowed=this.doCheckAccess(),this._register(qj(()=>this.accessAllowed=void 0))),!await this.accessAllowed)throw new AN}async doCheckAccess(){let r=(await Hj(this.extensionId)).accessAllowed;return R("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:this.extensionId,pemUsed:"getKernel",accessAllowed:r}),r}async*executeCode(t,r){await this.checkAccess();for await(let i of this.executeCodeInternal(t,void 0,r))yield i}async*executeChatCode(t,r,i){if(await this.checkAccess(),!["ms-vscode.dscopilot-agent",Ae].includes(this.extensionId.toLowerCase()))throw new Error(`Proposed API is not supported for extension ${this.extensionId}`);if(!nt(this.kernel.kernelConnectionMetadata))throw new Error("Chat code execution is only supported for Python kernels");for await(let s of this.executeCodeInternal(t,r,i))yield s}async*executeCodeInternal(t,r={},i){let o=!1,s={executionCount:this.execution.executionCount,requestSentAfter:0,requestAcknowledgedAfter:0,cancelledAfter:0,duration:0},a={kernelId:"",extensionId:this.extensionId,cancelled:!1,requestSent:!1,requestAcknowledged:!1,cancelledBeforeRequestSent:!1,cancelledBeforeRequestAcknowledged:!1,mimeTypes:"",failed:!1},l=new Fe,c=new Set;if(_oe(this.extensionId,this.kernel,"executeCode",s.executionCount).catch(h),this.kernel.disposed)throw a.failed=!0,RN(this.kernel,s,a).catch(h),new Error("Kernel is disposed");if(!this.kernel.session?.kernel)throw a.failed=!0,RN(this.kernel,s,a).catch(h),this.kernel.status==="dead"||this.kernel.status==="terminating"?new Error("Kernel is dead or terminating"):new Error("Kernel connection not available to execute 3rd party code");let u=[];u.push({dispose:()=>{s.duration=l.elapsedTime,a.mimeTypes=Array.from(c).join(","),o=!0,RN(this.kernel,s,a).catch(h)}});let d=ve.instance.get(we).getKernelExecution(this.kernel),f={started:new bm.EventEmitter,executionAcknowledged:new bm.EventEmitter};f.started.event(()=>{a.requestSent=!0,s.requestSentAfter=l.elapsedTime,!i.isCancellationRequested&&this.extensionId!==Ae&&u.push(this.progress.show())},this,u),f.executionAcknowledged.event(()=>{a.requestAcknowledged=!0,s.requestAcknowledgedAfter=l.elapsedTime},this,u),i.onCancellationRequested(()=>{o||(a.cancelled=!0,s.cancelledAfter=l.elapsedTime,a.cancelledBeforeRequestSent=!a.requestSent,a.cancelledBeforeRequestAcknowledged=!a.requestAcknowledged,p.debug(`Code execution cancelled by extension ${this.extensionId}`))},this,u);try{for await(let g of d.executeCode(t,this.extensionId,f,i))if(Dk(this.extensionId,this.kernel.session,g),g.items.forEach(b=>c.add(b.mime)),r&&Yj(g))for await(let b of this.handleChatOutput(g,d,f,c,r,i))yield b;else yield g}finally{z(u)}}async*handleChatOutput(t,r,i,o,s={},a){let l=t.items.find(w=>w.mime===xk);if(!l)return;let c=(t.metadata||{}).metadata,u=c.function,d=c.id,f=c.dataIsNone?void 0:new TextDecoder().decode(l.data),g=s[u];if(!g)throw new Error(`Chat Function ${u} not found`);let b=await g(f),I=Vj(d,b);for await(let w of r.executeCode(I,this.extensionId,i,a))if(w.items.forEach(D=>o.add(D.mime)),Yj(w))for await(let D of this.handleChatOutput(w,r,i,o,s,a))yield D;else yield w}};function Yj(n){return n.items.some(e=>e.mime===xk)}async function _oe(n,e,t,r){let i=await ct(e.id);R("DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",{executionCount:r},{kernelId:i,pemUsed:t,extensionId:n})}async function RN(n,e,t){t.kernelId=await ct(n.id),R("DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",e,t)}function Kk(n,e){let t=ve.instance.get(we),r=ve.instance.get(it).getSelected(e.notebook)?.controller;return NN.createApiKernel(n,e,t.getKernelExecution(e),r)}var mg=k(N());var Ok=Symbol("IReservedPythonNamedProvider"),vd=Symbol("IInterpreterPackages"),Fk=Symbol("IWorkspaceInterpreterTracker");var ca=class{constructor(e){this.workspaceInterpreterTracker=e;ca.isActiveWorkspaceInterpreter=this.isActiveWorkspaceInterpreterImpl.bind(this)}activate(){this.workspaceInterpreterTracker?.activate()}isActiveWorkspaceInterpreterImpl(e,t){return this.workspaceInterpreterTracker?.isActiveWorkspaceInterpreter(e,t)??!1}};ca.isActiveWorkspaceInterpreter=()=>!1,ca=v([(0,mg.injectable)(),m(0,(0,mg.inject)(Fk)),m(0,(0,mg.optional)())],ca);async function qi(n,e){if(!n)return;let t=un(n),[r,i]=lk.get(t)||[{resourceType:$i(n),resourceHash:n?await ct(n.toString()):void 0,kernelSessionId:await ct(Date.now().toString()),capturedEnvVars:void 0,userExecutedCell:void 0,disableUI:void 0,kernelLanguage:void 0,kernelId:void 0,kernelSpecHash:void 0,isUsingActiveInterpreter:void 0,pythonEnvironmentType:void 0,pythonEnvironmentPath:void 0,pythonEnvironmentVersion:void 0,kernelConnectionType:void 0},{previouslySelectedKernelConnectionId:""}];typeof e.capturedEnvVars=="boolean"&&(r.capturedEnvVars=e.capturedEnvVars),e.userExecutedCell&&(r.userExecutedCell=!0),typeof e.disableUI=="boolean"&&(r.disableUI=e.disableUI);let o=e.kernelConnection;if(o){let s=o.id;i.previouslySelectedKernelConnectionId!==s&&(r.userExecutedCell=e.userExecutedCell,r.disableUI=e.disableUI),i.previouslySelectedKernelConnectionId&&i.previouslySelectedKernelConnectionId!==s&&(r.kernelSessionId=await ct(Date.now().toString()));let a;switch(o.kind){case"connectToLiveRemoteKernel":a=o.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":a=o.kernelSpec.language;break;case"startUsingPythonInterpreter":a=ge;break;default:break}let l="kernelSpec"in o&&o.kernelSpec.specFile?ct(o.kernelSpec.specFile):Promise.resolve("");r.kernelLanguage=a,[r.kernelId,r.kernelSpecHash]=await Promise.all([ct(o.id),l]),i.previouslySelectedKernelConnectionId=o.id;let c=o.interpreter;if(c){r.isUsingActiveInterpreter=ca.isActiveWorkspaceInterpreter(n,c),r.pythonEnvironmentType=Ve(c);let[u,d]=await Promise.all([ct(Re(fl(c.uri))),rd(c)]);r.pythonEnvironmentPath=u,hN.set(r.pythonEnvironmentPath,c),d?r.pythonEnvironmentVersion=`${d.major}.${d.minor}.${d.micro}`:r.pythonEnvironmentVersion=void 0,gN(r)}r.kernelConnectionType=r.kernelConnectionType||o?.kind}else i.previouslySelectedKernelConnectionId="";lk.set(t,[r,i])}async function ua(n,e){await qi(n,{kernelConnection:e,userExecutedCell:!0})}var MN=new Map;function Zj(n){return MN.has(n)||MN.set(n,{onDidStart:void 0,kernels:new WeakMap}),MN.get(n)}function Xj(n,e){let t=Zj(e),r=t.kernels.get(n)||Kk(e,n);return t.kernels.set(n,r),r}function e9(n){return{async getKernel(e){let t,r=ve.instance.get(we),i=Lk.workspace.notebookDocuments.find(a=>a.uri.toString()===e.toString()),o=r.get(i||e);if(!o||!o.startedAtLeastOnce||!o.userStartedKernel){R("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:n,pemUsed:"getKernel",accessAllowed:t});return}n!==Ae&&ua(o.resourceUri,o.kernelConnectionMetadata);let{api:s}=Xj(o,n);return s},get onDidStart(){if(![Ae,Mw].includes(n)&&!Kw.includes(n.split(".")[0]))throw new Error(`Proposed API is not supported for extension ${n}`);let e=Zj(n);if(!e.onDidStart){let t=ve.instance.get(we),r=ve.instance.get(M);e.onDidStart=new Lk.EventEmitter,r.push(e.onDidStart,t.onDidPostInitializeKernel(({kernel:i,token:o,waitUntil:s})=>{let{api:a,progress:l}=Xj(i,n);e.onDidStart?.fire({uri:i.uri,kernel:a,token:o,waitUntil:c=>{let u=Xi(Promise.resolve(c));s(c);let d=l.show(),f=new Fe;u.promise.finally(()=>{p.trace(`${n} took ${f.elapsedTime}ms during kernel startup`),It(i.resourceUri,"DATASCIENCE.JUPYTER_NEW_KERNEL_API_KERNEL_STARTUP_WAIT_UNTIL",{duration:f.elapsedTime},{extensionId:n}),d.dispose()})}})}),e.onDidStart)}return e.onDidStart.event}}}var yd=Symbol("JupyterServerHelper"),Uk=Symbol("INotebookImporter"),fg=Symbol("INotebookExporter"),bd=Symbol("IJupyterInterpreterDependencyManager"),hg=Symbol("INbConvertInterpreterDependencyChecker"),Wk=Symbol("INbConvertExportToPythonService"),gg=Symbol("IJupyterServerProvider"),Ht=Symbol("IJupyterServerUriStorage"),Vk=Symbol("IJupyterKernelService"),Id=Symbol("IJupyterRequestAgentCreator"),Mc=Symbol("IJupyterRequestCreator"),jk=Symbol("INotebookStarter"),Im=Symbol("ILiveRemoteKernelConnectionUsageTracker"),Jk=Symbol("IJupyterRemoteCachedKernelValidator"),Vt=Symbol("IJupyterServerProviderRegistry");function Bk(n,e,t,r,i){R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:r,pemUsed:"createJupyterServerCollection"});let s=i.get(Vt).createJupyterServerCollection(r,n,vh(e),t);return{dispose:()=>{s?.dispose()},get id(){return n},set label(l){s.label=vh(l)},get label(){return s.label},set documentation(l){s.documentation=l},get documentation(){return s.documentation},set commandProvider(l){s.commandProvider=l},get commandProvider(){return s.commandProvider}}}var t9=!1;function r9(n,e){if(t9)return;t9=!0,e.get(Qt).setApi(n)}var wd=require("vscode");var vg=k(N());var El=k(N());var Sd=class extends qe{constructor(t,r){super("remotejupyterserveruriprovider",r.message||r.toString());this.serverProviderHandle=t;this.originalError=r}};var Fo=class extends qe{constructor(e){super("jupyterselfcert",e)}static isSelfCertsError(e){return e.message.indexOf("reason: self signed certificate")>=0}};var Sl=class extends qe{constructor(e){super("jupyterselfexpiredcert",e)}static isSelfCertsExpiredError(e){return e.message.indexOf("reason: certificate has expired")>=0}};var Br=Symbol("IDataScienceErrorHandler"),kn=class extends qe{constructor(t,r,i){super(t,r);this.kernelConnectionMetadata=i}},Cl=class extends Gr{constructor(t,r,i){super(t,r);this.kernelConnectionMetadata=i}};var Di=class extends qe{constructor(t,r,i){super("remotejupyterserverconnection",y.remoteJupyterConnectionFailedWithServerWithError(n9(t),i.message||i.toString()));this.url=t;this.serverProviderHandle=r;this.originalError=i;this.baseUrl=n9(t)}};function n9(n){let e=new URL(n);return`${e.protocol}//${e.host}/`}var CC=require("vscode");var i9=require("vscode");var Cd=class n extends Jn{constructor(t){super();this.serverSettings=t;this._isDisposing=!1;this.kernelSpecManager=new this.jupyterlab.KernelSpecManager({serverSettings:this.serverSettings}),this.kernelManager=new this.jupyterlab.KernelManager({serverSettings:this.serverSettings}),this.sessionManager=new this.jupyterlab.SessionManager({serverSettings:this.serverSettings,kernelManager:this.kernelManager}),this.contentsManager=new this.jupyterlab.ContentsManager({serverSettings:this.serverSettings})}get jupyterlab(){return this._jupyterlab||(this._jupyterlab=require("@jupyterlab/services")),this._jupyterlab}static create(t){return new n(t)}dispose(){this.isDisposed||this._isDisposing||(this._isDisposing=!0,(async()=>{p.trace("Disposing Jupyter Lab Helper");try{this.contentsManager&&(p.trace("SessionManager - dispose contents manager"),this.contentsManager.dispose()),this.sessionManager&&!this.sessionManager.isDisposed&&(p.trace("ShutdownSessionAndConnection - dispose session manager"),await br(1e4,this.sessionManager.ready),this.sessionManager.dispose()),this.kernelManager?.isDisposed||this.kernelManager?.dispose(),this.kernelSpecManager?.isDisposed||this.kernelSpecManager?.dispose()}catch(t){p.error("Exception on Jupyter Lab Helper shutdown: ",t)}finally{p.trace("Finished disposing Jupyter Lab Helper")}})().catch(h).finally(()=>super.dispose()))}async getRunningSessions(){if(!this.sessionManager)return[];await br(1e4,this.sessionManager.ready).catch(h),await this.sessionManager.refreshRunning();let t=[],r=this.sessionManager.running(),i=r.next().value;for(;i;)t.push(i),i=r.next().value;return t}async getRunningKernels(){let t=await this.jupyterlab.KernelAPI.listRunning(this.serverSettings),r=new Set;return t.map(i=>{let o=i;return{id:i.id,name:i.name,lastActivityTime:o.last_activity?new Date(Date.parse(o.last_activity.toString())):new Date,numberOfConnections:o.connections?parseInt(o.connections.toString(),10):0}}).filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))}async getKernelSpecs(){if(!this.serverSettings||!this.sessionManager||!this.contentsManager)throw new pn;try{let t=new Fe,r=this.kernelSpecManager;if(!r)return p.error(`No SessionManager to enumerate kernelspecs (no specs manager). Returning a default kernel. Specs ${JSON.stringify(this.kernelSpecManager?.specs?.kernelspecs||{})}.`),R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsManager"}),[await ws()];let i={wasSessionManagerReady:this.sessionManager.isReady,wasSpecsManagerReady:r.isReady,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:r.isReady,waitedForChangeEvent:!1},o=(c={})=>r.specs&&Object.keys(r.specs.kernelspecs).length?r.specs.kernelspecs:c,s=o();await br(1e4,this.sessionManager.ready),i.sessionManagerReady=this.sessionManager.isReady,await br(1e4,r.refreshSpecs()),i.specsManagerReady=r.isReady;let a=!1;if(r&&Object.keys(r.specs?.kernelspecs||{}).length===0){let c=[],u=re(),d=u.resolve.bind(u);r.specsChanged.connect(d),c.push(new i9.Disposable(()=>r.specsChanged.disconnect(d)));let f=Promise.all([u.promise,r.ready,r.refreshSpecs(),this.sessionManager.ready]);await br(1e4,f),i.waitedForChangeEvent=!0,u.completed||(a=!0,R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:r.isReady,reason:r.isReady?this.sessionManager.isReady?"SpecsDidNotChangeInTime":"SessionManagerIsNotReady":"SpecManagerIsNotReady"})),z(c)}let l=o(s);if(Object.keys(l||{}).length){let c=[];return Object.entries(l).forEach(([u,d])=>{d&&c.push(new md(d))}),R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",{duration:t.elapsedTime},i),c}else return p.error(`Jupyter Lab Helper cannot enumerate kernelspecs. Returning a default kernel. Specs ${JSON.stringify(l)}.`),a||R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsEventAfterRefresh"}),[await ws()]}catch(t){return p.error("Jupyter Lab Helper:getKernelSpecs failure: ",t),[]}}};var sn=class{constructor(e,t,r,i,o){this.jupyterPickerRegistration=e;this.configService=t;this.errorHandler=r;this.requestAgentCreator=i;this.requestCreator=o}async createConnectionInfo(e){let t=await this.getJupyterServerUri(e);if(!t)throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`);let r={baseUrl:t.connectionInformation.baseUrl.toString(!0),displayName:t.label,token:t.connectionInformation.token||"",authorizationHeader:t.connectionInformation.headers||{},fetch:t.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:t.connectionInformation.WebSocket};return mC(e,r,this.requestCreator,this.requestAgentCreator,this.configService,CC.Uri.file(""))}async validateRemoteUri(e,t,r){let i;if(!t){let s=await this.getJupyterServerUri(e);if(s)t={baseUrl:s.connectionInformation.baseUrl.toString(!0),displayName:s.label,token:s.connectionInformation.token||"",authorizationHeader:s.connectionInformation.headers||{},fetch:s.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:s.connectionInformation.WebSocket};else throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`)}let o=mC(e,t,this.requestCreator,this.requestAgentCreator,this.configService,CC.Uri.file(""));try{i=Cd.create(o.settings),await Promise.all([i.getRunningKernels(),i.getKernelSpecs()])}catch(s){if(Fo.isSelfCertsError(s)){if(!await hk(this.configService,s.message))throw s}else if(Sl.isSelfCertsExpiredError(s)){if(!await gk(this.configService,s.message))throw s}else throw t&&!r&&await this.errorHandler.handleError(new Di(t.baseUrl,e,s)),s}finally{o.dispose(),i&&i.dispose()}}async getJupyterServerUri(e){let t=new CC.CancellationTokenSource;try{let r=this.jupyterPickerRegistration.jupyterCollections.find(l=>l.extensionId===e.extensionId&&l.id===e.id)||await this.jupyterPickerRegistration.activateThirdPartyExtensionAndFindCollection(e.extensionId,e.id);if(!r)return;let i=await Promise.resolve(r.serverProvider.provideJupyterServers(t.token)),o=i?.find(l=>l.id===e.handle);if(!o&&i?.length===0)try{o=await r.serverProvider.resolveJupyterServer({id:e.handle,label:""},t.token)}catch{}if(!o)return;if(o.connectionInformation)return o;let s=await Promise.resolve(r.serverProvider.resolveJupyterServer(o,t.token));if(!s?.connectionInformation)return;let a=Object.assign({},o);return a.connectionInformation=s.connectionInformation,a}catch(r){throw r instanceof qe?r:new Sd(e,r)}finally{t.dispose()}}};sn=v([(0,El.injectable)(),m(0,(0,El.inject)(Vt)),m(1,(0,El.inject)(ie)),m(2,(0,El.inject)(Br)),m(3,(0,El.inject)(Id)),m(3,(0,El.optional)()),m(4,(0,El.inject)(Mc))],sn);var da=class{constructor(e,t,r){this.serverUriStorage=e;this.jupyterConnection=t;this.serverProviderRegistry=r}async addJupyterServer(e){if(e.extensionId.toLowerCase()!=qa.toLowerCase())throw new Error("Deprecated API");try{await this.jupyterConnection.validateRemoteUri(e)}catch(t){p.error(`Error in validating the Remote Uri ${e.id}.${e.handle}`,t);return}this.serverProviderRegistry.jupyterCollections.some(t=>t.extensionId===e.extensionId)||await this.serverUriStorage.add(e)}};da=v([(0,vg.injectable)(),m(0,(0,vg.inject)(Ht)),m(1,(0,vg.inject)(sn)),m(2,(0,vg.inject)(Vt))],da);var o9=k(N()),wl=require("vscode");var Ed=require("vscode");function er(n,e=!1){return typeof n!="object"||!n?!1:!!(n instanceof Ed.CancellationError||e&&(n.message.includes("Canceled")||n.message.includes(le.canceled)))}async function tr(n,e,...t){let r;return Fw(e)?(t.push(e),r=void 0):r=e,n?n.isCancellationRequested?r:new Promise((i,o)=>{if(n.isCancellationRequested)return i(r);let s=n.onCancellationRequested(()=>{s.dispose(),i(r)});Promise.race(t).then(i,o).finally(()=>s.dispose())}):await Promise.race(t)}async function rr(n,...e){if(!n)return Promise.race(e);if(n.isCancellationRequested)throw new Ed.CancellationError;return new Promise((t,r)=>{if(n.isCancellationRequested)return r(new Ed.CancellationError);let i=n.onCancellationRequested(()=>{i.dispose(),r(new Ed.CancellationError)});Promise.race(e).then(t,r).finally(()=>i.dispose())})}function yg(...n){let e=new Ed.CancellationTokenSource,t=[];for(let i of n)i&&(i.isCancellationRequested&&e.cancel(),i.onCancellationRequested(()=>e.cancel(),void 0,t));let r=e.dispose.bind(e);return e.dispose=()=>{r(),z(t)},e}var vn;(e=>{function n(t){if(t?.isCancellationRequested)throw new Ed.CancellationError}e.throwIfCanceled=n})(vn||={});function s9(n){let e=new Map,t=(a,l)=>{if(!e.has(a)){let c={id:a,label:l.displayName,connectionInformation:{baseUrl:wl.Uri.parse(l.baseUrl),token:l.token,fetch:l.fetch,headers:l.authorizationHeader,WebSocket:l.WebSocket}};e.set(a,{serverUri:l,server:c})}return e.get(a).server},r=new wl.EventEmitter,i={async provideJupyterServers(a){let l=n.getHandles?await rr(a,n.getHandles()):[];return!l||l.length===0?[]:rr(a,Promise.all(l.map(c=>n.getServerUri(c).then(u=>t(c,u)))))},resolveJupyterServer(a,l){return a},onDidChangeServers:r.event};if(!n.handleQuickPick||!n.getQuickPickEntryItems)return{serverProvider:i};let o=new Map;return{serverProvider:i,commandProvider:{async handleCommand(a,l){let c=o.get(a.label);if(!c||!n.handleQuickPick)return;let u=await rr(l,n.handleQuickPick(c,!0));if(u==="back")return;if(!u)throw new wl.CancellationError;let d=await n.getServerUri(u);return t(u,d)},async provideCommands(a,l){return n.getQuickPickEntryItems?(await rr(l,Promise.resolve(n.getQuickPickEntryItems()))).map(u=>{let d={label:vh(u.label),canBeAutoSelected:u.default,description:vh(u.description)};return o.set(d.label,u),d}):[]}}}}var KN=class extends Jn{constructor(t,r,i,o){super();this.extensionId=t;this.id=r;this.label=i;this.serverProvider=o;this._onDidChangeProvider=new wl.EventEmitter;this.onDidChangeProvider=this._onDidChangeProvider.event}set commandProvider(t){this._commandProvider=t,this._onDidChangeProvider.fire()}get commandProvider(){return this._commandProvider}},bg=class extends $t{constructor(){super();this._onDidChangeCollections=new wl.EventEmitter;this._collections=new Map;ve.instance.get(M).push(this)}get onDidChangeCollections(){return this._onDidChangeCollections.event}get jupyterCollections(){return Array.from(this._collections.values())}async activateThirdPartyExtensionAndFindCollection(t,r){return await this.loadExtension(t,r).catch(h),this.jupyterCollections.find(i=>i.extensionId===t&&i.id===r)}async loadExtension(t,r){if(t===Ae)return;let i=wl.extensions.getExtension(t);if(!i)throw new Error(`Extension '${t}' that provides Jupyter Server '${r}' not found`);i.isActive||await i.activate().then(h,h)}createJupyterServerCollection(t,r,i,o){let s=`${t}#${r}`;if(this._collections.has(s)&&t!==Ae)throw new Error(`Jupyter Server Provider with id ${s} already exists`);let a=new KN(t,r,i,o);return this._collections.set(s,a),this._onDidChangeCollections.fire({added:[a],removed:[]}),this._register(a.onDidDispose(()=>{this._collections.delete(s),this._onDidChangeCollections.fire({removed:[a],added:[]})},this)),a}};bg=v([(0,o9.injectable)()],bg);var $k=Symbol("IExportedKernelServiceFactory");function Toe(n,e){return new Promise(t=>{e.onDidChange(r=>{for(let i of r.added)xt(i.connection)&&i.connection.serverProviderHandle.id===n.id&&i.connection.serverProviderHandle.handle===n.handle&&t()})})}function a9(n,e){let t=e.get(sa),r=n.id.startsWith("_builtin")?Ae:t.determineExtensionFromCallStack().extensionId;if(p.error(`The API registerRemoteServerProvider has being deprecated and will be removed soon, please use createJupyterServerCollection (extension ${r}).`),r.toLowerCase()!=qa.toLowerCase())throw new Error("Deprecated API");R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:r,pemUsed:"registerRemoteServerProvider"});let{serverProvider:i,commandProvider:o}=s9(n),s=Bk(n.id,n.displayName||n.detail||n.id,i,r,e);return o&&(s.commandProvider=o),{dispose:()=>{s.dispose()}}}function l9(n){return n.then(()=>void 0).catch(e=>(p.error("Failure during activation.",e),Promise.reject(e)))}function c9(n){let e=n.get(sa);return R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:e.determineExtensionFromCallStack().extensionId,pemUsed:"registerRemoteServerProvider"}),n.get($k).getService()}async function u9(n,e,t){let r=t.get(sa);p.error("The API addRemoteJupyterServer has being deprecated and will be removed soon, please use createJupyterServerCollection.");let i=r.determineExtensionFromCallStack().extensionId;if(i.toLowerCase()!=qa.toLowerCase())throw new Error("Deprecated API");R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:i,pemUsed:"addRemoteJupyterServer"});let o=t.get(da),s=t.get(it),a=Toe({id:n,handle:e},s);await o.addJupyterServer({id:n,handle:e,extensionId:i}),await a}async function d9(n,e,t){let r=t.get(sa);R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:r.determineExtensionFromCallStack().extensionId,pemUsed:"openNotebook"});let i=t.get(it),o=typeof e=="string"?e:void 0,s=typeof e=="string"?void 0:e,a=o&&i.all.find(c=>c.id===e)?.id;if(!a&&s&&!Ha()&&(a=i.all.find(c=>c.kind==="startUsingPythonInterpreter"&&c.interpreter.id===s.id)?.id,!a)){let u=await t.get(ym).getKernelConnection(s);a=u&&i.all.find(d=>d.id===u?.id)?.id}if(!a)throw new Error(`Kernel ${e} not found.`);let l=wd.window.activeNotebookEditor?.notebook?.uri?.toString()===n.toString()?wd.window.activeNotebookEditor:await wd.window.showNotebookDocument(await wd.workspace.openNotebookDocument(n));return await wd.commands.executeCommand("notebook.selectKernel",{notebookEditor:l,id:a,extension:Ae}),l.notebook}var An=Symbol("INotebookEditorProvider"),Ig=Symbol("INotebookPythonEnvironmentService");function p9(n,e,t,r){let i=t.get(sa),o=t.get(Ig),s={ready:l9(n),registerPythonApi:a=>r9(a,t),registerRemoteServerProvider:a=>a9(a,t),getKernelService:()=>c9(t),addRemoteJupyterServer:(a,l)=>u9(a,l,t),openNotebook:async(a,l)=>d9(a,l,t),createJupyterServerCollection:(a,l,c)=>Bk(a,l,c,i.determineExtensionFromCallStack().extensionId,t),get kernels(){return e9(i.determineExtensionFromCallStack().extensionId)},onDidChangePythonEnvironment:o.onDidChangeEnvironment,getPythonEnvironment(a){return o.getPythonEnvironment(a)}};return(kr()||r.extensionMode===ON.ExtensionMode.Development||r.extensionMode===ON.ExtensionMode.Test)&&(s.serviceContainer=t,s.serviceManager=e),s}var m9=require("vscode"),f9={codeLoadingTime:0,endActivateTime:0,startActivateTime:0,totalActivateTime:0,workspaceFolderCount:0};function h9(n,e){if(!kr())try{n.endActivateTime=e.elapsedTime,n.totalActivateTime=e.elapsedTime,Object.assign(f9,n),v9(n),R("EXTENSION.LOAD",n)}catch(t){p.error("sendStartupTelemetry() failed.",t)}}function g9(n,e,t){try{let r={};e.endActivateTime=t.elapsedTime,e.totalActivateTime=t.elapsedTime,Object.assign(f9,e),v9(e),R("EXTENSION.LOAD",e,r,n)}catch(r){p.error("sendErrorTelemetry() failed.",r)}}function v9(n){let e=m9.workspace.workspaceFolders?.length??0;n.workspaceFolderCount=e}var qk=Symbol("IExtensionActivationManager"),me=Symbol("IExtensionSyncActivationService");var Kc=k(N());var Pl=Symbol("IEnvironmentVariablesService"),kl=Symbol("ICustomEnvironmentVariablesProvider");var et=Symbol("IInterpreterService");var zk=k(N()),xl=require("vscode");var Roe={JupyterSessionWaitForIdleSession:y.waitingForJupyterSessionToBeIdle,KernelsGetKernelForRemoteConnection:y.gettingListOfKernelsForRemoteConnection,KernelsGetKernelSpecs:y.gettingListOfKernelSpecs,KernelsRegisterKernel:y.registeringKernel,NotebookConnect:y.connectingToJupyter,NotebookStart:y.startingJupyterNotebook,InstallingMissingDependencies:y.installingMissingDependencies,ExportNotebookToPython:y.exportNotebookToPython,PerformingExport:y.performingExport};function Gk(n){return Roe[n]}var lt=class{constructor(e){this.kernelResourceProgressReporter=new Map;e.push(this),lt.instance=this}activate(){}dispose(){z(Array.from(lt.disposables))}static createProgressReporter(e,t,r){if(!lt.instance)return new xl.Disposable(h);let i=e?un(e):"";return lt.instance.kernelResourceProgressReporter.has(i)?lt.reportProgress(e,t):lt.createProgressReporterInternal(i,t,r)}static wrapAndReportProgress(e,t,r){let i=e?un(e):"";if(!lt.instance)return r();let o=lt.reportProgressInternal(i,t);return r().finally(()=>o?.dispose())}static reportProgress(e,t){let r=Gk(t)||t,i=e?un(e):"";return r?lt.reportProgressInternal(i,r||""):new xl.Disposable(()=>h)}static reportProgressInternal(e,t){if(!lt.instance)return new xl.Disposable(h);let r=lt.instance.kernelResourceProgressReporter.get(e);if(r||(r={title:t,pendingProgress:[],progressList:[],dispose:h},lt.instance.kernelResourceProgressReporter.set(e,r)),r.reporter)r.progressList.push(t),r.reporter.report({message:t});else{if(r.progressList.includes(t))return new xl.Disposable(h);r.pendingProgress.push(t)}return{dispose:()=>{try{if(!r)return;let i=r.progressList.findIndex(o=>o===t);if(i>=0&&r.progressList.splice(i),r.progressList.length>0){let o=r.progressList[r.progressList.length-1];r.reporter&&r.reporter.report({message:o===r.title&&r.reporter?"":o})}else lt.instance.kernelResourceProgressReporter.delete(e),r.dispose()}catch(i){p.error(`Failed to dispose Progress reporter for ${e}`,i)}}}}static createProgressReporterInternal(e,t,r){let i=re(),o=new xl.Disposable(()=>i.resolve()),s=lt.instance.kernelResourceProgressReporter.get(e)||{title:t,pendingProgress:[],progressList:[],tokenSources:[],dispose:()=>{o.dispose()}},a=!1,l=()=>{a||(a=!0,xl.window.withProgress({location:xl.ProgressLocation.Notification,title:t},async(c,u)=>{let d=lt.instance.kernelResourceProgressReporter.get(e);if(d){for(d.reporter=c;d.pendingProgress.length>0;){let f=d.pendingProgress.shift();f===t?d.progressList.push(f):f!==t&&f&&(d.progressList.push(f),c.report({message:f}))}await tr(u,i.promise),lt.instance.kernelResourceProgressReporter.get(e)===d&&lt.instance.kernelResourceProgressReporter.delete(e),lt.disposables.delete(o)}}).then(h,h))};return lt.instance.kernelResourceProgressReporter.set(e,{...s,dispose:()=>o.dispose(),show:l}),lt.disposables.add(o),s.pendingProgress.push(t),r||l(),{dispose:()=>o.dispose(),show:l}}};lt.disposables=new Set,lt=v([(0,zk.injectable)(),m(0,(0,zk.inject)(M))],lt);var Sg=k(N()),Qk=require("vscode");var wr=Symbol("IPlatformService"),tt=Symbol("IFileSystem");var ake=Symbol("IBufferDecoder"),mo=Symbol("IProcessServiceFactory"),EC=class extends qe{constructor(e){super("unknown",e)}};var FN=class{constructor(e,t){this.uri=e;this.value=t}};function Aoe(n){return Array.isArray(n)}var Noe,fo=class n{constructor(e,t){this[Noe]="ResourceMap";if(e instanceof n)this.map=new Map(e.map),this.toKey=t??n.defaultToKey;else if(Aoe(e)){this.map=new Map,this.toKey=t??n.defaultToKey;for(let[r,i]of e)this.set(r,i)}else this.map=new Map,this.toKey=e??n.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,t){return this.map.set(this.toKey(e),new FN(e,t)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(let[,r]of this.map)e(r.value,r.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(Noe=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},Moe,Dl=class{constructor(e,t){this[Moe]="ResourceSet";!e||typeof e=="function"?this._map=new fo(e):(this._map=new fo(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((r,i)=>e.call(t,i,i,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(Moe=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var Koe,y9=class{constructor(){this[Koe]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=0){let r=this._map.get(e);if(r)return t!==0&&this.touch(r,t),r.value}set(e,t,r=0){let i=this._map.get(e);if(i)i.value=t,r!==0&&this.touch(i,r);else{switch(i={key:e,value:t,next:void 0,previous:void 0},r){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let r=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this,t=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.key,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}values(){let e=this,t=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.value,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}entries(){let e=this,t=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:[r.key,r.value],done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}[(Koe=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,r=this.size;for(;t&&r>e;)this._map.delete(t.key),t=t.next,r--;this._head=t,this._size=r,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,r=e.previous;if(!t||!r)throw new Error("Invalid list");t.previous=r,r.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;let r=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(r.previous=i,i.next=r),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;let r=e.next,i=e.previous;e===this._head?(r.previous=void 0,this._head=r):(r.previous=i,i.next=r),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,r)=>{e.push([r,t])}),e}fromJSON(e){this.clear();for(let[t,r]of e)this.set(t,r)}};var _l=class{constructor(e,t,r){this.processFactory=e;this.platform=t;this.fs=r;this.userSitePaths=new fo}async getExecutablesPath(e){let t=e.executable.uri;if(!(Ve(e)!=="Unknown"||!t)){if(!this.userSitePaths.has(t)){let r=this.getUserSitePathImpl(t);r.catch(()=>{this.userSitePaths.get(t)===r&&this.userSitePaths.delete(t)}),this.userSitePaths.set(t,r)}return this.userSitePaths.get(t)}}async getUserSitePathImpl(e){let t=await this.processFactory.create(void 0),r="USER_BASE_VALUE",i=this.platform.isWindows?"USER_SITE":"USER_BASE",{stdout:o}=await t.exec(e.fsPath,["-c",`import site;print("${r}");print(site.${i});print("${r}");`]);if(o.includes(r)){let s=o.substring(o.indexOf(r)+r.length,o.lastIndexOf(r)).trim(),a=Qk.Uri.file(s),l;if(this.platform.isWindows?l=Qk.Uri.joinPath(bi(a),"Scripts"):l=Qk.Uri.joinPath(a,"bin"),!l||!this.fs.exists(l))throw new Error(`USER_SITE ${l.fsPath} dir does not exist for the interpreter ${U(e)}`);return p.trace(`USER_SITE for ${U(e)} is ${l.fsPath}`),l}else throw new Error(`USER_SITE not found for the interpreter ${U(e)}. Stdout: ${o}`)}};v([qr()],_l.prototype,"getExecutablesPath",1),_l=v([(0,Sg.injectable)(),m(0,(0,Sg.inject)(mo)),m(1,(0,Sg.inject)(wr)),m(2,(0,Sg.inject)(tt))],_l);var LN=require("vscode");var b9=6e4,Pd=class{constructor(e,t,r,i,o,s){this.interpreterService=e;this.customEnvVarsService=t;this.apiProvider=r;this.extensionChecker=i;this.envVarsService=o;this.globalExecPaths=s;this.disposables=[];this.activatedEnvVariablesCache=new Map;this.cachedEnvVariables=new Map;this.customEnvVarsService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables),this.interpreterService.onDidChangeInterpreter(this.clearCache,this,this.disposables),this.interpreterService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables)}clearCache(){this.activatedEnvVariablesCache.clear(),this.cachedEnvVariables.clear()}dispose(){this.disposables.forEach(e=>e.dispose())}async getActivatedEnvironmentVariables(e,t,r){let i=y.activatingPythonEnvironment(nn(t));return lt.wrapAndReportProgress(e,i,async()=>this.getActivatedEnvironmentVariablesImplWithCaching(e,t.id,r))}async getActivatedEnvironmentVariablesImplWithCaching(e,t,r){let i=await this.interpreterService.resolveEnvironment(t);if(!i){p.warn(`Failed to resolve environment for ${t}`);return}let o=`${e?.toString()||""}${t}`,s=this.activatedEnvVariablesCache.get(o);if(s&&s.time.elapsedTime>=b9&&this.activatedEnvVariablesCache.delete(o),!this.activatedEnvVariablesCache.has(o)){let l=this.getActivatedEnvironmentVariablesImpl(e,i,r);l.catch(h),this.activatedEnvVariablesCache.set(o,{promise:l,time:new Fe})}let a=this.activatedEnvVariablesCache.get(o).promise;return r?a:tr(r,a)}async getActivatedEnvironmentVariablesImpl(e,t,r){if(!this.extensionChecker.isPythonExtensionInstalled)return;let i=new Fe;return this.getActivatedEnvironmentVariablesFromPython(e,t,r).then(o=>{if(!r?.isCancellationRequested)return o}).catch(o=>{p.error(`Failed to get env vars with python ${U(t.id)} in ${i.elapsedTime}ms`,o)})}async getActivatedEnvironmentVariablesFromPython(e,t,r){let i=`${e?.toString()||""}${t.id||""}`,o=this.cachedEnvVariables.get(i);if(o&&o.lastRequestedTime.elapsedTime>b9&&this.cachedEnvVariables.delete(i),!this.cachedEnvVariables.has(i)){let s=this.getActivatedEnvironmentVariablesFromPythonImpl(e,t,r);this.cachedEnvVariables.set(i,{promise:s,lastRequestedTime:new Fe})}return tr(r,this.cachedEnvVariables.get(i).promise)}async getActivatedEnvironmentVariablesFromPythonImpl(e,t,r){e=e||(LN.workspace.workspaceFolders?.length?LN.workspace.workspaceFolders[0].uri:void 0);let i=new Fe,o=this.customEnvVarsService.getEnvironmentVariables(e,"RunPythonCode").catch(()=>{}),s="emptyVariables",a,l=await this.apiProvider.getApi().then(u=>u.getActivatedEnvironmentVariables(e,t,!1).catch(d=>{p.error(`Failed to get activated env variables from Python Extension for ${U(t.path)}`,d),s="failedToGetActivatedEnvVariablesFromPython"}));if(r?.isCancellationRequested)return;let c=Ve(t);if(R("DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",{duration:i.elapsedTime},{envType:c,source:"python",failed:Object.keys(l||{}).length===0,reason:s},a),l?p.debug(`Got env vars from Python Ext in ${i.elapsedTime}ms for ${U(t.path)}, with env var count ${Object.keys(l||{}).length}.`):c==="Conda"?p.error(`Failed to get activated conda env vars for ${U(t.path)}
                 in ${i.elapsedTime}ms`):p.warn(`Failed to get activated env vars for ${U(t.path)} in ${i.elapsedTime}ms`),!l){let u=await o;if(l={},Ve(t)==="Conda"){let I=await oa(t);I?l.CONDA_PREFIX=I:p.warn(`Failed to get the SysPrefix for the Conda Environment ${U(t.path)}}`)}this.envVarsService.mergeVariables(process.env,l),this.envVarsService.mergeVariables(u,l),this.envVarsService.mergePaths(process.env,l),process.env.PYTHONPATH&&(l.PYTHONPATH=process.env.PYTHONPATH);let d=u?Object.keys(u).find(I=>I.toLowerCase()=="path"):void 0;d&&u[d]&&this.envVarsService.appendPath(l,u[d]),u.PYTHONPATH&&this.envVarsService.appendPythonPath(l,u.PYTHONPATH);let f=await this.globalExecPaths.getExecutablesPath(t).catch(h);if(r?.isCancellationRequested)return;let g=l.PATH||l.Path,b=g?g.split(jn):[];f&&b[1]!==f.fsPath?(p.trace(`Prepend PATH with user site path for ${U(t.path)}, user site ${f.fsPath}`),this.envVarsService.prependPath(l,f.fsPath)):Jr(t)||p.error(`Unable to determine site packages path for python ${U(t.path)} (${Ve(t)})`),!l.PATH&&l.Path&&(l.PATH=l.Path)}return t.executable.uri&&(p.trace(`Prepend PATH with python bin for ${U(t.path)}`),this.envVarsService.prependPath(l,rt(t.executable.uri.fsPath))),l}};v([ti("Getting activated env variables",1),m(1,Dc("id"))],Pd.prototype,"getActivatedEnvironmentVariablesImpl",1),v([m(1,Dc("id")),m(2,od())],Pd.prototype,"getActivatedEnvironmentVariablesFromPython",1),Pd=v([(0,Kc.injectable)(),m(0,(0,Kc.inject)(et)),m(1,(0,Kc.inject)(kl)),m(2,(0,Kc.inject)(Qt)),m(3,(0,Kc.inject)($e)),m(4,(0,Kc.inject)(Pl)),m(5,(0,Kc.inject)(_l))],Pd);var Ps=Symbol("IEnvironmentActivationService");var Eg=k(N()),wg=require("vscode");var Cg=class{constructor(e,t,r){this.disposables=e;this.extensionChecker=t;this.pythonApi=r;this._changed=new wg.EventEmitter;this._registered=!1;wg.window.onDidChangeActiveNotebookEditor(()=>{this._changed.fire()},this,e)}activate(){this.extensionChecker.isPythonExtensionActive?this.registerStatusFilter():this.pythonApi.onDidActivatePythonExtension(this.registerStatusFilter,this,this.disposables)}get changed(){return this._changed.event}get hidden(){return!!(wg.window.activeNotebookEditor&&Pt(wg.window.activeNotebookEditor.notebook))}registerStatusFilter(){this._registered||(this._registered=!0,this.pythonApi.getApi().then(e=>{e.registerInterpreterStatusFilter&&(e.registerInterpreterStatusFilter(this),this._changed.fire())}).catch(h))}};Cg=v([(0,Eg.injectable)(),m(0,(0,Eg.inject)(M)),m(1,(0,Eg.inject)($e)),m(2,(0,Eg.inject)(Qt))],Cg);function I9(n){n.addSingleton(Qt,tg),n.addSingleton($e,dd),n.addSingleton(et,rg),n.addSingleton(me,Cg),n.addSingleton(Ps,Pd)}var S9=k(N());var wC=require("vscode");var Pg=class{activate(){wC.commands.registerCommand("jupyter.reloadVSCode",this.onReloadVSCode,this)}async onReloadVSCode(e){await wC.window.showInformationMessage(e,le.reload)===le.reload&&wC.commands.executeCommand("workbench.action.reloadWindow").then(h,h)}};Pg=v([(0,S9.injectable)()],Pg);var C9=k(N()),Hi=require("vscode");var Oc=class{get activeDebugConsole(){return Hi.debug.activeDebugConsole}get activeDebugSession(){return p.ci(`Getting active debug session, ${Hi.debug.activeDebugSession?.name}`),Hi.debug.activeDebugSession}get breakpoints(){return Hi.debug.breakpoints}get onDidChangeActiveDebugSession(){return Hi.debug.onDidChangeActiveDebugSession}get onDidStartDebugSession(){return Hi.debug.onDidStartDebugSession}get onDidReceiveDebugSessionCustomEvent(){return Hi.debug.onDidReceiveDebugSessionCustomEvent}get onDidTerminateDebugSession(){return Hi.debug.onDidTerminateDebugSession}get onDidChangeBreakpoints(){return Hi.debug.onDidChangeBreakpoints}registerDebugConfigurationProvider(e,t){return Hi.debug.registerDebugConfigurationProvider(e,t)}registerDebugAdapterTrackerFactory(e,t){return Hi.debug.registerDebugAdapterTrackerFactory(e,t)}startDebugging(e,t,r){return Hi.debug.startDebugging(e,t,r)}addBreakpoints(e){Hi.debug.addBreakpoints(e)}removeBreakpoints(e){Hi.debug.removeBreakpoints(e)}};Oc.instance=new Oc,Oc=v([(0,C9.injectable)()],Oc);var Yk=k(N()),UN=require("vscode");var kg=class{constructor(e){this.extensionContext=e;this.testingState=new Map}async store(e,t,r){if(Un&&this.extensionContext.extensionMode!==UN.ExtensionMode.Production){this.testingState.set(`${e}#${t}`,r||"");return}if(r)await this.extensionContext.secrets.store(`${e}.${t}`,r);else try{await this.extensionContext.secrets.delete(`${e}.${t}`)}catch(i){p.error(i)}}async retrieve(e,t){if(Un&&this.extensionContext.extensionMode!==UN.ExtensionMode.Production)return this.testingState.get(`${e}#${t}`);try{return await this.extensionContext.secrets.get(`${e}.${t}`)}catch{try{await this.extensionContext.secrets.delete(`${e}.${t}`);return}catch(i){p.error(i)}}}};kg=v([(0,Yk.injectable)(),m(0,(0,Yk.inject)(Ze))],kg);var Xk=k(N()),PC=require("vscode");var xg=class{constructor(e){this._extensions=[];e.push(PC.extensions.onDidChange(()=>this._extensions=PC.extensions.all)),this._extensions=PC.extensions.all}get extensions(){return this._extensions}determineExtensionFromCallStack(e){e=e||new Error().stack;try{let t=PC.extensions.getExtension(Ae).extensionUri.toString().toLowerCase(),r=[];if(e){r=e.split(`
`).map(l=>{let c=/\((.*)\)/.exec(l),u=c?c[1]:void 0;try{let d=/\((.*)\:\d*\:\d*\)/.exec(l);if(!d)return u;if(!u||u.startsWith(d[1]))return d[1]}catch{}return u}).filter(l=>l&&!l.toLowerCase().startsWith(t));let i=t.split(/[\\/]/),o=i.findIndex(l=>l.startsWith(Ae)),s=o===-1?void 0:i[o-1];qA(new Error("Ex")).forEach(l=>{let c=l.getFileName();c&&!c.toLowerCase().startsWith(t)&&r.push(c)});for(let l of r){let c=this.extensions.find(u=>u.id!==Ae&&(l.toLowerCase().startsWith(u.extensionUri.fsPath.toLowerCase())||l.toLowerCase().startsWith(u.extensionUri.path.toLowerCase())));if(c)return{extensionId:c.id,displayName:c.packageJSON.displayName}}let a=r.find(l=>l.includes(Ae));if(a&&(a=a.substring(0,a.indexOf(Ae)-1)),!s||!a)return{extensionId:mh,displayName:y.unknownPackage};for(let l of r.filter(c=>c.startsWith(a)&&!c.includes(Ae))){let c=l.substring(a.length).substring(1).split(/[\\/]/)[0];c.includes("-")&&(c=c.substring(0,c.lastIndexOf("-")));let u=this.extensions.find(d=>d.id===c);if(u)return{extensionId:u.id,displayName:u.packageJSON.displayName}}}return p.error("Unable to determine the caller of the extension API for trace stack",e),p.error("Jupyter Root",t),p.error("Frames",r),{extensionId:mh,displayName:y.unknownPackage}}catch(t){return p.error("Unable to determine the caller of the extension API for trace stack.",e),p.error("Failure error",t),{extensionId:mh,displayName:y.unknownPackage}}}};xg=v([(0,Xk.injectable)(),m(0,(0,Xk.inject)(M))],xg);var Zk=Symbol("IWorkspaceService"),_i=Symbol("IDebugManager"),Tl=Symbol("IApplicationEnvironment"),Rxe=Symbol("IWebviewPanelMessageListener"),Axe=Symbol("IWebviewViewMessageListener"),Nxe=Symbol("IWebview"),Mxe=Symbol("IWebviewView"),Kxe=Symbol("IWebviewPanel"),kd=Symbol("IWebviewPanelProvider"),ex=Symbol("IWebviewViewProvider"),kC=Symbol("IEncryptedStorage");var E9=k(N());var Dg=class{constructor(){this._list=[]}async dispose(){let e=this._list.map(t=>t.dispose());await Promise.all(e),this._list=[]}push(e){e&&this._list.push(e)}get list(){return this._list}};Dg=v([(0,E9.injectable)()],Dg);var Td=k(N()),j9=require("vscode"),xC=k(W9());var px=class{setSharedProperty(e,t){Vh(e,t)}postEvent(e,t){let r={};t.forEach((i,o)=>{r[o]=i}),R(e,void 0,r)}};var tM=k(require("vscode")),mx=k(N());var Ag=class{constructor(e){this.extensionContext=e}get extensionVersion(){return this.extensionContext.extension.packageJSON.version}};Ag=v([(0,mx.injectable)(),m(0,(0,mx.inject)(Ze))],Ag);function ks(){return tM.env.appName.indexOf("Insider")>0||tM.env.appName.indexOf("Code - OSS Dev")>=0?"insiders":"stable"}var rse="VSCode.ABExp.FeatureData",rM="vscode",Ng=class{constructor(e,t,r){this.configurationService=e;this.appEnvironment=t;this.globalState=r;this._optInto=[];this._optOutFrom=[];this.settings=e.getSettings(void 0);let i=this.settings.experiments.optInto,o=this.settings.experiments.optOutFrom;if(this._optInto=i.filter(l=>!l.endsWith("control")),this._optOutFrom=o.filter(l=>!l.endsWith("control")),!this.enabled)return;let s;ks()==="insiders"?s=xC.TargetPopulation.Insiders:s=xC.TargetPopulation.Public;let a=new px;this.experimentationService=(0,xC.getExperimentationService)(Ae,this.appEnvironment.extensionVersion,s,a,this.globalState)}get enabled(){return this.settings.experiments.enabled&&!this.settings.experiments.optOutFrom.includes("All")}async activate(){this.experimentationService&&this.enabled&&(await this.experimentationService.initializePromise,this.getFeatures().length===0&&await this.experimentationService.initialFetch,this.logExperiments())}inExperiment(e){return!this.experimentationService||!this.enabled||this._optOutFrom.includes(e.toString())?!1:this._optInto.includes(e.toString())||this._optInto.includes("All")?(this.experimentationService.getTreatmentVariable(rM,e),!0):e==="DoNotWaitForZmqPortsToBeUsed"&&(ks()==="insiders"||lh())||e==="DataViewerContribution"&&(ks()==="insiders"||lh())?!0:this.experimentationService.getTreatmentVariable(rM,e)===!0}async getExperimentValue(e){if(!(!this.experimentationService||!this.enabled||this._optOutFrom.includes(e)))return this.experimentationService.getTreatmentVariable(rM,e)}getFeatures(){return this.globalState.get(rse,{features:[]}).features}logExperiments(){let e=j9.workspace.getConfiguration("telemetry"),t=!1;if(e&&e.get("enableTelemetry")===!1&&(p.info("Telemetry is disabled"),t=!0),e&&e.get("telemetryLevel")==="off"&&(p.info("Telemetry level is off"),t=!0),t&&p.info("Experiments are disabled, only manually opted experiments are active."),this._optOutFrom.includes("All"))return;if(this._optInto.includes("All")){p.info(rm.inGroup("All"));return}let r=new Set(this._optInto),i=new Set;this._optOutFrom.filter(o=>o!=="All").forEach(o=>{p.info(rm.notInGroup(o))}),this._optInto.filter(o=>o!=="All").forEach(o=>{i.add(o),p.info(rm.inGroup(o))}),t&&!i.has("DoNotWaitForZmqPortsToBeUsed")&&(ks()==="insiders"||lh())&&p.info(rm.inGroup("DoNotWaitForZmqPortsToBeUsed")),t||this.getFeatures().forEach(o=>{o.toLowerCase().startsWith("jupyter")&&!this._optOutFrom.includes(o)&&!this._optInto.includes(o)&&(r.add(o),p.info(rm.inGroup(o)))})}};Ng=v([(0,Td.injectable)(),m(0,(0,Td.inject)(ie)),m(1,(0,Td.inject)(Tl)),m(2,(0,Td.inject)(Le)),m(2,(0,Td.named)(ut))],Ng);var hx=k(N()),Lo=require("vscode");var fx=require("vscode");function Rd(n){fx.env.openExternal(typeof n=="string"?fx.Uri.parse(n):n).then(h,h)}var nse=[{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE",message:QS.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/309",setting:{setting:"formatting.formatOnSave",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE",message:QS.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/313",setting:{setting:"linting.lintOnTextChange",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES",message:QS.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/1704",setting:{setting:"autoComplete.preloadModules"}}],Mg=class{constructor(e){this.persistentStateFactory=e;this._onDidChangeFeatures=new Lo.EventEmitter;this.onDidChangeFeatures=this._onDidChangeFeatures.event;this._features={};this.disposables=[];this._updateFeatures(),this.disposables.push(Lo.workspace.onDidChangeConfiguration(()=>{this._updateFeatures()}))}get features(){return this._features}set features(e){this._features=e,this._onDidChangeFeatures.fire()}_updateFeatures(){this.features={}}dispose(){this.disposables.forEach(e=>e.dispose())}initialize(){nse.forEach(this.registerDeprecation.bind(this))}registerDeprecation(e){Array.isArray(e.commands)&&e.commands.forEach(t=>{this.disposables.push(Lo.commands.registerCommand(t,()=>this.notifyDeprecation(e),this))}),e.setting&&this.checkAndNotifyDeprecatedSetting(e)}async notifyDeprecation(e){let t=this.persistentStateFactory.createGlobalPersistentState(e.doNotDisplayPromptStateKey,!0);if(!t.value)return;let r="Learn more",i="Never show again",o=await Lo.window.showInformationMessage(e.message,r,i);if(o)switch(o){case r:{Rd(e.moreInfoUrl);break}case i:{await t.updateValue(!1);break}default:throw new Error("Selected option not supported.")}}checkAndNotifyDeprecatedSetting(e){let t=!1;Array.isArray(Lo.workspace.workspaceFolders)&&Lo.workspace.workspaceFolders.length>0?Lo.workspace.workspaceFolders.forEach(r=>{t||(t=this.isDeprecatedSettingAndValueUsed(Lo.workspace.getConfiguration("jupyter",r.uri),e.setting))}):t=this.isDeprecatedSettingAndValueUsed(Lo.workspace.getConfiguration("jupyter"),e.setting),t&&this.notifyDeprecation(e).catch(r=>p.debug("Jupyter Extension: notifyDeprecation",r))}isDeprecatedSettingAndValueUsed(e,t){if(!e.has(t.setting))return!1;let r=e.get(t.setting);return!Array.isArray(t.values)||t.values.length===0?Array.isArray(r)?r.length>0:!0:!Array.isArray(t.values)||t.values.length===0?r===void 0?!1:Array.isArray(r)?r.length>0:!0:t.values.indexOf(e.get(t.setting))>=0}};Mg=v([(0,hx.injectable)(),m(0,(0,hx.inject)(ml))],Mg);var Ad=k(N());var gx=class{constructor(e,t,r,i){this.storage=e;this.key=t;this.defaultValue=r;this.expiryDurationMs=i}get value(){if(this.expiryDurationMs){let e=this.storage.get(this.key,{data:this.defaultValue});return!e||!e.expiry||e.expiry<Date.now()?this.defaultValue:e.data}else return this.storage.get(this.key,this.defaultValue)}async updateValue(e){this.expiryDurationMs?await this.storage.update(this.key,{data:e,expiry:Date.now()+this.expiryDurationMs}):await this.storage.update(this.key,e)}},Kg=class{constructor(e,t){this.globalState=e;this.workspaceState=t}createGlobalPersistentState(e,t,r){return new gx(this.globalState,e,t,r)}createWorkspacePersistentState(e,t,r){return new gx(this.workspaceState,e,t,r)}};Kg=v([(0,Ad.injectable)(),m(0,(0,Ad.inject)(Le)),m(0,(0,Ad.named)(ut)),m(1,(0,Ad.inject)(Le)),m(1,(0,Ad.named)(ri))],Kg);var J9="Path",B9="PATH",$9=/^win/.test(process.platform);var q9=k(N()),Al=require("vscode");var xe=class n extends Error{static{this.back=new n("back")}static{this.cancel=new n("cancel")}static{this.resume=new n("resume")}},DC=class{constructor(){this.steps=[]}run(e,t){return this.stepThrough(e,t)}async showQuickPick(e){return this.showLazyLoadQuickPick(e).selection}showLazyLoadQuickPick({title:e,step:t,totalSteps:r,items:i,activeItem:o,placeholder:s,buttons:a,shouldResume:l,matchOnDescription:c,matchOnDetail:u,acceptFilterBoxTextAsSelection:d,startBusy:f,stopBusy:g,validate:b,onDidTriggerItemButton:I,onDidTriggerButton:w,supportBackInFirstStep:D,onDidChangeItems:A,ignoreFocusOut:T}){let $=[],ne=re(),H=Al.window.createQuickPick();return H.title=e,H.step=t,H.totalSteps=r,H.placeholder=s,H.ignoreFocusOut=T??!0,H.items=i,g&&(H.busy=f??!1,g(()=>{H.enabled&&(H.busy=!1)},this,$)),A&&(H.keepScrollPosition=!0,A(oe=>{H.items=oe},this,$)),I&&H.onDidTriggerItemButton(oe=>I(oe),void 0,$),H.matchOnDescription=c||!1,H.matchOnDetail=u||!1,o?H.activeItems=[o]:H.activeItems=[],H.buttons=[...this.steps.length>1||D?[Al.QuickInputButtons.Back]:[],...a||[]],$.push(H.onDidTriggerButton(oe=>{oe===Al.QuickInputButtons.Back?ne.reject(xe.back):w?w(oe):ne.resolve(oe)}),H.onDidChangeSelection(async oe=>{let ae=oe.length?oe[0].label:"",Y=!!ae;if(ae&&b&&oe.length){H.enabled=!1,H.busy=!0;let Ie=await b(oe[0]);Ie&&(Y=!1,await Al.window.showErrorMessage(Ie,{modal:!0})),H.enabled=!0,H.busy=!1}Y&&ne.resolve(oe[0])}),H.onDidHide(()=>{(async()=>{ne.reject(l&&await l()?xe.resume:xe.cancel)})().catch(ne.reject)})),d&&$.push(H.onDidAccept(async()=>{if(!H.busy){let oe=b?await b(H):void 0;oe?(H.enabled=!1,H.busy=!0,await Al.window.showErrorMessage(oe),H.enabled=!0,H.busy=!1):ne.resolve(H.value)}})),this.current&&this.current.dispose(),this.current=H,this.current.show(),ne.promise.finally(()=>z($)).catch(h),{quickPick:H,selection:ne.promise}}async showInputBox({title:e,step:t,totalSteps:r,value:i,prompt:o,validate:s,password:a,buttons:l,shouldResume:c,validationMessage:u}){let d=[];try{return await new Promise((f,g)=>{let b=Al.window.createInputBox();b.title=e,b.step=t,b.totalSteps=r,b.password=!!a,b.value=i||"",b.prompt=o,b.validationMessage=u||"",b.ignoreFocusOut=!0,b.validationMessage=u||"",b.buttons=[...this.steps.length>1?[Al.QuickInputButtons.Back]:[],...l||[]],d.push(b.onDidTriggerButton(I=>{I===Al.QuickInputButtons.Back?g(xe.back):f(I)}),b.onDidAccept(async()=>{let I=b.value;b.enabled=!1,b.busy=!0;let w=await s(I);w?(b.validationMessage=w,b.show()):(b.validationMessage="",f(I)),b.enabled=!0,b.busy=!1}),b.onDidChangeValue(async()=>{b.validationMessage=""}),b.onDidHide(()=>{(async()=>{b.busy||g(c&&await c()?xe.resume:xe.cancel)})().catch(g)})),this.current&&this.current.dispose(),this.current=b,this.current.show()})}finally{d.forEach(f=>f.dispose())}}async stepThrough(e,t){let r=e;for(;r;){this.steps.push(r),this.current&&(this.current.enabled=!1,this.current.busy=!0);try{r=await r(this,t)}catch(i){if(i===xe.back)this.steps.pop(),r=this.steps.pop();else if(i===xe.resume)r=this.steps.pop();else if(i===xe.cancel)r=void 0;else throw i;if(!r)return i}}this.current&&this.current.dispose()}},vx=Symbol("IMultiStepInputFactory"),Og=class{create(){return new DC}};Og=v([(0,q9.injectable)()],Og);var H9=k(N()),G9=require("vscode");var Fg=class{activate(){G9.languages.getLanguages().then(e=>{e.map(t=>t.toLowerCase()).forEach(t=>{RS.includes(t)||RS.push(t)})},h)}};Fg=v([(0,H9.injectable)()],Fg);var z9=Symbol("IServiceManager"),st=Symbol("IServiceContainer");var Lc=k(Jo());var QB=require("os"),wM;function YB(n){wM=n}async function XB(n,e={}){return(await wM.get(mo).create(void 0)).shellExec(n,e)}function jg(n){return Lc.pathExists(n)}function PM(n){return Lc.pathExistsSync(n)}function ZB(n){return Lc.readFile(n,"utf-8")}function e3(n){return Lc.readFileSync(n,"utf-8")}var t3=n=>Ih(n,(0,QB.homedir)());function r3(n){return wM.get(ie).getSettings()[n]}var s3=k(N()),Dm=k(require("os")),a3=k(lm()),xM=require("vscode");var kM=require("vscode"),i3=k(require("os"));var n3=i3.homedir();function xm(n){return process.env[n]}function Kd(){if(Kr()==="Windows")return kM.Uri.file(xm("USERPROFILE")||n3);let n=xm("HOME")||xm("HOMEPATH")||n3;return kM.Uri.file(n.replace(/\\/g,"/"))}var Jg=k(lm());function o3(n){n=n.replace(/\.00*(?=[1-9]|0\.)/,".");let e=Jg.coerce(n);return e===null||!Jg.valid(e)?new Jg.SemVer("0.0.0"):e}var Kl=class{constructor(){this._homeDir=Kd()||xM.Uri.file(Dm.homedir());this._tempDir=xM.Uri.file(Dm.tmpdir());this.osType=Kr();this.osType,"Unknown"}get homeDir(){return this._homeDir}get tempDir(){return this._tempDir}get pathVariableName(){return this.isWindows?J9:B9}async getVersion(){if(this.version)return this.version;switch(this.osType){case"Windows":case"OSX":try{let e=(0,a3.coerce)(Dm.release());if(e)return this.version=e;throw new Error("Unable to parse version")}catch{return o3(Dm.release())}default:throw new Error("Not Supported")}}get isWindows(){return this.osType==="Windows"}get isMac(){return this.osType==="OSX"}get isLinux(){return this.osType==="Linux"}};Kl=v([(0,s3.injectable)()],Kl);function l3(n){n.addSingleton(wr,Kl),YB(n.get(st))}var Mx=k(N()),d3=require("vscode");var _m=require("child_process"),Nx=require("vscode");var DM="utf8";var Rx=require("vscode"),c3=require("os"),Ax=Rx.Uri.file((0,c3.homedir)());function u3(n,e){let t=e?[{uri:Rx.Uri.file(e),name:"",index:0}]:[];return U(n?Rx.Uri.file(n):void 0,t,Ax)}function jt(n,e=[]){return U(n,e,Ax)}function _M(n,e,t){let r=e.reduce((o,s,a)=>{let l=KS(s);return(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'")&&(s.includes("/")||s.includes("\\")))&&(l=`${s[0]}${jt(s.substr(1))}`),a===0?l:`${o} ${l}`},""),i=[`Process Execution: ${jt(n)} ${r}`];t&&t.cwd&&i.push(`    > ${UA.currentWorkingDirectory} ${jt(t.cwd.toString())}`),p.info(i.join(`
`))}var TM=class{decode(e){return Buffer.concat(e).toString(DM)}},Od=class Od{constructor(e){this.env=e;this.processesToKill=new Set;this.decoder=new TM}static isAlive(e){try{return e?(process.kill(e,0),!0):!1}catch{return!1}}static kill(e){try{if(!e)return;process.platform==="win32"?(0,_m.execSync)(`taskkill /pid ${e} /T /F`):process.kill(e)}catch{}}dispose(){this.processesToKill.forEach(e=>{try{e.dispose()}catch{}})}execObservable(e,t,r={}){let i=this.getDefaultOptions(r),o=(0,_m.spawn)(e,t,i),s=!1;p.ci(`Exec observable ${e}, ${t.join(" ")}`);let a=[],l={dispose:function(){o&&!o.killed&&!s&&Od.kill(o.pid),o&&o.unref(),z(a)}};this.processesToKill.add(l);let c=jae();a.push(c);let u=(f,g,b)=>{f.on(g,b),a.push({dispose:()=>f.removeListener(g,b)})};r.token&&a.push(r.token.onCancellationRequested(()=>{!s&&!o.killed&&(Od.kill(o.pid),s=!0)}));let d=(f,g)=>{let b=this.decoder.decode([g]);f==="stderr"&&r.throwOnStdErr?c.reject(new EC(b)):c.fire({source:f,out:b})};return u(o.stdout,"data",f=>d("stdout",f)),u(o.stderr,"data",f=>d("stderr",f)),o.once("close",()=>{s=!0,c.resolve(),a.forEach(f=>f.dispose())}),o.once("exit",()=>{s=!0,c.resolve(),a.forEach(f=>f.dispose())}),o.once("error",f=>{s=!0,c.reject(f),a.forEach(g=>g.dispose())}),_M(e,t,r),{proc:o,out:c,dispose:l.dispose}}exec(e,t,r={}){let i=this.getDefaultOptions(r),o=(0,_m.spawn)(e,t,i),s=re(),a={dispose:()=>{!o.killed&&!s.completed&&Od.kill(o.pid)}};this.processesToKill.add(a);let l=[],c=(f,g,b)=>{f.on(g,b),l.push({dispose:()=>f.removeListener(g,b)})};r.token&&l.push(r.token.onCancellationRequested(a.dispose));let u=[];c(o.stdout,"data",f=>u.push(f));let d=[];return c(o.stderr,"data",f=>{r.mergeStdOutErr&&u.push(f),d.push(f)}),o.once("close",()=>{if(s.completed)return;let f=d.length===0?void 0:this.decoder.decode(d);if(f&&f.length>0&&r.throwOnStdErr)s.reject(new EC(f));else{let g=this.decoder.decode(u);s.resolve({stdout:g,stderr:f})}l.forEach(g=>g.dispose())}),o.once("error",f=>{s.reject(f),l.forEach(g=>g.dispose())}),_M(e,t,r),s.promise}shellExec(e,t={}){let r=this.getDefaultOptions(t);return new Promise((i,o)=>{let s,a=(0,_m.exec)(e,r,(c,u,d)=>{s?.dispose(),c&&c!==null?o(c):r.throwOnStdErr&&d&&d.length?o(new Error(d)):i({stderr:d&&d.length>0?d:void 0,stdout:u})});t.token&&(s=t.token.onCancellationRequested(()=>{a.exitCode===null&&!a.killed&&(o(new Nx.CancellationError),Od.kill(a.pid))}));let l={dispose:()=>{a.killed||Od.kill(a.pid)}};this.processesToKill.add(l)})}getDefaultOptions(e){let t={...e},r=t;if(r){let i=r.encoding=typeof r.encoding=="string"&&r.encoding.length>0?r.encoding:DM;delete r.encoding,r.encoding=i}if(!t.env||Object.keys(t.env).length===0){let i=this.env?this.env:process.env;t.env={...i}}else t.env={...t.env};return t.env.PYTHONUNBUFFERED="1",t.env.PYTHONIOENCODING||(t.env.PYTHONIOENCODING="utf-8"),t.env.PYTHON_FROZEN_MODULES||(t.env.PYTHON_FROZEN_MODULES="on"),t}};v([ti("Execing shell command",5),m(1,od())],Od.prototype,"shellExec",1);var ma=Od;function jae(){let n=new Nx.EventEmitter,e=re();return e.promise.catch(h),{get onDidChange(){return n.event},get done(){return e.promise},resolve:e.resolve.bind(e),reject:e.reject.bind(e),fire:n.fire.bind(n),dispose:()=>{n.dispose()}}}var Tm=class{constructor(e){this.envVarsService=e}async create(e,t){if(!d3.workspace.isTrusted)throw new Error("Workspace not trusted");let r=await this.envVarsService.getEnvironmentVariables(e,"RunNonPythonCode",t);return ea(new ma(r))}};v([ti("Create ProcessService",5)],Tm.prototype,"create",1),Tm=v([(0,Mx.injectable)(),m(0,(0,Mx.inject)(kl))],Tm);function p3(n){n.addSingleton(mo,Tm)}var f3=k(require("os")),Ox=k(N());var Bg=k(require("vscode")),m3;(l=>{let n=Bg.FileSystemError.FileNotFound().name,e=Bg.FileSystemError.FileExists().name,t=Bg.FileSystemError.FileIsADirectory().name,r=Bg.FileSystemError.FileNotADirectory().name,i=Bg.FileSystemError.NoPermissions().name,o=[n,e,t,r,i];function s(c,u){if(o.includes(c.name))return c.name===u}function a(c){return s(c,n)}l.isFileNotFound=a})(m3||={});function Jae(n,e){let t=n.code;if(t)return t===e}function Kx(n){let e=m3.isFileNotFound(n);return e!==void 0?e:Jae(n,"ENOENT")}var h3=require("vscode");var $g=class{constructor(e){this.fs=e}async parseFile(e,t){if(e)try{return Bae(await this.fs.readFile(h3.Uri.file(e)),t)}catch(r){Kx(r)||p.error(`Failed to parse env file ${e}`,r)}}mergeVariables(e,t){t&&Object.keys(e).forEach(r=>{let i=r.toLowerCase();if(i=="pythonpath"||i=="path")return;let o=Object.keys(t).find(s=>s.toLowerCase()===i)||r;t[o]=e[r]})}mergePaths(e,t){let r=Object.keys(e).find(o=>o.toLowerCase()==="path"),i=Object.keys(t).find(o=>o.toLowerCase()==="path")||r;r&&i&&(t[i]=e[r])}appendPythonPath(e,...t){return this.appendPaths(e,"PYTHONPATH",!0,...t)}appendPath(e,...t){return this.appendPaths(e,"PATH",!0,...t)}prependPath(e,...t){return this.appendPaths(e,"PATH",!1,...t)}appendPaths(e,t,r,...i){let o=i.filter(f=>typeof f=="string"&&f.trim().length>0).map(f=>f.trim()).join(jn);if(o.length===0)return e;let s=t.toLowerCase(),a=e?Object.keys(e).find(f=>f.toLowerCase()==s):void 0,l=e&&a?e[a]:void 0,c=a||t;l&&typeof l=="string"&&l.length>0?r&&!(e[c]||"").endsWith(jn+o)?e[c]=l+jn+o:!r&&!(e[c]||"").startsWith(o+jn)&&(e[c]=o+jn+l):e[c]=o;let d=["Path","PATH"].find(f=>f!==c);if(f3.platform()==="win32"&&d&&d in e&&typeof e[d]=="string"){let f=e[d],g=d;f&&typeof f=="string"&&f.length>0?r&&!(e[g]||"").endsWith(jn+o)?e[g]=f+jn+o:!r&&!(e[g]||"").startsWith(o+jn)&&(e[g]=o+jn+f):e[g]=o}return e}};$g=v([(0,Ox.injectable)(),m(0,(0,Ox.inject)(tt))],$g);function Bae(n,e){let t=e||{},r={};return n.toString().split(`
`).forEach((i,o)=>{let[s,a]=$ae(i);s!==""&&(r[s]=Hae(a,r,t))}),r}function $ae(n){let e=n.match(/^\s*([a-zA-Z]\w*)\s*=\s*(.*?)?\s*$/);if(!e)return["",""];let t=e[1],r=e[2];return r&&r!==""?r[0]==="'"&&r[r.length-1]==="'"?(r=r.substring(1,r.length-1),r=r.replace(/\\n/gm,`
`)):r[0]==='"'&&r[r.length-1]==='"'&&(r=r.substring(1,r.length-1),r=r.replace(/\\n/gm,`
`)):r="",[t,r]}var qae=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function Hae(n,e,t,r=""){let i=!1,o=n;return o=o.replace(qae,(s,a,l,c,u)=>c>0&&u[c-1]==="\\"?s:l&&l!==""||!a||a===""?(i=!0,s):e[a]||t[a]||r),!i&&o!==n&&(n=o,R("ENVFILE_VARIABLE_SUBSTITUTION")),n.replace(/\\\$/g,"$")}var Ol=k(N());var vo=require("vscode");var fa=require("vscode");var RM={number:"number",string:"string",undefined:"undefined",object:"object",function:"function"};function AM(n){return Array.isArray?Array.isArray(n):!!(n&&typeof n.length===RM.number&&n.constructor===Array)}function Fx(n){return typeof n===RM.string||n instanceof String}function NM(n){return typeof n===RM.object&&n!==null&&!Array.isArray(n)&&!(n instanceof RegExp)&&!(n instanceof Date)}var Lx=class{resolve(e){return Fx(e)?this.__resolveString(e):AM(e)?this.__resolveArray(e):NM(e)?this.__resolveLiteral(e):e}resolveAny(e){return Fx(e)?this.__resolveString(e):AM(e)?this.__resolveAnyArray(e):NM(e)?this.__resolveAnyLiteral(e):e}__resolveString(e){let t=/\$\{(.*?)\}/g;return e.replace(t,(r,i)=>{let o=this[i];return Fx(o)?o:r&&(r.indexOf("env.")>0||r.indexOf("env:")>0)?"":r})}__resolveLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(r=>{let i=e[r];t[r]=this.resolve(i)}),t}__resolveAnyLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(r=>{let i=e[r];t[r]=this.resolveAny(i)}),t}__resolveArray(e){return e.map(t=>this.__resolveString(t))}__resolveAnyArray(e){return e.map(t=>this.resolveAny(t))}};var qg=class extends Lx{constructor(t,r){super();let i=t?fa.workspace.getWorkspaceFolder(t):void 0;this._workspaceFolder=i?i.uri.fsPath:r?.fsPath||__dirname,this._workspaceFolderName=Se(this._workspaceFolder),this._fileWorkspaceFolder=this._workspaceFolder,this._filePath=t?t.fsPath:void 0,fa.window&&fa.window.activeTextEditor&&(this._lineNumber=fa.window.activeTextEditor.selection.anchor.line+1,this._selectedText=fa.window.activeTextEditor.document.getText(new fa.Range(fa.window.activeTextEditor.selection.start,fa.window.activeTextEditor.selection.end))),this._execPath=process.execPath,Object.keys(process.env).forEach(o=>{this[`env:${o}`]=this[`env.${o}`]=process.env[o]})}get userHome(){return Kd().fsPath}get cwd(){return this.workspaceFolder}get workspaceRoot(){return this._workspaceFolder}get workspaceFolder(){return this._workspaceFolder}get fileWorkspaceFolder(){return this._fileWorkspaceFolder}get workspaceRootFolderName(){return this._workspaceFolderName}get workspaceFolderBasename(){return this._workspaceFolderName}get file(){return this._filePath}get relativeFile(){return this.file?Qw(this._workspaceFolder,this.file):void 0}get relativeFileDirname(){return this.relativeFile?rt(this.relativeFile):void 0}get fileBasename(){return this.file?Se(this.file):void 0}get fileBasenameNoExtension(){return this.file?nW(this.file).name:void 0}get fileDirname(){return this.file?rt(this.file):void 0}get fileDirnameBasename(){return this.fileDirname?Se(this.fileDirname):void 0}get pathSeparator(){return hn}get fileExtname(){return this.file?Ui(this.file):void 0}get lineNumber(){return this._lineNumber}get selectedText(){return this._selectedText}get execPath(){return this._execPath}};var Wx=require("vscode"),KC,Ux=!1;function g3(){b3()&&y3()}async function v3(n,e){if(b3()){let r=new qg(e,void 0).resolveAny(I3());await n.exists(Wx.Uri.file(r))&&y3()}}function y3(){R("ENVFILE_WORKSPACE"),Ux=!0}function b3(){return!Ux}function I3(){return KC||(KC=Wx.workspace.getConfiguration("python").inspect("envFile")?.defaultValue||""),KC}var zae;(t=>{function n({telemetrySent:r,defaultSetting:i}){r!==void 0&&(Ux=r),I3!==void 0&&(KC=i)}t.setState=n;function e(){KC=void 0,Ux=!1}t.resetState=e})(zae||={});var Qae=60*1e3,Rm=class{constructor(e,t,r,i,o=Qae){this.envVarsService=e;this.extensionChecker=r;this.pythonApi=i;this.cacheDuration=o;this.trackedWorkspaceFolders=new Set;this.fileWatchers=new Set;this.disposables=[];this.changeEventEmitter=new vo.EventEmitter;t.push(this)}get onDidEnvironmentVariablesChange(){return this.changeEventEmitter.event}dispose(){this.changeEventEmitter.dispose(),z(this.disposables)}async getEnvironmentVariables(e,t,r){if(e=e||(vo.workspace.workspaceFolders?.length?vo.workspace.workspaceFolders[0].uri:void 0),t==="RunPythonCode")return this._getEnvironmentVariables(e,t,r);let i=new Qp(this.cacheDuration,this.getCacheKeyForMergedVars(e));if(i.hasData&&i.data)return p.debug(`Cached data exists getEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),i.data;let o=this._getEnvironmentVariables(e,t,r);return o.then(s=>{r?.isCancellationRequested||(i.data=s)}).catch(h),o}async getCustomEnvironmentVariables(e,t,r){e=e||(vo.workspace.workspaceFolders?.length?vo.workspace.workspaceFolders[0].uri:void 0);let i=this.getWorkspaceFolderUri(e);if(!i){p.ci(`No workspace folder found for ${e?e.fsPath:"<No Resource>"}`);return}if(t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled){let l=await this.pythonApi.getNewApi();if(l&&!r?.isCancellationRequested)return this.pythonEnvVarChangeEventHooked||(this.pythonEnvVarChangeEventHooked=!0,l.environments.onDidEnvironmentVariablesChange(c=>{p.debug(`Python env vars changed ${c.resource?.uri?.path}`),this.onEnvironmentFileChanged(c.resource?.uri),this.changeEventEmitter.fire(c.resource?.uri)},this,this.disposables)),l.environments.getEnvironmentVariables(i)}let o=new Qp(this.cacheDuration,this.getCacheKeyForCustomVars(e));if(o.hasData)return p.debug(`Cached custom vars data exists getCustomEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),o.data;if(r?.isCancellationRequested)return;this.trackedWorkspaceFolders.add(i.fsPath||"");let s=this.getEnvFile(i);this.createFileWatcher(s,i);let a=this.envVarsService.parseFile(s,process.env);return a.then(l=>{r?.isCancellationRequested||(o.data=l)}).catch(h),a}createFileWatcher(e,t){let r=this.getCacheKeyForMergedVars(t);if(this.fileWatchers.has(r))return;let i=new vo.RelativePattern(vo.Uri.file(rt(e)),Se(e)),o=vo.workspace.createFileSystemWatcher(i,!1,!1,!1);o?(this.disposables.push(o),this.fileWatchers.add(r),o.onDidChange(()=>this.onEnvironmentFileChanged(t),this,this.disposables),o.onDidCreate(()=>this.onEnvironmentFileCreated(t),this,this.disposables),o.onDidDelete(()=>this.onEnvironmentFileChanged(t),this,this.disposables)):p.error("Failed to create file watcher for environment file")}getEnvFile(e){return We(e.fsPath,".env")}async _getEnvironmentVariables(e,t,r){let i=await this.getCustomEnvironmentVariables(e,t,r);if(r?.isCancellationRequested)return{};if(i&&t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled)return i;i||(i={});let o={};this.envVarsService.mergeVariables(process.env,o),this.envVarsService.mergeVariables(i,o),this.envVarsService.mergePaths(process.env,o),process.env.PYTHONPATH&&(o.PYTHONPATH=process.env.PYTHONPATH);let s=i?Object.keys(i).find(a=>a.toLowerCase()=="path"):void 0;return s&&i[s]&&this.envVarsService.appendPath(o,i[s]),i.PYTHONPATH&&this.envVarsService.appendPythonPath(o,i.PYTHONPATH),o}getWorkspaceFolderUri(e){let t=vo.workspace.workspaceFolders||[],r=t.length===1?t[0].uri:void 0;return e&&vo.workspace.getWorkspaceFolder(e)?.uri||r}onEnvironmentFileCreated(e){this.onEnvironmentFileChanged(e),g3()}onEnvironmentFileChanged(e){new Qp(this.cacheDuration,this.getCacheKeyForMergedVars(e)).clear(),new Qp(this.cacheDuration,this.getCacheKeyForCustomVars(e)).clear(),this.changeEventEmitter.fire(e)}getCacheKeyForMergedVars(e){return`${ys(e)}:RunNonPythonCode`}getCacheKeyForCustomVars(e){return`${ys(e)}:RunNonPythonCode:CustomVars`}};v([ti("Get Custom Env Variables",1)],Rm.prototype,"getEnvironmentVariables",1),Rm=v([(0,Ol.injectable)(),m(0,(0,Ol.inject)(Pl)),m(1,(0,Ol.inject)(M)),m(2,(0,Ol.inject)($e)),m(3,(0,Ol.inject)(Qt)),m(4,(0,Ol.inject)("number")),m(4,(0,Ol.optional)())],Rm);function S3(n){n.addSingleton(Pl,$g),n.addSingleton(kl,Rm)}var C3=k(N()),Fd=require("vscode");var MM=require("vscode");var Hg=class{activate(){Fd.commands.registerCommand("jupyter.runInDedicatedExtensionHost",this.updateAffinity,this)}async updateAffinity(){let e=MM.workspace.getConfiguration("extensions").get("experimental.affinity"),t=0;e&&Object.values(e).forEach(o=>{t=Math.max(t,o)});let r=t+1,i={"ms-toolsai.jupyter":r,"ms-toolsai.jupyter-renderers":r};Fd.extensions.getExtension(Zn)&&(i[Zn]=r),Fd.extensions.getExtension(Gp)&&(i[Gp]=r),await MM.workspace.getConfiguration("extensions").update("experimental.affinity",{...e??{},...i},Fd.ConfigurationTarget.Global),Fd.commands.executeCommand("workbench.action.reloadWindow").then(h,h)}};Hg=v([(0,C3.injectable)()],Hg);var OC=require("vscode");var Fl=k(N());var E3=["currentServerHash","connectToLocalKernelsOnly","JUPYTER_LOCAL_KERNELSPECS","JUPYTER_LOCAL_KERNELSPECS_V1","JUPYTER_LOCAL_KERNELSPECS_V2","JUPYTER_LOCAL_KERNELSPECS_V3","JUPYTER_REMOTE_KERNELSPECS","JUPYTER_REMOTE_KERNELSPECS_V1","JUPYTER_REMOTE_KERNELSPECS_V2","JUPYTER_REMOTE_KERNELSPECS_V3","JUPYTER_LOCAL_KERNELSPECS_V4","JUPYTER_REMOTE_KERNELSPECS_V4-","LOCAL_KERNEL_SPECS_CACHE_KEY_V_2022_10","LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2022_10","user-jupyter-server-uri-list-v2","REGISTRATION_ID_EXTENSION_OWNER_MEMENTO_KEY","jupyter.jupyterServer.uriList"],Gg=class{constructor(e,t,r,i){this.globalState=e;this.crypto=t;this.workspaceState=r;this.extensionContext=i}activate(){this.removeOldCachedItems().then(h,h)}async removeOldCachedItems(){await Promise.all([await this.getUriAccountKey()].concat(E3).filter(t=>this.globalState.get(t,void 0)!==void 0).map(t=>this.globalState.update(t,void 0).then(h,h)));let e=this.workspaceState.keys().filter(t=>t.startsWith("LAST_EXECUTED_CELL_")&&!t.startsWith("LAST_EXECUTED_CELL_V2_"));await Promise.all(e.map(t=>this.workspaceState.update(t,void 0))),await Promise.all(E3.map(t=>this.globalState.keys().filter(r=>r.startsWith(t)).map(r=>this.globalState.update(r,void 0).then(h,h))).flat()),await this.extensionContext.secrets.delete(`${Xn.JupyterServerRemoteLaunchService}.remote-uri-list`).then(h,h)}async getUriAccountKey(){let e=vl();return e?this.crypto.createHash(Re(e),"SHA-512"):OC.workspace.workspaceFile?this.crypto.createHash(Re(OC.workspace.workspaceFile),"SHA-512"):OC.env.machineId}};Gg=v([(0,Fl.injectable)(),m(0,(0,Fl.inject)(Le)),m(0,(0,Fl.named)(ut)),m(1,(0,Fl.inject)(Mh)),m(2,(0,Fl.inject)(Le)),m(2,(0,Fl.named)(ri)),m(3,(0,Fl.inject)(Ze))],Gg);function w3(n){n.addSingletonInstance(d2,$9),n.addSingleton(sa,xg),n.addSingleton(ml,Kg),n.addSingleton(_i,Oc),n.addSingleton(Tl,Ag),n.addSingleton(kC,kg),n.addSingleton(Mh,_h),n.addSingleton(sd,Ng),n.addSingleton(LP,Mg),n.addSingleton(aa,Dg),n.addSingleton(vx,Og),n.addSingleton(me,Fg),n.addSingleton(me,Gg),n.addSingleton(me,Pg),n.addSingleton(me,Hg),l3(n),p3(n),S3(n)}var Vx=Symbol("ICodeExecutionHelper");var Ti=require("vscode");var P3=k(N());var zg=class{async getFileToExecute(){let e=Ti.window.activeTextEditor;if(!e){Ti.window.showErrorMessage("No open file to run in terminal").then(h,h);return}if(e.document.isUntitled){Ti.window.showErrorMessage("The active file needs to be saved before it can be run").then(h,h);return}if(e.document.languageId!==ge){Ti.window.showErrorMessage("The active file is not a Python source file").then(h,h);return}return e.document.isDirty&&await e.document.save(),e.document.uri}getSelectedTextToExecute(e){if(!e)return;let t=e.selection,r;return t.isEmpty?r=e.document.lineAt(t.start.line).text:t.isSingleLine?r=this.getSingleLineSelectionText(e):r=this.getMultiLineSelectionText(e),yh(r.trimEnd())}async saveFileIfDirty(e){let t=Ti.workspace.textDocuments.filter(r=>r.uri.path===e.path);t.length===1&&t[0].isDirty&&await t[0].save()}getSingleLineSelectionText(e){let t=e.selection,r=new Ti.Range(t.start,t.end),i=e.document.getText(r),o=e.document.lineAt(t.start.line).text;return i.trim()===o.trim()?o:i}getMultiLineSelectionText(e){let t=e.selection,r=new Ti.Range(t.start,t.end),i=e.document.getText(r),o=new Ti.Range(new Ti.Position(t.start.line,0),new Ti.Position(t.end.line,e.document.lineAt(t.end.line).text.length)),s=e.document.getText(o);if(i.trim()===s.trim())return s;let a=e.document.lineAt(t.start.line).text,l=new Ti.Range(t.start,new Ti.Position(t.start.line,a.length)),c=e.document.getText(l);return c.trimStart()===a.trimStart()?a+i.substring(c.length):i}};zg=v([(0,P3.injectable)()],zg);function k3(n){n.addSingleton(Vx,zg)}var Ld=k(N()),D3=k(lm()),FC=require("vscode");var x3="CONDA_INFORMATION_CACHE";function KM(n){return n&&zw(n.fsPath)&&n.fsPath.startsWith(hn)&&`${hn}${Se(n.fsPath)}`===n.fsPath?Se(n.fsPath):n?.fsPath}var Ds=class{constructor(e,t,r){this.pythonApi=e;this.globalState=t;this.fs=r}async getCondaVersion(){if(this._version)return this._version;if(this._previousVersionCall)return this._previousVersionCall;let e=async()=>{let t=this.getCondaVersionFromPython();t.then(i=>{this._version=i,this.updateCache().catch(h)}).catch(h);let r=Xi(this.getCachedInformation());return await Promise.race([r.promise,t]),r.completed&&r.value?.version?this._version=r.value.version:t};return this._previousVersionCall=e(),this._previousVersionCall}async getCondaFile(){if(this._file)return KM(this._file);if(this._previousFileCall)return this._previousFileCall.then(KM);let e=async()=>{let t=this.pythonApi.getApi().then(i=>i.getCondaFile?i.getCondaFile():void 0);t.then(i=>{p.trace(`Conda file is ${i}`),this._file=i?FC.Uri.file(i):void 0,this.updateCache().catch(h)}).catch(h);let r=Xi(this.getCachedInformation());return await Promise.race([r.promise,t]),r.completed&&r.value?.file?this._file=r.value.file:t.then(i=>i?FC.Uri.file(i):void 0)};return this._previousFileCall=e(),this._previousFileCall.then(KM)}async isCondaAvailable(){return typeof this.isAvailable=="boolean"?this.isAvailable:this.getCondaVersion().then(e=>this.isAvailable=e!==void 0).catch(()=>this.isAvailable=!1)}async updateCache(){if(!this._file||!this._version)return;let e=this._file.fsPath.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(this._file);await this.globalState.update(x3,{version:this._version.raw,file:this._file.fsPath,fileHash:e})}async getCachedInformation(){let e=this.globalState.get(x3,void 0);if(!e)return;let t=e.file.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(FC.Uri.file(e.file));if(e.fileHash===t)return{version:new D3.SemVer(e.version),file:FC.Uri.file(e.file)}}async getCondaVersionFromPython(){return this.pythonApi.getApi().then(e=>e.getCondaVersion?e.getCondaVersion():void 0)}};Ds=v([(0,Ld.injectable)(),m(0,(0,Ld.inject)(Qt)),m(1,(0,Ld.inject)(Le)),m(1,(0,Ld.named)(ut)),m(2,(0,Ld.inject)(tt))],Ds);var LC=k(N());var T3=k(jx());var _3="_VSCODE_getDataFrame",Jx=T3.default`
                            try:
                                del _VSCODE_getDataFrame
                            except:
                                pass
                            `,Ll=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetDataFrameInfo(e){let t=await this.getContentsOfDataFrameScript(),r=e.isDebugging?"True":"False",i=`${_3}("info", ${r}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Jx}:{code:`${t}

${i}

${Jx}`}}async generateCodeToGetDataFrameRows(e){let t=await this.getContentsOfDataFrameScript(),r=e.isDebugging?"True":"False",i=`${_3}("rows", ${r}, ${e.variableName}, ${e.startIndex}, ${e.endIndex})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Jx}:{code:`${t}

${i}

${Jx}`}}async getContentsOfDataFrameScript(){if(Ll.contentsOfDataFrameScript)return Ll.contentsOfDataFrameScript;let e=zt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","dataframes","vscodeDataFrame.py"),t=await this.fs.readFile(e);return Ll.contentsOfDataFrameScript=t,t}};Ll=v([(0,LC.injectable)(),m(0,(0,LC.inject)(tt)),m(1,(0,LC.inject)(Ze))],Ll);var WC=k(N());function Bx(n,e){e===void 0&&(e=!1);var t=n.length,r=0,i="",o=0,s=16,a=0,l=0,c=0,u=0,d=0;function f(T,$){for(var ne=0,H=0;ne<T||!$;){var oe=n.charCodeAt(r);if(oe>=48&&oe<=57)H=H*16+oe-48;else if(oe>=65&&oe<=70)H=H*16+oe-65+10;else if(oe>=97&&oe<=102)H=H*16+oe-97+10;else break;r++,ne++}return ne<T&&(H=-1),H}function g(T){r=T,i="",o=0,s=16,d=0}function b(){var T=r;if(n.charCodeAt(r)===48)r++;else for(r++;r<n.length&&Qg(n.charCodeAt(r));)r++;if(r<n.length&&n.charCodeAt(r)===46)if(r++,r<n.length&&Qg(n.charCodeAt(r)))for(r++;r<n.length&&Qg(n.charCodeAt(r));)r++;else return d=3,n.substring(T,r);var $=r;if(r<n.length&&(n.charCodeAt(r)===69||n.charCodeAt(r)===101))if(r++,(r<n.length&&n.charCodeAt(r)===43||n.charCodeAt(r)===45)&&r++,r<n.length&&Qg(n.charCodeAt(r))){for(r++;r<n.length&&Qg(n.charCodeAt(r));)r++;$=r}else d=3;return n.substring(T,$)}function I(){for(var T="",$=r;;){if(r>=t){T+=n.substring($,r),d=2;break}var ne=n.charCodeAt(r);if(ne===34){T+=n.substring($,r),r++;break}if(ne===92){if(T+=n.substring($,r),r++,r>=t){d=2;break}var H=n.charCodeAt(r++);switch(H){case 34:T+='"';break;case 92:T+="\\";break;case 47:T+="/";break;case 98:T+="\b";break;case 102:T+="\f";break;case 110:T+=`
`;break;case 114:T+="\r";break;case 116:T+="	";break;case 117:var oe=f(4,!0);oe>=0?T+=String.fromCharCode(oe):d=4;break;default:d=5}$=r;continue}if(ne>=0&&ne<=31)if(UC(ne)){T+=n.substring($,r),d=2;break}else d=6;r++}return T}function w(){if(i="",d=0,o=r,l=a,u=c,r>=t)return o=t,s=17;var T=n.charCodeAt(r);if(FM(T)){do r++,i+=String.fromCharCode(T),T=n.charCodeAt(r);while(FM(T));return s=15}if(UC(T))return r++,i+=String.fromCharCode(T),T===13&&n.charCodeAt(r)===10&&(r++,i+=`
`),a++,c=r,s=14;switch(T){case 123:return r++,s=1;case 125:return r++,s=2;case 91:return r++,s=3;case 93:return r++,s=4;case 58:return r++,s=6;case 44:return r++,s=5;case 34:return r++,i=I(),s=10;case 47:var $=r-1;if(n.charCodeAt(r+1)===47){for(r+=2;r<t&&!UC(n.charCodeAt(r));)r++;return i=n.substring($,r),s=12}if(n.charCodeAt(r+1)===42){r+=2;for(var ne=t-1,H=!1;r<ne;){var oe=n.charCodeAt(r);if(oe===42&&n.charCodeAt(r+1)===47){r+=2,H=!0;break}r++,UC(oe)&&(oe===13&&n.charCodeAt(r)===10&&r++,a++,c=r)}return H||(r++,d=1),i=n.substring($,r),s=13}return i+=String.fromCharCode(T),r++,s=16;case 45:if(i+=String.fromCharCode(T),r++,r===t||!Qg(n.charCodeAt(r)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=b(),s=11;default:for(;r<t&&D(T);)r++,T=n.charCodeAt(r);if(o!==r){switch(i=n.substring(o,r),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(T),r++,s=16}}function D(T){if(FM(T)||UC(T))return!1;switch(T){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function A(){var T;do T=w();while(T>=12&&T<=15);return T}return{setPosition:g,getPosition:function(){return r},scan:e?A:w,getToken:function(){return s},getTokenValue:function(){return i},getTokenOffset:function(){return o},getTokenLength:function(){return r-o},getTokenStartLine:function(){return l},getTokenStartCharacter:function(){return o-u},getTokenError:function(){return d}}}function FM(n){return n===32||n===9||n===11||n===12||n===160||n===5760||n>=8192&&n<=8203||n===8239||n===8287||n===12288||n===65279}function UC(n){return n===10||n===13||n===8232||n===8233}function Qg(n){return n>=48&&n<=57}var $x;(function(n){n.DEFAULT={allowTrailingComma:!1}})($x||($x={}));function R3(n,e){var t=[],r=new Object,i=void 0,o={value:{},offset:0,length:0,type:"object",parent:void 0},s=!1;function a(l,c,u,d){o.value=l,o.offset=c,o.length=u,o.type=d,o.colonOffset=void 0,i=o}try{WM(n,{onObjectBegin:function(l,c){if(e<=l)throw r;i=void 0,s=e>l,t.push("")},onObjectProperty:function(l,c,u){if(e<c||(a(l,c,u,"property"),t[t.length-1]=l,e<=c+u))throw r},onObjectEnd:function(l,c){if(e<=l)throw r;i=void 0,t.pop()},onArrayBegin:function(l,c){if(e<=l)throw r;i=void 0,t.push(0)},onArrayEnd:function(l,c){if(e<=l)throw r;i=void 0,t.pop()},onLiteralValue:function(l,c,u){if(e<c||(a(l,c,u,A3(l)),e<=c+u))throw r},onSeparator:function(l,c,u){if(e<=c)throw r;if(l===":"&&i&&i.type==="property")i.colonOffset=c,s=!1,i=void 0;else if(l===","){var d=t[t.length-1];typeof d=="number"?t[t.length-1]=d+1:(s=!0,t[t.length-1]=""),i=void 0}}})}catch(l){if(l!==r)throw l}return{path:t,previousNode:i,isAtPropertyKey:s,matches:function(l){for(var c=0,u=0;c<l.length&&u<t.length;u++)if(l[c]===t[u]||l[c]==="*")c++;else if(l[c]!=="**")return!1;return c===l.length}}}function LM(n,e,t){e===void 0&&(e=[]),t===void 0&&(t=$x.DEFAULT);var r={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(l){r.type==="property"&&(r.length=l-r.offset,r=r.parent)}function o(l){return r.children.push(l),l}var s={onObjectBegin:function(l){r=o({type:"object",offset:l,length:-1,parent:r,children:[]})},onObjectProperty:function(l,c,u){r=o({type:"property",offset:c,length:-1,parent:r,children:[]}),r.children.push({type:"string",value:l,offset:c,length:u,parent:r})},onObjectEnd:function(l,c){i(l+c),r.length=l+c-r.offset,r=r.parent,i(l+c)},onArrayBegin:function(l,c){r=o({type:"array",offset:l,length:-1,parent:r,children:[]})},onArrayEnd:function(l,c){r.length=l+c-r.offset,r=r.parent,i(l+c)},onLiteralValue:function(l,c,u){o({type:A3(l),offset:c,length:u,parent:r,value:l}),i(c+u)},onSeparator:function(l,c,u){r.type==="property"&&(l===":"?r.colonOffset=c:l===","&&i(c))},onError:function(l,c,u){e.push({error:l,offset:c,length:u})}};WM(n,s,t);var a=r.children[0];return a&&delete a.parent,a}function UM(n,e){if(n){for(var t=n,r=0,i=e;r<i.length;r++){var o=i[r];if(typeof o=="string"){if(t.type!=="object"||!Array.isArray(t.children))return;for(var s=!1,a=0,l=t.children;a<l.length;a++){var c=l[a];if(Array.isArray(c.children)&&c.children[0].value===o){t=c.children[1],s=!0;break}}if(!s)return}else{var u=o;if(t.type!=="array"||u<0||!Array.isArray(t.children)||u>=t.children.length)return;t=t.children[u]}}return t}}function qx(n){switch(n.type){case"array":return n.children.map(qx);case"object":for(var e=Object.create(null),t=0,r=n.children;t<r.length;t++){var i=r[t],o=i.children[1];o&&(e[i.children[0].value]=qx(o))}return e;case"null":case"string":case"number":case"boolean":return n.value;default:return}}function WM(n,e,t){t===void 0&&(t=$x.DEFAULT);var r=Bx(n,!1);function i(Y){return Y?function(){return Y(r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter())}:function(){return!0}}function o(Y){return Y?function(Ie){return Y(Ie,r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter())}:function(){return!0}}var s=i(e.onObjectBegin),a=o(e.onObjectProperty),l=i(e.onObjectEnd),c=i(e.onArrayBegin),u=i(e.onArrayEnd),d=o(e.onLiteralValue),f=o(e.onSeparator),g=i(e.onComment),b=o(e.onError),I=t&&t.disallowComments,w=t&&t.allowTrailingComma;function D(){for(;;){var Y=r.scan();switch(r.getTokenError()){case 4:A(14);break;case 5:A(15);break;case 3:A(13);break;case 1:I||A(11);break;case 2:A(12);break;case 6:A(16);break}switch(Y){case 12:case 13:I?A(10):g();break;case 16:A(1);break;case 15:case 14:break;default:return Y}}}function A(Y,Ie,Oe){if(Ie===void 0&&(Ie=[]),Oe===void 0&&(Oe=[]),b(Y),Ie.length+Oe.length>0)for(var pt=r.getToken();pt!==17;){if(Ie.indexOf(pt)!==-1){D();break}else if(Oe.indexOf(pt)!==-1)break;pt=D()}}function T(Y){var Ie=r.getTokenValue();return Y?d(Ie):a(Ie),D(),!0}function $(){switch(r.getToken()){case 11:var Y=r.getTokenValue(),Ie=Number(Y);isNaN(Ie)&&(A(2),Ie=0),d(Ie);break;case 7:d(null);break;case 8:d(!0);break;case 9:d(!1);break;default:return!1}return D(),!0}function ne(){return r.getToken()!==10?(A(3,[],[2,5]),!1):(T(!1),r.getToken()===6?(f(":"),D(),ae()||A(4,[],[2,5])):A(5,[],[2,5]),!0)}function H(){s(),D();for(var Y=!1;r.getToken()!==2&&r.getToken()!==17;){if(r.getToken()===5){if(Y||A(4,[],[]),f(","),D(),r.getToken()===2&&w)break}else Y&&A(6,[],[]);ne()||A(4,[],[2,5]),Y=!0}return l(),r.getToken()!==2?A(7,[2],[]):D(),!0}function oe(){c(),D();for(var Y=!1;r.getToken()!==4&&r.getToken()!==17;){if(r.getToken()===5){if(Y||A(4,[],[]),f(","),D(),r.getToken()===4&&w)break}else Y&&A(6,[],[]);ae()||A(4,[],[4,5]),Y=!0}return u(),r.getToken()!==4?A(8,[4],[]):D(),!0}function ae(){switch(r.getToken()){case 3:return oe();case 1:return H();case 10:return T(!0);default:return $()}}return D(),r.getToken()===17?t.allowEmptyContent?!0:(A(4,[],[]),!1):ae()?(r.getToken()!==17&&A(9,[],[]),!0):(A(4,[],[]),!1)}function A3(n){switch(typeof n){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(n){if(Array.isArray(n))return"array"}else return"null";return"object"}default:return"null"}}var VM=R3;var N3=LM,M3=UM;var K3=qx;var JM=require("vscode");var Hx=k(N()),Uc=require("vscode");var ii=class{constructor(e){this.disposables=[];this._onDidChange=new Uc.EventEmitter;e.push(this),Mr()||Uc.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.kernels.excludePythonEnvironments")&&this._onDidChange.fire()},this,this.disposables)}get onDidChange(){return this._onDidChange.event}dispose(){this._onDidChange.dispose(),z(this.disposables)}isPythonEnvironmentExcluded(e){if(Mr())return!1;let t=this.getExcludedPythonEnvironments(),r=jM(e,t),i="uri"in e?e.uri:e.executable.uri;return r&&(R("DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER"),p.debug(`Python Env hidden via filter: ${U(i)}`)),r}getExcludedPythonEnvironments(){if(!Uc.workspace.workspaceFolders||Uc.workspace.workspaceFolders.length===0)return Uc.workspace.getConfiguration("jupyter",void 0).get("kernels.excludePythonEnvironments",[]);let e=[];return Uc.workspace.workspaceFolders.forEach(t=>{e.push(...Uc.workspace.getConfiguration("jupyter",t.uri).get("kernels.excludePythonEnvironments",[]))}),e}};ii=v([(0,Hx.injectable)(),m(0,(0,Hx.inject)(M))],ii);function jM(n,e){let t="uri"in n?n.envPath:n.environment?.folderUri,r="uri"in n?n.uri:n.executable.uri;return!r&&!t?!1:e.some(o=>{let s=U(o.trim()).toLowerCase().replace(/\\/g,"/");if(o=o.trim().toLowerCase().replace(/\\/g,"/"),o.length===0||s.length===0)return!1;let a=U(r).toLowerCase().replace(/\\/g,"/"),l=r?r.fsPath.toLowerCase().replace(/\\/g,"/"):"";if(o===a||s===a||o===l||s===l)return!0;let c=U(t||"").toLowerCase().replace(/\\/g,"/"),u=U(t||"").toLowerCase().replace(/\\/g,"/");return o===c||s===c||o===u||s===u})}var Ud=class{constructor(e,t){this.disposableRegistry=e;this.pythonExtChecker=t;this.supportedWorkspaceTypes={untrustedWorkspace:!1,virtualWorkspace:!1}}async activate(){this.disposableRegistry.push(JM.languages.registerCompletionItemProvider({language:"json"},this,",","[")),this.disposableRegistry.push(JM.languages.registerCompletionItemProvider({language:"jsonc"},this,",","["))}async provideCompletionItems(e,t,r){if(!this.pythonExtChecker.isPythonExtensionInstalled||!this.pythonExtChecker.isPythonExtensionActive||oo().length===0||!Ud.canProvideCompletions(e,t))return[];let i=this.getCurrentItemsInList(e,t);return oo().filter(o=>!jM(o,i)).map(o=>{let s=nn(o),a=U(o.executable.uri);return{label:s,detail:a,insertText:`"${a.replace(/\\/g,"\\\\")}"`,filterText:`${s} ${a}`}})}static canProvideCompletions(e,t){if(Se(e.uri.fsPath)!=="settings.json")return!1;let r=VM(e.getText(),e.offsetAt(t));return r.path[0]==="jupyter.kernels.excludePythonEnvironments"&&r.path.length===2}getCurrentItemsInList(e,t){try{let r=e.getText(),i=VM(r,e.offsetAt(t)),o=N3(r),s=M3(o,[i.path[0]]);if(!s)return[];let a=K3(s);return Array.isArray(a)?a:[]}catch(r){return p.warn("Failed to provide completions for python env filter",r),[]}}};Ud=v([(0,WC.injectable)(),m(0,(0,WC.inject)(M)),m(1,(0,WC.inject)($e))],Ud);var O3=k(N()),Ri=require("vscode");var Yg=class{activate(){this.migrateFilters().catch(h)}async migrateFilters(){let e=Array.isArray(Ri.workspace.workspaceFolders)?Ri.workspace.workspaceFolders:[];await this.migrateWorkspaceFilters(Ri.workspace.getConfiguration("jupyter",void 0),Ri.ConfigurationTarget.Global),e.length===0?await this.migrateWorkspaceFilters(Ri.workspace.getConfiguration("jupyter",void 0),Ri.ConfigurationTarget.Global):e.length===1?await this.migrateWorkspaceFilters(Ri.workspace.getConfiguration("jupyter",e[0].uri),Ri.ConfigurationTarget.WorkspaceFolder):(await this.migrateWorkspaceFilters(Ri.workspace.getConfiguration("jupyter",void 0),Ri.ConfigurationTarget.Workspace),await Promise.all(e.map(t=>this.migrateWorkspaceFilters(Ri.workspace.getConfiguration("jupyter",t.uri),Ri.ConfigurationTarget.WorkspaceFolder))))}async migrateWorkspaceFilters(e,t){let r=e.inspect("kernels.filter"),i=[];switch(t){case Ri.ConfigurationTarget.Global:i=r?.globalValue||[];break;case Ri.ConfigurationTarget.Workspace:i=r?.workspaceValue||[];break;default:i=r?.workspaceFolderValue||[]}let o=i.filter(s=>s.type==="pythonEnvironment").map(s=>s.path);i.length&&await e.update("kernels.filter",void 0,t),o.length&&await e.update("kernels.excludePythonEnvironments",Array.from(new Set(o)),t)}};Yg=v([(0,O3.injectable)()],Yg);var Gx=k(N());var BM=require("vscode");var Xg=class{constructor(e){this.disposables=e}activate(){this.disposables.push(BM.commands.registerCommand("jupyter.filterKernels",()=>BM.commands.executeCommand("workbench.action.openSettings","jupyter.kernels.excludePythonEnvironments").then(h,h),this))}};Xg=v([(0,Gx.injectable)(),m(0,(0,Gx.inject)(M))],Xg);var Qx=k(N());var Am=Symbol("IModuleInstaller"),ARe=Symbol("IPythonInstallation"),zx=Symbol("IInstallationChannelManager"),VC=Symbol("IProductService"),jC=Symbol("IProductPathService");var Ai=Symbol("IInstaller");var ev=require("vscode");var Zg=class{constructor(e){this.serviceContainer=e}async getInstallationChannel(e,t){let r=await this.getInstallationChannels(t);if(r.length>=1)return r[0];if(r.length===0){await this.showNoInstallersMessage(t);return}}async getInstallationChannels(e){let t=this.serviceContainer.getAll(Am),r=[];if(t.length===0)return[];t.sort((o,s)=>s.priority-o.priority);let i=t[0].priority;for(let o of t){if(o.priority!==i){if(r.length>0)break;i=o.priority}await o.isSupported(e)&&r.push(o)}return r}async showNoInstallersMessage(e){let t=Ve(e);if(await ev.window.showErrorMessage(t==="Conda"?Rh.noCondaOrPipInstaller:Rh.noPipInstaller,{modal:!0},Rh.searchForHelp)===Rh.searchForHelp){let i=this.serviceContainer.get(wr),o=i.isWindows?"Windows":i.isMac?"MacOS":"Linux";ev.env.openExternal(ev.Uri.parse(`https://www.bing.com/search?q=Install Pip ${o} ${t==="Conda"?"Conda":""}`))}}};Zg=v([(0,Qx.injectable)(),m(0,(0,Qx.inject)(st))],Zg);var Zx=k(N());var Yx=require("vscode");function zi(n){switch(n){case 18:return"jupyter";case 20:return"notebook";case 23:return"pandas";case 19:return"ipykernel";case 22:return"nbconvert";case 21:return"kernelspec";case 27:return"pip";case 28:return"ensurepip";default:throw new Error(`Product ${n} cannot be installed as a Python Module.`)}}var F3=require("os");var tv=class extends qe{constructor(t,r,i){super("windowsLongPathNotEnabled",i);this.product=t;this.interpreter=r;this.originalMessage=i}};var Fr=Symbol("IPythonExecutionFactory"),zRe=Symbol("IPythonExecutionService");var Ul=class{constructor(e){this.serviceContainer=e}async installModule(e,t,r,i){let o=typeof e=="string"?e:zi(e),s=await this.getExecutionArgs(o,t,i),a=this.serviceContainer.get(Fr),l=this.serviceContainer.get(mo),c=this.serviceContainer.get(Ps),u=this.serviceContainer.get(Pl);if(r.token.isCancellationRequested)return;let d=async(g,b)=>{let I=re(),w=[];b.onCancellationRequested(()=>{r.cancel(),I.resolve()},this,w);let D;if(s.useShellExec){let H=await l.create(void 0);if(r.token.isCancellationRequested)return;try{let oe=await H.shellExec(s.args.join(" "),{cwd:s.cwd});p.debug(oe.stdout),I.resolve()}catch(oe){I.reject(oe)}}else if(s.exe){let H=await c.getActivatedEnvironmentVariables(void 0,t);if(r.token.isCancellationRequested)return;let oe={...process.env};u.mergeVariables(H||{},oe),u.mergePaths(H||{},oe);let ae=await l.create(void 0);if(r.token.isCancellationRequested)return;D=ae.execObservable(s.exe,s.args,{encoding:"utf-8",token:b,env:oe,cwd:s.cwd})}else{let H=await a.createActivatedEnvironment({interpreter:t});if(r.token.isCancellationRequested)return;D=H.execObservable(s.args,{encoding:"utf-8",token:b,cwd:s.cwd})}let A,T,$=[".","..","..."],ne=0;return D&&(D.out.onDidChange(H=>{let oe=$[ne%3],ae=H.out.trim();ne+=1;let Y=ae.length>28?`${ae.substring(0,28)}${oe}`:ae;g.report({message:Y}),p.debug(H.out),H.source==="stderr"&&(T?T+=H.out:!T&&H.out.includes("ERROR: Could not install packages")&&(T=H.out.substring(H.out.indexOf("ERROR: Could not install packages"))),A=H.out)},this,w),D.out.done.then(()=>{D?.proc?.exitCode!==0?T&&T.includes("https://pip.pypa.io/warnings/enable-long-paths")?(T=Ue(T,{trim:!0,removeEmptyEntries:!0}).filter(H=>!H.startsWith("[notice]")).join(F3.EOL),I.reject(new tv(e,t,T))):I.reject(A||D?.proc?.exitCode):I.resolve()},H=>{I.reject(H)}).finally(()=>z(w))),I.promise},f={location:Yx.ProgressLocation.Notification,cancellable:!0,title:jA.installingModule(o)};await Yx.window.withProgress(f,async(g,b)=>d(g,b))}};var nle=[zi(18),zi(20)];function Xx(n,e){return nle.includes(e)?n==="pip"?["jupyter-client<8","pyzmq<25"]:["jupyter_client<8","pyzmq<25"]:[]}var L3=require("vscode");var rv=class extends Ul{constructor(t){super(t)}get name(){return"Conda"}get displayName(){return"Conda"}get type(){return"Conda"}get priority(){return 0}async isSupported(t){if(this._isCondaAvailable===!1)return!1;let r=this.serviceContainer.get(Ds);return this._isCondaAvailable=await r.isCondaAvailable(),this._isCondaAvailable?Ve(t)==="Conda":!1}async installModule(t,r,i,o){if(await super.installModule(t,r,i,o),Jr(r)){if(!this.serviceContainer.get($e).isPythonExtensionActive)return;let l=await this.serviceContainer.get(et).getInterpreterDetails(r.id);l&&!Jr(l)&&Object.assign(r,l)}}async getExecutionArgs(t,r,i=0){let s=await this.serviceContainer.get(Ds).getCondaFile(),a=lr(r)?.environment?.name,l=this.getEnvironmentPath(r),c=[i&1?"update":"install"];return[19,23,22,18,20].map(zi).includes(t)&&c.push("-c","conda-forge"),a?(c.push("--name"),c.push(KS(a))):l&&(c.push("--prefix"),c.push(OS(l))),i&2&&c.push("--update-deps"),i&4&&c.push("--force-reinstall"),c.push(t),c.push(...Xx("conda",t)),c.push("-y"),{exe:s,args:c}}getEnvironmentPath(t){let r,i=lr(t);if(i?.environment?.folderUri)return i.environment.folderUri.fsPath;r=i?.executable.uri||L3.Uri.file(t.id);let o=rt(r.fsPath),s=Se(o);return["BIN","SCRIPTS"].indexOf(s.toUpperCase())!==-1?We(o,".."):o}};rv=v([(0,Zx.injectable)(),m(0,(0,Zx.inject)(st))],rv);var tD=k(N());function ile(){let n=xm("PIPENV_MAX_DEPTH");if(n===void 0)return 3;let e=parseInt(n,10);return isNaN(e)?(p.error(`PIPENV_MAX_DEPTH is incorrectly set. Converting value '${n}' to number results in NaN`),1):e}async function U3(n,e){let t=xm("PIPENV_PIPFILE")||"Pipfile",r=e.lookIntoParentDirectories?ile():1;for(;r>0&&!ud(n,rt(n));){let i=We(n,t);if(await jg(i))return i;n=rt(n),r-=1}}async function ole(n){let e=We(n,".project");if(!await jg(e))return;let t=await ZB(e);if(!await jg(t)){p.error(`The .project file inside environment folder: ${n} doesn't contain a valid path to the project`);return}return t}async function sle(n){let e=rt(rt(n.fsPath)),t=await ole(e);if(!(t===void 0||!Se(cd(e)).startsWith(`${Se(cd(t))}-`)))return U3(t,{lookIntoParentDirectories:!1})}async function W3(n,e){let t=await sle(n);if(!t)return!1;let r=xm("PIPENV_NO_INHERIT")===void 0,i=await U3(e.fsPath,{lookIntoParentDirectories:r});return i?ud(t,i):!1}var eD=require("vscode");function JC(n){let e="executable"in n?n.executable.uri||eD.Uri.file(n.path):n.uri;return eD.workspace.getWorkspaceFolder(e)?.uri||vl()}var j3=require("vscode");var V3="pipenv",nv=class extends Ul{constructor(e){super(e)}get name(){return"pipenv"}get type(){return"Pipenv"}get displayName(){return V3}get priority(){return 10}async isSupported(e){if(Bu(e)){let t=await this.serviceContainer.get(et).getActiveInterpreter(e),r=e?j3.workspace.getWorkspaceFolder(e):void 0;return!t||!r||Ve(t)!=="PipEnv"?!1:W3(t.uri,r.uri)}else return Ve(e)==="PipEnv"}async getExecutionArgs(e,t,r=0){let o=[r&4||r&2||r&1?"update":"install",e,"--dev"],s=JC(t);return{args:o,exe:V3,cwd:s?Re(s):void 0}}};nv=v([(0,tD.injectable)(),m(0,(0,tD.inject)(st))],nv);var rD=k(N());var Bo=We(__dirname,"..");var J3=We(Bo,"pythonFiles");var B3=require("vscode");var iv=class extends Ul{constructor(e){super(e)}get name(){return"Pip"}get type(){return"Pip"}get displayName(){return"Pip"}get priority(){return 0}async isSupported(e){switch(Ve(e)){case"Conda":case"PipEnv":case"Poetry":return!1}return this.isPipAvailable(e)}async getExecutionArgs(e,t,r=0){if(e===zi(27))return await this.serviceContainer.get(Ai).isInstalled(28,t)?{args:["-m","ensurepip"]}:{args:[We(J3,"get-pip.py")]};let i=[],o=B3.workspace.getConfiguration("http").get("proxy","");return o.length>0&&(i.push("--proxy"),i.push(o)),i.push("install","-U"),r&4&&i.push("--force-reinstall"),Ve(t)==="Unknown"&&i.push("--user"),{args:["-m","pip",...i,e].concat(Xx("pip",e))}}isPipAvailable(e){return this.serviceContainer.get(Fr).create({resource:void 0,interpreter:e}).then(r=>r.isModuleInstalled("pip")).catch(()=>!1)}};iv=v([(0,rD.injectable)(),m(0,(0,rD.inject)(st))],iv);var BC=k(N());var ale=5e4,Wc=class Wc{constructor(e,t){this.command=e;this.cwd=t;this.fixCwd()}static{this.poetryPromise=new Map}static async getPoetry(e){if(lle(e))return(Wc.poetryPromise.get(e)===void 0||kr())&&Wc.poetryPromise.set(e,Wc.locate(e)),Wc.poetryPromise.get(e)}static async locate(e){p.debug(`Getting poetry for cwd ${e}`);function*t(){let r=r3("poetryPath");r&&r!=="poetry"&&(yield r),yield"poetry";let i=Kd();if(i){let o=We(i.fsPath,".poetry","bin","poetry");PM(o)&&(yield o)}}for(let r of t()){p.debug(`Probing poetry binary for ${e}: ${r}`);let i=new Wc(r,e);if(await i.getEnvList()!==void 0)return p.debug(`Found poetry via filesystem probing for ${e}: ${r}`),i;p.debug(`Failed to find poetry for ${e}: ${r}`)}p.debug(`No poetry binary found for ${e}`)}async getEnvList(){return this.getEnvListCached(this.command,this.cwd)}async getEnvListCached(e,t){let r=await this.safeShellExecute(`${e} env list --full-path`);if(!r)return;let i="(Activated)";return(await Promise.all(Ue(r.stdout).map(async s=>{s.endsWith(i)&&(s=s.slice(0,-i.length));let a=s.trim();return await jg(a)?a:void 0}))).filter(s=>s!==void 0).map(s=>s)}async getActiveEnvPath(){return this.getActiveEnvPathCached(this.cwd)}async getActiveEnvPathCached(e){let t=await this.safeShellExecute(`${this.command} env info -p`,!0);if(t)return t.stdout.trim()}async getVirtualenvsPathSetting(){let e=await this.safeShellExecute(`${this.command} config virtualenvs.path`);if(e)return e.stdout.trim()}fixCwd(){if(Kr()==="Windows"&&/^[a-z]:/.test(this.cwd)){let e=this.cwd.split(":");e[0]=e[0].toUpperCase(),this.cwd=e.join(":")}}async safeShellExecute(e,t=!1){let r=new Fe,i=await XB(e,{cwd:this.cwd,throwOnStdErr:!0,timeout:ale}).catch(o=>{t?p.debug(o):p.error(o)});return p.debug(`Time taken to run ${e} in ms`,r.elapsedTime),i}};v([jR(3e4)],Wc.prototype,"getEnvListCached",1),v([jR(2e4)],Wc.prototype,"getActiveEnvPathCached",1);var nD=Wc;async function $3(n,e,t){let i=await(t?new nD(t,e):await nD.getPoetry(e))?.getActiveEnvPath();return i?eg(n,i):!1}function lle(n){let e=We(n,"pyproject.toml");return!(!PM(e)||!e3(e).includes("[tool.poetry]"))}var q3=require("vscode");var cle="poetry",ov=class extends Ul{constructor(t,r){super(t);this.configurationService=r}get name(){return"poetry"}get type(){return"Poetry"}get displayName(){return cle}get priority(){return 10}async isSupported(t){if(Ve(t)!=="Poetry")return!1;let r=JC(t);if(r){let i="executable"in t?t.executable.uri||q3.Uri.file(t.path):t.uri;return $3(i.fsPath,r.fsPath,this.configurationService.getSettings(void 0).poetryPath)}return!1}async getExecutionArgs(t,r){let o=[this.configurationService.getSettings(void 0).poetryPath,"add","--dev",t],s=JC(r)?.fsPath;return{useShellExec:!0,args:o,cwd:s}}};ov=v([(0,BC.injectable)(),m(0,(0,BC.inject)(st)),m(1,(0,BC.inject)(ie))],ov);var Wl=k(N()),e6=require("vscode");var ur=new Map;ur.set(18,"jupyter");ur.set(20,"notebook");ur.set(19,"ipykernel");ur.set(22,"nbconvert");ur.set(21,"kernelspec");ur.set(23,"pandas");ur.set(27,"pip");ur.set(28,"ensurepip");var Wd=k(N());var H3=new Set(["ipykernel","ipython-genutils","jupyter","jupyter-client","jupyter-core","ipywidgets","nbconvert","nbformat","notebook","pyzmq","pyzmq32","tornado","traitlets"].map(n=>n.toLowerCase())),G3="NOT INSTALLED",_s=class{constructor(e,t,r,i,o){this.pythonExtensionChecker=e;this.interpreterService=t;this.executionFactory=r;this.apiProvider=i;this.disposables=o;this.interpreterInformation=new Map;this.pendingInterpreterInformation=new Map;this.pendingInterpreterBeforeActivation=new Set;this.interpreterPackages=new Map;_s._instance=this,this.apiProvider.onDidActivatePythonExtension(()=>this.pendingInterpreterBeforeActivation.forEach(s=>this.trackPackages(s)),this,this.disposables)}static get instance(){return _s._instance}getPackageVersions(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(new Map);let t=un(e.uri),r=this.interpreterInformation.get(t);return r||(r=re(),this.interpreterInformation.set(t,r),this.trackInterpreterPackages(e).catch(h)),r.promise}async getPackageVersion(e,t){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(void 0);let r=await this.getPackageVersions(e),i=await ct(t.toLocaleLowerCase());if(!r.has(i))return;let o=r.get(i);if(o)return o===G3?void 0:o}trackPackages(e,t){this.trackPackagesInternal(e,t).catch(h)}async listPackages(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return[];let t=ys(e);if(!this.interpreterPackages.has(t)){let r=this.listPackagesImpl(e);this.interpreterPackages.set(t,r),r.catch(i=>{this.interpreterPackages.get(t)===r&&this.interpreterPackages.delete(t),p.warn(`Failed to get list of installed packages for ${t}`,i)})}return this.interpreterPackages.get(t).then(r=>Array.from(r))}async listPackagesImpl(e){let t=await this.interpreterService.getActiveInterpreter(e);if(!t)return new Set;let r=await this.executionFactory.createActivatedEnvironment({interpreter:t,resource:e}),i="389a87b7-288f-4235-92bf-73bf19bf6491",o=`import pkgutil;import json;print("${i}");print(json.dumps(list([x.name for x in pkgutil.iter_modules()])));print("${i}");`,s=await r.exec(["-c",o],{throwOnStdErr:!1});if(s.stdout){let a=JSON.parse(s.stdout.split(i)[1].trim());return new Set(a.concat(a.map(l=>l.toLowerCase())))}else return p.error(`Failed to get list of installed packages for ${jt(t.uri)}`,s.stderr),new Set}async trackPackagesInternal(e,t){if(!this.pythonExtensionChecker.isPythonExtensionActive){this.pendingInterpreterBeforeActivation.add(e);return}let r;if(Bu(e)){let i=await this.interpreterService.getActiveInterpreter(e);if(!i)return;r=i}else r=e;this.trackInterpreterPackages(r,t).catch(h)}async trackInterpreterPackages(e,t){let r=un(e.uri);if(this.pendingInterpreterInformation.has(r)&&!t)return;let i=this.getPackageInformation({interpreter:e});i.finally(()=>{let o=setTimeout(()=>{this.pendingInterpreterInformation.get(r)===i&&this.pendingInterpreterInformation.delete(r)},3e5),s={dispose:()=>clearTimeout(o)};this.disposables.push(s)}).catch(h),this.pendingInterpreterInformation.set(r,i)}async getPackageInformation({interpreter:e}){if(Jr(e))return;let r=await(await this.executionFactory.createActivatedEnvironment({interpreter:e})).execModule("pip",["list"],{throwOnStdErr:!1,mergeStdOutErr:!0}),i=new Map;await Promise.all(Array.from(H3).map(async a=>{i.set(await ct(a),G3)})),await Promise.all(r.stdout.split(`
`).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0).map(async a=>{let l=a.split(" ").filter(f=>f.trim().length);if(l.length<2)return;let[c,u]=l;if(!H3.has(c.toLowerCase().trim()))return;let d=ed(u);i.set(await ct(c),d||"")}));let o=un(e.uri),s=this.interpreterInformation.get(o);s||(s=re(),this.interpreterInformation.set(o,s)),s.resolve(i)}};_s=v([(0,Wd.injectable)(),m(0,(0,Wd.inject)($e)),m(1,(0,Wd.inject)(et)),m(2,(0,Wd.inject)(Fr)),m(3,(0,Wd.inject)(Qt)),m(4,(0,Wd.inject)(M))],_s);var z3=new Set;async function iD(n,e,t){if(Bu(t))return;z3.add(t.id);let r=`${await hl(t)}#${ur.get(e)}`;await n.update(r,!0)}async function Q3(n,e,t){let r=`${await hl(t)}#${ur.get(e)}`;await n.update(r,void 0)}async function Y3(n,e,t){let r=`${await hl(t)}#${ur.get(e)}`;return n.get(r,!1)}function X3(n){return z3.has(n.id)}async function t6(n,e,t){let r=`${await hl(t)}#${ur.get(e)}`;if(n.get(r,!1))return!0;let i=zi(e),o=_s.instance?_s.instance.getPackageVersion(t,i).then(s=>typeof s=="string"?"found":"notfound").catch(s=>{p.error("Failed to get interpreter package version",s)}):Promise.resolve(void 0);try{let s=await br(500,o);if(typeof s=="string")return s==="found"}catch{p.error(`Failed to check if package exists ${ur.get(e)}`)}}var oD=class{constructor(e,t){this.serviceContainer=e;this.configService=e.get(ie),this.productService=e.get(VC),this.persistentStateFactory=e.get(ml)}async install(e,t,r,i,o){let a=await this.serviceContainer.get(zx).getInstallationChannel(e,t);if(!a)return 2;if(r.token.isCancellationRequested)return 3;let l=i===!0?6:void 0;return o===!0&&(l=l?l|8:8),await a.installModule(e,t,r,l),r.token.isCancellationRequested?3:this.isInstalled(e,t).then(c=>c?0:2)}async isInstalled(e,t){let r=this.getExecutableNameFromSettings(e,void 0);return this.isExecutableAModule(e,void 0)?(await this.serviceContainer.get(Fr).createActivatedEnvironment({resource:void 0,interpreter:t})).isModuleInstalled(r):(await this.serviceContainer.get(mo).create(void 0)).exec(r,["--version"],{mergeStdOutErr:!0}).then(()=>!0).catch(()=>!1)}getExecutableNameFromSettings(e,t){let r=this.productService.getProductType(e);return this.serviceContainer.get(jC,r).getExecutableNameFromSettings(e,t)}isExecutableAModule(e,t){let r=this.productService.getProductType(e);return this.serviceContainer.get(jC,r).isExecutableAModule(e,t)}};v([ti("Checking if product is installed"),m(1,Dc("path"))],oD.prototype,"isInstalled",1);var sv=class{constructor(e,t,r,i){this.serviceContainer=e;this.interpreterPackages=t;this.memento=r;this.output=i;this._onInstalled=new e6.EventEmitter;this.productService=e.get(VC)}get onInstalled(){return this._onInstalled.event}dispose(){}async install(e,t,r,i,o){t&&this.interpreterPackages.trackPackages(t);let s="installed";try{let a=await this.createInstaller(e).install(e,t,r,i,o);switch(iD(this.memento,e,t).catch(h),a===0&&this._onInstalled.fire({product:e,resource:t}),a){case 3:s="cancelled";break;case 0:s="installed";break;case 2:s="ignored";break;case 1:s="disabled";break;default:break}return a}catch(a){throw s="failed",a}finally{R("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:s,moduleName:ur.get(e)})}}async isInstalled(e,t){return this.createInstaller(e).isInstalled(e,t)}translateProductToModuleName(e){return zi(e)}createInstaller(e){switch(this.productService.getProductType(e)){case"DataScience":return new oD(this.serviceContainer,this.output);default:break}throw new Error(`Unknown product ${e}`)}};sv=v([(0,Wl.injectable)(),m(0,(0,Wl.inject)(st)),m(1,(0,Wl.inject)(vd)),m(2,(0,Wl.inject)(Le)),m(2,(0,Wl.named)(ut)),m(3,(0,Wl.inject)(Mo)),m(3,(0,Wl.named)(Wu))],sv);var sD=k(N());var GM=class{constructor(e){this.serviceContainer=e;this.configService=e.get(ie),this.productInstaller=e.get(Ai)}isExecutableAModule(e,t){if(e===21)return!1;let r;try{r=this.productInstaller.translateProductToModuleName(e,2)}catch{}let i=this.getExecutableNameFromSettings(e,t);return typeof r=="string"&&r.length>0&&Se(i)===i}},av=class extends GM{constructor(e){super(e)}getExecutableNameFromSettings(e,t){return this.productInstaller.translateProductToModuleName(e,2)}};av=v([(0,sD.injectable)(),m(0,(0,sD.inject)(st))],av);var r6=k(N());var lv=class{constructor(){this.ProductTypes=new Map;this.ProductTypes.set(18,"DataScience"),this.ProductTypes.set(20,"DataScience"),this.ProductTypes.set(19,"DataScience"),this.ProductTypes.set(22,"DataScience"),this.ProductTypes.set(21,"DataScience"),this.ProductTypes.set(23,"DataScience"),this.ProductTypes.set(27,"DataScience"),this.ProductTypes.set(28,"DataScience")}getProductType(e){return this.ProductTypes.get(e)}};lv=v([(0,r6.injectable)()],lv);var aD=k(N());var cv=class{constructor(e){this.interpreterService=e}activate(){this.interpreterService.initialize()}};cv=v([(0,aD.injectable)(),m(0,(0,aD.inject)(et))],cv);var zM=require("vscode"),uv=k(N());var Ts=class{constructor(e,t,r){this.title=y.localPythonEnvironments;this._onDidChange=new zM.EventEmitter;this._onDidChangeStatus=new zM.EventEmitter;this.onDidChange=this._onDidChange.event;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshedOnceBefore=!1;this.disposables=[];this.promiseMonitor=new ao;this._status="idle";r.push(this),this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this,this.disposables);let i=()=>{let o=e.getNewApi();this.promiseMonitor.push(o),o.then(s=>{if(this.api=s,!s){this.status="idle",this._onDidChangeStatus.fire();return}this._onDidChange.fire(),s.environments.onDidChangeEnvironments(()=>this._onDidChange.fire(),this,this.disposables)}).catch(s=>p.error("Failed to get python api",s))};t.isPythonExtensionInstalled?i():t.onPythonExtensionInstallationStatusChanged(()=>{t.isPythonExtensionInstalled&&i()},this,this.disposables)}get items(){return this.api?(this.refreshedOnceBefore||(this.refreshedOnceBefore=!0,this.refresh().catch(h)),this.api.environments.known):[]}get status(){return this._status}set status(e){this._status=e,this._onDidChangeStatus.fire()}activate(){}dispose(){z(this.disposables)}async refresh(){if(!this.api)return;let e=this.api.environments.refreshEnvironments();this.promiseMonitor.push(e),await e.catch(h)}withFilter(e){return new Proxy(this,{get(t,r){switch(r){case"items":return t.items.filter(e);case"dispose":return h;default:return t[r]}}})}};Ts=v([(0,uv.injectable)(),m(0,(0,uv.inject)(Qt)),m(1,(0,uv.inject)($e)),m(2,(0,uv.inject)(M))],Ts);var pv=k(N());function QM(n,e){if(Array.isArray(n)){let t=n.slice(1);return e&&t.push(...e),{args:t,command:n[0],python:[...n],pythonExecutable:n[n.length-1]}}return{command:n,args:e||[],python:[n],pythonExecutable:n}}function n6(n,e){let t={command:n.command,args:[...n.args],python:[...n.python],pythonExecutable:n.pythonExecutable};return e&&t.args.push(...e),t.pythonExecutable===void 0&&(t.pythonExecutable=t.python[t.python.length-1]),t}var a6=require("vscode");function YM(n,e){return["-m",n,...e]}function i6(){let n=["-c","import sys;print(sys.executable)"];function e(t){return t.trim()}return[n,e]}function o6(n){let e=["-c",`import ${n};print('6af208d0-cb9c-427f-b937-ff563e17efdf')`];function t(r){return r.includes("6af208d0-cb9c-427f-b937-ff563e17efdf")?!0:(p.debug(`Module ${n} is not installed. Output ${r}`),!1)}return[e,t]}async function l6(n,e){let[t,r]=i6(),i=n6(n,t),o=await e(i.command,i.args);return a6.Uri.file(r(o.stdout))}var lD=class{constructor(e,t){this.deps=t;if(this.pythonEnvId=e.id,"executable"in e){if(!e.executable.uri)throw new Error(`interpreter.executable.uri is not defined for ${e.id}`);this.executable=e.executable.uri}else this.executable=e.uri}getExecutionInfo(e=[]){let t=this.deps.getPythonArgv(this.executable);return QM(t,e)}getExecutionObservableInfo(e=[]){let t=this.deps.getObservablePythonArgv(this.executable);return QM(t,e)}async getExecutablePath(){if(await this.deps.isValidExecutable(this.executable))return this.executable;let e=this.getExecutionInfo();return l6(e,this.deps.exec)}async isModuleInstalled(e){let[t,r]=o6(e),i=this.getExecutionInfo(t);try{let o=await this.deps.exec(i.command,i.args,{throwOnStdErr:!1});return r(o.stdout)}catch(o){return p.warn(`Module ${e} not installed in environment ${this.pythonEnvId}`,o),!1}}};function c6(n,e,t,r,i){return{getPythonArgv:o=>e||[Re(o)],getObservablePythonArgv:o=>t||[Re(o)],isValidExecutable:n,exec:async(o,s,a)=>r(o,s,Object.assign({throwOnStdErr:!0},a||{})),shellExec:async(o,s)=>i(o,{timeout:s})}}function u6(n,e,t){let r=c6(async i=>t.exists(i),void 0,void 0,(i,o,s)=>e.exec(i,o,s),(i,o)=>e.shellExec(i,o));return new lD(n,r)}function d6(n,e,t,r,i){let o=["run"];e.name===""?o.push("-p",e.path):o.push("-n",e.name);let s=[n,...o,"python"],a=c6(async l=>i.exists(l),s,void 0,(l,c,u)=>r.exec(l,c,u),(l,c)=>r.shellExec(l,c));return new lD(t,a)}var cD=class extends qe{constructor(t){super("notinstalled",`Module '${t}' not installed.`);this.moduleName=t}};var XM=class{constructor(e){this.deps=e}execObservable(e,t){let r={...t},i=this.deps.getExecutionObservableInfo(e);return this.deps.execObservable(i.command,i.args,r)}execModuleObservable(e,t,r){let i=YM(e,t),o={...r},s=this.deps.getExecutionObservableInfo(i),a={...r};return a.token=void 0,this.deps.execObservable(s.command,s.args,o)}async exec(e,t){let r={...t},i=this.deps.getExecutionInfo(e);return this.deps.exec(i.command,i.args,r)}async execModule(e,t,r){let i=YM(e,t),o={...r},s=this.deps.getExecutionInfo(i),a=await this.deps.exec(s.command,s.args,o);if(e&&UP.outputHasModuleNotInstalledError(e,a.stderr)&&!await this.deps.isModuleInstalled(e))throw new cD(e);return a}};function p6(n,e){let t={isModuleInstalled:async r=>e.isModuleInstalled(r),getExecutionInfo:r=>e.getExecutionInfo(r),getExecutionObservableInfo:r=>e.getExecutionObservableInfo(r),exec:async(r,i,o)=>n.exec(r,i,o),execObservable:(r,i,o)=>n.execObservable(r,i,o)};return new XM(t)}var uD=require("vscode");var dv=class{constructor(e,t,r){this.serviceContainer=e;this.activationHelper=t;this.processServiceFactory=r;this.disposables=this.serviceContainer.get(M),this.fileSystem=this.serviceContainer.get(tt)}async create(e){let t=await this.processServiceFactory.create(e.resource);return m6(e.interpreter,t,this.fileSystem,void 0)}async createActivatedEnvironment(e){if(e.resource=e.resource?e.resource:uD.workspace.workspaceFolders?.length?uD.workspace.workspaceFolders[0].uri:void 0,!uD.workspace.isTrusted)throw new Error("Workspace not trusted");let t=await this.activationHelper.getActivatedEnvironmentVariables(e.resource,e.interpreter);if(!(t&&Object.keys(t).length>0))return this.create({resource:e.resource,interpreter:e.interpreter});let i=new ma({...t});return this.disposables.push(i),m6(e.interpreter,i,this.fileSystem)}};dv=v([(0,pv.injectable)(),m(0,(0,pv.inject)(st)),m(1,(0,pv.inject)(Ps)),m(2,(0,pv.inject)(mo))],dv);function m6(n,e,t,r){let i=u6(n,e,t);if(r){let[s,a]=r;i=d6(s,a,n,e,t)}let o=p6(e,i);return{isModuleInstalled:s=>i.isModuleInstalled(s),execObservable:(s,a)=>o.execObservable(s,a),execModuleObservable:(s,a,l)=>o.execModuleObservable(s,a,l),exec:(s,a)=>o.exec(s,a),execModule:(s,a,l)=>o.execModule(s,a,l)}}var Vc=k(N()),jc=require("vscode");var f6="https://aka.ms/JupyterKernelStartFailureOverrideReservedName",h6=["abc","aifc","antigravity","argparse","array","ast","asynchat","asyncio","asyncore","atexit","audioop","base64","bdb","binascii","binhex","bisect","builtins","bz2","cProfile","calendar","cgi","cgitb","chunk","cmath","cmd","code","codecs","codeop","collections","colorsys","compileall","concurrent","configparser","contextlib","contextvars","copy","copyreg","crypt","csv","ctypes","curses","dataclasses","datetime","dbm","decimal","difflib","dis","distutils","doctest","email","encodings","ensurepip","enum","errno","faulthandler","fcntl","filecmp","fileinput","fnmatch","formatter","fractions","ftplib","functools","gc","genericpath","getopt","getpass","gettext","glob","graphlib","grp","gzip","hashlib","heapq","hmac","html","http","idlelib","imaplib","imghdr","imp","importlib","inspect","io","ipaddress","itertools","json","keyword","lib2to3","linecache","locale","logging","lzma","mailbox","mailcap","marshal","math","mimetypes","mmap","modulefinder","multiprocessing","netrc","nis","nntplib","ntpath","nturl2path","numbers","opcode","operator","optparse","os","parser","pathlib","pdb","pickle","pickletools","pipes","pkgutil","platform","plistlib","poplib","posix","posixpath","pprint","profile","pstats","pty","pwd","py_compile","pyclbr","pydoc","pydoc_data","queue","quopri","random","re","readline","reprlib","resource","rlcompleter","runpy","sched","secrets","select","selectors","shelve","shlex","shutil","signal","site","smtpd","smtplib","sndhdr","socket","socketserver","sqlite3","sre_compile","sre_constants","sre_parse","ssl","stat","statistics","string","stringprep","struct","subprocess","sunau","symbol","symtable","sys","sysconfig","syslog","tabnanny","tarfile","telnetlib","tempfile","termios","textwrap","this","threading","time","timeit","tkinter","token","tokenize","trace","traceback","tracemalloc","tty","turtle","turtledemo","types","typing","unicodedata","unittest","urllib","uu","uuid","warnings","wave","weakref","webbrowser","wsgiref","xdrlib","xml","xmlrpc","zipapp","zipfile","zipimport","zlib","zoneinfo"];var O6=k(qC());var dr=Symbol("IFileSystemNode");var Rle="jupyter.pythonPackages",iK="diagnostics.reservedPythonNames.exclude",fv=class{constructor(e,t,r,i){this.cache=e;this.platform=t;this.fs=i;this.ignoredFiles=new Set;this.cachedModules=new Set;this.pendingUpdate=Promise.resolve();this.disposables=[];r.push(this),this.cachedModules=new Set(this.cache.get(Rle,h6).map(o=>o.toLowerCase())),jc.workspace.onDidChangeConfiguration(o=>{o.affectsConfiguration(`jupyter.${iK}`)&&this.initializeIgnoreList()},this,this.disposables),this.initializeIgnoreList()}dispose(){z(this.disposables)}async getUriOverridingReservedPythonNames(e){let[t,r]=await Promise.all([this.fs.searchLocal("*.py",e.fsPath,!0),this.fs.searchLocal("*/__init__.py",e.fsPath,!0)]),i=[],o=Promise.all(t.map(a=>jc.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"file"})})),s=Promise.all(r.map(a=>jc.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"__init__"})}));return await Promise.all([o,s]),i}async isReserved(e){if(!e.fsPath.toLowerCase().endsWith(".py"))return!1;await this.pendingUpdate;let t=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;if(Array.from(this.ignoredFiles).some(o=>{if(o===t||(0,O6.default)(t,o,{dot:!0}))return!0}))return!1;let r=dn(e,Yu(e)).toLowerCase(),i=r==="__init__"?dn(bi(e)).toLowerCase():r;return this.cachedModules.has(i)}async addToIgnoreList(e){await this.pendingUpdate;let t=jc.workspace.getConfiguration("jupyter"),r=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;this.initializeIgnoreList();let i=this.ignoredFiles.size;if(this.ignoredFiles.add(r),i!==this.ignoredFiles.size)return this.pendingUpdate=this.pendingUpdate.finally(()=>t.update(iK,Array.from(this.ignoredFiles),jc.ConfigurationTarget.Global)),this.pendingUpdate}initializeIgnoreList(){let t=jc.workspace.getConfiguration("jupyter").get(iK,[]);this.platform.isWindows&&(t=t.map(r=>r.toLowerCase())),this.ignoredFiles=new Set(t)}};fv=v([(0,Vc.injectable)(),m(0,(0,Vc.inject)(Le)),m(0,(0,Vc.named)(ut)),m(1,(0,Vc.inject)(wr)),m(2,(0,Vc.inject)(M)),m(3,(0,Vc.inject)(dr))],fv);var HC=k(N());var sK=k(jx());var oK="_VSCODE_getVariable",hv=sK.default`
                            try:
                                del _VSCODE_getVariable
                            except:
                                pass
                            `,qo=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetVariableInfo(e){let t=await this.getContentsOfScript(),r=e.isDebugging?"True":"False",i=`${oK}("info", ${r}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:hv}:{code:`${t}

${i}

${hv}`}}async generateCodeToGetVariableProperties(e){let t=await this.getContentsOfScript(),r=e.isDebugging?"True":"False",i=`${oK}("properties", ${r}, ${e.variableName}, ${e.stringifiedAttributeNameList})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:hv}:{code:`${t}

${i}

${hv}`}}async generateCodeToGetAllVariableDescriptions(e){let t=await this.getContentsOfVariablesScript();return e?t=t+`

return _VSCODE_getAllChildrenDescriptions('${e.root}', ${JSON.stringify(e.propertyChain)}, ${e.startIndex})`:t=t+`

variables= %who_ls
return _VSCODE_getVariableDescriptions(variables)`,t}async generateCodeToGetVariableTypes(e){let r=`${await this.getContentsOfScript()}

_VSCODE_rwho_ls = %who_ls
`,i=e.isDebugging?"True":"False",o=sK.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=`${oK}("types", ${i}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:r,code:s,cleanupCode:`${hv}
${o}`}:{code:`${r}${s}

${hv}
${o}`}}async generateCodeToGetVariableValueSummary(e){let t=await this.getContentsOfVariablesScript();return t=t+`

variables= %who_ls
return _VSCODE_getVariableSummary(${e})`,t}async getContentsOfScript(){if(qo.contentsOfScript)return qo.contentsOfScript;let e=zt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariableInfo.py"),t=await this.fs.readFile(e);return qo.contentsOfScript=t,t}async getContentsOfVariablesScript(){if(qo.contentsOfVariablesScript)return qo.contentsOfVariablesScript;let e=zt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariablesForProvider.py"),t=await this.fs.readFile(e);return qo.contentsOfVariablesScript=t,t}};qo=v([(0,HC.injectable)(),m(0,(0,HC.inject)(tt)),m(1,(0,HC.inject)(Ze))],qo);var GC=require("vscode");var vv=k(N());var gv=class{constructor(e,t,r){this.pythonExtensionChecker=e;this.disposables=t;this.interpreterService=r;this.workspaceInterpreters=new Map}activate(){this.trackActiveInterpreters(),GC.extensions.onDidChange(this.trackActiveInterpreters,this,this.disposables)}isActiveWorkspaceInterpreter(e,t){if(!t)return!1;let r=ys(e),i=this.workspaceInterpreters.get(r);return i?Ko(i,t.uri):!1}trackActiveInterpreters(){Mr()||this.trackingInterpreters||!this.pythonExtensionChecker.isPythonExtensionActive||(this.trackingInterpreters=!0,this.interpreterService.onDidChangeInterpreter(async()=>{let e=Array.isArray(GC.workspace.workspaceFolders)?GC.workspace.workspaceFolders.map(t=>t.uri):[];await Promise.all(e.map(async t=>{try{let r=ys(t),i=await this.interpreterService.getActiveInterpreter(t);this.workspaceInterpreters.set(r,i?.uri)}catch{}}))},this,this.disposables))}};gv=v([(0,vv.injectable)(),m(0,(0,vv.inject)($e)),m(1,(0,vv.inject)(M)),m(2,(0,vv.inject)(et))],gv);function F6(n){n.addSingleton(Fr,dv),n.addSingleton(Ds,Ds),n.addSingleton(_l,_l),n.addSingleton(vd,_s),n.addSingleton(me,ca),n.addSingleton(me,cv),n.addSingleton(Fk,gv),n.addSingleton(me,Yg),n.addSingleton(me,Xg),n.addSingleton(me,Ud),n.addSingleton(ii,ii),n.addSingleton(Ok,fv),n.addSingleton(Oh,qo),n.addSingleton(Fh,Ll),n.addSingleton(Am,rv),n.addSingleton(Am,iv),n.addSingleton(Am,nv),n.addSingleton(Am,ov),n.addSingleton(zx,Zg),n.addSingleton(VC,lv),n.addSingleton(Ai,sv),n.addSingleton(jC,av,"DataScience"),n.addSingleton(Ts,Ts),n.addBinding(Ts,me)}var V6=k(N()),bv=require("vscode");var U6=new Set;function W6(n){U6.add(n)}function L6(n){try{U6.forEach(e=>e.report(n))}catch(e){p.error("Failed to report progress",e)}}function yv(n){return function(e,t,r){let i=r.value;r.value=async function(...o){return L6({action:n,phase:"started"}),i.apply(this,o).finally(()=>{L6({action:n,phase:"completed"})})}}}var Ho=class{constructor(){this.progressReporters=[];this.actionPhases=new Map;this.currentActions=[];W6(this)}get currentAction(){return this.currentActions.length===0?void 0:this.currentActions[this.currentActions.length-1]}createProgressIndicator(e,t=!1){let r=new bv.CancellationTokenSource,i=re(),o={location:bv.ProgressLocation.Notification,cancellable:t,title:e};return bv.window.withProgress(o,async(s,a)=>{a.onCancellationRequested(()=>{a.isCancellationRequested&&r.cancel(),i.resolve()}),r.token.onCancellationRequested(()=>{i.resolve()}),this.progressReporters.push(s),await i.promise}).then(h,h),{token:r.token,dispose:()=>i.resolve()}}report(e){if(this.progressReporters.length!==0&&(this.actionPhases.set(e.action,e.phase),e.phase==="started"&&this.currentActions.push(e.action),!!this.currentAction)){for(;this.actionPhases.get(this.currentAction)&&this.actionPhases.get(this.currentAction)!=="started";)this.actionPhases.delete(this.currentAction),this.currentActions.pop();this.updateProgressMessage()}}updateProgressMessage(){if(!this.currentAction||this.progressReporters.length===0)return;let e=Gk(this.currentAction);e&&this.progressReporters.forEach(t=>t.report({message:e}))}};Ho=v([(0,V6.injectable)()],Ho);var j6=k(N());var Hn=require("vscode");var Jc=require("vscode");var zC=class n{constructor(e){this.jupyterConfig=e}static{this.migratedSettings={interactiveWindowMode:"interactiveWindow.creationMode",interactiveWindowViewColumn:"interactiveWindow.viewColumn",splitRunFileIntoCells:"interactiveWindow.splitRunFileIntoCells",interactiveReplNotebook:"interactiveWindow.notebookRepl",sendSelectionToInteractiveWindow:"interactiveWindow.textEditor.executeSelection",normalizeSelectionForInteractiveWindow:"interactiveWindow.textEditor.normalizeSelection",magicCommandsAsComments:"interactiveWindow.textEditor.magicCommandsAsComments",enableAutoMoveToNextCell:"interactiveWindow.textEditor.autoMoveToNextCell",newCellOnRunLast:"interactiveWindow.textEditor.autoAddNewCell",pythonCellFolding:"interactiveWindow.textEditor.cellFolding",enableCellCodeLens:"interactiveWindow.codeLens.enable",addGotoCodeLenses:"interactiveWindow.codeLens.enableGotoCell",codeLenses:"interactiveWindow.codeLens.commands",debugCodeLenses:"interactiveWindow.codeLens.debugCommands","interactiveWindow.codeLes.debugCommands":"interactiveWindow.codeLens.debugCommands",codeRegularExpression:"interactiveWindow.cellMarker.codeRegex",markdownRegularExpression:"interactiveWindow.cellMarker.markdownRegex",decorateCells:"interactiveWindow.cellMarker.decorateCells",defaultCellMarker:"interactiveWindow.cellMarker.default",enableExtendedKernelCompletions:"enableExtendedPythonKernelCompletions"}}static{this.fullSettingIds={...this.migratedSettings}}async migrateSettings(){let e=[];for(let t of Object.keys(n.migratedSettings))e.push(...this.migrateSetting(t,n.migratedSettings[t]));e.push(this.migrateIntellisenseSettings());try{await Promise.all(e)}catch(t){Iv(t)}}async migrateIntellisenseSettings(){let e="pythonCompletionTriggerCharacters",t="completionTriggerCharacters",r=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t);try{if(r?.globalValue===r?.defaultValue||!i||i?.globalValue&&i.globalValue[ge])return;if(typeof r?.globalValue=="string"){let o=i.globalValue||i.defaultValue||{};o[ge]=r.globalValue.split(""),await this.jupyterConfig.update(t,o,Jc.ConfigurationTarget.Global).then(h,Iv)}}finally{r?.globalValue&&await this.jupyterConfig.update(e,void 0,Jc.ConfigurationTarget.Global).then(h,Iv)}}migrateSetting(e,t){let r=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t),o=[];if(r?.workspaceValue!==void 0){let s=Promise.resolve();i?.workspaceValue===void 0&&(s=this.jupyterConfig.update(t,r.workspaceValue,Jc.ConfigurationTarget.Workspace)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Jc.ConfigurationTarget.Workspace),Iv))}if(r?.workspaceFolderValue!==void 0){let s=Promise.resolve();i?.workspaceFolderValue===void 0&&(s=this.jupyterConfig.update(t,r.workspaceFolderValue,Jc.ConfigurationTarget.WorkspaceFolder)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Jc.ConfigurationTarget.WorkspaceFolder),Iv))}if(r?.globalValue!==void 0){let s=Promise.resolve();i?.globalValue===void 0&&(s=this.jupyterConfig.update(t,r.globalValue,Jc.ConfigurationTarget.Global)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Jc.ConfigurationTarget.Global),Iv))}return o}};function Iv(n){p.warn("Error migrating Jupyter configuration",n)}function Ale(n){return(e,t,r)=>{let i=null,o=null;if(typeof r.value=="function"?(i="value",o=r.value):typeof r.get=="function"&&(i="get",o=r.get),!o)throw new Error("not supported");r[i]=n(o,t)}}function Sv(n,e,t){return Ale((r,i)=>{let o=`$debounce$${i}`,s=`$debounce$result$${i}`;return function(...a){this[s]||(this[s]=t?t():void 0),clearTimeout(this[o]),e&&(this[s]=e(this[s],...a),a=[this[s]]),this[o]=setTimeout(()=>{r.apply(this,a),this[s]=t?t():void 0},n)}})}var ha=class ha{constructor(e,t,r){this._systemVariablesCtor=t;this._type=r;this.allowUnauthorizedRemoteConnection=!1;this.jupyterInterruptTimeout=1e4;this.jupyterLaunchTimeout=6e4;this.jupyterLaunchRetries=3;this.notebookFileRoot="";this.useDefaultConfigForJupyter=!1;this.sendSelectionToInteractiveWindow=!1;this.splitRunFileIntoCells=!0;this.markdownRegularExpression="";this.codeRegularExpression="";this.errorBackgroundColor="";this.variableExplorerExclude="";this.decorateCells="currentCell";this.enableCellCodeLens=!1;this.askForLargeDataFrames=!1;this.enableAutoMoveToNextCell=!1;this.askForKernelRestart=!1;this.codeLenses="";this.debugCodeLenses="";this.debugpyDistPath="";this.stopOnFirstLineWhileDebugging=!1;this.magicCommandsAsComments=!1;this.pythonExportMethod="direct";this.stopOnError=!1;this.addGotoCodeLenses=!1;this.runStartupCommands=[];this.debugJustMyCode=!1;this.defaultCellMarker="";this.themeMatplotlibPlots=!1;this.disableJupyterAutoStart=!1;this.enablePythonKernelLogging=!1;this.jupyterCommandLineArguments=[];this.widgetScriptSources=[];this.interactiveWindowMode="multiple";this.pythonCellFolding=!0;this.interactiveWindowViewColumn="secondGroup";this.disableZMQSupport=!1;this.forceIPyKernelDebugger=!1;this.verboseLogging=!1;this.showVariableViewWhenDebugging=!0;this.newCellOnRunLast=!0;this.logKernelOutputSeparately=!1;this.development=!1;this.poetryPath="";this.excludeUserSitePackages=!1;this.enableExtendedPythonKernelCompletions=!1;this.formatStackTraces=!1;this.interactiveReplNotebook=!1;this._changeEmitter=new Hn.EventEmitter;this._disposables=[];this._workspaceRoot=e,this.initialize(),Hn.workspace.isTrusted===!1&&(this.disableJupyterAutoStart=!0)}get onDidChange(){return this._changeEmitter.event}static{this.jupyterSettings=new Map}static getInstance(e,t,r){let i=ha.getSettingsUriAndTarget(e).uri,o=i?i.path:"",s=ha.jupyterSettings.get(o);return s?s._type==="web"&&r==="node"&&(s._systemVariablesCtor=t,s._type=r):(s=new ha(i,t,r),ha.jupyterSettings.set(o,s)),s}static getSettingsUriAndTarget(e){let t=e?Hn.workspace.getWorkspaceFolder(e):void 0,r=t?t.uri:void 0;!r&&Array.isArray(Hn.workspace.workspaceFolders)&&Hn.workspace.workspaceFolders.length>0&&(r=Hn.workspace.workspaceFolders[0].uri);let i=r?Hn.ConfigurationTarget.WorkspaceFolder:Hn.ConfigurationTarget.Global;return{uri:r,target:i}}static dispose(){if(!kr())throw new Error("Dispose can only be called from unit tests");ha.jupyterSettings.forEach(e=>e&&e.dispose()),ha.jupyterSettings.clear()}dispose(){this._disposables.forEach(e=>e&&e.dispose()),this._disposables=[]}createSystemVariables(e){return new this._systemVariablesCtor(e,this._workspaceRoot)}toJSON(){let e={};return this.getSerializableKeys().forEach(r=>e[r]=this[r]),e}update(e,t){let r=this.createSystemVariables(void 0),i=r.resolveAny(e.get("experiments"));this.experiments?Object.assign(this.experiments,i):this.experiments=i,this.experiments=this.experiments?this.experiments:{enabled:!0,optInto:[],optOutFrom:[]};let o=(a,l)=>{let c=zC.fullSettingIds[a],u=c&&l.get(c)!==void 0?l.get(c):l.get(a),d=r.resolveAny(u);d!==void 0&&(this[a]=d)};this.getSerializableKeys().filter(a=>a!=="experiments"&&a!=="logging"&&a!=="kernelPickerType").forEach(a=>o(a,e)),t&&o("poetryPath",t)}onWorkspaceFoldersChanged(){let e=(Hn.workspace.workspaceFolders||[]).map(i=>i.uri.path),r=Array.from(ha.jupyterSettings.keys()).filter(i=>e.indexOf(i)<0);if(r.length>0)for(let i of r)ha.jupyterSettings.delete(i)}initialize(){let e=()=>{let i=Hn.workspace.getConfiguration("jupyter",this._workspaceRoot),o=Hn.workspace.getConfiguration("python",this._workspaceRoot);this.update(i,o),this.debounceChangeNotification()};this._disposables.push(Hn.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this)),this._disposables.push(Hn.workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("jupyter")&&e(),i.affectsConfiguration("python.poetryPath")&&e()}));let t=Hn.workspace.getConfiguration("jupyter",this._workspaceRoot),r=Hn.workspace.getConfiguration("python",this._workspaceRoot);t&&(this.update(t,r),this.migrateSettings(t).catch(h))}async migrateSettings(e){await new zC(e).migrateSettings()}debounceChangeNotification(){this._changeEmitter.fire()}fireChangeNotification(){this._changeEmitter.fire()}getSerializableKeys(){return Object.getOwnPropertyNames(this).filter(e=>!e.startsWith("_"))}};v([Sv(1)],ha.prototype,"debounceChangeNotification",1);var Cv=ha;var Vl=require("vscode");var mD=class{async updateSectionSetting(e,t,r,i,o){let a={uri:i,target:o||Vl.ConfigurationTarget.WorkspaceFolder};e==="jupyter"&&o!==Vl.ConfigurationTarget.Global&&(a=Cv.getSettingsUriAndTarget(i));let l=Vl.workspace.getConfiguration(e,a.uri),c=l.inspect(t);c!==void 0&&(o===Vl.ConfigurationTarget.Global&&c.globalValue===r||o===Vl.ConfigurationTarget.Workspace&&c.workspaceValue===r||o===Vl.ConfigurationTarget.WorkspaceFolder&&c.workspaceFolderValue===r)||(await l.update(t,r,o),o&&await this.verifySetting(l,o,t,r))}async updateSetting(e,t,r,i){return this.updateSectionSetting("jupyter",e,t,r,i)}async verifySetting(e,t,r,i){if(kr()&&!TS()){let o=0;do{let s=e.inspect(r);if(!s&&i===void 0||s&&i!==void 0&&(t===Vl.ConfigurationTarget.Global?s.globalValue:t===Vl.ConfigurationTarget.Workspace?s.workspaceValue:s.workspaceFolderValue)===i)break;await new Promise(a=>setTimeout(a,250)),o+=1}while(o<20)}}};var Ev=class extends mD{getSettings(e){return Cv.getInstance(e,qg,"node")}};Ev=v([(0,j6.injectable)()],Ev);var Mn=k(Jo()),F$=k(bK()),L$=k(N()),U$=k(T$()),W$=require("util");var K$=k(N()),qd=k(require("vscode"));var N$=k(A$()),M$=require("vscode"),jl=class{constructor(e=N$.fetch){this.fetchImplementation=e;this.requestOptions={};let t=M$.workspace.getConfiguration("http").get("proxy","");t&&(this.requestOptions={headers:{proxy:t}})}async downloadFile(e){return this.fetchImplementation(e,this.requestOptions)}async exists(e){try{return(await this.downloadFile(e)).status===200}catch(t){return p.debug(`HttpClient - Failure checking for file ${e}: ${t}`),!1}}};var O$="utf8",Dv=class{constructor(){this.vscfs=qd.workspace.fs}arePathsSame(e,t){return yi(e,t)}async getFiles(e){return(await this.vscfs.readDirectory(e)).filter(r=>r[1]===qd.FileType.File).map(r=>qd.Uri.file(r[0]))}async copy(e,t,r){await this.vscfs.copy(e,t,r)}async createDirectory(e){await this.vscfs.createDirectory(e)}async delete(e){await this.vscfs.delete(e)}async readFile(e){let t=await this.vscfs.readFile(e);return new TextDecoder().decode(t)}async stat(e){return this.vscfs.stat(e)}async writeFile(e,t){return this.vscfs.writeFile(e,typeof t=="string"?new TextEncoder().encode(t):t)}async exists(e,t){if(e.scheme.toLowerCase()==="http"||e.scheme.toLowerCase()==="https")return new jl().exists(e.toString());let r;try{r=await this.stat(e)}catch(i){return Kx(i)||p.error(`stat() failed for "${e}"`,i),!1}return t===void 0?!0:t===qd.FileType.Unknown?r.type===qd.FileType.Unknown:(r.type&t)===t}async getFileHash(e){let t=await this.stat(e),r=`${t.ctime}-${t.mtime}`;return ia(r,"SHA-512")}};Dv=v([(0,K$.injectable)()],Dv);var V$=require("vscode");var qc=class extends Dv{constructor(){super();this.globFiles=(0,W$.promisify)(F$.default)}createLocalWriteStream(t){return Mn.createWriteStream(t)}async createTemporaryLocalFile(t){let r=typeof t=="string"?t:t.fileExtension,i=t&&typeof t=="object"?t.prefix:void 0,o={postfix:r,prefix:i};return new Promise((s,a)=>{U$.file(o,(l,c,u,d)=>{if(l)return a(l);s({filePath:c,dispose:d})})})}async searchLocal(t,r,i){let o;r&&(o={...o,cwd:r}),i&&(o={...o,dot:i});let s=await this.globFiles(t,o);return Array.isArray(s)?s:[]}async writeLocalFile(t,r){return await Mn.ensureDir(rt(t)),Mn.writeFile(t,r)}async readFile(t){if(Lm(t)){let r=await Mn.readFile(Re(t));return Buffer.from(r).toString(O$)}else return super.readFile(t)}async delete(t){Lm(t)?await this.exists(t)&&((await this.stat(t)).type===V$.FileType.Directory?await new Promise(i=>Mn.rm(Re(t),{force:!0,recursive:!0},i)):await Mn.unlink(Re(t))):await super.delete(t)}async exists(t,r){return Lm(t)?Mn.pathExists(Re(t)):super.exists(t,r)}async createDirectory(t){Lm(t)?await Mn.ensureDir(Re(t)):await this.vscfs.createDirectory(t)}async writeFile(t,r){if(Lm(t)){let i=Re(t);return await Mn.ensureDir(rt(i)),Mn.writeFile(i,typeof r=="string"?Buffer.from(r):r)}else await this.vscfs.writeFile(t,typeof r=="string"?new TextEncoder().encode(r):r)}async copy(t,r,i){if(Lm(t)&&Lm(r)){let o=typeof i===void 0||typeof i?.overwrite==null?!0:i?.overwrite;await Mn.copy(Re(t),Re(r),{overwrite:o})}else await super.copy(t,r,i)}};qc=v([(0,L$.injectable)()],qc);function Lm(n){return n.scheme==="file"}var rE=k(Jo());var j$=k(N()),J$=require("vscode");var _v=class extends nk{async computeWorkingDirectory(e){return nE(e)}};_v=v([(0,j$.injectable)()],_v);async function nE(n){let e=n&&n.scheme==="file"?await rE.pathExists(n.fsPath):!1;return(n&&n.scheme==="file"?await rE.pathExists(rt(n.fsPath)):!1)&&n&&n.fsPath.includes(".")?rt(n.fsPath):e&&n&&(await rE.stat(n.fsPath)).isDirectory()?n.fsPath:n&&J$.workspace.getWorkspaceFolder(n)?.uri.fsPath||vl()?.fsPath||process.cwd()}var Um=k(N());var B$=require("vscode");var Tv=class{constructor(e,t){this.jupyterOutput=e;this.disposableRegistry=t}register(){this.disposableRegistry.push(B$.commands.registerCommand(J.ViewJupyterOutput,this.viewJupyterOutput,this))}viewJupyterOutput(){this.jupyterOutput.show(!0)}};Tv=v([(0,Um.injectable)(),m(0,(0,Um.inject)(Mo)),m(0,(0,Um.named)(Wu)),m(1,(0,Um.inject)(M))],Tv);var iE=k(N()),q$=require("vscode");var $$=require("vscode");var Rv=class{constructor(e,t,r,i=[]){this.fs=e;this.disposableRegistry=t;this.options=r;this.loadFailedEmitter=new $$.EventEmitter;let o={enableScripts:!0,localResourceRoots:[this.options.rootPath,this.options.cwd,...i]};r.webviewHost?(this.webviewHost=r.webviewHost,this.webviewHost.webview.options=o):this.webviewHost=this.createWebview(o),this.loadPromise=this.load()}get loadFailed(){return this.loadFailedEmitter.event}asWebviewUri(e){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");return this.webviewHost.webview.asWebviewUri(e)}postMessage(e){this.webviewHost?.webview&&this.webviewHost?.webview.postMessage(e)}async generateLocalReactHtml(){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");let e=this.webviewHost.webview.asWebviewUri(this.options.cwd).toString(),t=this.options.scripts.map(o=>this.webviewHost.webview.asWebviewUri(o)),r=this.webviewHost.webview.asWebviewUri(this.options.rootPath).toString(),i="false";return`<!doctype html>
        <html lang="en">
            <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
                <meta http-equiv="Content-Security-Policy" content="img-src 'self' data: https: http: blob: ${this.webviewHost.webview.cspSource}; default-src 'unsafe-inline' 'unsafe-eval' data: https: http: blob: ${this.webviewHost.webview.cspSource};">
                <meta name="theme-color" content="#000000">
                <meta name="theme" content="${Je.GeneratedThemeName}"/>
                <title>VS Code Python React UI</title>
                <base href="${e}${e.endsWith("/")?"":"/"}"/>
                </head>
            <body>
                <noscript>You need to enable JavaScript to run this app.</noscript>
                <div id="root"></div>
                <script type="text/javascript">
                    // Public path that will be used by webpack.
                    window.__PVSC_Public_Path = "${r}/";
                    function resolvePath(relativePath) {
                        if (relativePath && relativePath[0] == '.' && relativePath[1] != '.') {
                            return "${e}" + relativePath.substring(1);
                        }

                        return "${e}" + relativePath;
                    }
                    function forceTestMiddleware() {
                        return ${i};
                    }
                </script>
                ${t.map(o=>`<script type="text/javascript" src="${o}"></script>`).join(`
`)}
            </body>
        </html>`}async load(){try{this.webviewHost?.webview&&((await Promise.all(this.options.scripts.map(t=>this.fs.exists(t)))).every(t=>t===!0)?(this.webviewHost.webview.html=await this.generateLocalReactHtml(),this.postLoad(this.webviewHost)):this.webviewHost.webview.html=y.badWebPanelFormatString(this.options.scripts.join(", ")))}catch(e){p.error(`Error Loading WebviewPanel: ${e}`),this.loadFailedEmitter.fire()}}};var MK=class extends Rv{constructor(t,r,i,o=[]){super(t,r,i,o);this.panelOptions=i;this._onDidChangeVisibility=new q$.EventEmitter}get visible(){return this.webviewHost?this.webviewHost.visible:!1}get onDidChangeVisibility(){return this._onDidChangeVisibility.event}createWebview(t){throw new Error("Webview Views must be passed in an initial view")}postLoad(t){this.disposableRegistry.push(t.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose()})),this.disposableRegistry.push(t.webview.onDidReceiveMessage(r=>{this.panelOptions.listener.onMessage(r.type,r.payload)})),this.disposableRegistry.push(t.onDidChangeVisibility(()=>{this._onDidChangeVisibility.fire()})),this._onDidChangeVisibility.fire()}},Av=class{constructor(e,t){this.disposableRegistry=e;this.fs=t}async create(e){return new MK(this.fs,this.disposableRegistry,e)}};Av=v([(0,iE.injectable)(),m(0,(0,iE.inject)(M)),m(1,(0,iE.inject)(tt))],Av);var Mv=k(N()),ID=require("vscode");var KK=class extends Rv{get panel(){return this.webviewHost}get panelOptions(){return this.options}constructor(e,t,r,i=[]){super(e,t,r,i)}async show(e){await this.loadPromise,this.panel&&(e?this.panel.visible||this.panel.reveal(this.panel.viewColumn,e):this.panel.active||this.panel.reveal(this.panel.viewColumn,e))}close(){this.panel&&this.panel.dispose()}get viewColumn(){return this.panel?.viewColumn}isVisible(){return this.panel?this.panel.visible:!1}isActive(){return this.panel?this.panel.active:!1}setTitle(e){this.panelOptions.title=e,this.panel&&(this.panel.title=e)}createWebview(e){return ID.window.createWebviewPanel(this.panelOptions.title.toLowerCase().replace(" ",""),this.panelOptions.title,{viewColumn:this.panelOptions.viewColumn,preserveFocus:!0},{retainContextWhenHidden:!0,enableFindWidget:!0,...e})}postLoad(e){this.disposableRegistry.push(e.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose()})),this.disposableRegistry.push(e.webview.onDidReceiveMessage(t=>{this.panelOptions.listener.onMessage(t.type,t.payload)})),this.disposableRegistry.push(e.onDidChangeViewState(t=>{this.panelOptions.listener.onChangeViewState(this)})),this.panelOptions.listener.onChangeViewState(this)}},Nv=class{constructor(e,t,r){this.disposableRegistry=e;this.fs=t;this.context=r}async create(e){let t=[ID.Uri.file(We(this.context.extensionPath,"temp"))];return Array.isArray(e.additionalPaths)&&t.push(...e.additionalPaths),new KK(this.fs,this.disposableRegistry,e,t)}};Nv=v([(0,Mv.injectable)(),m(0,(0,Mv.inject)(M)),m(1,(0,Mv.inject)(tt)),m(2,(0,Mv.inject)(Ze))],Nv);function H$(n){n.addSingleton(qc,qc),n.addBinding(qc,dr),n.addBinding(qc,tt),n.addSingleton(Zk,_v),n.addSingleton(ie,Ev),I9(n),w3(n),k3(n),F6(n),n.addSingletonInstance(VU,Date.now()),n.addSingleton(Ho,Ho),n.addSingleton(me,lt),n.addSingleton(Kh,Tv),n.add(ex,Av),n.add(kd,Nv)}var Wm=k(N()),Z$=require("vscode");var zd=k(N()),Fv=require("vscode");var oE=k(N()),Hc=require("vscode");var Kv=Symbol("IJupyterCommandFactory"),Hd=Symbol("IJupyterSubCommandExecutionService");function Ece(n){n.sort((e,t)=>e===18?-1:t===18?1:e===20?-1:t===20?1:0)}function OK(n,e){let t=nn(e)||lr(e)?.environment?.folderUri?.fsPath||e.uri.fsPath,r=n.map(i=>ur.get(i)).filter(i=>!!i).map(i=>i);switch(r.length){case 0:return"";case 1:return t?y.libraryRequiredToLaunchJupyterNotInstalledInterpreter(t,r[0]):y.libraryRequiredToLaunchJupyterNotInstalled(r[0]);default:{let i=r.pop();return t?y.librariesRequiredToLaunchJupyterNotInstalledInterpreter(t,`${r.join(", ")} ${le.and} ${i}`):y.librariesRequiredToLaunchJupyterNotInstalled(`${r.join(", ")} ${le.and} ${i}`)}}}var Rs=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.dependenciesInstalledInInterpreter=new Set}async installMissingDependencies(e,t){let r=new Hc.CancellationTokenSource;try{let i=Ve(e)==="Conda"?Promise.resolve(void 0):this.installer.isInstalled(27,e),[o,s]=await Promise.all([this.getDependenciesNotInstalled(e,void 0),i]);if(o.length===0)return 0;let a=OK(s===!1?[27].concat(o):o,e);switch(R("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:ur.get(18),pythonEnvType:Ve(e)}),await Hc.window.showErrorMessage(a,{modal:!0},y.jupyterInstall,y.selectDifferentJupyterInterpreter)){case y.jupyterInstall:{o.includes(21)&&!o.includes(18)&&o.push(18);let c=o.filter(d=>d!==21);Ece(c);let u=c.shift();for(;u;)if(await tr(r.token,2,this.installer.install(u,e,r,void 0,s===!1))===0){u=c.shift();continue}else return 2;return R("DATASCIENCE.USER_INSTALLED_JUPYTER"),this.checkKernelSpecAvailability(e)}case y.selectDifferentJupyterInterpreter:return R("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),1;case y.pythonInteractiveHelpLink:return Hc.env.openExternal(Hc.Uri.parse(_S.PythonInteractiveHelpLink)),R("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2;default:return R("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2}}finally{r.dispose()}}async areDependenciesInstalled(e,t){return this.getDependenciesNotInstalled(e,t).then(r=>r.length===0)}async getDependenciesNotInstalled(e,t){let r=un(e.uri);if(this.dependenciesInstalledInInterpreter.has(r))return[];let i=[];if(await tr(t,Promise.all([this.installer.isInstalled(18,e).then(s=>s?void 0:i.push(18)),this.installer.isInstalled(20,e).then(s=>s?void 0:i.push(20))])),i.length>0)return i;if(t?.isCancellationRequested)return[];let o=await this.isKernelSpecAvailable(e,t).then(s=>s?[]:[21]);return o.length===0&&this.dependenciesInstalledInInterpreter.add(r),o}async isKernelSpecAvailable(e,t){return this.commandFactory.createInterpreterCommand("kernelspec","jupyter",["-m","jupyter","kernelspec"],e,!1).exec(["--version"],{throwOnStdErr:!0}).then(()=>!0).catch(i=>(p.error("Kernel spec not found: ",i),!1))}async checkKernelSpecAvailability(e,t){return await this.isKernelSpecAvailable(e)?0:t?.isCancellationRequested?2:await Hc.window.showErrorMessage(y.jupyterKernelSpecModuleNotFound(e.uri.fsPath),{modal:!0},y.selectDifferentJupyterInterpreter)===y.selectDifferentJupyterInterpreter?1:2}};v([yv("InstallingMissingDependencies")],Rs.prototype,"installMissingDependencies",1),Rs=v([(0,oE.injectable)(),m(0,(0,oE.inject)(Ai)),m(1,(0,oE.inject)(Kv))],Rs);var PD=k(N());var kD=require("vscode");var z$=require("vscode");function SD(n,e){let t=nn(n),i={label:`${n.id===e.recommended?.id?"$(star-full) ":Jr(n)?"$(warning) ":""}${t}`};return i.description=U(n.executable.uri||n.path,z$.workspace.workspaceFolders||[],new Kl().homeDir),i.tooltip=Jr(n)?y.pythonCondaKernelsWithoutPython:"",i}function CD(n){switch(Ve(n)){case"Conda":return Jr(n)?{label:y.kernelCategoryForCondaWithoutPython,sortKey:"Z"}:{label:y.kernelCategoryForConda};case"PipEnv":return{label:y.kernelCategoryForPipEnv};case"Poetry":return{label:y.kernelCategoryForPoetry};case"Pyenv":return{label:y.kernelCategoryForPyEnv};case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return{label:y.kernelCategoryForVirtual};default:return{label:y.kernelCategoryForGlobal}}}var As=k(N()),Q$=require("vscode");var ED="INTERPRETER_PATH_SELECTED_FOR_JUPYTER_SERVER",FK="INTERPRETER_PATH_WAS_SELECTED_FOR_JUPYTER_SERVER",ga=class{constructor(e){this.memento=e}get interpreterSetAtleastOnce(){return!!this.selectedPythonPath||this.memento.get(FK,!1)}get selectedPythonPath(){if(this._interpreterPath)return this._interpreterPath;let e=this.memento.get(ED,void 0);if(e)return Q$.Uri.parse(e)}updateSelectedPythonPath(e){this._interpreterPath=e,this.memento.update(ED,e?.toString()).then(h,h),this.memento.update(FK,!0).then(h,h)}};ga=v([(0,As.injectable)(),m(0,(0,As.inject)(Le)),m(0,(0,As.named)(ut))],ga);var Ov=class{constructor(e,t,r,i){this.api=e;this.memento=t;this.checker=r;this.disposables=i}activate(){this.activateBackground().catch(h),this.api.onDidActivatePythonExtension(this.activateBackground,this,this.disposables)}async activateBackground(){!this.memento.get(ED)&&this.checker.isPythonExtensionActive&&await this.migrateSettings()}async migrateSettings(){if(this.settingsMigrated)return;this.settingsMigrated=!0;let t=(await this.api.getApi()).getInterpreterPathSelectedForJupyterServer();await this.memento.update(ED,t),await this.memento.update(FK,!0)}};Ov=v([(0,As.injectable)(),m(0,(0,As.inject)(Qt)),m(1,(0,As.inject)(Le)),m(1,(0,As.named)(ut)),m(2,(0,As.inject)($e)),m(3,(0,As.inject)(M))],Ov);var Qi=require("vscode");var LK=class{constructor(e){this.label=e}},wD=class extends LK{constructor(t,r){super(t);this.sortKey=r;this.kind=Qi.QuickPickItemKind.Separator}},Gd=class extends $t{constructor(t,r,i,o,s,a){super();this.provider=t;this.createQuickPickItem=r;this.getCategory=i;this.options=o;this.createErrorQuickPickItem=s;this._title=a;this.categories=new Map;this.quickPickItems=[];this.previouslyEnteredValue="";this.commands=[];this._placeholder="";this.quickPickItemMap=new WeakSet;this.errorQuickPickItemMap=new WeakSet}set recommended(t){let r=this._recommended?.id!==t?.id;this._recommended=t,r&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get recommended(){return this._recommended}set placeholder(t){this.quickPick&&(this.quickPick.placeholder=t),this._placeholder=t}get placeholder(){return this._placeholder}set selected(t){let r=this._selected!==t;this._selected=t,r&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get selected(){return this._selected}createQuickPick(){let t=[],r={iconPath:new Qi.ThemeIcon("refresh"),tooltip:le.refresh},i=this.quickPick=Qi.window.createQuickPick();return t.push(i),this.quickPickItems=[],i.placeholder=this.placeholder,i.matchOnDescription=!0,i.buttons=this.options.supportsBack?[Qi.QuickInputButtons.Back,r]:[r],i.ignoreFocusOut=!0,i.busy=!0,i.value=this.previouslyEnteredValue,i.onDidChangeValue(o=>this.previouslyEnteredValue=o,this,t),i.onDidHide(()=>z(t),this,t),i.title=this._title||y.kernelPickerSelectKernelFromRemoteTitleWithoutName,this.provider.then(o=>{this.resolvedProvider=o,this._title||(i.title=y.kernelPickerSelectKernelFromRemoteTitle(o.title)),i.busy=o.status==="discovering",o.onDidChange(()=>this.updateQuickPickItems(i,o),this,t),i.onDidTriggerButton(async a=>{a===r&&(i.busy=!0,await o.refresh().catch(h),this.updateQuickPickItems(i,o),i.busy=!1)},this,t);let s;o.onDidChangeStatus(()=>{switch(s&&clearTimeout(s),o.status){case"discovering":i.busy=!0;break;case"idle":s=setTimeout(()=>i.busy=!1,500),t.push(new Qi.Disposable(()=>s&&clearTimeout(s)));break}},this,t),Y$(o.items.map(a=>this.toQuickPickItem(a)),(a,l)=>X$(this.getCategory(a.item,this),this.getCategory(l.item,this))).forEach(a=>{let l=this.connectionToCategory(a[0].item);this.quickPickItems.push(l),a.sort((c,u)=>c.label.localeCompare(u.label)),this.quickPickItems.push(...a),this.categories.set(l,new Set(a))}),this.updateQuickPickItems(i,o)}).catch(o=>p.error(`Failed to get quick pick items for ${i.title}`,o)),t.forEach(o=>this._register(o)),{quickPick:i,disposables:t}}isCommandQuickPickItem(t){return this.commands.indexOf(t)>=0}addCommand(t,r,i){let o;i&&(o={execute:()=>Promise.resolve(void 0),label:y.recommendedItemCategoryInQuickPick,kind:Qi.QuickPickItemKind.Separator},this.commands.push(o));let s=t;return s.execute=r,this.commands.push(s),this.quickPick&&this.rebuildQuickPickItems(this.quickPick),{dispose:()=>{if(o){let l=this.commands.indexOf(o);l>=0&&this.commands.splice(l,1)}let a=this.commands.indexOf(s);a>=0&&this.commands.splice(a,1)}}}async selectItem(t){for(;!t.isCancellationRequested;){let{quickPick:r,disposables:i}=this.createQuickPick();r.show();try{this.previouslySelectedItem=void 0;let o=await new Promise((s,a)=>{r.onDidChangeSelection(l=>{if(l.length){let c=l[0];this.isSelectorQuickPickItem(c)?s(c.item):this.isCommandQuickPickItem(c)?s(c):this.isErrorQuickPickItem(c)}}),r.onDidTriggerButton(l=>l===Qi.QuickInputButtons.Back?s(xe.back):void 0,this,i),r.onDidHide(()=>s(void 0),this,i)});if(t.isCancellationRequested||!o)return;if(o instanceof xe)return o===xe.back?xe.back:void 0;if(o&&"label"in o&&this.isCommandQuickPickItem(o)){this.previouslySelectedItem=o;let s=await o.execute();if(!s||s===xe.back)continue;return s instanceof xe,s}return o||void 0}finally{z(i)}}}updateQuickPickItems(t,r){let i=new Map(t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>[a.item.id,a.item])),o=new Map(r.items.map(a=>[a.id,a]));this.quickPickItems=this.quickPickItems.map(a=>{if(this.isSelectorQuickPickItem(a)){let l=i.get(a.item.id);if(l&&l!==a.item)return this.toQuickPickItem(l);let c=o.get(a.item.id);if(c){let u=this.toQuickPickItem(c);if(JSON.stringify({...a,item:""})!==JSON.stringify({...u,item:""}))return this.toQuickPickItem(c)}}return a});let s=r.items.filter(a=>!i.has(a.id)).map(a=>this.toQuickPickItem(a));this.removeOutdatedQuickPickItems(t,r),Y$(s,(a,l)=>X$(this.getCategory(a.item,this),this.getCategory(l.item,this))).forEach(a=>{a.sort((u,d)=>u.label.localeCompare(d.label));let l=this.connectionToCategory(a[0].item),c=this.quickPickItems.find(u=>u.kind===Qi.QuickPickItemKind.Separator&&u.label===l.label);if(c){let u=this.quickPickItems.indexOf(c),d=this.categories.get(c),f=new Map(Array.from(d).map(I=>[I.item.id,I])),g=d.size;a.forEach(I=>{let w=f.get(I.item.id);w&&d.delete(w),d.add(I)});let b=Array.from(d);b.sort((I,w)=>I.label.localeCompare(w.label)),this.quickPickItems.splice(u+1,g,...b)}else{let u=this.quickPickItems.filter(g=>g instanceof wD).map((g,b)=>[g,b]);u.push([l,-1]),u.sort((g,b)=>g[0].sortKey.localeCompare(b[0].sortKey));let d=u.findIndex(g=>g[1]===-1),f=0;d>0&&(f=u.length===d+1?this.quickPickItems.length:u[d+1][1]),a.sort((g,b)=>g.label.localeCompare(b.label)),this.quickPickItems.splice(f,0,l,...a),this.categories.set(l,new Set(a))}}),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let r=this.recommended?this.toQuickPickItem(this.recommended):void 0,i=[];r&&i.push({label:y.recommendedItemCategoryInQuickPick,kind:Qi.QuickPickItemKind.Separator},r);let o=this.commands.findIndex(g=>g.kind===Qi.QuickPickItemKind.Separator&&g.label===y.recommendedItemCategoryInQuickPick),s=o>=0&&o+1<this.commands.length?this.commands[o+1]:void 0,a=r||s;a=this.selected?this.quickPickItems.filter(g=>this.isSelectorQuickPickItem(g)).map(g=>g).find(g=>g.item.id===this.selected?.id):a;let l=this.quickPickItems.filter(g=>!this.isSelectorQuickPickItem(g)||g.item.id!==r?.item?.id),c=t.activeItems.length?t.activeItems[0]:void 0;a&&c&&(this.isSelectorQuickPickItem(c)?!s&&a&&"item"in a&&c.item.id!==a.item.id&&(a=void 0):s&&s?.label===c.label||(a=void 0));let u=this.resolvedProvider?.lastError?this.toErrorQuickPickItem(this.resolvedProvider.lastError):void 0,d=[].concat(Array.from(this.commands)).concat(i).concat(l).concat(u?[u]:[]),f=a?[a]:t.activeItems.length?[t.activeItems[0]]:[];if(f.length&&!d.includes(f[0])){let g=f[0],b=this.isSelectorQuickPickItem(g)&&d.find(I=>this.isSelectorQuickPickItem(I)&&I.item.id===g.item.id);b?f[0]=b:f.length=0}t.items=d,t.activeItems=f,!t.activeItems.length&&this.previouslySelectedItem&&d.includes(this.previouslySelectedItem)&&(t.activeItems=[this.previouslySelectedItem])}isErrorQuickPickItem(t){return this.errorQuickPickItemMap.has(t)}toErrorQuickPickItem(t){if(!this.createErrorQuickPickItem)return;let r=this.createErrorQuickPickItem(t,this);return this.errorQuickPickItemMap.add(r),r}isSelectorQuickPickItem(t){return this.quickPickItemMap.has(t)}toQuickPickItem(t){let r=this.createQuickPickItem(t,this);return r.item=t,this.quickPickItemMap.add(r),r}removeOutdatedQuickPickItems(t,r){let i=t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>a.item.id),o=new Map(r.items.map(a=>[a.id,a])),s=i.filter(a=>!o.has(a));if(s.length){let a=[];this.categories.forEach((l,c)=>{l.forEach(u=>{s.includes(u.item.id)&&(l.delete(u),a.push(u))}),l.size||(a.push(c),this.categories.delete(c))}),this.quickPickItems=this.quickPickItems.filter(l=>!a.includes(l)),this.rebuildQuickPickItems(t)}}connectionToCategory(t){let r=this.getCategory(t,this);return new wD(r.label,r.sortKey||r.label)}};function Y$(n,e){let t=[],r;for(let i of n.slice(0).sort(e))!r||e(r[0],i)!==0?(r=[i],t.push(r)):r.push(i);return t}function X$(n,e){return(n.sortKey||n.label).localeCompare(e.sortKey||e.label,void 0,{sensitivity:"accent"})}var Gc=class{constructor(e){this.serviceContainer=e}async selectPythonInterpreter(){let e=await this.selectPythonEnvironment();return e?.executable?.uri&&await this.serviceContainer.get(et).getInterpreterDetails(e.executable.uri)}async selectPythonEnvironment(){let e=new kD.CancellationTokenSource,t=new Kl,r=this.serviceContainer.get(ga).selectedPythonPath,i=ve.instance.get(ii),o=ve.instance.get(Ts).withFilter(u=>!Jr(u)&&!i.isPythonEnvironmentExcluded(u)),s=()=>o.items.find(u=>Ko(u.executable.uri,r,t.osType)),a=r?y.currentlySelectedJupyterInterpreterForPlaceholder(U(r,kD.workspace.workspaceFolders||[],t.homeDir)):"",l=[],c=new Gd(Promise.resolve(o),SD,CD,{supportsBack:!1},void 0,y.quickPickSelectPythonEnvironmentTitle);c.placeholder=a,c.selected=s(),l.push(c),l.push(e);try{if(!c.selected&&r){let d=o.onDidChange(()=>{c.selected=s(),c.selected&&d.dispose()});l.push(d)}let u=await c.selectItem(e.token);return!u||u instanceof xe?void 0:u}catch(u){p.error("Failed to select a Python Environment to start Jupyter",u)}finally{z(l)}}};Gc=v([(0,PD.injectable)(),m(0,(0,PD.inject)(st))],Gc);var si=class{constructor(e,t,r,i,o){this.interpreterSelectionState=e;this.jupyterInterpreterSelector=t;this.interpreterConfiguration=r;this.interpreterService=i;this._onDidChangeInterpreter=new Fv.EventEmitter;Fv.workspace.onDidGrantWorkspaceTrust(()=>{this.getInitialInterpreterPromiseFailed&&(this.getInitialInterpreterPromise=void 0,this.getInitialInterpreterPromiseFailed=!1)},this,o)}get onDidChangeInterpreter(){return this._onDidChangeInterpreter.event}async getSelectedInterpreter(e){return await this.setInitialInterpreter(e),this._selectedInterpreter}async setInitialInterpreter(e){return this.getInitialInterpreterPromise||(this.getInitialInterpreterPromise=this.getInitialInterpreterImpl(e).then(t=>(t&&this.changeSelectedInterpreterProperty(t),t)),this.getInitialInterpreterPromise.catch(()=>this.getInitialInterpreterPromiseFailed=!0)),this.getInitialInterpreterPromise}async selectInterpreter(){let e=await this.jupyterInterpreterSelector.selectPythonInterpreter();if(!e)return;switch(await this.interpreterConfiguration.installMissingDependencies(e,void 0)){case 0:return await this.setAsSelectedInterpreter(e),e;case 2:return;default:return this.selectInterpreter()}}async installMissingDependencies(e){let t=await this.getSelectedInterpreter(),r=t;if(!r&&(r=await this.interpreterService.getActiveInterpreter(void 0),!r))return e&&await Fv.window.showErrorMessage(e.message,{modal:!0},y.selectDifferentJupyterInterpreter)!==y.selectDifferentJupyterInterpreter?2:(await this.selectInterpreter(),1);let i=await this.interpreterConfiguration.installMissingDependencies(r,e);return i===1?(r=await this.selectInterpreter(),r?0:2):(i===0&&r!==t&&await this.setAsSelectedInterpreter(r),i)}async setAsSelectedInterpreter(e){await this.setInitialInterpreter(),this.changeSelectedInterpreterProperty(e)}changeSelectedInterpreterProperty(e){this._selectedInterpreter=e,this._onDidChangeInterpreter.fire(e),this.interpreterSelectionState.updateSelectedPythonPath(e.uri)}async validateInterpreterPath(e,t){try{let r=await tr(t,this.interpreterService.getInterpreterDetails(e));if(r&&await this.interpreterConfiguration.areDependenciesInstalled(r,t))return r}catch{}}async getInitialInterpreterImpl(e){let t;if(this.interpreterSelectionState.selectedPythonPath&&(t=await this.validateInterpreterPath(this.interpreterSelectionState.selectedPythonPath,e),t||this.interpreterSelectionState.updateSelectedPythonPath(void 0)),!t){let r=await this.interpreterService.getActiveInterpreter(void 0);r&&await this.interpreterConfiguration.areDependenciesInstalled(r,e)&&(t=r)}return t}};si=v([(0,zd.injectable)(),m(0,(0,zd.inject)(ga)),m(1,(0,zd.inject)(Gc)),m(2,(0,zd.inject)(Rs)),m(3,(0,zd.inject)(et)),m(4,(0,zd.inject)(M))],si);var xD=Symbol("IKernelLauncher"),ai=Symbol("IRawNotebookSupportedService"),DD=Symbol("IRawKernelSessionFactory");var Lv=class{constructor(e,t,r,i){this.jupyterInterpreterService=e;this.disposables=t;this.rawSupported=r;this.extensionChecker=i;this.notebookOpened=!1}activate(){this.disposables.push(Z$.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookEditor,this)),this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(this.onDidChangeInterpreter,this))}onDidOpenNotebookEditor(e){Pt(e)&&(this.notebookOpened=!0,R("DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",$2(e)),!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(h))}onDidChangeInterpreter(){this.notebookOpened&&!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(h)}};Lv=v([(0,Wm.injectable)(),m(0,(0,Wm.inject)(si)),m(1,(0,Wm.inject)(M)),m(2,(0,Wm.inject)(ai)),m(3,(0,Wm.inject)($e))],Lv);var _D=k(N()),e7=require("vscode");var Qr=class{static dispose(){z(Qr.disposables)}constructor(e){e.push({dispose:()=>{Qr.dispose()}})}activate(){e7.workspace.onDidChangeNotebookDocument(e=>{Pt(e.notebook)&&e.cellChanges.filter(t=>t.outputs?.length===0).map(t=>{let r=Qr.cellToDisplayIdMapping.get(t.cell);r&&(Qr.cellToDisplayIdMapping.delete(t.cell),Qr.displayIdCellOutputMappingPerDocument.get(e.notebook)?.delete(r))})})}static trackOutputByDisplayId(e,t,r,i){let o=Qr.displayIdCellOutputMappingPerDocument.get(e.notebook);o||(o=new Map,Qr.displayIdCellOutputMappingPerDocument.set(e.notebook,o)),o.set(t,{outputContainer:r,cell:e,outputItems:i}),Qr.cellToDisplayIdMapping.set(e,t)}static getMappedOutput(e,t){let r=Qr.displayIdCellOutputMappingPerDocument.get(e);if(!r)return;let i=r.get(t);return i?.cell.document.isClosed?void 0:i}};Qr.displayIdCellOutputMappingPerDocument=new WeakMap,Qr.cellToDisplayIdMapping=new WeakMap,Qr.disposables=[],Qr=v([(0,_D.injectable)(),m(0,(0,_D.inject)(M))],Qr);var Vm=k(N());var UK="Active_Kernel_Id_List",wce=100,Go=class{constructor(e,t){this.globalMemento=e;this.crypto=t}async getPreferredRemoteKernelId(e){let t=this.globalMemento.get(UK,[]);if(t.length){let r=e.uri,i=await this.crypto.createHash(r.toString()),o=t.find(s=>s.fileHash===i);return p.trace(`Preferred Remote kernel for ${U(r)} is ${o?.kernelId}`),o?.kernelId}}async clearPreferredRemoteKernelId(e){await this.updatePreferredRemoteKernelIdInternal(e)}async storePreferredRemoteKernelId(e,t){await this.updatePreferredRemoteKernelIdInternal(e,t)}async updatePreferredRemoteKernelIdInternal(e,t){let r=!1,i=JSON.parse(JSON.stringify(this.globalMemento.get(UK,[]))),o=await this.crypto.createHash(e.toString()),s=i.findIndex(a=>a.fileHash===o);for(s>=0&&(r=!0,i.splice(s,1)),t&&(r=!0,i.push({fileHash:o,kernelId:t}),p.trace(`Storing Preferred remote kernel for ${U(e)} is ${t}`));i.length>wce;)r=!0,i.shift();r&&await this.globalMemento.update(UK,i)}};Go=v([(0,Vm.injectable)(),m(0,(0,Vm.inject)(Le)),m(0,(0,Vm.named)(ut)),m(1,(0,Vm.inject)(Mh))],Go);var Wv=k(N());var TD=require("vscode");var nr;(r=>{let n=ea(new TD.EventEmitter);r.onDidChangeNotebookCellExecutionState=n.event;function t(i,o,s){if(o!==1||!s){n.fire({cell:i,state:o});return}let a=ea(TD.workspace.onDidChangeNotebookDocument(l=>{if(l.notebook!==i.notebook)return;l.cellChanges.find(u=>u.cell===i)?.cell?.executionSummary?.executionOrder===s&&(a.dispose(),n.fire({cell:i,state:1}))}))}r.changeCellState=t})(nr||={});var Pce=1e3,Uv=class{constructor(e,t,r){this.serverStorage=e;this.kernelProvider=t;this.disposables=[];this.timeouts=new Set;this.kernelSpecificUpdates=new WeakMap;r.push(this)}dispose(){z(this.disposables),z(Array.from(this.timeouts.values()))}activate(){this.disposables.push(nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this))}onDidChangeNotebookCellExecutionState(e){let t=this.kernelProvider.get(e.cell.notebook);if(!t)return;let r=t.kernelConnectionMetadata;if(!xt(r))return;let i=this.kernelSpecificUpdates.get(t)||new us(Pce);this.kernelSpecificUpdates.set(t,i),i.trigger(()=>{t.disposed||t.disposing||this.serverStorage.update(r.serverProviderHandle).catch(h)})}};Uv=v([(0,Wv.injectable)(),m(0,(0,Wv.inject)(Ht)),m(1,(0,Wv.inject)(we)),m(2,(0,Wv.inject)(M))],Uv);var va=k(N()),sE=require("vscode");var t7=require("vscode"),Ft=class{constructor(e){this._event=new t7.EventEmitter;this._disableUI=e}get disableUI(){return this._disableUI}set disableUI(e){let t=this._disableUI!==e;this._disableUI=e,t&&this._event.fire()}get onDidChangeDisableUI(){return this._event.event}dispose(){this._event.dispose()}},RD=class extends Ft{constructor(t,r){super(t);this.ignoreTriggeringOnPostInitialized=r}};var kce="last-python-notebook-created",r7="last-notebook-created",Vv=class{constructor(e,t,r,i,o,s){this.configService=e;this.serverConnector=t;this.disposables=r;this.rawKernelSupport=i;this.mementoStorage=o;this.kernelProvider=s;sE.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook.bind(this),this,r)}activate(){this.checkDateForServerStart(),this.disposables.push(this.kernelProvider.onDidStartKernel(this.kernelStarted,this))}get lastNotebookCreated(){let e=this.mementoStorage.get(r7);return e?new Date(e):void 0}checkDateForServerStart(){this.shouldAutoStartStartServer(this.lastNotebookCreated)&&this.createServerIfNecessary().catch(h)}shouldAutoStartStartServer(e){if(!e)return!1;let r=new Date().getTime()-e.getTime();return Math.floor(r/(24*3600*1e3))<=7}async createServerIfNecessary(){if(!sE.workspace.isTrusted||this.rawKernelSupport.isSupported)return;let e=new sE.CancellationTokenSource,t=new Ft(!0);try{p.info("Attempting to start a server because of preload conditions ..."),this.configService.getSettings(void 0).disableJupyterAutoStart||await this.serverConnector.connect({resource:void 0,ui:t,token:e.token})}catch(r){p.error("Error starting server in serverPreload: ",r)}finally{t.dispose(),e.dispose()}}onDidOpenNotebook(e){Pt(e)&&this.createServerIfNecessary().catch(h)}kernelStarted(e){let t=uo(e.kernelConnectionMetadata);this.mementoStorage.update(r7,Date.now()).then(h,h),t===ge&&this.mementoStorage.update(kce,Date.now()).then(h,h)}};Vv=v([(0,va.injectable)(),m(0,(0,va.inject)(ie)),m(1,(0,va.inject)(yk)),m(2,(0,va.inject)(M)),m(3,(0,va.inject)(ai)),m(4,(0,va.inject)(Le)),m(4,(0,va.named)(ri)),m(5,(0,va.inject)(we))],Vv);var Io=k(N());var Ns=k(N());var Yi=class extends qe{constructor(e){super("jupyterinstall",e)}};var _r=require("vscode");var jm=class extends kn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeout(ot(e)),e)}};var Qd=class extends Cl{constructor(t,r,i,o){super(t,i,o);this.stdErr=r}};var jv=class extends kn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeoutWaitingForPort(ot(e)),e)}};var Jl=class extends kn{constructor(t=-1,r,i){super("kerneldied",y.kernelDied(r.trim()),i);this.exitCode=t;this.stdErr=r}};var Jm=class extends kn{constructor(t,r){super("noipykernel",y.kernelInvalid(ot(r)),r);this.reason=t}};var ya=class extends Cl{constructor(e){super(y.kernelDiedWithoutError(ot(e)),void 0,e)}};var AD=class extends qe{constructor(e){super("jupyterexpiredcert",e)}};var Yd=class extends qe{constructor(t){super("invalidremotejupyterserverurihandle","Server handle not in list of known handles");this.serverProviderHandle=t}};var zc=class extends qe{constructor(t,r,i){super("jupyternotebooknotinstalled",t+(r?`
${r}`:""));this.interpreter=i}};var n7=new Map;function ND(n,e){n7.set(Mt(n),e)}function Jv(n,e,t){let r=e.jupyterCollections.find(i=>i.extensionId===n.extensionId&&i.id===n.id);return n7.get(Mt(n))||r?.label||t||`${n.id}:${n.handle}`}var $v=class{constructor(e,t,r,i,o,s,a){this.dependencyManager=e;this.configuration=t;this.kernelDependency=r;this.serverUriStorage=i;this.jupyterUriProviderRegistration=o;this.fs=s;this.interpreterService=a;this.handledErrors=new WeakSet;this.handledKernelErrors=new WeakSet}async handleError(e){if(p.warn("DataScience Error",e),e=Gr.unwrap(e),!this.handledErrors.has(e)){if(this.handledErrors.add(e),e instanceof Yi)await this.dependencyManager?.installMissingDependencies(e);else if(e instanceof Fo)await hk(this.configuration,e.message);else if(e instanceof AD)await gk(this.configuration,e.message);else if(!er(e))if(e instanceof jm||e instanceof jv)_r.window.showErrorMessage(e.message).then(h,h);else if(e instanceof Qd||e instanceof Jl||e instanceof zc||e instanceof gs)_r.window.showErrorMessage(Bv(e)).then(h,h);else if(e instanceof Di&&Mr())_r.window.showErrorMessage(y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl)).then(h,h);else if(e instanceof Di){let t=await this.handleJupyterServerConnectionError(e,void 0);_r.window.showErrorMessage(t).then(h,h)}else if(e instanceof Sd){let t=await this.handleJupyterServerUriProviderError(e,void 0);_r.window.showErrorMessage(t).then(h,h)}else{let t=i7(e.message||e.toString());_r.window.showErrorMessage(t).then(h,h)}}}async getErrorMessageForDisplayInCell(e,t,r){return this.getErrorMessageForDisplayInCellImpl(e,t,r,!1)}async getErrorMessageForDisplayInCellOutput(e,t,r){return this.getErrorMessageForDisplayInCellImpl(e,t,r,!0)}async getErrorMessageForDisplayInCellImpl(e,t,r,i){if(e=Gr.unwrap(e),er(e)||p.error("Error in execution (get message for cell)",e),e instanceof ya)return"";if(e instanceof Jm){let o=this.interpreterService?await this.interpreterService.hasWorkspaceSpecificEnvironment():!1;return WK(e.kernelConnectionMetadata,!o&&!Mr()&&i)||e.message}else{if(e instanceof Yi)return _ce(e)||e.message;if(e instanceof Di&&!Mr())return e.message;if(e instanceof Di&&Mr())return y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl);if(er(e))return"";if(e instanceof tv){let o=typeof e.product=="string"?e.product:ur.get(e.product)||`${e.product}`,s=nn(e.interpreter)||e.interpreter.id||"",a=lr(e.interpreter),l=U(a?.executable.uri),c=s?` ${s} (${l})`:l;return y.packageNotInstalledWindowsLongPathNotEnabledError(o,c)}else{if((e instanceof Qd||e instanceof Jl)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&!await this.fs.exists(e.kernelConnectionMetadata.interpreter.uri))return y.failedToStartKernelDueToMissingPythonEnv(nn(e.kernelConnectionMetadata.interpreter)||No(e.kernelConnectionMetadata.interpreter)||U(e.kernelConnectionMetadata.interpreter.uri));if((e instanceof Qd||e instanceof Jl)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(e.kernelConnectionMetadata,void 0,!0)){let o=this.interpreterService?await this.interpreterService.hasWorkspaceSpecificEnvironment():!1;return WK(e.kernelConnectionMetadata,!o&&!Mr()&&i)||e.message}else if(e instanceof kn||e instanceof Cl){let[o,s]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(r),oa(e.kernelConnectionMetadata.interpreter)]),a=nm(_r.workspace.workspaceFolders||[],e,ot(e.kernelConnectionMetadata),s,o.map(l=>l.uri));if(a){if(a.reason==="moduleNotFound"&&["ipykernel_launcher","ipykernel"].includes(a.moduleName)){let c=this.interpreterService?await this.interpreterService.hasWorkspaceSpecificEnvironment():!1;return WK(e.kernelConnectionMetadata,!c&&!Mr()&&i)||e.message}let l=[a.message];return a.moreInfoLink&&l.push(le.clickHereForMoreInfoWithHtml(a.moreInfoLink)),dt(e.kernelConnectionMetadata)&&a.reason==="moduleNotFound"&&!["ipykernel_launcher","ipykernel"].includes(a.moduleName)&&await this.addErrorMessageIfPythonArePossiblyOverridingPythonModules(l,r),l.join(`
`)}}else{if(e instanceof Di)return this.handleJupyterServerConnectionError(e,t);if(e instanceof Sd)return this.handleJupyterServerUriProviderError(e,t);if(e instanceof Yd){let o=_r.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId;return Bv(y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(o),t)}}}}return Bv(e,t)}async handleJupyterServerUriProviderError(e,t){let r=await Jv(e.serverProviderHandle,this.jupyterUriProviderRegistration),i=e.originalError?.message||e.message;return Bv(y.remoteJupyterConnectionFailedWithServerWithError(r,i),t)}async handleJupyterServerConnectionError(e,t){let r=await Jv(e.serverProviderHandle,this.jupyterUriProviderRegistration,e.baseUrl),i=e.originalError.message||"";return Bv(y.remoteJupyterConnectionFailedWithServerWithError(r,i),t)}async handleJupyterServerProviderConnectionError(e,t){let r=new _r.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(r.token));return i&&(i.find(o=>o.id===e.handle)||await this.serverUriStorage.remove(e).catch(h)),!0}catch{return!1}finally{r.dispose()}}async handleKernelError(e,t,r,i,o){if(er(e)||p.warn(`Kernel Error, context = ${t}`,e),e=Gr.unwrap(e),er(e))return this.sendKernelTelemetry(e,t,i,"cancelled"),1;if(e instanceof Jm)if(p.warn(`Jupyter Kernel Dependency Error, reason=${e.reason}`,e),this.sendKernelTelemetry(e,t,i,e.category),e.reason===4&&this.kernelDependency){let s=new _r.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:r,ui:new Ft(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else return e.reason;else{if((t==="start"||t==="restart")&&e instanceof Yi)return this.sendKernelTelemetry(e,t,i,e.category),(this.dependencyManager?await this.dependencyManager.installMissingDependencies(e):2)===0?0:1;if(e instanceof Di||e instanceof Sd||e instanceof Yd){this.sendKernelTelemetry(e,t,i,e.category);let s=e instanceof Yd?"":e instanceof Di?e.originalError.message||"":e.originalError?.message||e.message,a=e.serverProviderHandle.extensionId,l=e.serverProviderHandle.id,c=this.jupyterUriProviderRegistration.jupyterCollections.find(I=>I.extensionId===a&&I.id==l);if(!c||await this.handleJupyterServerProviderConnectionError(e.serverProviderHandle,c))return 3;let u=e instanceof Di?e.baseUrl:"",d=Jv(e.serverProviderHandle,this.jupyterUriProviderRegistration,u),f=e instanceof Yd?_r.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId:"",g=o==="jupyterExtension"?[y.selectDifferentKernel]:[];switch(await _r.window.showErrorMessage(e instanceof Yd?y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(f):y.remoteJupyterConnectionFailedWithServer(d),{detail:s,modal:!0},y.removeRemoteJupyterConnectionButtonText,y.changeRemoteJupyterConnectionButtonText,...g)){case y.removeRemoteJupyterConnectionButtonText:return await this.serverUriStorage.remove(e.serverProviderHandle).catch(h),1;case y.changeRemoteJupyterConnectionButtonText:return 1;case y.selectDifferentKernel:return 3}return 1}else if(e instanceof Fo){this.sendKernelTelemetry(e,t,i,e.category);let s=y.jupyterSelfCertEnable,a=y.jupyterSelfCertClose;return _r.window.showErrorMessage(y.jupyterSelfCertFail(e.message),s,a).then(l=>{l===s?(R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),this.configuration.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,_r.ConfigurationTarget.Workspace).catch(h)):l===a&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE")}).then(h,h),2}else{if((t==="start"||t==="restart")&&r.kind==="startUsingPythonInterpreter"&&this.interpreterService&&!await this.fs.exists(r.interpreter.uri))return this.sendKernelTelemetry(e,t,i,"pythonEnvironmentMissing"),_r.window.showErrorMessage(y.failedToStartKernelDueToMissingPythonEnv(nn(r.interpreter)||No(r.interpreter)||U(r.interpreter.uri))).then(h,h),this.interpreterService.refreshInterpreters(!0).catch(h),2;if((t==="start"||t==="restart")&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(r,void 0,!0)){this.sendKernelTelemetry(e,t,i,"noipykernel");let s=new _r.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:r,ui:new Ft(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else{let[s,a]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(i),oa(r.interpreter)]),l=nm(_r.workspace.workspaceFolders||[],e,ot(r),a,s.map(c=>c.uri));return this.sendKernelTelemetry(e,t,i,l?.reason),l?this.showMessageWithMoreInfo(l.message,l?.moreInfoLink).catch(h):this.showMessageWithMoreInfo(Bv(e,t)).catch(h),2}}}}sendKernelTelemetry(e,t,r,i){this.handledKernelErrors.has(e)||(this.handledKernelErrors.add(e),t==="start"&&It(r,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:!1,failureCategory:i},e))}async showMessageWithMoreInfo(e,t){e.includes(J.ViewJupyterOutput)||(e=`${e} 
${y.viewJupyterLogForFurtherInfo}`);let r=t?[le.learnMore]:[];await _r.window.showErrorMessage(e,...r).then(i=>{i===le.learnMore&&t&&_r.env.openExternal(_r.Uri.parse(t))})}};$v=v([m(0,(0,Ns.inject)(bd)),m(0,(0,Ns.optional)()),m(1,(0,Ns.inject)(ie)),m(2,(0,Ns.inject)(Es)),m(2,(0,Ns.optional)()),m(3,(0,Ns.inject)(Ht)),m(4,(0,Ns.inject)(Vt)),m(5,(0,Ns.inject)(tt)),m(6,(0,Ns.inject)(et)),m(6,(0,Ns.optional)())],$v);var xce={restart:y.failedToRestartKernel,start:y.failedToStartKernel,interrupt:y.failedToInterruptKernel,execution:""};function Bv(n,e){n=typeof n=="string"?n:Gr.unwrap(n);let t=e?xce[e]:"",r="";return n instanceof zc?r=y.jupyterNotebookNotInstalledOrNotFound(n.interpreter):n instanceof qe?r=WP(n.stdErr)||n.stdErr||n.message:r=typeof n=="string"?n:n.message,i7(t,r)}function Dce(n){return(new RegExp(/\[([^\[]+)\]\((.*)\)/).exec(n)?.length??0)>0}function i7(n="",e=""){n&&e.startsWith(n.substring(0,n.length-1))&&(n="");let t=[n,e].map(r=>r.trim()).filter(r=>r.length>0).join(` 
`);return!Dce(t)&&t.length&&t.indexOf("command:jupyter.viewOutput")===-1?`${t.endsWith(".")?t:t+"."} 
${y.viewJupyterLogForFurtherInfo}`:t}function WK(n,e){if(n.kind==="connectToLiveRemoteKernel"||n.kind==="startUsingRemoteKernelSpec"||!n.interpreter)return;let t=nn(n.interpreter)||Re(n.interpreter.uri),r=ur.get(19),i=zi(19),o=`${OS(Re(n.interpreter.uri))} -m pip install ${i} -U --force-reinstall`;if(n.interpreter&&Ve(n.interpreter)==="Conda"){let a=lr(n.interpreter);a?.environment?.name?o=`conda install -n ${a?.environment?.name} ${i} --update-deps --force-reinstall`:a?.environment?.folderUri&&(o=`conda install -p ${Re(a?.environment?.folderUri)} ${i} --update-deps --force-reinstall`)}else n.interpreter&&Ve(n.interpreter)==="Unknown"&&(o=`${OS(Re(n.interpreter.uri))} -m pip install ${i} -U --user --force-reinstall`);let s=[y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter(t,ur.get(19))];return e?X3(n.interpreter)?s.push(y.createANewPythonEnvironment()):(s.push(y.createANewPythonEnvironment()),s.push(y.OrInstallPackageInstructions(r,o))):s.push(y.installPackageInstructions(r,o)),s.join(`
`)}function _ce(n){let e=`${ur.get(18)} ${le.and} ${ur.get(20)}`,t=[18,20].map(zi).join(" "),r=`python -m pip install ${t} -U
or
conda install ${t} -U`,i=y.installPackageInstructions(e,r);return n.message+`
`+i+`
`+le.clickHereForMoreInfoWithHtml("https://aka.ms/installJupyterForVSCode")}var qv=class extends $v{constructor(t,r,i,o,s,a,l,c){super(t,r,i,o,s,l,c);this.reservedPythonNames=a}async addErrorMessageIfPythonArePossiblyOverridingPythonModules(t,r){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(r);if(i.length>0){let o=r?bi(r):void 0,s=i.map(l=>{if(l.type==="file"){let c=r?U(l.uri,[],o):dn(l.uri);return`<a href='${l.uri.toString()}?line=1'>${c}</a>`}else{let c=r?U(l.uri,[],o):`${dn(bi(l.uri))}/__init__.py`;return`<a href='${l.uri.toString()}?line=1'>${c}</a>`}}),a="";s.length===1?a=s[0]:a=`${s.slice(0,-1).join(", ")} ${le.and} ${s.slice(-1)}`,t.push(y.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting(a)),t.push(y.listOfFilesWithLinksThatMightNeedToBeRenamed(a)),t.push(le.clickHereForMoreInfoWithHtml(f6))}}async getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(t){return t?this.reservedPythonNames.getUriOverridingReservedPythonNames(bi(t)):[]}};qv=v([(0,Io.injectable)(),m(0,(0,Io.inject)(bd)),m(0,(0,Io.optional)()),m(1,(0,Io.inject)(ie)),m(2,(0,Io.inject)(Es)),m(2,(0,Io.optional)()),m(3,(0,Io.inject)(Ht)),m(4,(0,Io.inject)(Vt)),m(5,(0,Io.inject)(Ok)),m(6,(0,Io.inject)(tt)),m(7,(0,Io.inject)(et))],qv);var KD=k(N());var aE=class{constructor(e,t,r,i){this.moduleName=e;this.args=t;this.pythonExecutionFactory=r;this._interpreter=i;this.interpreterPromise=Promise.resolve(this._interpreter),this.pythonLauncher=this.interpreterPromise.then(async o=>r.createActivatedEnvironment({interpreter:o}))}interpreter(){return this.interpreterPromise}async exec(e,t){let r={...t},i=await this.pythonLauncher,o=[...this.args,...e],s=o[1];return o.shift(),o.shift(),i.execModule(s,o,r)}},VK=class extends aE{constructor(e,t,r,i){super(e,t,r,i)}},jK=class extends aE{constructor(e,t,r,i){super(e,t,r,i)}async exec(e,t){let r,i={stdout:""};try{i=await super.exec(e,t)}catch(a){r=a}if(!i.stderr&&!r)return i;let o=()=>{if(r)throw p.error("Exception attempting to enumerate kernelspecs: ",r),r;return i},s=await this.interpreter();if(!s||this.moduleName.toLowerCase()!=="jupyter"||this.args.join(" ").toLowerCase()!=="-m jupyter kernelspec".toLowerCase())return o();try{if(e.join(" ").toLowerCase()==="list --json")return i=await this.getKernelSpecList(s,t),i;if(e.join(" ").toLowerCase()==="--version")return i=await this.getKernelSpecVersion(s,t),i}catch(a){p.error("Failed to get a list of the kernelspec using python script",a)}return o()}async getKernelSpecList(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([We(Bo,"pythonFiles","vscode_datascience_helpers","getJupyterKernels.py")],{...t,throwOnStdErr:!0})}async getKernelSpecVersion(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([We(Bo,"pythonFiles","vscode_datascience_helpers","getJupyterKernelspecVersion.py")],{...t,throwOnStdErr:!0})}},Hv=class{constructor(e){this.executionFactory=e}createInterpreterCommand(e,t,r,i){return e==="notebook"?new VK(t,r,this.executionFactory,i):e==="kernelspec"?new jK(t,r,this.executionFactory,i):new aE(t,r,this.executionFactory,i)}};Hv=v([(0,KD.injectable)(),m(0,(0,KD.inject)(Fr))],Hv);var lE=k(N());var o7=require("vscode");var Gv=class{constructor(e,t){this.service=e;this.disposables=t}activate(){this.disposables.push(o7.commands.registerCommand("jupyter.selectJupyterInterpreter",()=>{this.service.selectInterpreter().catch(h)}))}};Gv=v([(0,lE.injectable)(),m(0,(0,lE.inject)(si)),m(1,(0,lE.inject)(M))],Gv);var Ks=k(N());var d7=k(require("crypto")),Ms=k(N()),zv=k(Jo());var mr=require("vscode");var s7=k(Jo()),a7=require("vscode");async function OD(n){try{let e=await s7.realpath(n.fsPath);return Kr()!="Windows"&&(e=e.replace(/\\/g,"/")),a7.Uri.file(e)}catch{return n}}var ba=require("vscode");var LD="version";function FD(n){return`${LD}-${n.extension.packageJSON.version||"version"}`}async function cE(n,e){if(Ha())return ba.Uri.joinPath(n.globalStorageUri,FD(n));{let t=ba.Uri.joinPath(ba.Uri.file(n.globalStorageUri.fsPath),FD(n));if(e)try{await e.createDirectory(t)}catch(r){p.warn(`Failed to create temp directory (${t.fsPath}), falling back to extension dir`,r),t=ba.Uri.joinPath(n.extensionUri,"temp"),await e.createDirectory(t)}return t}}async function l7(n){try{let e=await ba.workspace.fs.readDirectory(n.globalStorageUri);await Promise.all(e.filter(([t,r])=>t.startsWith(LD)&&r===ba.FileType.Directory).map(([t])=>ba.workspace.fs.delete(ba.Uri.joinPath(n.globalStorageUri,t),{recursive:!0}))).catch(h)}catch{}}var Tce=We("AppData","Roaming","jupyter","kernels"),c7=We(".local","share","jupyter","kernels"),u7=We("Library","Jupyter","kernels"),Rce=We("AppData","Roaming","jupyter","runtime"),Ace=We("Library","Jupyter","runtime"),p7=We("share","jupyter","kernels"),UD="CACHE_KEY_FOR_JUPYTER_KERNELSPEC_ROOT_PATH.",JK="CACHE_KEY_FOR_JUPYTER_KERNEL_PATHS_.",Lr=class{constructor(e,t,r,i,o,s,a){this.platformService=e;this.envVarsProvider=t;this.globalState=i;this.fs=o;this.context=s;this.pythonExecFactory=a;this.cachedDataDirs=new Map;this.runtimeDirIsWritable=!1;this.envVarsProvider.onDidEnvironmentVariablesChange(()=>{this.cachedJupyterKernelPaths=void 0,this.cachedJupyterPaths=void 0},this,r)}async getKernelSpecTempRegistrationFolder(){let e=zt(await cE(this.context),"jupyter","kernels");return await this.fs.createDirectory(e),e}async getKernelSpecRootPath(){let e=this.getCachedRootPath();return e||this.cachedKernelSpecRootPath?e||this.cachedKernelSpecRootPath:(this.cachedKernelSpecRootPath=(async()=>{let t=this.platformService.homeDir;if(t)return this.platformService.isWindows?OD(zt(t,Tce)):this.platformService.isMac?zt(t,u7):zt(t,c7)})(),this.cachedKernelSpecRootPath.then(t=>{p.trace(`Getting Jupyter KernelSpec Root Path ${t?.toString()}`),this.updateCachedRootPath(t)}).catch(h),this.cachedKernelSpecRootPath)}async getRuntimeDir(){let e=await this.getRuntimeDirImpl();if(e)return e;let t=mr.Uri.joinPath(await cE(this.context),"jupyter","runtime");return await zv.ensureDir(t.fsPath),p.trace(`Using extension runtime directory ${t.fsPath}`),t}async getRuntimeDirImpl(){let e,t=this.platformService.homeDir;if(process.env.JUPYTER_RUNTIME_DIR?e=mr.Uri.file(cn(process.env.JUPYTER_RUNTIME_DIR)):t&&(this.platformService.isWindows?e=await OD(zt(t,Rce)):this.platformService.isMac?e=zt(t,Ace):e=process.env.XDG_RUNTIME_DIR?mr.Uri.file(We(process.env.XDG_RUNTIME_DIR,"jupyter","runtime")):zt(t,".local","share","jupyter","runtime")),!e){p.error("Failed to determine Jupyter runtime directory");return}try{if(await this.fs.createDirectory(e),!this.runtimeDirIsWritable){let r=`temp-test-write-access-${d7.randomBytes(20).toString("hex")}.txt`,i=zt(e,r);await zv.writeFile(i.fsPath,""),await zv.unlink(i.fsPath).catch(h)}return e}catch(r){p.error(`Failed to create/or verify write access to runtime directory ${e}`,r)}}async getDataDirs(e){let t=e.interpreter?e.interpreter.uri.toString():"";return this.cachedDataDirs.has(t)||this.cachedDataDirs.set(t,this.getDataDirsImpl(e.resource,e.interpreter)),this.cachedDataDirs.get(t)}async getDataDirsImpl(e,t){let r=new fo,i=await this.getJupyterPaths();for(let f of i)f&&!r.has(f)&&r.set(f,r.size);if(t)try{p.ci(`Getting Jupyter Data Dir for ${t.uri.fsPath}`);let f=await this.pythonExecFactory.createActivatedEnvironment({interpreter:t,resource:e}),g=mr.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyterDataDir.py"),b=await f.exec([g.fsPath],{});if(b.stdout.trim().length){let I=mr.Uri.file(b.stdout.trim());await this.fs.exists(I)&&(r.has(I)||r.set(I,r.size))}else p.debug(`Got an empty Jupyter Data Dir from ${t.id}, stderr = ${b.stderr}`)}catch(f){p.error(`Failed to get DataDir based on ENABLE_USER_SITE for ${nn(t)}`,f)}let o;t&&(o=await oa(t));let s=o?mr.Uri.joinPath(mr.Uri.file(o),"share","jupyter"):void 0,a=this.getSystemJupyterPaths(),l=s?new Dl(a).has(s)?void 0:s:void 0,c=this.getJupyterDataDir(),u=(process.env.JUPYTER_PREFER_ENV_PATH||"no").toLowerCase();return["no","n","false","off","0","0.0"].includes(u)?[c,l].forEach(f=>{f&&!r.has(f)&&r.set(f,r.size)}):[l,c].forEach(f=>{f&&!r.has(f)&&r.set(f,r.size)}),a.forEach(f=>{f&&!r.has(f)&&r.set(f,r.size)}),Array.from(r.entries()).sort((f,g)=>f[1]-g[1]).map(f=>f[0])}getJupyterConfigDir(){return process.env.JUPYTER_CONFIG_DIR?mr.Uri.file(cn(process.env.JUPYTER_CONFIG_DIR)):this.platformService.homeDir?mr.Uri.joinPath(this.platformService.homeDir,".jupyter"):void 0}getSystemJupyterPaths(){if(this.platformService.isWindows){let e=process.env.PROGRAMDATA?cn(process.env.PROGRAMDATA):void 0;return e?[mr.Uri.joinPath(mr.Uri.file(e),"jupyter")]:[]}else return[mr.Uri.file("/usr/local/share/jupyter"),mr.Uri.file("/usr/share/jupyter")]}getJupyterDataDir(){if(process.env.JUPYTER_DATA_DIR)return mr.Uri.file(cn(process.env.JUPYTER_DATA_DIR));if(this.platformService.homeDir)switch(this.platformService.osType){case"OSX":return mr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");case"Windows":let e=process.env.APPDATA?mr.Uri.file(cn(process.env.APPDATA)):"";if(e)return mr.Uri.joinPath(e,"jupyter");let t=this.getJupyterConfigDir();return t?mr.Uri.joinPath(t,"data"):mr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");default:{let r=process.env.XDG_DATA_HOME?mr.Uri.file(cn(process.env.XDG_DATA_HOME)):mr.Uri.joinPath(this.platformService.homeDir,".local","share");return mr.Uri.joinPath(r,"jupyter")}}}async getKernelSpecRootPaths(e){if(this.cachedKernelSpecRootPaths?.promise&&this.cachedKernelSpecRootPaths.stopWatch.elapsedTime<=6e4)return this.cachedKernelSpecRootPaths.promise;let t=new Fe,r=this.getKernelSpecRootPathsImpl(e);this.cachedKernelSpecRootPaths={promise:r,stopWatch:t};let i=e.onCancellationRequested(()=>{this.cachedKernelSpecRootPaths?.promise===r&&(this.cachedKernelSpecRootPaths=void 0)},this);return r.finally(()=>i.dispose()).catch(h),r}async getKernelSpecRootPathsImpl(e){let t=new Dl(await this.getJupyterPathKernelPaths(e));if(e.isCancellationRequested)return[];if(this.platformService.isWindows){let r=await this.getKernelSpecRootPath();if(e.isCancellationRequested)return[];r&&t.add(r),process.env.PROGRAMDATA&&t.add(mr.Uri.file(We(process.env.PROGRAMDATA,"jupyter","kernels")))}else{let r=this.platformService.isMac?u7:c7;t.add(mr.Uri.file(We("/","usr","share","jupyter","kernels"))),t.add(mr.Uri.file(We("/","usr","local","share","jupyter","kernels"))),this.platformService.homeDir&&t.add(zt(this.platformService.homeDir,r))}return p.debug(`Kernel Spec Root Paths, ${Array.from(t).map(r=>U(r)).join(", ")}`),Array.from(t)}async getJupyterPathKernelPaths(e){return this.cachedJupyterKernelPaths=this.cachedJupyterKernelPaths||this.getJupyterPathSubPaths(e,"kernels"),this.cachedJupyterKernelPaths.then(t=>{t.length>0&&this.updateCachedPaths(t).then(h,h)},h),this.getCachedPaths().length>0?this.getCachedPaths():this.cachedJupyterKernelPaths}async getJupyterPaths(e){return this.cachedJupyterPaths=this.cachedJupyterPaths||this.getJupyterPathSubPaths(e),this.cachedJupyterPaths}async getJupyterPathSubPaths(e,t){let r=new Dl,i=await this.envVarsProvider.getEnvironmentVariables(void 0,"RunPythonCode");if(e?.isCancellationRequested)return[];let o=i.JUPYTER_PATH?i.JUPYTER_PATH.split(jn).map(s=>t?We(s,t):s):[];return o.length>0&&(await Promise.all(o.map(async a=>OD(mr.Uri.file(a))))).forEach(a=>{a&&r.add(a)}),p.debug(`Jupyter Paths ${U(t)}: ${Array.from(r).map(s=>U(s))}`),Array.from(r)}getCachedPaths(){return this.globalState.get(JK,[]).map(e=>mr.Uri.parse(e))}async updateCachedPaths(e){let t=this.globalState.get(JK,[]),r=e.map(mr.Uri.toString);t.join(",")!==r.join(",")&&await this.globalState.update(JK,r)}getCachedRootPath(){if(this.globalState.get(UD)){let e=this.globalState.get(UD);if(e)return mr.Uri.parse(e)}}updateCachedRootPath(e){e?this.globalState.update(UD,e.toString()).then(h,h):this.globalState.update(UD,void 0).then(h,h)}};v([ti("getDataDirsImpl",7),m(1,Dc("id"))],Lr.prototype,"getDataDirsImpl",1),v([m(0,od())],Lr.prototype,"getJupyterPathKernelPaths",1),Lr=v([(0,Ms.injectable)(),m(0,(0,Ms.inject)(wr)),m(1,(0,Ms.inject)(kl)),m(2,(0,Ms.inject)(M)),m(3,(0,Ms.inject)(Le)),m(3,(0,Ms.named)(ut)),m(4,(0,Ms.inject)(dr)),m(5,(0,Ms.inject)(Ze)),m(6,(0,Ms.inject)(Fr))],Lr);var Bm=class{constructor(e,t,r,i,o,s,a){this.jupyterInterpreter=e;this.interpreterService=t;this.jupyterDependencyService=r;this.pythonExecutionFactory=i;this.jupyterOutputChannel=o;this.jupyterPaths=s;this.activationHelper=a}async refreshCommands(){}async isNotebookSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);return t?this.jupyterDependencyService.areDependenciesInstalled(t,e):!1}async getReasonForJupyterNotebookNotBeingSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t&&(t=await this.interpreterService.getActiveInterpreter(void 0),!t))return y.selectJupyterInterpreter;let r=await this.jupyterDependencyService.getDependenciesNotInstalled(t,e);return r.length===0?"":r.length===1&&r[0]===21?y.jupyterKernelSpecModuleNotFound(t.uri.fsPath):OK(r,t)}async getSelectedInterpreter(e){return this.jupyterInterpreter.getSelectedInterpreter(e)}async startNotebook(e,t){let r=await this.getSelectedInterpreterAndThrowIfNotAvailable(t.token);this.jupyterOutputChannel.appendLine(y.startingJupyterLogMessage(jt(r.uri),e.join(" ")));let i=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:r}),o={...t};o.token=void 0;let s=await this.activationHelper.getActivatedEnvironmentVariables(void 0,r)||process.env,a=(process.env.JUPYTER_PATH||s.JUPYTER_PATH||"").split(jn).filter(c=>c.trim().length);a.push(bi(await this.jupyterPaths.getKernelSpecTempRegistrationFolder()).fsPath),o.env={...s,JUPYTER_PATH:a.join(jn)},p.trace(`Start Jupyter Notebook with JUPYTER_PATH=${a.join(jn)}`),p.trace(`Start Jupyter Notebook with PYTHONPATH=${s.PYTHONPATH||""}`);let l=Object.keys(s).filter(c=>c.toLowerCase()==="path");if(l.length){let c=l.map(u=>`${u}=${s[u]}`).join(",");p.trace(`Start Jupyter Notebook with PATH variable. ${c}`)}else p.error("Start Jupyter Notebook without a PATH variable");return i.execModuleObservable("jupyter",["notebook"].concat(e),o)}async getRunningJupyterServers(e){let t=await this.getSelectedInterpreterAndThrowIfNotAvailable(e),r=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:t}),i={mergeStdOutErr:!0,token:e},o=We(Bo,"pythonFiles","vscode_datascience_helpers","getServerInfo.py"),s=await r.exec([o],i),a;try{a=JSON.parse(s.stdout.trim())}catch(l){p.warn("Failed to parse JSON when getting server info out from getServerInfo.py",l);return}return a}async installMissingDependencies(e){return this.jupyterInterpreter.installMissingDependencies(e)}async getSelectedInterpreterAndThrowIfNotAvailable(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t){let r=await this.getReasonForJupyterNotebookNotBeingSupported();throw new Yi(r)}return t}};Bm=v([(0,Ks.injectable)(),m(0,(0,Ks.inject)(si)),m(1,(0,Ks.inject)(et)),m(2,(0,Ks.inject)(Rs)),m(3,(0,Ks.inject)(Fr)),m(4,(0,Ks.inject)(Mo)),m(4,(0,Ks.named)(ph)),m(5,(0,Ks.inject)(Lr)),m(6,(0,Ks.inject)(Ps))],Bm);var WD=k(N());var $m=class{constructor(e){this.pythonExecutionFactory=e}async exportNotebookToPython(e,t,r,i){let o=await this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t}),s=r?[e.fsPath,"--to","python","--stdout","--template",r]:[e.fsPath,"--to","python","--stdout"];return o.execModule("jupyter",["nbconvert"].concat(s),{throwOnStdErr:!1,encoding:"utf8",token:i}).then(a=>{if(a.stdout==="")throw p.error("nbconvert zero size output"),new Error(a.stderr);return a.stdout})}};v([yv("ExportNotebookToPython")],$m.prototype,"exportNotebookToPython",1),$m=v([(0,WD.injectable)(),m(0,(0,WD.inject)(Fr))],$m);var uE=k(N());var Qv=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.nbconvertInstalledInInterpreter=new Dl}async isNbConvertInstalled(e,t){if(this.nbconvertInstalledInInterpreter.has(e.uri))return!0;let r=!!await this.installer.isInstalled(22,e)&&!!await this.installer.isInstalled(18,e);return r===!0&&this.nbconvertInstalledInInterpreter.add(e.uri),r}async getNbConvertVersion(e,t){let i=await this.commandFactory.createInterpreterCommand("nbconvert","jupyter",["-m","jupyter","nbconvert"],e,!1).exec(["--version"],{throwOnStdErr:!0});return ak(i.stdout)}};Qv=v([(0,uE.injectable)(),m(0,(0,uE.inject)(Ai)),m(1,(0,uE.inject)(Kv))],Qv);var Gm=k(N());var Yv=require("vscode");var Xd=k(N());var f7=require("vscode");var Ia=class{constructor(e,t,r,i,o){this.interpreterService=e;this.envActivation=t;this.envVarsService=r;this.customEnvVars=i;this.configService=o}async getEnvironmentVariables(e,t,r,i){let o=r.env&&Object.keys(r.env).length>0?Object.assign({},r.env):void 0,s=(r.language||"").toLowerCase()===ge;if(!t&&r.interpreterPath&&(t=await this.interpreterService.getInterpreterDetails(f7.Uri.file(r.interpreterPath),i).catch(d=>{p.error("Failed to fetch interpreter information for interpreter that owns a kernel",d)})),i?.isCancellationRequested)return;let[a,l]=await Promise.all([this.customEnvVars.getCustomEnvironmentVariables(e,s?"RunPythonCode":"RunNonPythonCode",i).catch(h),t?this.envActivation.getActivatedEnvironmentVariables(e,t,i).catch(d=>{p.error("Failed to get env variables for interpreter, hence no variables for Kernel",d)}):void 0]);if(i?.isCancellationRequested)return;await qi(e,{capturedEnvVars:Object.keys(l||{}).length>0}),!l&&Object.keys(a||{}).length===0&&p.debug("No custom variables nor do we have a conda environment");let c={...process.env};process.platform==="win32"&&(c={},Object.keys(process.env).forEach(d=>{c[d.toUpperCase()]=process.env[d]})),o=o||{},a=a||{};let u={};for(let[d,f]of Object.entries(o||{}))typeof f=="string"&&m7(d,f,process.env)!==f&&(u[d]=f,delete o[d]);s||t?(l=l||a,Object.assign(c,l,o),this.configService.getSettings(void 0).excludeUserSitePackages&&(p.info(`Adding env Variable PYTHONNOUSERSITE to ${U(t?.uri)}`),c.PYTHONNOUSERSITE="True"),s&&(c.PYDEVD_IPYTHON_COMPATIBLE_DEBUGGING="1")):(this.envVarsService.mergeVariables(o,c),this.envVarsService.mergeVariables(a,c));for(let[d,f]of Object.entries(u))c[d]=m7(d,f,c);return c}};Ia=v([(0,Xd.injectable)(),m(0,(0,Xd.inject)(et)),m(1,(0,Xd.inject)(Ps)),m(2,(0,Xd.inject)(Pl)),m(3,(0,Xd.inject)(kl)),m(4,(0,Xd.inject)(ie))],Ia);var Nce=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function m7(n,e,t){if(!e.includes("$"))return e;let r=!1,i=e;return i=i.replace(Nce,(o,s,a,l,c)=>l>0&&c[l-1]==="\\"?o:a&&a!==""||!s||s===""?(r=!0,o):t[s]||""),!r&&i!==e&&(p.debug(`${n} value in kernelSpec updated from ${e} to ${i}`),e=i),e.replace(/\\\$/g,"$")}var h7=require("vscode");async function g7(n,e,t){if(!t.interpreter||!nt(t)||!n.kernel||n.kernel.status==="dead"||n.kernel.status==="terminating"||t.kind!=="startUsingLocalKernelSpec"&&t.kind!=="startUsingPythonInterpreter")return;let r=new Fe;try{let i=await mn(n.kernel,`import sys as _VSCODE_sys
print(_VSCODE_sys.executable); del _VSCODE_sys`);if(i.length===0)return;let o=i[0];if(o.name!=="stdout"&&o.output_type!=="stream")return;let s=bs(o.text).trim().toLowerCase(),a=Ko(t.interpreter.uri,h7.Uri.file(s));await qi(e,{interpreterMatchesKernel:a})}catch(i){p.error(`Failed to compare interpreters after ${r.elapsedTime}ms`,i)}}function Mce(n){let e="kernelSpec"in n?n:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!dt(e))return!1;let t=e?e.kernelSpec:n;return VD(t.argv[0])}function qm(n){let e="kernelSpec"in n?n:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!dt(e))return!1;let t=e?e.kernelSpec:n;if(t.language&&t.language.toLowerCase()!==ge||!Mce(n))return!1;let r=t.argv.indexOf("-m");if(r===-1)return!1;let i=t.argv.length-1>=r?t.argv[r+1].toLowerCase():void 0;return i?i.includes("ipykernel_launcher")||i.includes("ipykernel"):!1}function VD(n){return n=Se(n).trim().toLowerCase(),n==="python"||n==="python3"||n==="python.exe"||n==="python3.exe"}var Hm=class{constructor(e,t,r,i){this.kernelDependencyService=e;this.fs=t;this.jupyterPaths=r;this.kernelEnvVars=i}async ensureKernelIsUsable(e,t,r,i,o){if(p.debug(`Check if a kernel ${t.id} is usable`),qm(t)&&t.interpreter){let a=await this.kernelDependencyService.installMissingDependencies({resource:e,kernelConnection:t,ui:r,token:i,ignoreCache:!0,cannotChangeKernels:o});switch(a){case 1:case 3:case 2:case 4:throw new Jm(a,t);default:break}}var s=void 0;dt(t)&&(s=t.kernelSpec.specFile,!s||!await this.fs.exists(Yv.Uri.file(s))?s=await this.registerKernel(t,i):t.interpreter&&s&&Se(rt(s)).toLowerCase()!=t.kernelSpec.name.toLowerCase()&&(s=await this.registerKernel(t,i)),t.interpreter&&s?(p.debug(`Updating Kernel Environment for ${t.id} for interpreter ${t.interpreter.id}`),await this.updateKernelEnvironment(e,t,s,i)):p.trace(`Not Updating Kernel Environment for ${t.id}`))}async registerKernel(e,t){let r=await this.jupyterPaths.getKernelSpecTempRegistrationFolder();if(!e.kernelSpec||t.isCancellationRequested||!e.kernelSpec.name)return;let i=zt(r,e.kernelSpec.name,"kernel.json");if(await this.fs.exists(i))return p.info(`Kernel spec file for ${e.id} already exists ${U(i)}`),i.fsPath;let o={...e.kernelSpec};if(e.kernelSpec.specFile&&!ud(Re(i),e.kernelSpec.specFile)&&(o.metadata=o.metadata||{},o.metadata={...o.metadata,vscode:{...o.metadata.vscode||{},originalSpecFile:e.kernelSpec.metadata?.vscode?.originalSpecFile||e.kernelSpec.specFile,originalDisplayName:e.kernelSpec.metadata?.vscode?.originalDisplayName||e.kernelSpec.display_name}}),e.interpreter&&(o.metadata={...o.metadata,interpreter:fm(e.interpreter)}),p.info(`RegisterKernel for ${e.id} into ${U(i)}`),p.debug(`RegisterKernel for ${e.id} into ${U(i)} with contents ${JSON.stringify(o)}`),await this.fs.writeFile(i,JSON.stringify(o,void 0,4)),t.isCancellationRequested)return;let s=o.metadata?.vscode?.originalSpecFile||o.metadata?.originalSpecFile;if(s){let a=rt(s),l=rt(i.fsPath),c=await this.fs.searchLocal("*.*[^json]",a);await Promise.all(c.map(async u=>{let d=We(a,u),f=We(l,u);await this.fs.copy(Yv.Uri.file(d),Yv.Uri.file(f))}))}return i.fsPath}async updateKernelEnvironment(e,t,r,i){let o=t.interpreter,s=t.kernelSpec,a=await this.jupyterPaths.getKernelSpecTempRegistrationFolder(),l=s;if(r&&a){let c=Se(r).toLowerCase()===s.name.toLowerCase()?r:zt(a,s.name,"kernel.json").fsPath;if(!await this.fs.exists(Yv.Uri.file(c))){p.warn(`Spec file for ${t.id} does not exist ${c} hence not updating env vars.`);return}let u=Yv.Uri.file(c);try{let d=JSON.parse(await this.fs.readFile(u));if(i?.isCancellationRequested||(d.metadata?.interpreter?(qm(s)&&(p.debug(`Python KernelSpec argv[0] updated for ${t.id} from '${d.argv[0]}' to '${U(o.uri)}'`),d.argv[0]=o.uri.fsPath),d.metadata=d.metadata||{},d.metadata.interpreter=o):p.trace(`KernelSpec argv[0] not updated for ${t.id} ('${d.argv[0]}')`),d.env=await this.kernelEnvVars.getEnvironmentVariables(e,o,l),d=Oj(d),await this.fs.writeFile(u,JSON.stringify(d,void 0,2)),p.debug(`Updated kernel spec for ${t.id} with environment variables for ${U(u)}`),i?.isCancellationRequested))return;l.metadata=d.metadata}catch(d){if(i?.isCancellationRequested)return;throw p.error(`Failed to update kernel spec for ${t.id} with environment variables for ${U(u)}`,d),d}}else p.warn(`Either Kernel spec file or root spec file path does not exist for ${t.id}.`)}};v([Nh("Failed to register an interpreter as a kernel")],Hm.prototype,"registerKernel",1),Hm=v([(0,Gm.injectable)(),m(0,(0,Gm.inject)(Es)),m(1,(0,Gm.inject)(dr)),m(2,(0,Gm.inject)(Lr)),m(3,(0,Gm.inject)(Ia))],Hm);var dE=k(N());var v7=require("vscode");var Xv=class{constructor(e,t){this.liveKernelConnectionTracker=e;this.providerRegistration=t}async isValid(e){if(!this.liveKernelConnectionTracker.wasKernelUsed(e))return!1;let t=await this.providerRegistration.jupyterCollections.find(i=>i.extensionId===e.serverProviderHandle.extensionId&&i.id===e.serverProviderHandle.id);if(!t)return p.warn(`Extension ${e.serverProviderHandle.extensionId} may have been uninstalled for provider ${e.serverProviderHandle.id}, handle ${e.serverProviderHandle.handle}`),!1;let r=new v7.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(r.token));return i?i.map(o=>o.id).includes(e.serverProviderHandle.handle)?!0:(p.warn(`Hiding remote kernel ${e.id} for ${t.id} as the remote Jupyter Server ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}:${e.serverProviderHandle.handle} is no longer available`),!1):!1}catch(i){return p.warn(`Failed to fetch remote servers from ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}`,i),!1}finally{r.dispose()}}};Xv=v([(0,dE.injectable)(),m(0,(0,dE.inject)(Im)),m(1,(0,dE.inject)(Vt))],Xv);var w7=k(So()),jD=require("vscode"),Os=k(N());var Zv=class extends kn{constructor(e){super("timeout",y.jupyterLaunchTimedOut,e)}};var ey=class extends Jn{constructor(t,r,i,o,s,a){super();this.interpreterService=t;this.disposableRegistry=r;this.configuration=o;this.notebookStarter=s;this.jupyterInterpreterService=a;this._isDisposing=!1;this.disposableRegistry.push(this.interpreterService.onDidChangeInterpreter(()=>this.onSettingsChanged())),this.disposableRegistry.push(this),jD.workspace.onDidChangeConfiguration(l=>{l.affectsConfiguration("python.dataScience",void 0)&&this.onSettingsChanged()},this,this.disposableRegistry),i.push({dispose:()=>Is(this)})}dispose(){this._isDisposing||(this._isDisposing=!0,this.cache?this.cache.then(t=>t.dispose()).catch(h).finally(()=>super.dispose()):super.dispose())}async startServer(t,r){if(this.isDisposed||this._isDisposing)throw new Error("Notebook server is disposed");if(!this.cache){let i=this.cache=this.startJupyterWithRetry(t,r);i.catch(o=>{p.error("Failed to start the Jupyter Server",o),this.cache===i&&(this.cache=void 0)})}return this.cache}async refreshCommands(){await this.jupyterInterpreterService?.refreshCommands()}async isJupyterServerSupported(t){return this.jupyterInterpreterService?this.jupyterInterpreterService.isNotebookSupported(t):!1}async getJupyterServerError(){return this.jupyterInterpreterService?this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported():y.webNotSupported}async getUsableJupyterPython(t){return!this.usablePythonInterpreter&&!this.isDisposed&&!this._isDisposing&&this.jupyterInterpreterService&&(this.usablePythonInterpreter=await rr(t,this.jupyterInterpreterService.getSelectedInterpreter(t))),this.usablePythonInterpreter}startJupyterWithRetry(t,r){return rr(r,(async()=>{let o,s=1,a=Math.max(1,this.configuration.getSettings(void 0).jupyterLaunchRetries),l;for(;s<=a&&!this.isDisposed&&!this._isDisposing;){try{return o=await this.startImpl(t,r),p.trace("Connection complete server"),o}catch(c){if(l=c,c instanceof Zv&&s<a)p.info("Retry because of wait for idle problem."),o?.dispose(),s+=1;else throw o&&(this.isDisposed||this._isDisposing),c}throw l}throw new Error("Max number of attempts reached")})())}async startImpl(t,r){p.debug("Launching server");let i=this.configuration.getSettings(t),o=i.useDefaultConfigForJupyter,s=await nE(t),a=vl(),l=fk(s,a?zt(a,`${(0,w7.default)()}.txt`):void 0,i);if(!this.notebookStarter)throw new Error("Notebook Starter cannot be undefined");return this.notebookStarter.start(t,o,this.configuration.getSettings(void 0).jupyterCommandLineArguments,jD.Uri.file(l),r)}onSettingsChanged(){this.usablePythonInterpreter=void 0}};ey=v([(0,Os.injectable)(),m(0,(0,Os.inject)(et)),m(1,(0,Os.inject)(M)),m(2,(0,Os.inject)(aa)),m(3,(0,Os.inject)(ie)),m(4,(0,Os.inject)(jk)),m(4,(0,Os.optional)()),m(5,(0,Os.inject)(Hd)),m(5,(0,Os.optional)())],ey);var mE=k(N());var JD=class extends Gr{constructor(){super("Python Extension not installed",void 0,"pythonExtension")}};var ty=class{constructor(e,t){this.jupyterServerProvider=e;this.extensionChecker=t;this.startupUi=new Ft(!0)}async connect(e){e.ui.disableUI||(this.startupUi.disableUI=!1);let t=e.ui.onDidChangeDisableUI(()=>{e.ui.disableUI||(this.startupUi.disableUI=!1,t.dispose())});if(e.ui=this.startupUi,this.extensionChecker.isPythonExtensionInstalled)return this.jupyterServerProvider.getOrStartServer(e).finally(()=>t.dispose());throw t.dispose(),this.startupUi.disableUI||await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),new JD}};ty=v([(0,mE.injectable)(),m(0,(0,mE.inject)(gg)),m(1,(0,mE.inject)($e))],ty);var zm=k(N());var BD=class extends qe{constructor(){super("nodeonly",y.webNotSupported)}};var ry=class{constructor(e,t){this.jupyterServerHelper=e;this.interpreterService=t}async getOrStartServer(e){if(!this.serverPromise){let t=this.serverPromise=this.startServerImpl(e);t.catch(()=>{t===this.serverPromise&&(this.serverPromise=void 0)})}return this.serverPromise}async startServerImpl(e){let t=this.jupyterServerHelper;if(!t)throw new BD;try{if(p.trace("Checking for server usability."),!await this.checkUsable())throw p.trace("Server not usable (should ask for install now)"),new Yi(y.jupyterNotSupported(await t.getJupyterServerError()));p.debug("Starting notebook server.");let i=await t.startServer(e.resource,e.token);return vn.throwIfCanceled(e.token),i}catch(r){throw e.token?.isCancellationRequested&&er(r)||await t.refreshCommands(),r}}async checkUsable(){try{return this.jupyterServerHelper?!!await this.jupyterServerHelper.getUsableJupyterPython():!0}catch(e){let t=await this.interpreterService.getActiveInterpreter(void 0);if(t){let r=nn(t)||Re(t.uri);throw new Error(y.jupyterNotSupportedBecauseOfEnvironment(r,e.toString()))}else throw new Yi(y.jupyterNotSupported(this.jupyterServerHelper?await this.jupyterServerHelper.getJupyterServerError():"Error"))}}};ry=v([(0,zm.injectable)(),m(0,(0,zm.inject)(yd)),m(0,(0,zm.optional)()),m(1,(0,zm.inject)(et))],ry);var P7=k(require("child_process")),Qc=k(N()),k7=k(require("os"));var x7=k(So()),fE=require("vscode");var qD=require("vscode");var ny=class extends qe{constructor(t,r,i){super("jupytercannotbelaunchedwitheroot",t+(r?`
${r}`:""));this.interpreter=i}};var Wce=new RegExp(zp.UrlPatternRegEx),$D=class{constructor(e,t,r,i,o,s){this.launchResult=e;this.notebookDir=t;this.rootDir=r;this.getServerInfo=i;this.serviceContainer=o;this.interpreter=s;this.startPromise=re();this.output="";this.subscriptions=[];this.ready=this.startPromise.promise;let l=o.get(ie).getSettings(void 0).jupyterLaunchTimeout;this.launchTimeout=setTimeout(()=>{this.startPromise.completed||this.rejectStartPromise(y.jupyterLaunchTimedOut)},l);let c=0;e.proc&&e.proc.on("exit",u=>c=u||0),this.subscriptions.push(e.out.onDidChange(u=>{p.trace(u.out),this.output+=u.out,zp.HttpPattern.exec(this.output)&&!this.startPromise.completed&&this.getServerInfo().then(d=>this.getJupyterURL(d,this.output)).catch(d=>p.warn("Failed to get server info",d))})),e.out.done.then(()=>this.rejectStartPromise(y.jupyterServerCrashed(c))).catch(u=>this.rejectStartPromise(u))}dispose(){clearTimeout(this.launchTimeout),z(this.subscriptions)}getJupyterURL(e,t){if(e&&e.length>0&&!this.startPromise.completed){let r=e.find(i=>ud(Re(this.notebookDir),Re(qD.Uri.file(i.notebook_dir))));if(r){let i=r.url,o=r.token;this.resolveStartPromise(i,o)}}if(!this.startPromise.completed){let i=Wce.exec(t)?.groups;if(!this.startPromise.completed&&i&&(i.LOCAL||i.IP)){let o=i.LOCAL?i.LOCAL:i.IP,s=`${i.PREFIX}${o}${i.REST}`,a;try{a=new URL(s)}catch(c){p.error(`Failed to parse ${s}`,c),this.rejectStartPromise(y.jupyterLaunchNoURL);return}let l=a.pathname.endsWith("/tree")?a.pathname.replace("/tree",""):a.pathname;this.resolveStartPromise(`${a.protocol}//${a.host}${l}`,`${a.searchParams.get("token")}`)}}}resolveStartPromise(e,t){if(clearTimeout(this.launchTimeout),!this.startPromise.rejected){let r=this.serviceContainer.get(ie),i=this.serviceContainer.get(Mc),o=this.serviceContainer.get(Id),s=mC({handle:"",id:"_builtin.jupyterServerLauncher",extensionId:Ae},{baseUrl:e,token:t,displayName:mk(t,e)},i,o,r,this.rootDir,new qD.Disposable(()=>this.launchResult.dispose()));this.startPromise.resolve(s)}}rejectStartPromise(e){if(clearTimeout(this.launchTimeout),!this.startPromise.resolved){e=typeof e=="string"?e:e.message;let t,r=this.output;r.includes("Jupyter command `jupyter-notebook` not found")?t=new zc(e,r,this.interpreter):r.includes("Running as root is not recommended. Use --allow-root to bypass")?t=new ny(e,r,this.interpreter):t=new gs(e,r,this.interpreter),this.startPromise.reject(t)}}};var iy=require("vscode");var Fs=new Set;function HD(...n){let e=new xr;try{let t=new class{async providePortAttributes(r,i){if(n.includes(r.port))return new iy.PortAttributes(iy.PortAutoForwardAction.Ignore)}};for(let r of n){let i={portRange:r};e.add(iy.workspace.registerPortAttributesProvider(i,t))}}catch(t){p.error("Failure in registering port attributes",t)}return e}var oy=class{constructor(e,t,r,i){this.jupyterInterpreterService=e;this.fs=t;this.serviceContainer=r;this.jupyterOutputChannel=i;this.disposables=[]}dispose(){for(;this.disposables.length>0;){let e=this.disposables.shift();try{e&&e.dispose()}catch{}}}async start(e,t,r,i,o){p.info("Starting Jupyter Server");let s=0,a,l=[],c=lt.reportProgress(e,"NotebookStart");try{let u=this.generateTempDir();u.then(w=>this.disposables.push(w)).catch(h);let d=await this.generateArguments(t,r,u,i.fsPath);vn.throwIfCanceled(o);let[f,g,b]=await Promise.all([this.jupyterInterpreterService.startNotebook(d||[],{throwOnStdErr:!1,encoding:"utf8",token:o}),u,this.jupyterInterpreterService.getSelectedInterpreter(o).catch(()=>{})]);f.proc&&(f.proc.on("exit",w=>s=w),f.out.onDidChange(w=>this.jupyterOutputChannel.append(w.out))),f&&o.onCancellationRequested(()=>{f.dispose()},this,l),p.debug("Waiting for Jupyter Notebook"),a=new $D(f,fE.Uri.file(g.path),i,()=>this.jupyterInterpreterService.getRunningJupyterServers(o),this.serviceContainer,b),vn.throwIfCanceled(o);let I=await rr(o,a.ready);try{let w=parseInt(new URL(I.baseUrl).port||"0",10);if(w&&!isNaN(w)){let D=HD(w);f.proc&&f.proc.on("exit",()=>{Fs.delete(w),D.dispose()}),Fs.add(w)}}catch(w){p.error(`Parsing failed ${I.baseUrl}`,w)}return z(l),I}catch(u){throw z(l),er(u)||u instanceof gs||u instanceof ny||u instanceof zc?u:await this.jupyterInterpreterService.isNotebookSupported()?s!==0?new Error(y.jupyterServerCrashed(s)):Gr.from(y.jupyterNotebookFailure(u),u):new Yi(await this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported())}finally{c.dispose(),a?.dispose()}}async generateDefaultArguments(e,t,r){let i=[];i.push(Promise.resolve("--no-browser")),i.push(Promise.resolve(this.getNotebookDirArgument(r))),e&&i.push(this.getConfigArgument(t)),i.push(Promise.resolve("--NotebookApp.iopub_data_rate_limit=10000000000.0"));let[o,s]=await Promise.all([Promise.all(i),this.getDockerArguments()]),a=process.env&&process.env.VSCODE_JUPYTER_DEBUG_JUPYTER?["--debug"]:[];return[...o,...s,...a]}async generateCustomArguments(e){return[...["--no-browser","--NotebookApp.iopub_data_rate_limit=10000000000.0","--KernelManager.autorestart=False"],...e]}async generateArguments(e,t,r,i){return!t||t.length===0?this.generateDefaultArguments(e,r,i):this.generateCustomArguments(t)}getNotebookDirArgument(e){return`--notebook-dir="${e.replace(/\\/g,"\\\\")}"`}async getConfigArgument(e){let t=await e,r=We(t.path,"jupyter_notebook_config.py");return await this.fs.writeFile(fE.Uri.file(r),""),p.debug(`Generating custom default config at ${r}`),`--config=${r}`}async getDockerArguments(){let e=[];try{let t=await this.fs.readFile(fE.Uri.file("/proc/self/cgroup")).catch(()=>"");return!t.includes("docker")&&!t.includes("kubepods")?e:(e.push("--ip"),e.push("127.0.0.1"),new Promise(r=>{P7.exec("id",{encoding:"utf-8"},(i,o)=>{o&&o.toString().includes("(root)")&&e.push("--allow-root"),r(e)})}))}catch{return e}}async generateTempDir(){let e=fE.Uri.file(We(k7.tmpdir(),(0,x7.default)()));return await this.fs.createDirectory(e),{path:Re(e),dispose:async()=>{let t=0;for(;t<10;)try{await this.fs.delete(e),t=10}catch{t+=1}}}}};oy=v([(0,Qc.injectable)(),m(0,(0,Qc.inject)(Hd)),m(1,(0,Qc.inject)(tt)),m(2,(0,Qc.inject)(st)),m(3,(0,Qc.inject)(Mo)),m(3,(0,Qc.named)(ph))],oy);var Bl=require("vscode"),Qm=k(N());var sy=class extends $t{constructor(t,r){super();this._onDidLoad=this._register(new Bl.EventEmitter);this._onDidChangeUri=this._register(new Bl.EventEmitter);this._onDidRemoveUris=this._register(new Bl.EventEmitter);this._onDidAddUri=this._register(new Bl.EventEmitter);this._all=[];r.push(this),this.newStorage=this._register(new BK(t))}get onDidLoad(){return this._onDidLoad.event}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}get all(){return this.updateStore(),this._all}hookupStorageEvents(){this.storageEventsHooked||(this.storageEventsHooked=!0,this._register(this.newStorage.onDidAdd(t=>this._onDidAddUri.fire(t),this)),this._register(this.newStorage.onDidChange(t=>this._onDidChangeUri.fire(t),this)),this._register(this.newStorage.onDidRemove(t=>this._onDidRemoveUris.fire(t),this)))}updateStore(){this.hookupStorageEvents();let t=this._all;return this._all=this.newStorage.getAll(),(t.length!==this._all.length||JSON.stringify(this._all)!==JSON.stringify(t))&&this._onDidLoad.fire(),this._all}async clear(){this.hookupStorageEvents(),await this.newStorage.clear(),this._all=[],this._onDidLoad.fire()}async add(t,r){this.hookupStorageEvents(),p.ci(`setUri: ${t.id}.${t.handle}`);let i={time:r?.time??Date.now(),displayName:"",provider:t};await this.newStorage.add(i),this.updateStore()}async update(t){this.hookupStorageEvents(),await this.newStorage.update(t),this.updateStore()}async remove(t){this.hookupStorageEvents(),await this.newStorage.remove(t),this.updateStore()}};sy=v([(0,Qm.injectable)(),m(0,(0,Qm.inject)(Le)),m(0,(0,Qm.named)(ut)),m(1,(0,Qm.inject)(M))],sy);var BK=class{constructor(e){this.memento=e;this._onDidChangeUri=new Bl.EventEmitter;this._onDidRemoveUris=new Bl.EventEmitter;this._onDidAddUri=new Bl.EventEmitter;this.updatePromise=Promise.resolve();this.mementoKey=`MEMENTO_KEY_FOR_STORING_USED_JUPYTER_PROVIDERS_${Bl.env.machineId}`}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}dispose(){this._onDidAddUri.dispose(),this._onDidChangeUri.dispose(),this._onDidRemoveUris.dispose()}async add(e){return this.updatePromise=this.updatePromise.then(async()=>{let t=this.getAll(),r=t.find(a=>Mt(a.provider)===Mt(e.provider)),o=[{displayName:e.displayName||r?.displayName||Mt(e.provider),serverHandle:e.provider,time:e.time}].concat(t.sort((a,l)=>l.time-a.time).filter(a=>Mt(a.provider)!==Mt(e.provider)).map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}))),s=o.splice(Xn.JupyterServerUriListMax);if(await this.memento.update(this.mementoKey,o),r||this._onDidAddUri.fire(e),s.length){let a=s.map(l=>({provider:l.serverHandle,time:l.time,displayName:l.displayName||""}));this._onDidRemoveUris.fire(a.map(l=>l.provider))}this._onDidChangeUri.fire()}).catch(h)}async update(e){let r=this.getAll().find(o=>o.provider.id===e.id&&o.provider.handle===e.handle),i={provider:e,time:Date.now(),displayName:r?.displayName||""};await this.add(i)}async remove(e){await(this.updatePromise=this.updatePromise.then(async()=>{let t=!1;try{let r=this.getAll();if(r.length===0)return;let i=r.filter(s=>s.provider.id!==e.id||s.provider.handle!==e.handle),o=r.filter(s=>s.provider.id===e.id&&s.provider.handle===e.handle);if(i.length===0)await this.clear();else if(o.length){let s=i.map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}));t=!0,await this.memento.update(this.mementoKey,s),this._onDidRemoveUris.fire(o.map(a=>a.provider))}}finally{t||this._onDidRemoveUris.fire([e])}}).catch(t=>p.error(`Failed to remove Server handle ${JSON.stringify(e)}`,t)))}getAll(){let e=this.memento.get(this.mementoKey,[]),t=[];return e.forEach(async r=>{let i=Mt(r.serverHandle),o={time:r.time,displayName:r.displayName||i,provider:r.serverHandle};t.push(o)}),t}async clear(){let e=this.getAll();await this.memento.update(this.mementoKey,[]),e.length&&this._onDidRemoveUris.fire(e.map(t=>t.provider))}};var Zd=k(N());var GD="removeKernelUrisAndSessionsUsedByResources",ay=class{constructor(e,t,r){this.disposables=e;this.uriStorage=t;this.memento=r;this.usedRemoteKernelServerIdsAndSessions={}}activate(){this.usedRemoteKernelServerIdsAndSessions=this.memento.get(GD,{}),this.uriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}wasKernelUsed(e){let t=Mt(e.serverProviderHandle);return t in this.usedRemoteKernelServerIdsAndSessions&&typeof e.kernelModel.id=="string"&&e.kernelModel.id in this.usedRemoteKernelServerIdsAndSessions[t]}trackKernelIdAsUsed(e,t,r){let i=Mt(t);this.usedRemoteKernelServerIdsAndSessions[i]=this.usedRemoteKernelServerIdsAndSessions[i]||{},this.usedRemoteKernelServerIdsAndSessions[i][r]=this.usedRemoteKernelServerIdsAndSessions[i][r]||[];let o=this.usedRemoteKernelServerIdsAndSessions[i][r];o.includes(e.toString())||(o.push(e.toString()),this.memento.update(GD,this.usedRemoteKernelServerIdsAndSessions).then(h,h))}trackKernelIdAsNotUsed(e,t,r){let i=Mt(t);if(!(i in this.usedRemoteKernelServerIdsAndSessions)||!(r in this.usedRemoteKernelServerIdsAndSessions[i]))return;let o=this.usedRemoteKernelServerIdsAndSessions[i][r];!Array.isArray(o)||!o.includes(e.toString())||(o.splice(o.indexOf(e.toString()),1),o.length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i][r],Object.keys(this.usedRemoteKernelServerIdsAndSessions[i]).length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i],this.memento.update(GD,this.usedRemoteKernelServerIdsAndSessions).then(h,h))}onDidRemoveServers(e){e.forEach(t=>{let r=Mt(t);delete this.usedRemoteKernelServerIdsAndSessions[r],this.memento.update(GD,this.usedRemoteKernelServerIdsAndSessions).then(h,h)})}};ay=v([(0,Zd.injectable)(),m(0,(0,Zd.inject)(M)),m(1,(0,Zd.inject)(Ht)),m(2,(0,Zd.inject)(Le)),m(2,(0,Zd.named)(ut))],ay);var ef=k(require("node-fetch")),U8=k(F8());var L8=require("vscode");function IO(n){return class extends n{constructor(...r){super(...r);this._onAnyMessage=new L8.EventEmitter;this.onAnyMessage=this._onAnyMessage.event;this.msgChain=Promise.resolve(),this.sendChain=Promise.resolve(),this.receiveHooks=[],this.sendHooks=[]}patchSuperEmit(r){super.emit=r}send(r,i){this.sendHooks?this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(r,i)))).then(()=>super.send(r,i)):super.send(r,i)}handleEvent(r,i,...o){return i==="message"&&this.receiveHooks.length?(this.msgChain=this.msgChain.then(()=>Promise.all(this.receiveHooks.map(s=>s(o[0])))).then(()=>r(i,...o)).catch(s=>p.error(`Exception while handling messages: ${s}`)),!0):r(i,...o)}emit(r,...i){if(r==="unexpected-response"&&i.length===2){let o=i[1];p.error(`Error in websocket: (${o?.statusCode}) ${o?.statusMessage}, ${o?.path}, Headers = ${JSON.stringify(o?.headers)}`)}return r==="error"&&p.error("Error in websocket",i.length?i[0]:void 0),this.handleEvent((o,...s)=>super.emit(o,...s),r,...i)}addReceiveHook(r){this.receiveHooks.push(r)}removeReceiveHook(r){this.receiveHooks=this.receiveHooks.filter(i=>i!==r)}addSendHook(r){this.sendHooks.push(r)}removeSendHook(r){this.sendHooks=this.sendHooks.filter(i=>i!==r)}}}var W8=k(N());var ci=new Map;var uy=class{getRequestCtor(e,t,r){class i extends ef.Request{constructor(s,a){super(s,a);let l=this.headers,c=r();Object.keys(c).forEach(f=>l.append(f,c[f].toString())),l.set("Content-Type","application/json");let d=l.append.bind(l);l.append=(f,g)=>{f.toLowerCase()!=="authorization"&&d(f,g)}}}return r&&Object.keys(r()||{}).length?i:ef.Request}getWebsocketCtor(e,t,r){let i=()=>{let s={},a;if(t&&(s={...s,rejectUnauthorized:!1}),e&&(a={Cookie:e}),r){let l=r();a=a?{...a,...l}:l}return a&&(s={...s,headers:a}),s};class o extends IO(U8.default){constructor(l,c){super(l,c,i());let u,d=/.*\/kernels\/(.*)\/.*/.exec(l);d&&d.length>1&&(this.kernelId=d[1]),this.kernelId?(ci.set(this.kernelId,this),this.on("close",()=>{u&&this.timer!==u&&clearInterval(u),ci.get(this.kernelId)===this&&ci.delete(this.kernelId)})):p.error("KernelId not extracted from Kernel WebSocket URL"),u=this.timer=setInterval(()=>this.ping(h),3e4)}}return o}wrapWebSocketCtor(e){class t extends IO(e){constructor(o,s,a){super(o,s,a);let l,c=/.*\/kernels\/(.*)\/.*/.exec(o);c&&c.length>1&&(this.kernelId=c[1]),this.kernelId?(ci.set(this.kernelId,this),this.on("close",()=>{l&&this.timer!==l&&clearInterval(l),ci.get(this.kernelId)===this&&ci.delete(this.kernelId)})):p.error("KernelId not extracted from Kernel WebSocket URL"),l=this.timer=setInterval(()=>this.ping(h),3e4)}}return t}getFetchMethod(){return ef.default}getHeadersCtor(){return ef.Headers}getRequestInit(){return{cache:"no-store",credentials:"same-origin"}}};uy=v([(0,W8.injectable)()],uy);var V8=require("https"),j8=k(N());var dy=class{createHttpRequestAgent(){return new V8.Agent({rejectUnauthorized:!1})}};dy=v([(0,j8.injectable)()],dy);var Qo=k(N());var zo=require("vscode");var Hue=["/bin/sh","/bin/bash","/bin/zsh"];function o_(n,e){let t=(n.argv||[]).some(r=>(r=r.toLowerCase(),Hue.some(i=>r.includes(i))));R("DATASCIENCE.KERNEL_SPEC_LANGUAGE",void 0,{language:n.language,kind:e,usesShell:t})}var py="remoteKernelSpecCache.json";var Gue=2e3,s_=class extends Jn{constructor(t,r,i,o,s,a,l,c,u,d){super();this.id=t;this.displayName=r;this.env=i;this.cachedRemoteKernelValidator=o;this.kernelProvider=a;this.serverProviderHandle=l;this.jupyterConnection=c;this.fs=u;this.context=d;this._status="idle";this._onDidChangeStatus=new zo.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new ao;this.kernelIdsToHide=new Set;this.kind="remote";this.cache=[];this._onDidChangeKernels=new zo.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._onDidChange=new zo.EventEmitter;this.onDidChange=this._onDidChange.event;this.cacheFile=zo.Uri.joinPath(d.globalStorageUri,py),this.cacheKey=Mt(l),this._register(s.registerKernelFinder(this)),this._register(this._onDidChangeKernels.event(()=>this._onDidChange.fire(),this)),this._register(this._onDidChangeKernels),this._register(this._onDidChange),this._register(this._onDidChangeStatus),this._register(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}get lastError(){return this._lastError}get kernels(){return this.cache}get items(){return this.kernels}get title(){return this.displayName}dispose(){super.dispose(),this._cacheUpdateCancelTokenSource?.dispose(),this.kernelDisposeDelayTimer?.dispose()}async activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.loadCache().then(h,h),this._register(this.kernelProvider.onDidStartKernel(t=>{xt(t.kernelConnectionMetadata)&&this.updateCache().then(h,h)},this)),this._register(this.kernelProvider.onDidDisposeKernel(t=>{if(t&&xt(t.kernelConnectionMetadata)){this.kernelDisposeDelayTimer?.dispose();let r=setTimeout(()=>{this.updateCache().then(h,h)},Gue);return this.kernelDisposeDelayTimer=new zo.Disposable(()=>clearTimeout(r)),r}},this))}async refresh(){await this.loadCache(!0,!0)}getListOfKernelsWithCachedConnection(t,r=!1){return(!this.cachedConnection||r)&&(this.cachedConnection=this.getRemoteConnectionInfo(t)),this.cachedConnection.then(i=>i?(this.cachedConnection=Promise.resolve(i),this.listKernelsFromConnection(i)):Promise.resolve([])).catch(i=>this.isDisposed?Promise.reject(i):r?(this.cachedConnection=void 0,Promise.reject(i)):this.getListOfKernelsWithCachedConnection(t,!0))}async loadCache(t=!1,r=!1){p.ci(`Remote Kernel Finder load cache Server: ${this.id}`);let i=(async()=>{let o=t?[]:await this.getFromCache(),s=[];if(!t&&Array.isArray(o)&&o.length>0)s=o,this.updateCache().then(h,h),this.loadCache(!0).then(h,h);else try{s=await this.getListOfKernelsWithCachedConnection(r),this._lastError=void 0}catch(a){a instanceof zo.CancellationError||(p.error("UniversalRemoteKernelFinder: Failed to get kernels without cache",a),this._lastError=a,this._onDidChange.fire())}await this.writeToCache(s)})();this.promiseMonitor.push(i),await i}async updateCache(){let t=(async()=>{let r=[];this._cacheUpdateCancelTokenSource?.dispose();let i=new zo.CancellationTokenSource;this._cacheUpdateCancelTokenSource=i;try{r=await this.getListOfKernelsWithCachedConnection(!1)}catch(o){p.warn(`Could not fetch kernels from the ${this.kind} server, falling back to cache: ${o}`),r=await this.getFromCache(i.token),r=r.filter(s=>s.kind==="connectToLiveRemoteKernel")}i.token.isCancellationRequested||await this.writeToCache(r)})();this.promiseMonitor.push(t),await t}async getRemoteConnectionInfo(t=!0){let r=[];return t&&r.push(lt.createProgressReporter(void 0,y.connectingToJupyter)),this.jupyterConnection.createConnectionInfo(this.serverProviderHandle).finally(()=>z(r))}async getFromCache(t){try{if(t?.isCancellationRequested)throw new zo.CancellationError;let r=this.cache;(!r||r.length===0)&&(r=await this.getCacheContents());let i=[],o=Promise.all(r.map(async s=>{await this.isValidCachedKernel(s)&&i.push(s)}));return await tr(t,o),i}catch(r){p.error("UniversalRemoteKernelFinder: Failed to get from cache",r)}return[]}async getCacheContents(){try{let t=await this.fs.readFile(this.cacheFile),r=JSON.parse(t);if(r.extensionVersion!==this.env.extensionVersion)return[];let i=r.data[this.cacheKey]||[];return Array.isArray(i)?i.map(o=>Cs.fromJSON(o)):[]}catch{return[]}}async listKernelsFromConnection(t){let r=[];try{let i=Cd.create(t.settings);r.push({dispose:()=>Is(i)});let[o,s,a,l]=await Promise.all([i.getRunningKernels(),i.getKernelSpecs(),i.getRunningSessions(),lj(t.serverProviderHandle)]),c=s.map(f=>(o_(f,"remote"),hC.create({kernelSpec:f,id:xi(f,void 0,l),baseUrl:t.baseUrl,serverProviderHandle:t.serverProviderHandle})));return[...a.map(f=>{let g=f.kernel,b=g.last_activity?new Date(Date.parse(g.last_activity.toString())):new Date,I=g.connections?parseInt(g.connections.toString(),10):0,w=o.find(T=>T.id===f.kernel?.id)||{},D=s.find(T=>T.name===f.kernel?.name)||{};return fC.create({kernelModel:{...f.kernel,...D,...w,name:f.kernel?.name||"",lastActivityTime:b,numberOfConnections:I,model:f},baseUrl:t.baseUrl,id:f.kernel?.id||"",serverProviderHandle:t.serverProviderHandle})}).filter(f=>!this.kernelIdsToHide.has(f.kernelModel.id||"")),...c]}catch(i){throw p.error(`Error fetching kernels from ${t.baseUrl} (${t.displayName}):`,i),i}finally{await Promise.all(r.map(i=>i.dispose().catch(h)))}}async writeToCache(t){try{p.trace(`UniversalRemoteKernelFinder: Writing ${t.length} remote kernel connection metadata to cache`);let r=this.cache,i=new Map(r.map(f=>[f.id,f])),o=new Map(t.map(f=>[f.id,f])),s=t.filter(f=>!i.has(f.id)),a=t.filter(f=>i.has(f.id)&&!Xs(f,i.get(f.id))),l=r.filter(f=>!o.has(f.id)),c=this.cacheKey;this.cache=r.filter(f=>o.has(f.id)).concat(s),this.cache.forEach(f=>{let g=o.get(f.id);f!==g&&g.kind==="connectToLiveRemoteKernel"&&f.kind==="connectToLiveRemoteKernel"&&f.updateModel(g.kernelModel)});let u=t.map(f=>f.toJSON()),d={extensionVersion:this.env.extensionVersion,data:{}};try{let f=await this.fs.readFile(this.cacheFile),g=JSON.parse(f);g.extensionVersion===this.env.extensionVersion&&(d=g)}catch{}d.data[c]=u,await this.fs.createDirectory(this.context.globalStorageUri).then(()=>this.fs.writeFile(this.cacheFile,JSON.stringify(d))).catch(f=>{p.error("Failed to cache the remote kernels.",f)}),(s.length||a.length||l.length)&&this._onDidChangeKernels.fire({removed:l})}catch(r){p.error("UniversalRemoteKernelFinder: Failed to write to cache",r)}}async isValidCachedKernel(t){switch(t.kind){case"startUsingRemoteKernelSpec":return!1;case"connectToLiveRemoteKernel":return this.cachedRemoteKernelValidator.isValid(t)}}};var a_=require("vscode");var tu=class{constructor(e,t,r,i,o,s,a,l,c,u){this.serverUriStorage=e;this.env=t;this.cachedRemoteKernelValidator=r;this.kernelFinder=i;this.kernelProvider=o;this.jupyterConnection=s;this.disposables=a;this.fs=l;this.context=c;this.jupyterServerProviderRegistry=u;this.serverFinderMapping=new Map;this.handledProviders=new WeakSet;this.mappedProviders=new WeakSet;this.mappedServers=new Set}activate(){this.serverUriStorage.onDidAdd(e=>this.validateAndCreateFinder(e),this,this.disposables),this.serverUriStorage.onDidChange(this.buildListOfFinders,this,this.disposables),this.serverUriStorage.onDidLoad(this.handleProviderChanges,this,this.disposables),this.serverUriStorage.onDidLoad(this.buildListOfFinders,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderHandleChanges,this,this.disposables),this.serverUriStorage.onDidRemove(this.urisRemoved,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderChanges,this,this.disposables),this.buildListOfFinders(),this.handleProviderChanges().catch(h)}buildListOfFinders(){this.serverUriStorage.all.map(e=>this.validateAndCreateFinder(e).catch(h))}handleProviderHandleChanges(){this.jupyterServerProviderRegistry.jupyterCollections.forEach(e=>{this.handledProviders.has(e)||(this.handledProviders.add(e),e.serverProvider.onDidChangeServers&&e.serverProvider.onDidChangeServers(this.buildListOfFinders,this,this.disposables))}),this.buildListOfFinders()}async handleProviderChanges(){if(!this.serverUriStorage.all.length)return;let e=new a_.CancellationTokenSource;this.disposables.push(e),await Promise.all(this.jupyterServerProviderRegistry.jupyterCollections.map(t=>{let r=t.serverProvider;if(!(!r||this.mappedProviders.has(r)))return this.mappedProviders.add(r),r?.onDidChangeServers&&r?.onDidChangeServers(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.serverUriStorage.onDidLoad(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.lookForServersInCollectionAndRemoveOldServers(t).catch(h)})),e.dispose()}async lookForServersInCollectionAndRemoveOldServers(e){if(!this.serverUriStorage.all.length)return;let t=new Set(this.serverUriStorage.all.map(o=>Mt(o.provider))),r=e.serverProvider;if(!r)return;let i=new a_.CancellationTokenSource;try{let o=await Promise.resolve(r.provideJupyterServers(i.token)),s=new Set;(o||[]).forEach(a=>{let l={extensionId:e.extensionId,handle:a.id,id:e.id},c=Mt(l);s.add(c),ND(l,a.label),!(this.mappedServers.has(c)||!t.has(c))&&(this.mappedServers.add(c),this.createRemoteKernelFinder(l,a.label))}),this.serverFinderMapping.forEach((a,l)=>{a.serverProviderHandle.extensionId===e.extensionId&&a.serverProviderHandle.id===e.id&&!s.has(Mt(a.serverProviderHandle))&&(a.dispose(),this.serverFinderMapping.delete(l))})}catch(o){p.error(`Failed to get servers for Collection ${e.id} in ${e.extensionId}`,o)}finally{i.dispose()}}async validateAndCreateFinder(e){let t=Mt(e.provider);if(this.serverFinderMapping.has(t))return;let r=new a_.CancellationTokenSource,i=async()=>{let s=this.jupyterServerProviderRegistry.jupyterCollections.find(c=>c.extensionId===e.provider.extensionId&&c.id===e.provider.id);if(!s||!s.serverProvider)return;let l=(await Promise.resolve(s.serverProvider.provideJupyterServers(r.token)))?.find(c=>c.id===e.provider.handle)?.label;l&&this.createRemoteKernelFinder(e.provider,l)},o=async()=>{let s=await this.jupyterServerProviderRegistry.jupyterCollections.find(a=>a.extensionId===e.provider.extensionId&&a.extensionId===qa&&a.id===e.provider.id)?.label;s&&this.createRemoteKernelFinder(e.provider,s)};await Promise.all([i().catch(h),o().catch(h)]),r.dispose()}getOrCreateRemoteKernelFinder(e,t){let r=Mt(e);if(!this.serverFinderMapping.has(r)){let i=new s_(`remote-${r}`,t,this.env,this.cachedRemoteKernelValidator,this.kernelFinder,this.kernelProvider,e,this.jupyterConnection,this.fs,this.context);this.disposables.push(i),this.serverFinderMapping.set(r,i),i.activate().then(h,h)}return this.serverFinderMapping.get(r)}createRemoteKernelFinder(e,t){this.getOrCreateRemoteKernelFinder(e,t)}urisRemoved(e){e.forEach(t=>{let r=Mt(t),i=this.serverFinderMapping.get(r);i&&i.dispose(),this.serverFinderMapping.delete(r)})}dispose(){this.serverFinderMapping.forEach(e=>e.dispose())}};v([qr("Handle Jupyter Provider Changes")],tu.prototype,"handleProviderChanges",1),v([qr("Check Servers in Jupyter Server Provider")],tu.prototype,"lookForServersInCollectionAndRemoveOldServers",1),v([qr("Failed to create a Remote Kernel Finder")],tu.prototype,"validateAndCreateFinder",1),tu=v([(0,Qo.injectable)(),m(0,(0,Qo.inject)(Ht)),m(1,(0,Qo.inject)(Tl)),m(2,(0,Qo.inject)(Jk)),m(3,(0,Qo.inject)(Dr)),m(4,(0,Qo.inject)(we)),m(5,(0,Qo.inject)(sn)),m(6,(0,Qo.inject)(M)),m(7,(0,Qo.inject)(tt)),m(8,(0,Qo.inject)(Ze)),m(9,(0,Qo.inject)(Vt))],tu);var rp=k(N());var h_=require("vscode");var g_=k(So());var Gl=k(N());var l_=class extends qe{constructor(t){super("localjupyterserverconnection",y.jupyterNotebookFailure(t.message||t.toString()));this.originalError=t}};function fy(n){if(kr()){let e=n;if(e&&e._futures){let t=e._futures;t.forEach&&t.forEach(r=>{r._status!==void 0&&(r._status|=4)})}e&&e._reconnectLimit&&(e._reconnectLimit=0)}}var my=class extends Gr{constructor(e){super(e.message,e)}};var bE=require("vscode");var tf=class extends kn{constructor(e){super("invalidkernel",y.kernelInvalid(ot(e)),e)}};async function hy(n,e,t,r,i){if(!t.kernel)throw new tf(n);let o=lt.reportProgress(e,y.waitingForJupyterSessionToBeIdle),s=[];o&&s.push(o);try{p.trace(`Waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`);let a=re();i.onCancellationRequested(()=>a.reject(new bE.CancellationError),void 0,s);let l=(f,g)=>{p.trace(`Got status ${g} in waitForIdleOnSession`),g=="idle"&&a.resolve(g)};t.kernel.statusChanged?.connect(l),s.push(new bE.Disposable(()=>ei(()=>t.kernel?.statusChanged?.disconnect(l)))),t.kernel.status=="idle"&&a.resolve(t.kernel.status);let c=re(),u=()=>c.resolve("");t.disposed.connect(u,c),s.push(new bE.Disposable(()=>ei(()=>t.disposed.disconnect(u,c)))),c.promise.catch(h),a.promise.catch(h);let d=await br(r,"",a.promise,c.promise);if(t.isDisposed)throw p.error("Session disposed while waiting for session to be idle."),new tf(n);if(p.trace(`Finished waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),d=="idle")return;throw p.error(`Shutting down after failing to wait for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),new Zv(n)}catch(a){throw p.ci("Error waiting for idle",a),a}finally{z(s)}}var f_=require("vscode");var Sa=k(p_()),SO=require("vscode");var gy=class extends Jn{constructor(t,r){super();this.kind=t;this.session=r;this.propertyChanged=new Sa.Signal(this);this.kernelChanged=new Sa.Signal(this);this.statusChanged=new Sa.Signal(this);this.connectionStatusChanged=new Sa.Signal(this);this.iopubMessage=new Sa.Signal(this);this.unhandledMessage=new Sa.Signal(this);this.anyMessage=new Sa.Signal(this);this.pendingInput=new Sa.Signal(this);this.disposed=new Sa.Signal(this);this.didShutdown=this._register(new SO.EventEmitter);this._onDidKernelSocketChange=this._register(new SO.EventEmitter);r.propertyChanged.connect(this.onPropertyChanged,this),r.kernelChanged.connect(this.onKernelChanged,this),r.statusChanged.connect(this.onStatusChanged,this),r.connectionStatusChanged.connect(this.onConnectionStatusChanged,this),r.iopubMessage.connect(this.onIOPubMessage,this),r.unhandledMessage.connect(this.onUnhandledMessage,this),r.pendingInput.connect(this.onPendingInput,this),r.anyMessage.connect(this.onAnyMessage,this),this._register({dispose:()=>{this.session.propertyChanged.disconnect(this.onPropertyChanged,this),this.session.kernelChanged.disconnect(this.onKernelChanged,this),this.session.statusChanged.disconnect(this.onStatusChanged,this),this.session.connectionStatusChanged.disconnect(this.onConnectionStatusChanged,this),this.session.iopubMessage.disconnect(this.onIOPubMessage,this),this.session.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.session.pendingInput.disconnect(this.onPendingInput,this),this.session.anyMessage.disconnect(this.onAnyMessage,this)}})}get id(){return this.session.id}get path(){return this.session.path}get name(){return this.session.name}get type(){return this.session.type}get serverSettings(){return this.session.serverSettings}get model(){return this.session.model}get kernel(){return this.isDisposed||!this.session.kernel?null:this.session.kernel}get onDidShutdown(){return this.didShutdown.event}get kernelId(){return this.session?.kernel?.id||""}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}dispose(){this.isDisposed||(super.dispose(),this.statusChanged.emit("dead"),this.disposed.emit(),Sa.Signal.disconnectAll(this))}async restart(){await this.session.kernel?.restart(),this.initializeKernelSocket(),p.info(`Restarted ${this.session?.kernel?.id}`)}initializeKernelSocket(){if(!this.session.kernel)throw new Error("Kernel not initialized in Session");let t={kernel:this.session.kernel,options:{clientId:this.session.kernel.clientId,id:this.session.kernel.id,model:{...this.session.kernel.model},userName:this.session.kernel.username},socket:ci.get(this.session.kernel.id)};JSON.stringify(this.previousKernelSocketInformation?.kernel.model)===JSON.stringify(t.kernel.model)&&this.previousKernelSocketInformation?.kernel===t.kernel&&this.previousKernelSocketInformation?.kernel.id===t.kernel.id&&this.previousKernelSocketInformation?.socket===t.socket||(this.previousKernelSocketInformation=t,this.session.kernel?.connectionStatusChanged.disconnect(this.onKernelConnectionStatusHandler,this),this.session.kernel?.connectionStatusChanged.connect(this.onKernelConnectionStatusHandler,this),this._onDidKernelSocketChange.fire())}onPropertyChanged(t,r){this.propertyChanged.emit(r)}onKernelChanged(t,r){this.kernelChanged.emit(r)}onStatusChanged(t,r){this.statusChanged.emit(r);let i=this.status;p.ci(`Server Status = ${i}`)}onConnectionStatusChanged(t,r){this.connectionStatusChanged.emit(r)}onIOPubMessage(t,r){this.iopubMessage.emit(r)}onUnhandledMessage(t,r){p.warn(`Unhandled message found: ${r.header.msg_type}`),this.unhandledMessage.emit(r)}onAnyMessage(t,r){this.anyMessage.emit(r)}onPendingInput(t,r){this.pendingInput.emit(r)}setPath(t){return this.session.setPath(t)}setName(t){return this.session.setName(t)}setType(t){return this.session.setType(t)}changeKernel(t){return this.session.changeKernel(t)}onKernelConnectionStatusHandler(t,r){p.ci(`Server Kernel Status = ${r}`)}};var m_=class extends gy{constructor(t,r,i,o,s){super(dt(i)?"localJupyter":"remoteJupyter",t);this.resource=r;this.kernelConnectionMetadata=i;this.kernelService=o;this.creator=s;this.isShuttingDown=!1;this.initializeKernelSocket()}get status(){return this.isDisposed?"dead":this.session?.kernel?this.session.kernel.status:(p.ci(`Kernel status not started because real session is ${this.session?"defined":"undefined"} & real kernel is ${this.session?.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!1).finally(()=>super.dispose())}async waitForIdle(t,r){try{await hy(this.kernelConnectionMetadata,this.resource,this.session,t,r)}catch(i){throw p.ci("Error waiting for idle",i),await this.shutdown().catch(h),i}}async restart(){let t=[],r=new f_.CancellationTokenSource;this.restartToken=r;let i=new Ft(!1);t.push(i),t.push(r);try{await this.validateLocalKernelDependencies(r.token,i),await super.restart()}finally{z(t)}}async validateLocalKernelDependencies(t,r){if(!(!this.kernelConnectionMetadata?.interpreter||!dt(this.kernelConnectionMetadata)||!this.kernelService)){if(t.isCancellationRequested)throw new f_.CancellationError;await this.kernelService.ensureKernelIsUsable(this.resource,this.kernelConnectionMetadata,r,t,this.creator==="3rdPartyExtension")}}async shutdown(){return this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!0)}async shutdownImplementation(t){if(this.isDisposed||this.isShuttingDown)return;this.isShuttingDown=!0;let r=(new Error().stack||"").split(`
`).filter(o=>o.includes(Ae));p.trace(`Shutdown session - current session, called from 
 ${r.map(o=>`    ${o}`).join(`
`)}`);let i=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata.id}`;p.debug(`shutdownSession ${i} - start`);try{if(t||this.canShutdownSession())try{p.debug(`Session can be shutdown ${this.kernelConnectionMetadata.id}`),fy(this.session.kernel),this.session.isDisposed||await br(1e3,this.session.shutdown().catch(h))}catch{try{this.session.isDisposed||this.session.dispose()}catch(o){p.warn("Failures in disposing the session",o)}}finally{this.didShutdown.fire()}else p.debug(`Session cannot be shutdown ${this.kernelConnectionMetadata.id}`);try{this.session.isDisposed||this.session.dispose()}catch(o){p.warn("Failures in disposing the session",o)}super.dispose(),p.trace("Shutdown session -- complete")}catch(o){p.warn("Failures in disposing the session",o)}p.debug(`shutdownSession ${i} - shutdown complete`)}canShutdownSession(){return dt(this.kernelConnectionMetadata)?!0:this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?!1:this.resource&&$i(this.resource)==="interactive"?!0:!(this.resource&&$i(this.resource)==="notebook"&&xt(this.kernelConnectionMetadata))}};var ru=class{constructor(e,t,r,i,o){this.jupyterNotebookProvider=e;this.jupyterConnection=t;this.asyncDisposables=r;this.kernelService=i;this.configService=o}async create(e){let t=[],r,i=()=>{e.ui.disableUI||r||(r=lt.createProgressReporter(e.resource,xt(e.kernelConnection)?y.connectingToJupyter:y.startingJupyter),t.push(r))};e.ui.disableUI&&e.ui.onDidChangeDisableUI(i,this,t),i();let o,s=[],a=this.configService.getSettings(e.resource).jupyterLaunchTimeout;try{o=xt(e.kernelConnection)?await rr(e.token,this.jupyterConnection.createConnectionInfo(e.kernelConnection.serverProviderHandle)):await this.jupyterNotebookProvider.getOrStartServer({resource:e.resource,token:e.token,ui:e.ui}),await rr(e.token,this.validateLocalKernelDependencies(e));let l=Cd.create(o.settings);this.asyncDisposables.push({dispose:()=>Is(l)}),s.push(l),await rr(e.token,this.validateRemoteServer(e,l));let c=await this.connectToOrCreateSession({...e,contentsManager:l.contentsManager,sessionManager:l.sessionManager,kernelManager:l.kernelManager,kernelSpecManager:l.kernelSpecManager,idleTimeout:a,connection:o});e.token.isCancellationRequested&&(await c.shutdown().catch(h),ei(()=>c.dispose())),vn.throwIfCanceled(e.token),p.info(`Started session for kernel ${e.kernelConnection.kind}:${e.kernelConnection.id}`);let u=new m_(c,e.resource,e.kernelConnection,this.kernelService,e.creator),d=c.disposed,f=()=>{l.dispose(),d.disconnect(f)};this.asyncDisposables.push({dispose:()=>u.shutdown().finally(()=>u.dispose())}),c.disposed.connect(f);let g=u.onDidDispose(f);return this.asyncDisposables.push(g),u}catch(l){throw z(s),xt(e.kernelConnection)?o?Fo.isSelfCertsError(l)?new Fo(o.baseUrl):Sl.isSelfCertsExpiredError(l)?new Sl(o.baseUrl):new Di(o.baseUrl,e.kernelConnection.serverProviderHandle,l):l:l instanceof qe?l:new l_(l)}finally{z(t)}}async validateRemoteServer(e,t){if(t.isDisposed)throw new pn;if(!dt(e.kernelConnection))try{await Promise.all([t.getRunningKernels(),t.getKernelSpecs()])}catch(r){throw p.error("Failed to fetch running kernels from remote server, connection may be outdated or remote server may be unreachable",r),new Di(e.kernelConnection.baseUrl,e.kernelConnection.serverProviderHandle,r)}}async validateLocalKernelDependencies(e){if(e.token.isCancellationRequested)throw new h_.CancellationError;e.kernelConnection?.interpreter&&dt(e.kernelConnection)&&this.kernelService&&await this.kernelService.ensureKernelIsUsable(e.resource,e.kernelConnection,e.ui,e.token,e.creator==="3rdPartyExtension")}async connectToOrCreateSession(e){if(e.token.isCancellationRequested)throw new h_.CancellationError;let t;try{if(e.kernelConnection&&e.kernelConnection.kind==="connectToLiveRemoteKernel"&&e.kernelConnection.kernelModel.id&&e.kernelConnection.kernelModel.model){if(!e.kernelConnection.kernelModel.model)throw new Error("Kernel model not defined when connecting to an existing session");t=e.sessionManager.connectTo({...e.kernelConnection.kernelModel,model:e.kernelConnection.kernelModel.model}),await rr(e.token,Lw(async()=>t.kernel?.connectionStatus==="connected"||e.token.isCancellationRequested,e.idleTimeout,100))}else p.trace(`createNewKernelSession ${e.kernelConnection?.id}`),t=await this.createNewSession(e),await hy(e.kernelConnection,e.resource,t,e.idleTimeout,e.token).catch(h);if(e.token.isCancellationRequested)throw new h_.CancellationError;return t}catch(r){let i=e.ui.disableUI?p.debug:p.error;throw r instanceof qe?(i("Failed to change kernel, re-throwing",r),r):(i("Failed to change kernel",r),new tf(e.kernelConnection))}}async createNewSession(e){let t=(e.connection,e.resource,void 0),r=t?.path,i=ug(e.kernelConnection)??e.kernelSpecManager?.specs?.default??"",o;if(t?.name)o=t.name;else{let a=e.resource?Yu(e.resource):"";o=`${e.resource?dn(e.resource,a):""}-${(0,g_.default)()}${a}`}let s={path:r||Yue(e.resource),kernel:{name:i},name:o,type:(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console"};try{let a=await rr(e.token,e.sessionManager.startNew(s,{kernelConnectionOptions:{handleComms:!0}}));if(!a.kernel)throw new my(new Error("No kernel created"));return p.info(y.createdNewKernel(e.connection.baseUrl,a?.kernel?.id||"")),a}catch(a){throw a instanceof my?a:new my(a)}}};ru=v([(0,Gl.injectable)(),m(0,(0,Gl.inject)(gg)),m(1,(0,Gl.inject)(sn)),m(2,(0,Gl.inject)(aa)),m(3,(0,Gl.inject)(Vk)),m(3,(0,Gl.optional)()),m(4,(0,Gl.inject)(ie))],ru);function Que(){return`${cg}${(0,g_.default)()}`}function Yue(n){let e=`${Que()}${(0,g_.default)()}.ipynb`;return n?`${dn(n,".ipynb")}${e}`:`${y.defaultNotebookName}${e}`}var vy=class{constructor(e,t,r){this.rawKernelSupported=e;this.newRawKernelSessionFactory=t;this.newJupyterSessionFactory=r}async create(e){let t=e.kernelConnection;return this.rawKernelSupported.isSupported&&dt(t)&&this.newRawKernelSessionFactory?this.newRawKernelSessionFactory.create({...e,kernelConnection:t}):this.newJupyterSessionFactory.create(e)}};vy=v([(0,rp.injectable)(),m(0,(0,rp.inject)(ai)),m(1,(0,rp.inject)(DD)),m(1,(0,rp.optional)()),m(2,(0,rp.inject)(ru))],vy);var IE=Symbol("RemoteKernelFinderController");function G8(n,e){n.add(Kv,Hv),n.addSingleton(me,Gv),n.addSingleton(me,Ov),n.addSingleton(yd,ey),n.addSingleton(Rs,Rs),n.addSingleton(hg,Qv),n.addSingleton(Wk,$m),n.addSingleton(Gc,Gc),n.addSingleton(si,si),n.addSingleton(ga,ga),n.addSingleton(da,da),n.addSingleton(Vk,Hm),n.addSingleton(gg,ry),n.addSingleton(bd,Bm),n.addSingleton(Hd,Bm),n.addSingleton(Ht,sy),n.addSingleton(jk,oy),n.addSingleton(yk,ty),n.addSingleton(gC,vy),n.addSingleton(ru,ru),n.addSingleton(Mc,uy),n.addSingleton(Id,dy),n.addSingleton(sn,sn),n.addSingleton(Im,ay),n.addBinding(Im,me),n.addSingleton(Jk,Xv),n.addSingleton(Br,qv),n.addSingleton(IE,tu),n.addBinding(IE,me),n.addSingleton(Vt,bg)}var rf=k(N()),nu=require("vscode");var yy=class{constructor(e,t,r,i){this.disposableRegistry=e;this.kernelProvider=t;this.serverUriStorage=r;this.jupyterUriProviderRegistration=i;this.kernelsStartedSuccessfully=new WeakSet;this.kernelDisposables=new WeakMap;this.kernelConnectionToKernelMapping=new WeakMap;this.kernelsRestarting=new WeakSet;this.kernelReconnectProgress=new WeakMap;this.lastExecutedCellPerKernel=new WeakMap}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelDisposables.get(e)?.dispose(),this.kernelDisposables.delete(e),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(nr.onDidChangeNotebookCellExecutionState(e=>{if(!Pt(e.cell.notebook)||e.state!==1)return;let t=this.kernelProvider.get(e.cell.notebook);!t||this.lastExecutedCellPerKernel.get(t)!==e.cell||this.lastExecutedCellPerKernel.delete(t)}))}getKernelSpecificDisposables(e){let t=this.kernelDisposables.get(e)||new xr;return this.disposableRegistry.push(t),this.kernelDisposables.set(e,t),t}onDidStartKernel(e){if(this.kernelsStartedSuccessfully.has(e)||!e.session?.kernel)return;let t=this.getKernelSpecificDisposables(e);t.add(nr.onDidChangeNotebookCellExecutionState(r=>{r.cell.notebook===e.notebook&&this.kernelProvider.get(r.cell.notebook)===e&&r.state===3&&this.lastExecutedCellPerKernel.set(e,r.cell)},this)),this.kernelsStartedSuccessfully.add(e),this.kernelConnectionToKernelMapping.set(e.session.kernel,e),e.session?.kernel?.connectionStatusChanged.connect(this.onKernelStatusChanged,this),t.add(e.addHook("willRestart",async()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),this.kernelsRestarting.add(e)},this)),t.add(e.onRestarted(()=>this.kernelsRestarting.delete(e),this))}onKernelStatusChanged(e,t){let r=this.kernelConnectionToKernelMapping.get(e);if(r&&!this.kernelsRestarting.has(r))switch(t){case"connected":{this.kernelReconnectProgress.get(r)?.dispose(),this.kernelReconnectProgress.delete(r);return}case"disconnected":{this.kernelReconnectProgress.has(r)&&(this.kernelReconnectProgress.get(r)?.dispose(),this.kernelReconnectProgress.delete(r),this.onKernelDisconnected(r)?.catch(h));return}case"connecting":this.kernelReconnectProgress.has(r)||this.onKernelConnecting(r)?.catch(h);return;default:return}}async onKernelConnecting(e){let t=this.getKernelSpecificDisposables(e),r=re(),i=new nu.Disposable(()=>r.resolve());if(this.kernelReconnectProgress.set(e,i),xt(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata))return;let o=y.automaticallyReconnectingToAKernelProgressMessage(ot(e.kernelConnectionMetadata));nu.window.withProgress({location:nu.ProgressLocation.Notification,title:o},async()=>r.promise).then(h,h),t.add(i)}async onKernelDisconnected(e){if(e.disposed||e.disposing||(It(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),xt(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata)))return;let t=dt(e.kernelConnectionMetadata)?y.kernelDisconnected(ot(e.kernelConnectionMetadata)):y.remoteJupyterConnectionFailedWithServer(e.kernelConnectionMetadata.baseUrl);nu.window.showErrorMessage(t).then(h,h);try{let r=this.lastExecutedCellPerKernel.get(e);if(!r||r.document.isClosed||r.notebook.isClosed||r.executionSummary?.success===!1)return;await Ac(r,e.controller,t,!1)}finally{await e.dispose()}}async handleRemoteServerShutdown(e,t){let r=this.jupyterUriProviderRegistration.jupyterCollections.find(o=>o.extensionId===t.serverProviderHandle.extensionId&&o.id===t.serverProviderHandle.id);if(!r)return!1;let i=new nu.CancellationTokenSource;try{return(await Promise.resolve(r.serverProvider.provideJupyterServers(i.token))||[]).map(a=>a.id).includes(t.serverProviderHandle.handle)?!1:(await this.serverUriStorage.remove(t.serverProviderHandle),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),!0)}catch{return!1}finally{i.dispose()}}};yy=v([(0,rf.injectable)(),m(0,(0,rf.inject)(M)),m(1,(0,rf.inject)(we)),m(2,(0,rf.inject)(Ht)),m(3,(0,rf.inject)(Vt))],yy);var SE=k(N());var by=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.kernelsStartedSuccessfully=new WeakSet;this.kernelRestartProgress=new WeakMap}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this))}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e)}onKernelStatusChanged({kernel:e}){if(!(!this.kernelsStartedSuccessfully.has(e)||!e.session||e.session.kind==="localRaw"))if(e.status==="autorestarting"){let t=lt.createProgressReporter(e.resourceUri,y.restartingKernelStatus(ot(e.kernelConnectionMetadata)));this.kernelRestartProgress.set(e,t)}else e.status!=="starting"&&e.status!=="busy"&&e.status!=="unknown"&&this.kernelRestartProgress.has(e)&&(this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e))}};by=v([(0,SE.injectable)(),m(0,(0,SE.inject)(M)),m(1,(0,SE.inject)(we))],by);var CE=k(N()),CO=require("vscode");var nf=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.lastExecutedCellPerKernel=new WeakMap;this.kernelsStartedSuccessfully=new WeakSet}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry)}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e),nr.onDidChangeNotebookCellExecutionState(t=>{t.cell.notebook===e.notebook&&this.kernelProvider.get(t.cell.notebook)===e&&this.lastExecutedCellPerKernel.set(e,t.cell)})}async onKernelStatusChanged({kernel:e}){this.kernelsStartedSuccessfully.has(e)&&(e.disposed||e.disposing||!e.session||(e.session.kind==="localRaw"&&e.status==="dead"&&(CO.window.showErrorMessage(y.kernelDiedWithoutError(ot(e.kernelConnectionMetadata))).then(h,h),await this.endCellAndDisplayErrorsInCell(e)),e.session.kind!=="localRaw"&&e.status==="autorestarting"&&(CO.window.showErrorMessage(y.kernelDiedWithoutErrorAndAutoRestarting(ot(e.kernelConnectionMetadata))).then(h,h),await this.endCellAndDisplayErrorsInCell(e))))}async endCellAndDisplayErrorsInCell(e){let t=this.lastExecutedCellPerKernel.get(e);if(It(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),!!t)return Ac(t,e.controller,y.kernelCrashedDueToCodeInCurrentOrPreviousCell,!1)}};v([qr()],nf.prototype,"onKernelStatusChanged",1),nf=v([(0,CE.injectable)(),m(0,(0,CE.inject)(M)),m(1,(0,CE.inject)(we))],nf);var iu=k(N()),ip=require("vscode");var np=class{constructor(e,t,r,i){this.installer=e;this.memento=t;this.rawSupport=r;this.serviceContainer=i;this.installPromises=new Map}async installMissingDependencies({resource:e,kernelConnection:t,ui:r,token:i,ignoreCache:o,cannotChangeKernels:s,installWithoutPrompting:a}){if(!dt(t)||!nt(t)||!t.interpreter)return 0;p.info(`Check & install missing Kernel dependencies for ${U(t.interpreter?.uri)}, ui.disabled=${r.disableUI} for resource '${U(e)}'`);let l=async()=>{if(await lt.wrapAndReportProgress(e,y.validatingKernelDependencies,()=>this.areDependenciesInstalled(t,i,o)))return 0;if(i?.isCancellationRequested)return 1};if(!a){let g=await l();if(g===0||g===1)return g}let c=un(t.interpreter.uri),u=this.installPromises.get(c),d;if(!u){let g=new ip.CancellationTokenSource,b=i.onCancellationRequested(()=>{g.cancel(),b.dispose()});u=lt.wrapAndReportProgress(e,y.installingMissingDependencies,async()=>{if(a){let I=await l();if(I===0||I===1)return I}return this.runInstaller(e,t.interpreter,r,g,s,a)}),u.finally(()=>{b.dispose(),g.dispose()}).catch(h),this.installPromises.set(c,u)}let f=2;try{f=await u,(d?.token?.isCancellationRequested||i.isCancellationRequested)&&(f=1)}catch(g){p.ci("Failed to install kernel dependency",g),f=2}finally{this.installPromises.delete(c)}return f}async areDependenciesInstalled(e,t,r){if(e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"||e.interpreter===void 0)return!0;if(!r&&this.rawSupport.isSupported&&await Y3(this.memento,19,e.interpreter))return p.info(`IPyKernel found previously in this environment ${U(e.interpreter.uri)}`),!0;let i=this.installer.isInstalled(19,e.interpreter).then(o=>o===!0);return i.then(o=>{o&&e.interpreter&&iD(this.memento,19,e.interpreter).catch(h)},h),tr(t,!1,i)}async runInstaller(e,t,r,i,o,s){if(p.ci(`Run Installer for ${U(e)} ui.disableUI=${r.disableUI}, cancelTokenSource.token.isCancellationRequested=${i.token.isCancellationRequested}`),r.disableUI)return 4;let a=Ve(t),[l,c]=await Promise.all([t6(this.memento,19,t),a==="Conda"?void 0:await this.installer.isInstalled(27,t)]);if(i.token.isCancellationRequested)return 1;let u=l?y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate:y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter,d=c===!1?[19,27]:[19],f=u(nn(t)||t.uri.fsPath,d.map($=>ur.get($)).join(` ${le.and} `)),g=d.map($=>ur.get($)).join(", "),b=e?$i(e):void 0,I=e?await ct(e.toString()):void 0;It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a});let w=le.install,D=y.selectKernel,A=le.moreInfo,T=[w];e&&!o&&T.push(D),T.push(A);try{(!Hp()||!s)&&It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"prompted",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a});let $;do $=Hp()||s?w:await tr(i.token,ip.window.showInformationMessage(f,{modal:!0},...T)),$===A&&(It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"moreInfo",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),ip.env.openExternal(ip.Uri.parse("https://aka.ms/AAhi594")));while($===A);if(i.token.isCancellationRequested)return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),1;if($===D)return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"differentKernel",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),3;if($===w){It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"install",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a});let ne=await tr(i.token,3,this.installer.install(19,t,i,l===!0,c===!1));if(ne===0)return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"installed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),0;if(ne===2)return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"failed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),2}return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),1}catch($){throw p.error(`Failed to install ${g}`,$),It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"error",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),$}}};v([ti("Install Missing Dependencies")],np.prototype,"installMissingDependencies",1),v([ti("Are Dependencies Installed"),m(0,Dc("id"))],np.prototype,"areDependenciesInstalled",1),np=v([(0,iu.injectable)(),m(0,(0,iu.inject)(Ai)),m(1,(0,iu.inject)(Le)),m(1,(0,iu.named)(ut)),m(2,(0,iu.inject)(ai)),m(3,(0,iu.inject)(st))],np);var v_=k(N()),Sy=require("vscode");var Iy=class extends $t{constructor(t){super();this._onDidChangeRegistrations=this._register(new Sy.EventEmitter);this.onDidChangeRegistrations=this._onDidChangeRegistrations.event;this._finders=[];this.connectionFinderMapping=new Map;this._onDidChangeKernels=this._register(new Sy.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._status="idle";this._onDidChangeStatus=this._register(new Sy.EventEmitter);t.push(this),this._register(this._onDidChangeStatus),this._register(this._onDidChangeRegistrations)}get status(){return this._status}set status(t){this._status!=t&&(this._status=t,this._onDidChangeStatus.fire())}get onDidChangeStatus(){return this._onDidChangeStatus.event}registerKernelFinder(t){this._finders.push(t);let r=()=>{this.status=this._finders.every(s=>s.status==="idle")?"idle":"discovering"};r();let i=this._register(new xr),o=()=>{let s=this._finders.findIndex(a=>a===t);s>=0&&this._finders.splice(s,1),i.dispose(),r(),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[],removed:[t]})};return i.add(t.onDidChangeStatus(r,this)),i.add(t.onDidChangeKernels(()=>this._onDidChangeKernels.fire())),i.add(t.onDidDispose(()=>o())),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[t],removed:[]}),new Sy.Disposable(()=>o())}get kernels(){let t=[];this.connectionFinderMapping.clear();let r=new Set;this._finders.filter(o=>o.kind==="localPythonEnvironment").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&r.add(s.kernelSpec.specFile),t.push(s),this.connectionFinderMapping.set(s.id,o)})}),this._finders.filter(o=>o.kind==="localKernelSpec").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&r.has(s.kernelSpec.specFile)||(t.push(s),this.connectionFinderMapping.set(s.id,o))})});let i=this._finders.filter(o=>o.kind==="remote");for(let o of i){let s=o.kernels;s.forEach(a=>{this.connectionFinderMapping.set(a.id,o)}),t.push(...s)}return t}getFinderForConnection(t){return this.connectionFinderMapping.get(t.id)}get registered(){return this._finders}};Iy=v([(0,v_.injectable)(),m(0,(0,v_.inject)(M))],Iy);var Yr=k(N());var ui=require("vscode");var y_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.executions=new WeakMap;this.kernelsByNotebook=new WeakMap;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new ui.EventEmitter;this._onDidStartKernel=new ui.EventEmitter;this._onDidCreateKernel=new ui.EventEmitter;this._onDidDisposeKernel=new ui.EventEmitter;this._onKernelStatusChanged=new ui.EventEmitter;this._onDidPostInitializeKernel=new um;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),ui.workspace.onDidCloseNotebookDocument(r=>this.disposeOldKernel(r,"notebookClosed"),this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel),t.push(this._onDidPostInitializeKernel)}get kernels(){let e=new Set;return ui.workspace.notebookDocuments.forEach(t=>{let r=this.get(t);r&&e.add(r)}),Array.from(e)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get onDidPostInitializeKernel(){return this._onDidPostInitializeKernel.event}get(e){if(Wn(e)){let t=ui.workspace.notebookDocuments.find(r=>r.uri.toString()===e.toString());return t?this.get(t):void 0}else return typeof e=="string"?this.kernelsById.get(e)?.kernel:this.kernelsByNotebook.get(e)?.kernel}getKernelExecution(e){return this.executions.get(e)}getInternal(e){return this.kernelsByNotebook.get(e)}async dispose(){p.ci("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,r){this.kernelsByNotebook.set(e,{options:t,kernel:r}),this.kernelsById.set(r.id,{options:t,kernel:r}),this._onDidCreateKernel.fire(r)}deleteMappingIfKernelIsDisposed(e){e.onDisposed(()=>{this.get(e.notebook)===e&&(this.kernelsByNotebook.delete(e.notebook),this.kernelsById.delete(e.id),p.debug(`Kernel got disposed, hence there is no longer a kernel associated with ${U(e.uri)}`)),this.pendingDisposables.delete(e)},this,this.disposables)}disposeOldKernel(e,t){let r=this.kernelsByNotebook.get(e);r&&(p.debug(`Disposing kernel associated with ${U(e.uri)}, isClosed=${e.isClosed}, reason = ${t}`),this.kernelsById.delete(r.kernel.id),this.pendingDisposables.add(r.kernel),r.kernel.dispose().catch(i=>p.warn("Failed to dispose old kernel",i)).finally(()=>this.pendingDisposables.delete(r.kernel)).catch(h)),this.kernelsByNotebook.delete(e)}handleServerRemoval(e){ui.workspace.notebookDocuments.forEach(t=>{let r=this.kernelsByNotebook.get(t);if(r){let i=r.options.metadata;(i.kind==="connectToLiveRemoteKernel"||i.kind==="startUsingRemoteKernelSpec")&&e.find(s=>s.id===i.serverProviderHandle.id&&s.handle===i.serverProviderHandle.handle)&&(this.kernelsByNotebook.delete(t),this.kernelsById.delete(r.kernel.id))}})}},b_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.kernelsByUri=new Map;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new ui.EventEmitter;this._onDidStartKernel=new ui.EventEmitter;this._onDidCreateKernel=new ui.EventEmitter;this._onDidDisposeKernel=new ui.EventEmitter;this._onDidPostInitializeKernel=new um;this._onKernelStatusChanged=new ui.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),ui.workspace.onDidCloseNotebookDocument(r=>{p.debug(`Notebook document ${U(r.uri)} got closed`),this.disposeOldKernel(r.uri)},this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel),t.push(this._onDidPostInitializeKernel)}get kernels(){return Array.from(this.kernelsByUri.values()).map(e=>e.kernel)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get onDidPostInitializeKernel(){return this._onDidPostInitializeKernel.event}get(e){return this.kernelsByUri.get(e.toString())?.kernel||this.kernelsById.get(e.toString())?.kernel}getInternal(e){return this.kernelsByUri.get(e.toString())}async dispose(){p.ci("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,r){this.kernelsByUri.set(e.toString(),{options:t,kernel:r}),this.kernelsById.set(r.id,{options:t,kernel:r}),this._onDidCreateKernel.fire(r)}deleteMappingIfKernelIsDisposed(e,t){t.onDisposed(()=>{this.get(e)===t&&(this.kernelsByUri.delete(e.toString()),this.kernelsById.delete(t.id),p.debug(`Kernel got disposed, hence there is no longer a kernel associated with ${U(e)}`)),this.pendingDisposables.delete(t)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByUri.get(e.toString());t&&(p.ci(`Disposing kernel associated with ${U(e)}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(r=>p.warn("Failed to dispose old kernel",r)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(h)),this.kernelsByUri.delete(e.toString())}};var wO=k(So()),Tr=require("vscode");var Y8=k(jx());var EO="KERNEL_INFO",Xue=1e3*60*60*24*2;async function Q8(n,e,t){let r=[],i={banner:"",help_links:[],implementation:"",implementation_version:"",language_info:{name:"",version:""},protocol_version:"",status:"ok"};if(!n.kernel)return;n.kernel?.info&&(r.push(n.kernel.info),n.kernel.info.then(a=>z8(t,e,a)).catch(h));let o=n.kernel.requestKernelInfo().then(a=>a?.content);if(r.push(o),o.then(a=>z8(t,e,a)).catch(h),e.kind==="connectToLiveRemoteKernel"){let a=Zue(t,e);a?r.push(Promise.resolve(a)):r.push(vi(5e3).then(()=>i))}let s=await Promise.race(r);return s===i?p.warn("Failed to Kernel info in a timely manner, defaulting to empty info!"):p.trace("Got Kernel info"),s}async function z8(n,e,t){if(!t||!xt(e))return;let r=n.get(EO,[]).filter(i=>Date.now()-i.age<Xue).filter(i=>i.id!==e.id);r.push({id:e.id,age:Date.now(),info:t}),await n.update(EO,r)}function Zue(n,e){if(xt(e))return n.get(EO,[]).find(t=>t.id===e.id)?.info}var I_=class extends kn{constructor(e){super("kernelpromisetimeout",y.interruptingKernelFailed,e)}};var S_="e976ee50-99ed-4aba-9b6b-9dcd5634d07d:IPyWidgets:";function EE(n){let e=typeof n=="string"?n:"";return typeof n!="string"&&"content"in n&&"code"in n.content&&typeof n.content.code=="string"&&(e=n.content.code),!e.includes(S_)}function P_(n){return n.status==="dead"||n.status==="terminating"&&!n.disposed&&!n.disposing||!n.disposed&&!n.disposing&&(n.session?.status=="unknown"||n.session?.kernel?.status=="unknown")&&(n.session.kernel?.isDisposed||n.session.isDisposed)}function X8(n){return n.status==="dead"||n.status==="terminating"&&!n.isDisposed||!n.isDisposed&&(n.status=="unknown"||n.kernel?.status=="unknown")&&(n.kernel?.isDisposed||n.isDisposed)}var C_=class{constructor(e,t,r,i,o,s,a,l,c){this.id=e;this.uri=t;this.resourceUri=r;this.kernelConnectionMetadata=i;this.sessionCreator=o;this.kernelSettings=s;this.startupCodeProviders=a;this._creator=l;this.workspaceMemento=c;this.disposables=[];this._onIPyWidgetVersionResolved=new Tr.EventEmitter;this._onDidKernelSocketChange=new Tr.EventEmitter;this._onStatusChanged=new Tr.EventEmitter;this._onRestarted=new Tr.EventEmitter;this._onStarted=new Tr.EventEmitter;this._onPostInitialized=new um;this._onDisposed=new Tr.EventEmitter;this.hookedSessionForEvents=new WeakSet;this.hooks=new Map;this.startCancellation=new Tr.CancellationTokenSource;this.startupUI=new Ft(!0);this.disposables.push(this._onStatusChanged),this.disposables.push(this._onRestarted),this.disposables.push(this._onStarted),this.disposables.push(this._onDisposed),this.disposables.push(this._onIPyWidgetVersionResolved),this.disposables.push(this._onDidKernelSocketChange),qi(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,disableUI:this.startupUI.disableUI}).catch(h),this.startupUI.onDidChangeDisableUI(()=>{this.startupUI.disableUI||qi(this.resourceUri,{disableUI:!1}).catch(h)},this.disposables)}get ipywidgetsVersion(){return this._ipywidgetsVersion}get onIPyWidgetVersionResolved(){return this._onIPyWidgetVersionResolved.event}get onStatusChanged(){return this._onStatusChanged.event}get onRestarted(){return this._onRestarted.event}get onStarted(){return this._onStarted.event}get onPostInitialized(){return this._onPostInitialized.event}get onDisposed(){return this._onDisposed.event}get creator(){return this._creator}get startedAtLeastOnce(){return this._startedAtLeastOnce}get userStartedKernel(){return!this.startupUI.disableUI}get info(){return this._info}get status(){return this._jupyterSessionPromise&&!this._session?"starting":this._session?.status??(this.isKernelDead?"dead":"unknown")}get disposed(){return this._disposed===!0||this._session?.isDisposed===!0}get disposing(){return this._disposing===!0}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}get session(){return this._session}get isPostInitializedInProgress(){return this._isPostInitializedInProgress===!0}get restarting(){return this._restartPromise||Promise.resolve()}addHook(e,t,r,i){let o=this.hooks.get(e)||new Set;this.hooks.set(e,o),t=r?t.bind(r):t,o.add(t);let s={dispose:()=>{o.delete(t)}};return i&&i.push(s),s}async start(e){this.startCancellation.token.isCancellationRequested&&(this.startCancellation.dispose(),this.startCancellation=new Tr.CancellationTokenSource);let t=await this.startJupyterSession(e);return e?.ignoreTriggeringOnPostInitialized||await this.triggerOnDidStartKernel(e?.disableUI===!0,!1),t}async interrupt(){let e=Promise.all(Array.from(this.hooks.get("willInterrupt")||new Set).map(r=>r()));p.info(`Interrupt requested ${U(this.resourceUri||this.uri)}`);let t;try{let r=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;p.info("Interrupt kernel execution"),r?(t=this._interruptPromise?await this._interruptPromise:await(this._interruptPromise=this.interruptExecution(r,e)),this._interruptPromise=void 0):(p.info("No kernel session to interrupt"),this._interruptPromise=void 0,t="success")}finally{await Promise.all(Array.from(this.hooks.get("interruptCompleted")||new Set).map(r=>r())).catch(h)}if(p.info(`Interrupt requested & sent for ${U(this.uri)} in notebookEditor.`),t==="timeout"){let r=y.restartKernelAfterInterruptMessage(ot(this.kernelConnectionMetadata)),i=y.restartKernelMessageYes;await Tr.window.showInformationMessage(r,{modal:!0},i)===i&&await this.restart()}}async dispose(){if(p.info(`Dispose Kernel '${U(this.uri)}' associated with '${U(this.resourceUri)}'`),this._disposing=!0,this.disposingPromise)return this.disposingPromise;this._ignoreJupyterSessionDisposedErrors=!0,this.startCancellation.cancel();let e=async()=>{let t=[];t.push(Promise.all(Array.from(this.hooks.get("willCancel")||new Set).map(r=>r())).then(h).catch(h)),this._session=this._session?this._session:this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0,this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,this._session&&(t.push(Is(this._session,this.disposables)),this._session=void 0),this._disposed=!0,this._onDisposed.fire(),this._onStatusChanged.fire("dead");try{await Promise.all(t)}finally{this.startCancellation.dispose(),z(this.disposables)}};this.disposingPromise=e(),await this.disposingPromise}async restart(){try{let e=$i(this.resourceUri);p.info(`Restart requested ${U(this.uri)}`),await Promise.all(Array.from(this.hooks.get("willRestart")||new Set).map(r=>r(this._jupyterSessionPromise))),this.startCancellation.cancel(),this.startCancellation.dispose();let t=new Fe;try{let r=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;r?(this._restartPromise||(this._restartPromise=r.restart(),this._restartPromise.finally(()=>this._restartPromise=void 0).catch(h)),await this._restartPromise,this.startCancellation=new Tr.CancellationTokenSource):await this.start(new Ft(!1)),It(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},{resourceType:e})}catch(r){p.error(`Restart failed ${U(this.uri)}`,r),this._ignoreJupyterSessionDisposedErrors=!0;let i=this._session;throw this._session=void 0,this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,It(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},void 0,r),i&&await Is(i,this.disposables),this._ignoreJupyterSessionDisposedErrors=!1,r}await this.initializeAfterStart(this._session),this._onRestarted.fire(),await this.triggerOnDidStartKernel(!1,!0)}catch(e){throw p.error(`Failed to restart kernel ${U(this.uri)}`,e),e}finally{Promise.all(Array.from(this.hooks.get("restartCompleted")||new Set).map(e=>e())).catch(h)}}async startJupyterSession(e=new Ft(!1)){if(this._startedAtLeastOnce=!0,e.disableUI||(this.startupUI.disableUI=!1),e.onDidChangeDisableUI(()=>{!e.disableUI&&this.startupUI.disableUI&&(this.startupUI.disableUI=!1)},this.disposables),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||ua(this.resourceUri,this.kernelConnectionMetadata).catch(h)},this,this.disposables),this.disposing)throw new Tr.CancellationError;if(vn.throwIfCanceled(this.startCancellation.token),!this._jupyterSessionPromise){let t=new Fe;this._jupyterSessionPromise=this.createJupyterSession();try{let r=await this._jupyterSessionPromise;return It(this.resourceUri,"DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",{duration:t.elapsedTime}),r}catch(r){throw p.ci(`Failed to create Jupyter Session in Kernel.startNotebook for ${U(this.uri)}`),this.startCancellation.cancel(),this._jupyterSessionPromise=void 0,r}}return this._jupyterSessionPromise}async triggerOnDidStartKernel(e,t=!1){e||((!this._postInitializedOnStartPromise||t)&&(this._isPostInitializedInProgress=!0,this._postInitializedOnStartPromise=this._onPostInitialized.fireAsync({},this.startCancellation.token),this._postInitializedOnStartPromise.finally(()=>this._isPostInitializedInProgress=!1)),await this._postInitializedOnStartPromise)}async interruptExecution(e,t){let r=re(),i=new Fe,o=[],s=c=>{(c==="restarting"||c==="autorestarting")&&(p.warn("Kernel restarting during interrupt"),r.resolve(!0))},a=(c,u)=>s(u);return e.statusChanged.connect(a),o.push(new Tr.Disposable(()=>ei(()=>e.statusChanged.disconnect(a)))),e&&e.kernel&&(p.info(`Interrupting kernel: ${e.kernel.name}`),await hh(this.kernelSettings.interruptTimeout,new I_(this.kernelConnectionMetadata),e.kernel.interrupt()).catch(c=>{p.warn(`Error during interrupt: ${c}`),r.resolve(!0)})),(async()=>{let c=re();this.status==="busy"&&(this.onDisposed(()=>c.resolve("dead"),this,o),this.onStatusChanged(()=>this.status==="dead"?c.resolve("dead"):void 0,this,o));try{return await br(this.kernelSettings.interruptTimeout,"timeout",t.then(()=>"success"),r.promise.then(()=>"restart"),c.promise)}catch(u){if(r.completed)return"restart";throw It(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},void 0,u),u}finally{z(o)}})().then(c=>(It(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},{result:c}),c))}async createJupyterSession(){let e=Tr.workspace.notebookDocuments.find(i=>i.uri.toString()===this.uri.toString()),t=e?Pn(e)?.jupyterSessionTelemetry():void 0;if(await qi(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,userExecutedCell:!this.startupUI.disableUI}),t?.stop(),this.disposing)throw new Tr.CancellationError;vn.throwIfCanceled(this.startCancellation.token);let r=[];try{p.info(`Starting Kernel ${tde(this,this.startupUI)}`),this.createProgressIndicator(r),this.isKernelDead=!1,this._onStatusChanged.fire("starting");let i=await this.sessionCreator.create({resource:this.resourceUri,ui:this.startupUI,kernelConnection:this.kernelConnectionMetadata,token:this.startCancellation.token,creator:this.creator});if(this.disposing)throw new Tr.CancellationError;if(vn.throwIfCanceled(this.startCancellation.token),await this.initializeAfterStart(i),this.disposing)throw new Tr.CancellationError;return this.sendKernelStartedTelemetry(),this._session=i,this._onStarted.fire(),p.info("Kernel successfully started"),i}catch(i){if(this.startupUI.disableUI?p.trace(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,i):!this.startCancellation.token&&!er(i)&&p.error(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,i),vn.throwIfCanceled(this.startCancellation.token),i instanceof gs)throw i;let o=y.sessionStartFailedWithKernel(ot(this.kernelConnectionMetadata));throw Gr.from(o+" "+("message"in i?i.message:i.toString()),i)}finally{z(r)}}sendKernelStartedTelemetry(){this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent&&this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent===this.startupUI.disableUI||this.startTelemetrySent&&!this.startupUI.disableUI||(this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent=this.startupUI.disableUI===!0,this.startTelemetrySent=!0,It(this.resourceUri,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:this.startupUI.disableUI}))}createProgressIndicator(e){let t=lt.createProgressReporter(this.resourceUri,y.connectingToKernel(ot(this.kernelConnectionMetadata)),this.startupUI.disableUI);e.push(t),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||t.show&&t.show()},this,e)}async initializeAfterStart(e){let t=Tr.workspace.notebookDocuments.find(o=>o.uri.toString()===this.uri.toString()),r=Pn(t),i=t?r?.postKernelStartup():void 0;try{if(await Promise.all(Array.from(this.hooks.get("didStart")||new Set).map(a=>a(e,this.startCancellation.token).catch(h))),p.trace(`Started running kernel initialization for ${U(this.uri)}`),!e){p.trace("Not running kernel initialization");return}if(!this.hookedSessionForEvents.has(e)){this.hookedSessionForEvents.add(e),e.onDidKernelSocketChange(l=>this._onDidKernelSocketChange.fire(l)),e.onDidDispose(()=>{if(p.ci(`Kernel got disposed as a result of session.onDisposed (1) ${U(this.resourceUri||this.uri)}`),!this._ignoreJupyterSessionDisposedErrors){p.info(`Kernel got disposed as a result of session.onDisposed ${U(this.resourceUri||this.uri)} & _ignoreJupyterSessionDisposedErrors = false.`);let l=this._session===e;this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,this._session=void 0,l&&(this.isKernelDead=!0,this._onStatusChanged.fire("dead"))}});let a=(l,c)=>this._onStatusChanged.fire(c);e.statusChanged.connect(a),this.disposables.push(new Tr.Disposable(()=>ei(()=>e.statusChanged.disconnect(a))))}if(e.kernel?.registerCommTarget(Je.DefaultCommTarget,h),this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel")this.determineVersionOfIPyWidgets(e).catch(a=>p.error("Failed to determine IPyWidget version",a)),this.gatherInternalStartupCode().then(a=>this.executeSilently(e,a,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"})).catch(a=>p.error("Failed to execute internal startup code",a));else{await this.determineVersionOfIPyWidgets(e);let a=await this.gatherInternalStartupCode();await this.executeSilently(e,a,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"}),await this.executeSilently(e,this.getUserStartupCommands(),{traceErrors:!1})}i?.stop();let o=r?.kernelInfo();try{p.debug("Requesting Kernel info"),this._info=await Q8(e,this.kernelConnectionMetadata,this.workspaceMemento)}catch(a){p.warn("Failed to request KernelInfo",a)}o?.stop();let s=r?.kernelIdle();this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&(p.trace("End running kernel initialization, now waiting for idle"),await e.waitForIdle(this.kernelSettings.launchTimeout,this.startCancellation.token),p.trace("End running kernel initialization, session is idle")),s?.stop()}finally{i?.stop()}}async determineVersionOfIPyWidgets(e){if(!nt(this.kernelConnectionMetadata)){this._ipywidgetsVersion==AS,this._onIPyWidgetVersionResolved.fire(AS);return}let t=async()=>{let r=Y8.default`
        try:
            import ipywidgets as _VSCODE_ipywidgets
            print("${S_}" + _VSCODE_ipywidgets.__version__)
            del _VSCODE_ipywidgets
        except:
            pass
        `,i=await this.executeSilently(e,[r]).catch(o=>p.error("Failed to determine version of IPyWidgets",o));if(Array.isArray(i)){let o=i.some(l=>(l.text||"")?.toString().includes(`${S_}8.`)),s=i.some(l=>(l.text||"")?.toString().includes(`${S_}7.`)),a=this._ipywidgetsVersion=s?7:o?8:void 0;p.trace(`Determined IPyWidgets Version as ${a}`),this._ipywidgetsVersion==a,this._onIPyWidgetVersionResolved.fire(a)}else p.warn("Failed to determine IPyKernel Version",JSON.stringify(i))};if(await t(),!this._ipywidgetsVersion&&this.session?.kernel){let r=(i,o)=>{if(o.direction==="send")return;let s=o.msg;s.content&&"data"in s.content&&s.content.data&&(s.content.data[Li]||"target_name"in s.content&&s.content.target_name===Je.DefaultCommTarget)&&(this._ipywidgetsVersion||(t().catch(h),this.session?.kernel&&this.session.kernel.anyMessage.disconnect(r,this)))};this.session.kernel.anyMessage.connect(r,this)}}async gatherInternalStartupCode(){let e=[],t=await Promise.all(this.startupCodeProviders.sort((r,i)=>i.priority-r.priority).map(r=>r.getCode(this)));for(let r of t)e.push(...r);if(nt(this.kernelConnectionMetadata)&&this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"){let r=Re(this.resourceUri);r&&e.push(`__vsc_ipynb_file__ = "${r.replace(/\\/g,"\\\\")}"`),this.kernelSettings.enableExtendedPythonKernelCompletions||e.push(dh.DisableJedi),e.push(...ede(this.getMatplotLibInitializeCode(),"Failed to initialize matplotlib startup code. Matplotlib might be missing."))}return e}getMatplotLibInitializeCode(){let e=[];if(this.kernelSettings.themeMatplotlibPlots){p.ci(`Initialize config for plots for ${U(this.resourceUri||this.uri)}`);let t=dh.MatplotLibInit;p.trace(`Initialize matplotlib for ${U(this.resourceUri||this.uri)}`),e.push(...Ue(t,{trim:!1}));let r=Tr.window.activeColorTheme.kind===Tr.ColorThemeKind.Dark;e.push(r?"matplotlib.style.use('dark_background')":`matplotlib.rcParams.update(${Je.MatplotLibDefaultParams})`)}return e}getUserStartupCommands(){let e=this.kernelSettings.runStartupCommands;if(Array.isArray(e)&&(e=e.join(`
`)),e){let t=e.replace(/\\n/g,`
`);return Ue(t,{trim:!1})}return[]}async executeSilently(e,t,r){if(t.join("").trim().length!==0){if(!e.kernel){p.trace(`Not executing startup as there is no session, code: ${t}`);return}return mn(e.kernel,t.join(`
`),r)}}},E_=class extends C_{get creator(){return"3rdPartyExtension"}constructor(e,t,r,i,o,s,a){super(`3rdPartyKernel_${(0,wO.default)()}`,e,t,r,i,o,s,"3rdPartyExtension",a)}},w_=class extends C_{constructor(t,r,i,o,s,a,l,c){super((0,wO.default)(),r.uri,t,i,o,s,l,"jupyterExtension",c);this.notebook=r;this.controller=a}get creator(){return"jupyterExtension"}};function ede(n,e){return!n||n.length===0||(n=n.map(t=>`    ${t}`),n.unshift("try:"),n.push("except:",`    print('${e}')`)),n}function k_(n){if(n.length>0){let e=n[0].data;if(e&&e.hasOwnProperty("text/plain"))return bs(e["text/plain"]);if(n[0].output_type==="stream"){let t=n[0];return bs(t.text)}}}function tde(n,e){let t=n.kernelConnectionMetadata.interpreter,r=[];if(t){r.push(`Python Path: ${U(t.uri)}`),r.push(t?Ve(t):"");let i=Ji(t);i&&r.push(`${i.major}.${i.minor}.${i.micro}`)}else(n.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||n.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec")&&r.push(n.kernelConnectionMetadata.kernelSpec.display_name);return`(${r.filter(i=>i).join(", ")}) for '${U(n.uri)}' (disableUI=${e.disableUI})`}function PO(n,e){return{get enableExtendedPythonKernelCompletions(){return n.getSettings(e).enableExtendedPythonKernelCompletions},get interruptTimeout(){return n.getSettings(e).jupyterInterruptTimeout},get launchTimeout(){return n.getSettings(e).jupyterLaunchTimeout},get runStartupCommands(){return n.getSettings(e).runStartupCommands},get themeMatplotlibPlots(){return n.getSettings(e).themeMatplotlibPlots}}}var of=require("vscode");var xO=require("vscode");var kO=k(SN()),fr=require("vscode");var x_=k(lm());var Cy=new WeakMap;function ou(n){if(n.parent_header&&"msg_id"in n.parent_header)return n.parent_header.msg_id}var op=class op{constructor(e,t,r,i,o,s,a,l){this.cell=e;this.controller=t;this.context=r;this.formatters=i;this.kernel=o;this.request=s;this._onErrorHandlingIOPubMessage=new fr.EventEmitter;this.onErrorHandlingExecuteRequestIOPubMessage=this._onErrorHandlingIOPubMessage.event;this.outputsAreSpecificToAWidget=[];this.commIdsMappedToParentWidgetModel=new Map;this.disposables=[];this.prompts=new Set;this.ownedCommIds=new Set;this.commIdsMappedToWidgetOutputModels=new Set;this.ownedRequestMsgIds=new Set;this._completed=re();this.gotIdleIOPubStatus=!1;this.gotShellReply=!1;this.streamsReAttachedToExecutingCell=!1;this._completed.promise.catch(h),this.executeRequestMessageId=l,this.ownedRequestMsgIds.add(l),fr.workspace.onDidChangeNotebookDocument(c=>{if(!Pt(c.notebook))return;let u=c.cellChanges.find(({cell:d})=>d===this.cell);u&&u.outputs?.length===0&&(this.clearLastUsedStreamOutput(),this.cellHasErrorsInOutput=!1)},this,this.disposables),this.execution=a,this.kernel.anyMessage.connect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.connect(this.onKernelIOPubMessage,this),s&&(s.onIOPub=()=>{this.cell.document.isClosed&&!this.completedExecution&&s.dispose()},s.onReply=c=>{if(this.cell.document.isClosed){s.dispose();return}this.handleReply(c)},s.onStdin=this.handleInputRequest.bind(this),s.done.finally(()=>{this.completedExecution=!0,this.endCellExecution()}).catch(h))}static{this.modelIdsOwnedByCells=new WeakMap}get hasErrorOutput(){return this.cellHasErrorsInOutput===!0}static{this.outputsOwnedByWidgetModel=new Map}get completed(){return this._completed.promise}dispose(){this.disposed||(this.disposed=!0,at(this.cell,"Execution Message Handler disposed"),z(this.disposables),this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this.kernel.anyMessage.disconnect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.disconnect(this.onKernelIOPubMessage,this),this._onErrorHandlingIOPubMessage.dispose())}endCellExecution(){this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this._completed.resolve()}onKernelAnyMessage(e,{direction:t,msg:r}){if(this.cell.document.isClosed)return this.endCellExecution();let i=require("@jupyterlab/services");if(!this.request&&t==="recv"){let o=ou(r);i.KernelMessage.isStatusMsg(r)&&r.content.execution_state==="idle"&&o===this.executeRequestMessageId&&(this.gotIdleIOPubStatus=!0),r.channel==="shell"&&o===this.executeRequestMessageId&&(this.gotShellReply=!0);let s=i.KernelMessage.isStatusMsg(r)&&r.content.execution_state!=="idle"&&o!==this.executeRequestMessageId;typeof r.parent_header=="object"&&r.parent_header&&"msg_type"in r.parent_header&&r.parent_header.msg_type;let a=o?o!==this.executeRequestMessageId&&!s:!1,l=typeof r.parent_header=="object"&&r.parent_header&&"msg_type"in r.parent_header&&r.parent_header.msg_type==="interrupt_request",c=this.gotIdleIOPubStatus&&this.gotShellReply,u=["kernel_info_reply","execute_input","execute_reply"],d="msg_type"in r&&typeof r.msg_type=="string"&&u.includes(r.msg_type);if(!this.completedExecution&&c)return this.completedExecution=!0,this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endCellExecution();if(!this.completedExecution&&(d||a)){this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=setTimeout(()=>(this.completedExecution=!0,this.endAbnormallyTimeout=void 0,this.endCellExecution()),l?1e3:100),this.disposables.push(new fr.Disposable(()=>{clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=void 0}));return}}t!=="send"||!this.completedExecution||i.KernelMessage.isCommMsgMsg(r)&&this.ownedCommIds.has(r.content.comm_id)&&this.ownedRequestMsgIds.add(r.header.msg_id)}onKernelIOPubMessage(e,t){if(this.cell.document.isClosed)return this.endCellExecution();if(!(!t.parent_header||!("msg_id"in t.parent_header)||!this.ownedRequestMsgIds.has(t.parent_header.msg_id)||t.channel!=="iopub"))try{this.handleIOPub(t)}catch(r){p.error("Failed to handle iopub message as a result of some comm message",t,r),!this.completedExecution&&!this.cell.document.isClosed&&this._onErrorHandlingIOPubMessage.fire(r)}}clearLastUsedStreamOutput(){this.lastUsedStreamOutput=void 0}createTemporaryTask(e){if(this.cell.document.isClosed)return;let t=Cy.get(this.cell.notebook);return t&&(!e||e&&t.cell.index===this.cell.index)?t:(this.previousResultsToRestore={...this.cell.executionSummary||{}},this.temporaryExecution=ki.getOrCreate(this.cell,this.controller),this.temporaryExecution?.start(),this.previousResultsToRestore?.executionOrder&&this.temporaryExecution&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution)}endTemporaryTask(){this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.previousResultsToRestore&&this.temporaryExecution?(this.previousResultsToRestore.executionOrder&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution.end(this.previousResultsToRestore.success,this.previousResultsToRestore.timing?.endTime)):this.temporaryExecution?.end(void 0),this.previousResultsToRestore=void 0,this.temporaryExecution=void 0}handleIOPub(e){this.startTime||(this.startTime=new Date().getTime(),this.execution?.start(this.startTime),p.debug(`Kernel acknowledged execution of cell ${this.cell.index} @ ${this.startTime}`));let t=require("@jupyterlab/services");if(t.KernelMessage.isCommOpenMsg(e))this.handleCommOpen(e);else if(t.KernelMessage.isExecuteResultMsg(e))this.handleExecuteResult(e);else if(t.KernelMessage.isExecuteInputMsg(e))this.handleExecuteInput(e);else if(t.KernelMessage.isStatusMsg(e)){let r=e;this.handleStatusMessage(r)}else t.KernelMessage.isStreamMsg(e)?this.handleStreamMessage(e):t.KernelMessage.isDisplayDataMsg(e)?this.handleDisplayData(e):t.KernelMessage.isUpdateDisplayDataMsg(e)?this.handleUpdateDisplayDataMessage(e):t.KernelMessage.isClearOutputMsg(e)?this.handleClearOutput(e):t.KernelMessage.isErrorMsg(e)?this.handleError(e):t.KernelMessage.isCommOpenMsg(e)||(t.KernelMessage.isCommMsgMsg(e)?this.handleCommMsg(e):t.KernelMessage.isCommCloseMsg(e)||p.warn(`Unknown message ${e.header.msg_type} : hasData=${"data"in e.content}`));"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleCommOpen(e){this.ownedCommIds.add(e.content.comm_id);let t=e.content.data?.state||void 0;e.content.target_name===Je.DefaultCommTarget&&t&&t._model_module==="@jupyter-widgets/output"&&this.commIdsMappedToWidgetOutputModels.add(e.content.comm_id)}handleCommMsg(e){let t=e.content.data;if(!(!t||t.method!=="update"||typeof t.state!="object")){if("msg_id"in t.state&&typeof t.state.msg_id=="string"){let r="msg_id"in e.parent_header?e.parent_header:void 0;(this.ownedRequestMsgIds.has(e.content.comm_id)||r&&this.ownedRequestMsgIds.has(r.msg_id))&&(t.state.msg_id?this.outputsAreSpecificToAWidget.push({handlingCommId:e.content.comm_id,msgIdsToSwallow:t.state.msg_id}):this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId===e.content.comm_id&&this.outputsAreSpecificToAWidget.pop())}else if("children"in t.state&&Array.isArray(t.state.children)&&this.ownedCommIds.has(e.content.comm_id)){let r="IPY_MODEL_";t.state.children.forEach(i=>{if(typeof i!="string")return p.warn("Came across a comm update message a child that isn't a string",i);if(!i.startsWith(r))return p.warn(`Came across a comm update message a child that start start with ${r}`,i);let o=i.substring(r.length);this.ownedCommIds.add(o),this.commIdsMappedToParentWidgetModel.set(o,e.content.comm_id)})}}}clearOutputIfNecessary(e){return this.clearOutputOnNextUpdateToOutput?(at(this.cell,"Clear cell output"),this.clearLastUsedStreamOutput(),e?.clearOutput().then(h,h),this.clearOutputOnNextUpdateToOutput=!1,{previousValueOfClearOutputOnNextUpdateToOutput:!0}):{previousValueOfClearOutputOnNextUpdateToOutput:!1}}addToCellData(e,t){if(e.data&&typeof e.data=="object"&&Li in e.data){let l=e.data[Li];if(l&&this.context.extensionMode===fr.ExtensionMode.Test&&(l._vsc_test_cellIndex=this.cell.index),l&&"model_id"in l){let c=op.modelIdsOwnedByCells.get(this.cell)||new Set;c.add(l.model_id),op.modelIdsOwnedByCells.set(this.cell,c)}}let r=co(e),i="transient"in e&&typeof e.transient=="object"&&e.transient&&"display_id"in e.transient&&typeof e.transient?.display_id=="string"?e.transient?.display_id:void 0;if(this.cell.document.isClosed)return;at(this.cell,()=>`Update output with mimes ${r.items.map(l=>l.mime).toString()}`);let o=this.getOrCreateExecutionTask(!0);this.clearOutputIfNecessary(o),i&&Qr.trackOutputByDisplayId(this.cell,i,r,r.items),this.clearLastUsedStreamOutput(),at(this.cell,"Append output in addToCellData");let s=!0,a=ou(t);(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&r.items.every(l=>this.canMimeTypeBeRenderedByWidgetManager(l))||this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&this.updateJupyterOutputWidgetWithOutput({commId:this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId,outputToAppend:r},o)?.outputAdded)&&(s=!1),s&&o?.appendOutput([r]).then(h,h),this.endTemporaryTask()}canMimeTypeBeRenderedByWidgetManager(e){let t=e.mime;if(t=="application/vnd.code.notebook.stderr"||t=="application/vnd.code.notebook.stdout"||t=="application/vnd.code.notebook.error")return!0;if(t===Li){let r=JSON.parse(new TextDecoder().decode(e.data));return typeof r.model_id=="string"&&this.commIdsMappedToWidgetOutputModels.has(r.model_id)?Z8():!0}return t.startsWith("application/vnd")?Z8():!0}updateJupyterOutputWidgetWithOutput(e,t){let r=this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId:void 0,i="commId"in e?e.commId:r;if(!i)return;let o="outputToAppend"in e?e.outputToAppend:void 0,s=this.commIdsMappedToParentWidgetModel.get(i)||i,a=this.cell.notebook.getCells().find(w=>op.modelIdsOwnedByCells.get(w)?.has(s));if(!a){p.warn(`Unable to find a cell that owns the model ${s}`);return}let l=a.outputs.find(w=>w.items.find(D=>{if(D.mime!==Li)return!1;try{return JSON.parse(new TextDecoder().decode(D.data)).model_id===s}catch(A){p.warn("Failed to deserialize the widget data",A)}return!1}));if(!l)return;let c=op.outputsOwnedByWidgetModel.get(s)||new Set,d=("clearOutput"in e?e.clearOutput:!1)||(this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput===!0:!1);this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!1);let f=a.outputs.slice().filter(w=>d?!c.has(w.id):!0),g=f.slice(0,f.indexOf(l)+1),b=f.slice(f.indexOf(l)+1);op.outputsOwnedByWidgetModel.set(s,c),o&&c.add(o.id);let I=o?g.concat(o).concat(b):g.concat(b);return b.length===0&&o?t?.appendOutput(o,a).then(h,h):d&&!o&&b.length===0||t?.replaceOutput(I,a).then(h,h),{outputAdded:!0}}async handleInputRequest(e){if(e.content&&"prompt"in e.content){let t=new fr.CancellationTokenSource;this.prompts.add(t);let r=e.content.password!==null&&e.content.password;await fr.window.showInputBox({prompt:e.content.prompt?e.content.prompt.toString():"",ignoreFocusOut:!0,password:r},t.token).then(i=>{this.kernel.sendInputReply({value:i||"",status:"ok"},e.header)},h),this.prompts.delete(t)}}handleExecuteResult(e){this.addToCellData({output_type:"execute_result",data:e.content.data,metadata:e.content.metadata,transient:e.content.transient,execution_count:e.content.execution_count},e)}handleExecuteReply(e){let t=e.content;t.payload&&t.payload.forEach(r=>{r.source&&r.source==="set_next_input"&&"text"in r&&"replace"in r&&this.handleSetNextInput(r),r.data&&r.data.hasOwnProperty("text/plain")&&this.addToCellData({output_type:"stream",text:r.data["text/plain"].toString(),name:"stdout",metadata:{},execution_count:t.execution_count},e)})}handleSetNextInput(e){let t=new fr.WorkspaceEdit;if(e.replace)t.replace(this.cell.document.uri,new fr.Range(this.cell.document.lineAt(0).range.start,this.cell.document.lineAt(this.cell.document.lineCount-1).range.end),e.text);else{at(this.cell,"Create new cell after current");let r=new fr.NotebookCellData(fr.NotebookCellKind.Code,e.text,this.cell.document.languageId);r.outputs=[],r.metadata={};let i=fr.NotebookEdit.insertCells(this.cell.index+1,[r]);t.set(this.cell.notebook.uri,[i])}fr.workspace.applyEdit(t).then(h,h)}handleExecuteInput(e){e.content.execution_count&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleStatusMessage(e){at(this.cell,`Kernel switching to ${e.content.execution_state}`)}getOrCreateExecutionTask(e){return!e&&this.execution?this.execution:this.execution?.cell===this.cell?this.execution:this.createTemporaryTask(e)}handleStreamMessage(e){if(ou(e)&&this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow==ou(e)||e.parent_header.msg_type==="comm_msg"&&e.header.msg_type==="stream")return;at(this.cell,`Update streamed output, new output '${e.content.text.substring(0,100)}'`);let t=this.getOrCreateExecutionTask(!0),r=e.content.name==="stdout"?fr.NotebookCellOutputItem.stdout("").mime:fr.NotebookCellOutputItem.stderr("").mime;!this.request&&!this.streamsReAttachedToExecutingCell&&!this.lastUsedStreamOutput&&this.cell.outputs.length&&this.cell.outputs[this.cell.outputs.length-1].items.length>=1&&this.cell.outputs[this.cell.outputs.length-1].items.every(o=>o.mime===r)&&(this.lastUsedStreamOutput={output:this.cell.outputs[0],stream:e.content.name}),this.streamsReAttachedToExecutingCell=!0;let{previousValueOfClearOutputOnNextUpdateToOutput:i}=this.clearOutputIfNecessary(t);if(this.lastUsedStreamOutput?.stream===e.content.name){let o=co({output_type:"stream",name:e.content.name,text:e.content.text});at(this.cell,`Append output items '${e.content.text.substring(0,100)}`),t?.appendOutputItems(o.items,this.lastUsedStreamOutput.output).then(h,h)}else if(i){let o=bs(e.content.text),s=co({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},at(this.cell,`Replace output with '${o.substring(0,100)}'`),t?.replaceOutput([s]).then(h,h)}else{let o=H2(bs(e.content.text)),s=co({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},at(this.cell,`Append new output '${o.substring(0,100)}'`),t?.appendOutput([s]).then(h,h)}this.endTemporaryTask()}handleDisplayData(e){let t={output_type:"display_data",data:vC(e.content.data),metadata:e.content.metadata,transient:e.content.transient};this.addToCellData(t,e)}handleClearOutput(e){if(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===ou(e)){if(e.content.wait)this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!0);else{let t=this.getOrCreateExecutionTask(!0);this.updateJupyterOutputWidgetWithOutput({clearOutput:!0},t),this.endTemporaryTask()}return}if(e.content.wait)this.clearOutputOnNextUpdateToOutput=!0;else{let t=this.getOrCreateExecutionTask(!0);this.clearLastUsedStreamOutput(),t?.clearOutput().then(h,h),this.endTemporaryTask()}}handleError(e){let t=e.content.traceback;p.ci(`Traceback for error ${t}`),this.formatters.forEach(i=>{t=i.format(this.cell,t)}),p.ci(`Traceback for error after formatting ${t}`);let r={output_type:"error",ename:e.content.ename,evalue:e.content.evalue,traceback:t};if(this.cell.notebook.notebookType!=="interactive"){let i=ki.get(this.cell);i&&e.content.ename!=="KeyboardInterrupt"&&(i.errorInfo={name:e.content.ename,message:e.content.evalue,location:Nj(e.content.traceback,this.cell),uri:this.cell.document.uri,stack:e.content.traceback.join(`
`)})}this.addToCellData(r,e),this.cellHasErrorsInOutput=!0}handleReply(e){require("@jupyterlab/services").KernelMessage.isExecuteReplyMsg(e)&&(this.handleExecuteReply(e),"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count))}handleUpdateDisplayDataMessage(e){let t=e.content.transient.display_id;if(!t){p.warn("Update display data message received, but no display id",e.content);return}let r=Qr.getMappedOutput(this.cell.notebook,t);if(!r){p.trace("Update display data message received, but no output found to update",e.content);return}if(r.cell.document.isClosed){p.warn("Update display data message received, but output cell is closed",e.content);return}let i=wN(new fr.NotebookCellOutput(r.outputItems,r.outputContainer.metadata)),o=co({...i,data:e.content.data,metadata:e.content.metadata});if(r.outputItems.length===0&&o.items.length===0){p.trace("Update display data message received, but no output to update",e.content);return}let s=!1;if(r.outputItems.length===o.items.length){let a=!0;if((0,kO.default)(r.outputContainer.metadata||{},o.metadata||{})||(s=!0,a=!1),a){for(let l=0;l<r.outputItems.length;l++)if(!(0,kO.default)(r.outputItems[l],o.items[l])){a=!1;break}}if(a){p.trace("Update display data message received, but no output to update (data is the same)",e.content);return}}if(at(this.cell,`Replace output items in display data ${o.items.length}`),s){let a=r.cell.outputs.map(c=>{let u=wN(c);return u.output_type==="display_data"&&"transient"in u&&u.transient&&typeof u.transient=="object"&&"display_id"in u.transient&&typeof u.transient.display_id=="string"&&u.transient.display_id===t?o:c});this.getOrCreateExecutionTask(!1)?.replaceOutput(a,r.cell).then(h,h),Qr.trackOutputByDisplayId(r.cell,t,o,o.items)}else this.getOrCreateExecutionTask(!1)?.replaceOutputItems(o.items,r.outputContainer).then(h,h),Qr.trackOutputByDisplayId(r.cell,t,r.outputContainer,o.items);this.endTemporaryTask()}};v([qr()],op.prototype,"handleReply",1);var wE=op;function Z8(){let n=fr.extensions.getExtension(Vu);if(!n)return!1;let e=(0,x_.coerce)(n.packageJSON.version);return e?e.compare(new x_.SemVer("1.1.0"))>=0:!1}var su=class extends Error{constructor(t){super(t.evalue||t.ename);this.ename=t.ename,this.evalue=t.evalue,this.traceback=t.traceback}};var D_=class{constructor(e,t){this.controller=e;this.requestListener=t}create(e,t,r,i){return DO.fromCell(e,t,r,this.controller,this.requestListener,i)}},DO=class n{constructor(e,t,r,i,o,s){this.cell=e;this.codeOverride=t;this.kernelConnection=r;this.controller=i;this.requestListener=o;this.resumeExecution=s;this.type="cell";this._result=re();this.cancelHandled=!1;this.disposables=[];if(xO.workspace.onDidCloseTextDocument(a=>{if(a===this.cell.document){p.info(`Disposing request as the cell (${this.cell.index}) was deleted ${U(this.cell.notebook.uri)}`);try{this.request?.dispose()}catch(l){p.error(`Error during cell execution dispose: ${l}`)}this.started&&!this._completed&&this.completedDueToCancellation()}},this,this.disposables),this.canExecuteCell())this.execution=ki.getOrCreate(e,this.controller,!s?.msg_id),fd.setCellState(e,2);else{let a=ki.get(e);a&&(a.start(),a.end(void 0))}}get result(){return this._result.promise}get executionOrder(){return this._executionOrder}static fromCell(e,t,r,i,o,s){return new n(e,t,r,i,o,s)}async start(e){if(this.session=e,this.resumeExecution?.msg_id)return this.resume(e,this.resumeExecution);if(this.cancelHandled){at(this.cell,"Not starting as it was cancelled");return}if(at(this.cell,"Start execution"),p.ci(`Cell Exec contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return e.kind==="remoteJupyter"&&e.status==="unknown"&&(!e.kernel||e.kernel.isDisposed||e.isDisposed)?(this.execution?.start(),this.execution?.clearOutput().then(h,h),this.completedWithErrors(new pn),this.result):this.started?(at(this.cell,"Cell has already been started yet CellExecution.Start invoked again"),p.error(`Cell has already been started yet CellExecution.Start invoked again ${this.cell.index}`),this.result):(this.started=!0,Cy.set(this.cell.notebook,this.execution),fd.setCellState(this.cell,3),this.execute(this.codeOverride||this.cell.document.getText().replace(/\r\n/g,`
`),e).catch(t=>this.completedWithErrors(t)).catch(h),this.result)}async resume(e,t){if(this.cancelHandled){at(this.cell,"Not resuming as it was cancelled");return}if(!e.kernel)throw new Error("Kernel not available to resume execution");if(at(this.cell,"Start resuming execution"),p.ci(`Cell Exec (resuming) contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return this.started?(p.error(`Cell has already been started yet CellExecution.resume invoked again ${this.cell.index}`),this.result):(this.started=!0,Cy.set(this.cell.notebook,this.execution),this.execution?.start(t.startTime),t.executionCount&&this.execution&&(this.execution.executionOrder=t.executionCount),fd.setCellState(this.cell,3),this.cellExecutionHandler=this.requestListener.registerListenerForResumingExecution(this.cell,{kernel:e.kernel,cellExecution:this.execution,msg_id:t.msg_id}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(r=>{p.error(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,r),this.completedWithErrors(r.error)},this,this.disposables),this.cellExecutionHandler.completed.finally(()=>this.completedSuccessfully()).catch(h),this.result)}async cancel(e=!1){if(!this.cancelHandled){if(this.cancelRequested=!0,this.started&&!e&&this.execution?.started){at(this.cell,"Cell is already running, waiting for it to finish or kernel to start"),await this.result.catch(h);return}this.cancelHandled||this._completed||(at(this.cell,"Execution cancelled"),this.cancelHandled=!0,this.completedDueToCancellation(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,at(this.cell,"Execution disposed"),z(this.disposables))}completedWithErrors(e,t,r=!0){if(!this.cancelHandled){if(!this.disposed&&!this.cancelRequested?p.warn("Cell completed with errors",e):p.warn(`Cell completed with errors (${this.disposed?"disposed":"cancelled"})`),at(this.cell,"Completed with errors"),r){let i,o;e&&!(e instanceof qe)&&e.message?.includes("Canceled future for execute_request message before replies were done")&&this.session&&X8(this.session)&&(e=new pn),e&&(e instanceof qe?i=nm(xO.workspace.workspaceFolders||[],e,ot(this.kernelConnection),Th(this.kernelConnection.interpreter))?.message:i=e.message||e.name||e.stack),o=Wh(i||""),o&&this.execution?.appendOutput(o).then(h,h)}this.endCellTask("failed",t),at(this.cell,"Completed with errors, & resolving"),this._result.reject(e)}}get isEmptyCodeCell(){return this.cell.document.getText().trim().length===0}completedSuccessfully(e){at(this.cell,"Completed successfully");let t="success";this.endCellTask("success",e),at(this.cell,`Completed successfully & resolving with status = ${t}`),this._result.resolve()}endCellTask(e,t=new Date().getTime()){if(!this._completed){if(this._completed=!0,this.isEmptyCodeCell)this.execution&&(this.execution.executionOrder=void 0),this.execution?.end(void 0);else if(e==="success"||e==="failed")this.endTime=t,this.execution?.end(e==="success",this.endTime);else{try{this.request?.dispose()}catch{}this.execution?.end(void 0)}Cy.get(this.cell.notebook)===this.execution&&Cy.set(this.cell.notebook,void 0),this._executionOrder=this.execution?.executionOrder,fd.setCellState(this.cell,1),this.execution=void 0}}completedDueToCancellation(){at(this.cell,"Completed due to cancellation"),this.endCellTask("cancelled"),at(this.cell,"Cell cancelled & resolving"),this._result.resolve()}canExecuteCell(){return this.cell.document.languageId==="raw"?!1:!this.cell.document.isClosed}async execute(e,t){if(!t.kernel)throw new Error("No kernel available to execute code");if(at(this.cell,"Send code for execution"),e.trim().length===0||this.cell.document.isClosed)return e.trim().length===0&&(this.execution?.start(this.resumeExecution?.startTime),this.execution?.clearOutput()?.then(h,h)),at(this.cell,"Empty cell execution"),this.completedSuccessfully();let r={cellId:this.cell.document.uri.toString(),...ld(this.cell).metadata},i=t.kernel;try{nr.changeCellState(this.cell,3),p.trace(`Cell Index:${this.cell.index} sent to kernel`),this.request=i.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!0},!1,r),this.request.done.then(h,h)}catch(o){return p.error(`Cell execution failed without request, for cell Index ${this.cell.index}`,o),this.completedWithErrors(o)}this.cellExecutionHandler=this.requestListener.registerListenerForExecution(this.cell,{kernel:i,cellExecution:this.execution,request:this.request}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(o=>{p.error(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,o),this.completedWithErrors(o.error)},this,this.disposables);try{at(this.cell,"Wait for jupyter execution");let o=await this.request.done,s=new Date().getTime();at(this.cell,"Jupyter execution completed"),o.content.status==="error"?this.completedWithErrors(new su(o.content),s,!1):this.completedSuccessfully(s),at(this.cell,"Executed successfully in executeCell")}catch(o){if(this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&p.error("Error in waiting for cell to complete",o),at(this.cell,"Some other execution error"),o&&o instanceof Error&&er(o,!0)?this.completedWithErrors({message:o.message}):this.completedWithErrors(o)}}};var e5=require("vscode");var __=class{constructor(e,t,r,i){this.controller=e;this.context=t;this.formatters=r;this.notebook=i;this.disposables=[];this.messageHandlers=new WeakMap;e5.workspace.onDidChangeNotebookDocument(o=>{o.notebook===this.notebook&&o.contentChanges.forEach(s=>s.removedCells.forEach(a=>this.messageHandlers.get(a)?.dispose()))},this,this.disposables)}dispose(){z(this.disposables),this.notebook&&this.notebook.getCells().forEach(e=>this.messageHandlers.get(e)?.dispose())}registerListenerForExecution(e,t){this.messageHandlers.get(e)?.dispose();let r=new wE(e,this.controller,this.context,this.formatters,t.kernel,t.request,t.cellExecution,t.request.msg.header.msg_id);return this.messageHandlers.set(e,r),r}registerListenerForResumingExecution(e,t){this.messageHandlers.get(e)?.dispose();let r=new wE(e,this.controller,this.context,this.formatters,t.kernel,void 0,t.cellExecution,t.msg_id);return this.messageHandlers.set(e,r),r}};var T_=require("vscode");function zl(n,e,t){n!==Ae&&p.trace(`Execution Id:${e}. ${t}.`)}var t5=new Map,Ey=class n{constructor(e,t){this.code=e;this.extensionId=t;this.type="code";this._onDidEmitOutput=new T_.EventEmitter;this.onDidEmitOutput=this._onDidEmitOutput.event;this._onRequestSent=new T_.EventEmitter;this.onRequestSent=this._onRequestSent.event;this._onRequestAcknowledge=new T_.EventEmitter;this.onRequestAcknowledged=this._onRequestAcknowledge.event;this._done=re();this.cancelHandled=!1;this.disposables=[];let r=t5.get(t)||0;r+=1,t5.set(t,r),this.executionId=`${t}-${r}`,this.disposables.push(this._onDidEmitOutput)}get done(){return this._done.promise}get result(){return this._done.promise}static fromCode(e,t){return new n(e,t)}async start(e){if(this.session=e,this.cancelHandled){zl(this.extensionId,this.executionId,"Not starting as it was cancelled");return}if(zl(this.extensionId,this.executionId,"Start Code execution"),p.ci(`Code Exec contents ${this.code.substring(0,50)}...`),!e.kernel||e.kernel.isDisposed||e.isDisposed){this._done.reject(new pn);return}if(this.started)return zl(this.extensionId,this.executionId,"Code has already been started yet CodeExecution.Start invoked again"),p.error(`Code has already been started yet CodeExecution.Start invoked again ${this.executionId}`),this.done;await this.execute(this.code.replace(/\r\n/g,`
`),e).catch(h)}async cancel(){if(!(this.cancelHandled||this._completed)){if(this.cancelRequested=!0,this.started){zl(this.extensionId,this.executionId,"Code is already running, interrupting and waiting for it to finish or kernel to start");let e=this.session?.kernel;e&&this.extensionId!==Ae&&await e.interrupt().catch(h),this.request?.dispose(),await this.request?.done.catch(h)}this.cancelHandled||this._completed||(zl(this.extensionId,this.executionId,"Execution cancelled"),this.cancelHandled=!0,this._done.resolve(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,this._completed||zl(this.extensionId,this.executionId,"Execution disposed"),z(this.disposables))}async execute(e,t){if(!t.kernel){let i=new Error("No kernel available to execute code");throw this._done.resolve(),i}zl(this.extensionId,this.executionId,"Send code for execution");let r=t.kernel;try{this.started=!0,this._onRequestSent.fire(),zl(this.extensionId,this.executionId,"Execution Request Sent to Kernel"),this.request=Uj(r,e,()=>this._onRequestAcknowledge.fire(),i=>this._onDidEmitOutput.fire(i)),this.request.done.then(h,h)}catch(i){p.error(`Code execution failed without request, for exec ${this.executionId}`,i),this._completed=!0,this._done.reject(i);return}try{let i=await this.request.done;this._completed=!0,i.content.status==="error"?(zl(this.extensionId,this.executionId,"Executed with errors"),this._done.reject(new su(i.content))):(zl(this.extensionId,this.executionId,"Executed successfully"),this._done.resolve())}catch(i){if(this._completed=!0,this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&p.error(`Error in waiting for code ${this.executionId} to complete`,i),this._done.reject(i)}}};var R_=class{constructor(e,t,r,i){this.session=e;this.executionFactory=t;this.metadata=r;this.resourceUri=i;this.queueOfItemsToExecute=[];this.cancelledOrCompletedWithErrors=!1;this.startedRunningCells=!1;this.disposables=[]}get queueOfCellsToExecute(){return this.queueOfItemsToExecute.filter(e=>e.type==="cell").map(e=>e)}get isEmpty(){return this.queueOfItemsToExecute.length===0}get failed(){return this.cancelledOrCompletedWithErrors}get queue(){return this.queueOfCellsToExecute.map(e=>e.cell)}dispose(){this.disposables.forEach(e=>e.dispose()),this.lastCellExecution?.dispose()}queueCell(e,t){this.enqueue({cell:e,codeOverride:t})}queueCode(e,t,r){return this.enqueue({code:e,extensionId:t,token:r})}enqueue(e){let t;if("cell"in e){let{cell:r,codeOverride:i}=e,o=this.queueOfCellsToExecute.find(a=>a.cell===r);if(o)return at(r,"Use existing cell execution"),o;let s=this.executionFactory.create(r,i,this.metadata);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),at(r,"User queued cell for execution")}else{let{code:r,extensionId:i,token:o}=e,s=Ey.fromCode(r,i);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),this.disposables.push(la(o.onCancellationRequested)(()=>s.cancel()))}return this.startExecutingCells(),t}resumeCell(e,t){if(this.queueOfCellsToExecute.find(o=>o.cell===e)){at(e,"Use existing cell execution");return}let i=this.executionFactory.create(e,"",this.metadata,t);this.disposables.push(i),this.queueOfItemsToExecute.push(i),at(e,"User queued cell for execution"),this.startExecutingCells()}async cancel(e){this.cancelledOrCompletedWithErrors=!0,p.debug("Cancel pending cells"),await Promise.all(this.queueOfItemsToExecute.map(t=>t.cancel(e))),this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.splice(0,this.queueOfItemsToExecute.length)}async cancelQueuedCells(){this.cancelledOrCompletedWithErrors=!0,p.debug("Cancel pending cells"),await Promise.all(this.queueOfCellsToExecute.map(e=>e.cancel())),this.lastCellExecution?.type==="cell"&&this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.push(...this.queueOfItemsToExecute.filter(e=>e.type==="code"))}async waitForCompletion(e){let t=e?this.queueOfCellsToExecute.filter(r=>e===r.cell):this.queueOfItemsToExecute;await Promise.all(t.map(r=>r.result))}startExecutingCells(){this.startedRunningCells||this.start().catch(h),this.startedRunningCells=!0}async start(){try{await this.executeQueuedCells()}catch(e){p.error("Failed to execute cells in CellExecutionQueue",e),this.cancelledOrCompletedWithErrors=!0,await this.cancelQueuedCells()}}async executeQueuedCells(){let e,t=await this.session;for(this.queueOfItemsToExecute.forEach(r=>r.type==="cell"&&at(r.cell,"Ready to execute"));this.queueOfItemsToExecute.length;){this.lastCellExecution?.dispose();let r=this.queueOfItemsToExecute[0];this.lastCellExecution=r,r.type==="cell"&&at(r.cell,"Before Execute individual cell");let i=!0;try{r.type==="cell"&&r.cell.notebook.isClosed?e=!0:r.type==="cell"&&this.cancelledOrCompletedWithErrors||(i=await r.start(t).then(()=>!0).catch(()=>!1))}finally{r.type==="cell"&&at(r.cell,`After Execute individual cell ${i}`);let s=this.queueOfItemsToExecute.indexOf(r);s>=0&&this.queueOfItemsToExecute.splice(s,1),r.type==="cell"&&nr.changeCellState(r.cell,1,r.executionOrder)}let o=!1;if(r.type==="cell"&&ld(r.cell).metadata?.tags?.includes("raises-exception")&&(o=!0),e||this.cancelledOrCompletedWithErrors||!i&&!o){this.cancelledOrCompletedWithErrors=!0;let s=[];if(this.cancelledOrCompletedWithErrors&&s.push("cancellation or failure in execution"),e&&s.push("Notebook being closed"),typeof i=="number"&&!i&&s.push("failure in cell execution"),s.length===0&&s.push("an unknown reason"),this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length===this.queueOfItemsToExecute.length){p.warn(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}else if(this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length!==this.queueOfItemsToExecute.length)p.warn(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancelQueuedCells();else if(e){p.warn(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}}if(t.status==="dead"||t.status==="terminating"){this.cancelledOrCompletedWithErrors=!0,p.warn("Cancel all remaining cells due to dead kernel"),await this.cancel();break}}}};var A_=class{constructor(e,t,r,i){this.kernel=e;this.notebook=i;this.disposables=[];this._visibleExecutionCount=0;this.documentExecutions=new WeakMap;this._onDidReceiveDisplayUpdate=new of.EventEmitter;this.onDidReceiveDisplayUpdate=this._onDidReceiveDisplayUpdate.event;this.hookedSesions=new WeakSet;let o=new __(e.controller,t,r,i);this.disposables.push(o),this.executionFactory=new D_(e.controller,o),nr.onDidChangeNotebookCellExecutionState(s=>{s.cell.notebook===e.notebook&&s.state===1&&s.cell.executionSummary?.executionOrder&&(this._visibleExecutionCount=Math.max(this._visibleExecutionCount,s.cell.executionSummary.executionOrder))}),e.onRestarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.onStarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.addHook("willInterrupt",this.onWillInterrupt,this,this.disposables),e.addHook("willCancel",this.onWillCancel,this,this.disposables),e.addHook("willRestart",s=>this.onWillRestart(s),this,this.disposables),e.onStatusChanged(this.hookupIOPubHandler,this,this.disposables),e.onRestarted(this.hookupIOPubHandler,this,this.disposables),this.hookupIOPubHandler()}get executionCount(){return this._visibleExecutionCount}hookupIOPubHandler(){let e=this.kernel.session;if(!e||this.hookedSesions.has(e))return;this.hookedSesions.add(e);let t=(r,i)=>{if(i.header.msg_type!=="update_display_data"&&i.header.msg_type!=="display_data")return;let o=i,s=o.content.transient?.display_id;if(!s||!jj(e,s))return;let a=co({output_type:"display_data",data:o.content.data,metadata:o.content.metadata,transient:o.content.transient});this._onDidReceiveDisplayUpdate.fire(a)};e.iopubMessage.connect(t),this.disposables.push({dispose:()=>{e?.iopubMessage.disconnect(t)}})}get pendingCells(){return this.documentExecutions.get(this.notebook)?.queue||[]}async resumeCellExecution(e,t){if(at(e,`NotebookKernelExecution.resumeCellExecution (start), ${U(e.notebook.uri)}`),e.kind==of.NotebookCellKind.Markup)return;It(this.kernel.resourceUri,"DATASCIENCE.RESUME_EXECUTE_CELL");let r=this.kernel.start(new Ft(!1)),i=this.getOrCreateCellExecutionQueue(e.notebook,r);i.resumeCell(e,t);let o=await i.waitForCompletion(e).then(()=>!0).catch(()=>!1);at(e,`NotebookKernelExecution.resumeCellExecution (completed), ${U(e.notebook.uri)}`),p.trace(`Cell ${e.index} executed ${o?"successfully":"with an error"}`)}async executeCell(e,t){at(e,`NotebookKernelExecution.executeCell (1), ${U(e.notebook.uri)}`);let r=new Fe;if(e.kind==of.NotebookCellKind.Markup)return;at(e,`NotebookKernelExecution.executeCell (2), ${U(e.notebook.uri)}`);let i=this.kernel.restarting.then(()=>this.kernel.start(new Ft(!1)));at(e,`NotebookKernelExecution.executeCell (3), ${U(e.notebook.uri)}`),await i;let o=this.getOrCreateCellExecutionQueue(e.notebook,i);o.queueCell(e,t);let s=!0;try{at(e,`NotebookKernelExecution.executeCell (4), ${U(e.notebook.uri)}`),await o.waitForCompletion(e)}catch(a){throw s=!1,a}finally{at(e,`NotebookKernelExecution.executeCell completed (5), ${U(e.notebook.uri)}`),p.trace(`Cell ${e.index} executed ${s?"successfully":"with an error"}`),It(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CELL",{duration:r.elapsedTime})}}async*executeCode(e,t,r,i){let o=new Fe,s;if(t===Ae||t===Ow){let f=this.kernel.restarting.then(()=>this.kernel.start(new Ft(!0)));s=Ey.fromCode(e,t),f.then(g=>s.start(g))}else{let f=this.kernel.restarting.then(()=>this.kernel.start(new RD(!1,this.kernel.isPostInitializedInProgress)));s=this.getOrCreateCellExecutionQueue(this.notebook,f).queueCode(e,t,i)}t!==Ae&&p.trace(`Queue code ${s.executionId} from ${t} after ${o.elapsedTime}ms:
${e}`);let a=!1,l=[];s.result.finally(()=>{a=!0,!i.isCancellationRequested&&p.debug(`Execution of code ${s.executionId} completed in ${o.elapsedTime}ms`),t!==Ae&&It(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CODE",{duration:o.elapsedTime},{extensionId:t}),z(l)}).catch(h);let c=Xi(s.result),u=[],d=re();for(l.push(s.onRequestSent(()=>r.started.fire())),l.push(s.onRequestAcknowledged(()=>r.executionAcknowledged.fire())),s.onDidEmitOutput(f=>{u.push(f),d.resolve(),d=re()},this,l),i.onCancellationRequested(()=>{a||p.debug(`Code execution cancelled by extension ${t}`)},this,l);;){await Promise.race([d.promise,c.promise]),a&&(d=re());let f=this.kernel.session;for(;u.length;){let g=u.shift();f&&Dk(t,f,g),yield g}if(c.completed)break}}executeHidden(e){return this.kernel.start().then(r=>r.kernel?mn(r.kernel,e):Promise.reject(new pn))}async onWillInterrupt(){let e=this.documentExecutions.get(this.notebook);!e&&this.kernel.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||(p.info("Interrupt kernel execution"),e&&(await e.cancel(),await e.waitForCompletion().catch(h)))}async onWillCancel(){let e=this.documentExecutions.get(this.notebook);e&&await e.cancel(!0)}async onWillRestart(e){let t=this.documentExecutions.get(this.notebook),r=e?await e.catch(()=>{}):void 0,i=t?t.cancel(!0).then(()=>t.waitForCompletion().catch(h)):Promise.resolve();r||(p.info("No kernel session to interrupt"),await i)}getOrCreateCellExecutionQueue(e,t){let r=this.documentExecutions.get(e);if(r&&!r.isEmpty&&!r.failed)return r;let i=new R_(t,this.executionFactory,this.kernel.kernelConnectionMetadata,this.kernel.resourceUri);return this.disposables.push(i),of.workspace.onDidCloseNotebookDocument(async o=>{o===e&&(p.debug(`Cancel executions after closing notebook ${U(o.uri)}`),(!i.failed||!i.isEmpty)&&await i.cancel(!0))},this,this.disposables),this.documentExecutions.set(e,i),i}};var wo=Symbol("IReplNotebookTrackerService");var wy=class extends y_{constructor(t,r,i,o,s,a,l,c,u,d){super(t,r);this.sessionCreator=i;this.configService=o;this.context=s;this.formatters=l;this.startupCodeProviders=c;this.workspaceStorage=u;this.replTracker=d;r.push(a.onDidRemove(this.handleServerRemoval.bind(this)))}getOrCreate(t,r){let i=this.getInternal(t);if(i&&i.options.metadata.id===r.metadata.id)return i.kernel;i&&p.trace(`Kernel for ${U(t.uri)} with id ${i.options.metadata.id} is being replaced with ${r.metadata.id}`),this.disposeOldKernel(t,"createNewKernel");let o=this.replTracker.isForReplEditor(t),s=o?r.resourceUri:t.uri,a=PO(this.configService,s),l=this.startupCodeProviders.getProviders(o?Yt:bt),c=new w_(s,t,r.metadata,this.sessionCreator,a,r.controller,l,this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(u=>this._onKernelStatusChanged.fire({kernel:c,status:u}),this,this.disposables),c.onPostInitialized(u=>u.waitUntil(this._onDidPostInitializeKernel.fireAsync({kernel:c},u.token)),this,this.disposables),this.executions.set(c,new A_(c,this.context,this.formatters,t)),this.asyncDisposables.push(c),this.storeKernel(t,r,c),this.deleteMappingIfKernelIsDisposed(c),c}};wy=v([(0,Yr.injectable)(),m(0,(0,Yr.inject)(aa)),m(1,(0,Yr.inject)(M)),m(2,(0,Yr.inject)(gC)),m(3,(0,Yr.inject)(ie)),m(4,(0,Yr.inject)(Ze)),m(5,(0,Yr.inject)(Ht)),m(6,(0,Yr.multiInject)(ig)),m(7,(0,Yr.inject)(Rc)),m(8,(0,Yr.inject)(Le)),m(8,(0,Yr.named)(ri)),m(9,(0,Yr.inject)(wo))],wy);var Py=class extends b_{constructor(t,r,i,o,s,a){super(t,r);this.sessionCreator=i;this.configService=o;this.startupCodeProviders=s;this.workspaceStorage=a}getOrCreate(t,r){let i=this.getInternal(t);if(i&&i.options.metadata.id===r.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t,s=PO(this.configService,o),a=o.path.endsWith(".interactive")?Yt:bt,l=new E_(t,o,r.metadata,this.sessionCreator,s,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return l.onRestarted(()=>this._onDidRestartKernel.fire(l),this,this.disposables),l.onDisposed(()=>{this._onDidDisposeKernel.fire(l)},this,this.disposables),l.onStarted(()=>this._onDidStartKernel.fire(l),this,this.disposables),l.onStatusChanged(c=>this._onKernelStatusChanged.fire({kernel:l,status:c}),this,this.disposables),l.onPostInitialized(c=>c.waitUntil(this._onDidPostInitializeKernel.fireAsync({kernel:l},c.token)),this,this.disposables),this.asyncDisposables.push(l),this.storeKernel(t,r,l),this.deleteMappingIfKernelIsDisposed(t,l),l}};Py=v([(0,Yr.injectable)(),m(0,(0,Yr.inject)(aa)),m(1,(0,Yr.inject)(M)),m(2,(0,Yr.inject)(gC)),m(3,(0,Yr.inject)(ie)),m(4,(0,Yr.inject)(Rc)),m(5,(0,Yr.inject)(Le)),m(5,(0,Yr.named)(ri))],Py);var sf=k(N()),au=require("vscode");var ky=class{constructor(e,t,r,i){this.extensionChecker=t;this.interpreterService=r;this.kernelFinder=i;this.refreshedOnceBefore=!1;this.disposables=[];e.push(this)}dispose(){z(this.disposables)}activate(){this.extensionChecker.isPythonExtensionInstalled?this.startRefreshWithPython():(this.startRefreshWithoutPython(),this.extensionChecker.onPythonExtensionInstallationStatusChanged(()=>{this.extensionChecker.isPythonExtensionInstalled&&this.startRefreshWithPython()},this,this.disposables))}startRefreshWithoutPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=()=>{let t=Date.now().toString();p.debug(`Start refreshing Kernel Picker (${t})`);let r=au.notebooks.createNotebookControllerDetectionTask(bt),i=au.notebooks.createNotebookControllerDetectionTask(Yt);this.disposables.push(r),this.disposables.push(i),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"&&(p.debug(`End refreshing Kernel Picker (${t})`),r.dispose(),i.dispose())},this,this.disposables)};if(this.kernelFinder.status==="discovering")return e();this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="discovering"&&e()},this,this.disposables)}startRefreshWithPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=!1;au.window.onDidChangeActiveNotebookEditor(o=>{!e&&o&&Pt(o.notebook)&&(e=!0,p.debug("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(h))},this,this.disposables),au.workspace.onDidOpenNotebookDocument(o=>{!e&&Pt(o)&&(e=!0,p.debug("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(h))},this,this.disposables);let t,r="",i=()=>(t&&!t.isDisposed||(r=Date.now().toString(),p.debug(`Start refreshing Kernel Picker (${r})`),t=new xr(au.notebooks.createNotebookControllerDetectionTask(bt),au.notebooks.createNotebookControllerDetectionTask(Yt)),this.disposables.push(t)),t);this.kernelFinder.status==="idle"?(p.debug(`End refreshing Kernel Picker (${r})`),t?.dispose()):i(),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"?(p.debug(`End refreshing Kernel Picker (${r})`),t?.dispose()):i()},this,this.disposables)}};ky=v([(0,sf.injectable)(),m(0,(0,sf.inject)(M)),m(1,(0,sf.inject)($e)),m(2,(0,sf.inject)(et)),m(3,(0,sf.inject)(Dr))],ky);var r5=k(N());var xy=class{constructor(){this.providers=new Map}getProviders(e){return(this.providers.get(e)||[]).slice()}register(e,t){this.providers.set(t,this.providers.get(t)||[]),this.providers.get(t).push(e)}};xy=v([(0,r5.injectable)()],xy);var PE=k(N());var Dy=class{constructor(e,t){this.kernelProvider=e;this.disposables=t}activate(){this.kernelProvider.onDidCreateKernel(e=>this.addOnStartHooks(e),this,this.disposables)}addOnStartHooks(e){e.addHook("didStart",async t=>{t&&await g7(t,e.resourceUri,e.kernelConnectionMetadata)},this,this.disposables)}};Dy=v([(0,PE.injectable)(),m(0,(0,PE.inject)(we)),m(1,(0,PE.inject)(M))],Dy);var kE=k(N());var n5=require("vscode");var _y=class{constructor(e,t){this.kernelProvider=e;this.disposables=[];this.restartProgress=new WeakMap;this.interruptProgress=new WeakMap;t.push(this)}dispose(){z(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.kernelProvider.onDidDisposeKernel(e=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables)}onDidCreateKernel(e){e.addHook("willRestart",async()=>{this.restartProgress.get(e)?.dispose();let t=lt.createProgressReporter(e.resourceUri,y.restartingKernelStatus(`: ${ot(e.kernelConnectionMetadata)}`));this.restartProgress.set(e,t)},this,this.disposables),e.addHook("restartCompleted",async()=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables),e.addHook("willInterrupt",async()=>{let t=new xr,r=setTimeout(()=>{t.isDisposed||t.add(lt.createProgressReporter(e.resourceUri,y.interruptKernelStatus(ot(e.kernelConnectionMetadata))))},1e3);t.add(new n5.Disposable(()=>clearTimeout(r))),this.interruptProgress.set(e,t)},this,this.disposables),e.addHook("interruptCompleted",async()=>this.interruptProgress.get(e)?.dispose(),this,this.disposables)}};_y=v([(0,kE.injectable)(),m(0,(0,kE.inject)(we)),m(1,(0,kE.inject)(M))],_y);var cu=k(N()),DE=require("vscode");var Ea=k(N()),xE=require("vscode");var Yo=require("vscode");var rde=/python\s\d*.?\d*$/,_O="__old_vscode_kernelspecs",TO=class{constructor(e,t,r){this.fs=e;this.globalState=t;this.jupyterPaths=r;this.findKernelSpecsInPathCache=new Map;this.pathToKernelSpec=new Map;this.disposables=[];this.oldKernelSpecsFolder&&p.trace(`Old kernelSpecs (created by Jupyter Extension) stored in directory ${this.oldKernelSpecsFolder}`)}get oldKernelSpecsFolder(){return this._oldKernelSpecsFolder||this.globalState.get("OLD_KERNEL_SPECS_FOLDER__","")}set oldKernelSpecsFolder(e){this._oldKernelSpecsFolder=e,this.globalState.update("OLD_KERNEL_SPECS_FOLDER__",e).then(h,h)}clearCache(){this.pathToKernelSpec.clear(),this.findKernelSpecsInPathCache.clear()}dispose(){z(this.disposables)}async loadKernelSpec(e,t,r){if(e.fsPath.includes(_O))return;let i=un(e);if(!this.pathToKernelSpec.has(i)){let o=this.loadKernelSpecImpl(e,t,r).then(async s=>{let a=await this.jupyterPaths.getKernelSpecRootPath(),l=s&&a&&Rn(s)&&s.specFile&&bh(Yo.Uri.file(s.specFile),a);if(s&&!l)return s;s?.specFile&&l&&this.deleteOldKernelSpec(s.specFile).catch(h),this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i),this.cache=this.cache?.filter(c=>yi(c.kernelSpecFile,e))});this.pathToKernelSpec.set(i,o),o.finally(()=>{t.isCancellationRequested&&this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i)}).catch(h)}return this.pathToKernelSpec.get(i)}async deleteOldKernelSpec(e){let t=Se(rt(e)),r=We(rt(rt(e)),_O);this.oldKernelSpecsFolder=r;let i=We(r,t,Se(e));await this.fs.createDirectory(Yo.Uri.file(rt(i))),await this.fs.copy(Yo.Uri.file(e),Yo.Uri.file(i)).catch(h),await this.fs.delete(Yo.Uri.file(e)),p.trace(`Old KernelSpec '${e}' deleted and backup stored in ${r}`)}async loadKernelSpecImpl(e,t,r){return nde(e,this.fs,t,r)}async findKernelSpecsInPaths(e,t){let r=un(e),i=this.findKernelSpecsInPathCache.get(r);if(i)return i;let o=(async()=>await this.fs.exists(e)?t.isCancellationRequested?[]:(await this.fs.searchLocal("**/kernel.json",e.fsPath,!0)).map(l=>zt(e,l)):[])();this.findKernelSpecsInPathCache.set(r,o);let s=t.onCancellationRequested(()=>{this.findKernelSpecsInPathCache.get(r)===o&&this.findKernelSpecsInPathCache.delete(r)});return o.finally(()=>{t.isCancellationRequested&&this.findKernelSpecsInPathCache.get(r)===o&&this.findKernelSpecsInPathCache.delete(r),s.dispose()}).catch(h),o.catch(a=>{this.findKernelSpecsInPathCache.get(r)===o&&this.findKernelSpecsInPathCache.delete(r),p.warn(`Failed to search for kernels in ${U(e)} with an error`,a)}),o}},Ty=class{constructor(e,t,r,i,o,s){this.fs=e;this.extensionChecker=t;this.memento=r;this.env=o;this.jupyterPaths=s;this.disposables=[];this._status="idle";this.promiseMonitor=new ao;this._onDidChangeStatus=new Yo.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeKernels=new Yo.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.timeouts=new Map;i.push(this),this.disposables.push(this.promiseMonitor),this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.kernelSpecFinder=new TO(e,r,s),this.disposables.push(this.kernelSpecFinder),this.disposables.push(new Yo.Disposable(()=>z(Array.from(this.timeouts.values()))))}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}clearCache(){this.kernelSpecFinder.clearCache()}async listKernelsFirstTimeFromMemento(e){let t=(async()=>{let r=this.memento.get(e,JSON.stringify({kernels:[],extensionVersion:""})),i=JSON.parse(r),o=[];i&&Array.isArray(i.kernels)&&i.extensionVersion===this.env.extensionVersion&&(o=i.kernels.map(a=>Cs.fromJSON(a)));let s=[];return await Promise.all(o.map(async a=>{await this.isValidCachedKernel(a)&&s.push(a)})),s})();return this.promiseMonitor.push(t),t}writeToMementoCache(e,t){this.timeouts.get(t)?.dispose();let r=setTimeout(()=>{this.memento.update(t,JSON.stringify({kernels:e.map(i=>i.toJSON()),extensionVersion:this.env.extensionVersion}))},500);this.timeouts.set(t,{dispose:()=>Kt(clearTimeout)(r)})}async isValidCachedKernel(e){switch(e.kind){case"startUsingPythonInterpreter":return this.fs.exists(e.interpreter.uri);case"startUsingLocalKernelSpec":return(e.kernelSpec.specFile?this.fs.exists(Yo.Uri.file(e.kernelSpec.specFile)):Promise.resolve(!0)).then(r=>r&&e.interpreter?this.fs.exists(e.interpreter.uri):Promise.resolve(!0))}}};async function nde(n,e,t,r){if(n.fsPath.includes(_O))return;let i;try{i=JSON.parse(await e.readFile(n))}catch(d){p.error(`Failed to parse kernelspec ${n}`,d);return}let o=rt(n.fsPath);if(i.argv=i.argv.map(d=>d.replaceAll("{resource_dir}",o)),t.isCancellationRequested||(i.name=r?await DN(r):i.name,t.isCancellationRequested))return;if(!i.display_name.toLowerCase().match(rde)&&i.language===ge&&i.argv.length>2){let d=i.argv.slice(1).map(f=>f.toLowerCase()).filter(f=>!["-m","ipykernel","ipykernel_launcher","-f","{connection_file}"].includes(f));d.length&&(i.name=`${i.name}.${d.join("#")}`)}let a=i.metadata||{};a.vscode=a.vscode||{},a.vscode.originalSpecFile||(a.vscode.originalSpecFile=n.fsPath),a.vscode.originalDisplayName||(a.vscode.originalDisplayName=i.display_name),a.originalSpecFile&&(a.vscode.originalSpecFile=a.originalSpecFile,delete a.originalSpecFile),i.metadata=a,i.name=i?.name||Se(rt(n.fsPath));let l=new md(i,n.fsPath,r?.uri.fsPath||i?.metadata?.interpreter?.path,Rn(i)),c=r?.uri.fsPath||i?.metadata?.interpreter?.path,u=Jr(r);if(!(c&&!u&&!await e.exists(Yo.Uri.file(c))))return i.isRegisteredByVSC=Rn(i),l}function i5(){return`LOCAL_KERNEL_SPECS_CACHE_KEY_V_2023_2:${xE.env.appHost}:${xE.env.remoteName||""}`}var Xo=class extends Ty{constructor(t,r,i,o,s,a){super(t,i,o,s,a,r);this._kernels=new Map}activate(){this.listKernelsFirstTimeFromMemento(i5()).then(t=>{this._kernels.size===0&&t.length&&(t.forEach(r=>this._kernels.set(r.id,r)),this._onDidChangeKernels.fire())}).catch(h),this.refresh().then(h,h)}get kernels(){return Array.from(this._kernels.values())}dispose(){this._onDidChangeKernels.dispose()}async refresh(){this.clearCache(),await this.refreshData()}async refreshData(){let t=new xE.CancellationTokenSource;try{await this.listKernelSpecs(t.token)}finally{t.dispose()}}writeKernelsToMemento(){this.writeToMementoCache(Array.from(this._kernels.values()),i5())}async listKernelSpecs(t){let i=(async()=>{let o=await this.findKernelSpecs(t);if(t.isCancellationRequested)return[];let s=Array.from(this._kernels.values()).sort((u,d)=>u.id.localeCompare(d.id)),a=o.sort((u,d)=>u.id.localeCompare(d.id)),l=new Set(o.map(u=>u.id)),c=s.filter(u=>!l.has(u.id));return o.forEach(u=>this._kernels.set(u.id,u)),c.length&&(p.debug(`Local kernel spec connection deleted ${c.map(u=>`${u.kind}:'${u.id}'`)}`),c.forEach(u=>this._kernels.delete(u.id))),(s.length!==a.length||c.length||JSON.stringify(s)!==JSON.stringify(a))&&(this._onDidChangeKernels.fire(),this.writeKernelsToMemento()),o})();return this.promiseMonitor.push(i),i}async findKernelSpecs(t){let r=await this.jupyterPaths.getKernelSpecRootPaths(t);if(t.isCancellationRequested)return[];let i=await Promise.all(r.map(l=>this.kernelSpecFinder.findKernelSpecsInPaths(l,t)));if(t.isCancellationRequested)return[];let o=new Set,s=[],a=new Map;return await Promise.all(i.flat().map(async l=>{try{let c=await this.kernelSpecFinder.loadKernelSpec(l,t);if(!c||t.isCancellationRequested)return;if(o_(c,"local"),c.metadata?.originalSpecFile){if(o.has(c.metadata.originalSpecFile))return;o.add(c.metadata.originalSpecFile)}if(c.specFile){if(o.has(c.specFile))return;o.add(c.specFile)}let u=a.get(c.display_name),d=pd.create({kernelSpec:c,interpreter:void 0,id:xi(c)});u&&u.executable!==c.executable?(s.push(d),Xs(d,this._kernels.get(d.id))||(this._kernels.set(d.id,d),this._onDidChangeKernels.fire(),this.writeKernelsToMemento())):u?p.warn(`Duplicate kernel found ${c.display_name} ${c.executable} in ${c.specFile}`):(s.push(d),a.set(c.display_name,c),Xs(d,this._kernels.get(d.id))||(this._kernels.set(d.id,d),this._onDidChangeKernels.fire(),this.writeKernelsToMemento()))}catch(c){p.error(`Failed to load kernelSpec for ${l}`,c);return}})),s}};v([Sv(100)],Xo.prototype,"writeKernelsToMemento",1),Xo=v([(0,Ea.injectable)(),m(0,(0,Ea.inject)(dr)),m(1,(0,Ea.inject)(Lr)),m(2,(0,Ea.inject)($e)),m(3,(0,Ea.inject)(Le)),m(3,(0,Ea.named)(ut)),m(4,(0,Ea.inject)(M)),m(5,(0,Ea.inject)(Tl))],Xo);var Po=k(N()),o5=require("vscode");var sp=Symbol("ITrustedKernelPaths");var Gn=require("vscode");function RO(){return`LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2023_3:${Gn.env.appHost}:${Gn.env.remoteName||""}`}async function ide(n,e,t,r,i){let o=await oa(n);if(!o){p.warn(`Failed to get sysPrefix for interpreter ${jt(n.id)}`);return}let s=Gn.Uri.file(We(o,p7)),a=await t.getKernelSpecRootPaths(e);if(e.isCancellationRequested||a.some(d=>yi(d,s)))return;let l=await r.findKernelSpecsInPaths(s,e);if(e.isCancellationRequested)return;let c=new Set,u=new Map;await Promise.all(l.map(async d=>{try{let f=await r.loadKernelSpec(d,e,n);if(e.isCancellationRequested||!f)return;if(f.metadata?.originalSpecFile){if(c.has(f.metadata.originalSpecFile))return;c.add(f.metadata.originalSpecFile)}if(f.specFile){if(c.has(f.specFile))return;c.add(f.specFile)}let g=u.get(f.display_name);g&&g.executable!==f.executable?i.fire(f):g||(u.set(f.display_name,f),i.fire(f))}catch(f){p.error(`Failed to load kernel spec ${d}`,f)}}))}var N_=class extends $t{constructor(t,r,i,o,s){super();this.interpreter=t;this.interpreterService=r;this.jupyterPaths=i;this.extensionChecker=o;this.kernelSpecFinder=s;this.cancelToken=new Gn.CancellationTokenSource;this._kernels=new Map;this._onDidChangeKernels=this._register(new Gn.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this.lastKnownInterpreterVersion=Ji(t),this.lastKnownInterpreterSysPrefix=Th(t),this.lastKnownEnvFolder=lr(t)?.environment?.folderUri,this._register({dispose:()=>this.cancelToken.cancel()}),this._register(this.cancelToken),this._register(this.interpreterService.onDidChangeInterpreter(this.clearCacheWhenInterpretersChange,this)),this._register(this.interpreterService.onDidChangeInterpreters(this.clearCacheWhenInterpretersChange,this))}async listKernelSpecs(t){return this.extensionChecker.isPythonExtensionInstalled?!t&&this.kernelSpecPromise?this.kernelSpecPromise:(this.cancelToken.cancel(),this.cancelToken.dispose(),this.cancelToken=this._register(new Gn.CancellationTokenSource),this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise.then(()=>{switch(this._kernels.size){case 0:p.trace(`No Kernels found in interpreter ${this.interpreter.id}`);break;case 1:break;default:p.trace(`Kernels for interpreter ${this.interpreter.id} are ${Array.from(this._kernels.keys()).join(", ")}`)}}),this.kernelSpecPromise):[]}clearCacheWhenInterpretersChange(){let t=lr({id:this.interpreter.id});if(!t)return;let r=Ji(t),i=Th(t);(this.lastKnownEnvFolder?.fsPath!==t.environment?.folderUri?.fsPath||this.lastKnownInterpreterVersion?.sysVersion!==r?.sysVersion||Ve(this.interpreter)!==Ve(t)||this.lastKnownInterpreterSysPrefix!==i)&&(this.lastKnownInterpreterVersion=r,this.lastKnownInterpreterSysPrefix=i,this.listKernelSpecs(!0).catch(h))}async listKernelSpecsImpl(){let t=this.cancelToken.token;if(!Th(this.interpreter))return;p.trace(`Search for KernelSpecs in Interpreter ${jt(this.interpreter.uri)}`);let i=new Map,o=new Gn.EventEmitter,s=o.event(f=>{if(t.isCancellationRequested)return;if(f.language===ge&&(!f.env||Object.keys(f.env).length===0)&&bC(f)){p.trace(`Hiding default KernelSpec ${jt(f.argv[0])} for interpreter ${jt(f.interpreterPath)} (KernelSpec file ${jt(f.specFile)})`);return}let g=qm(f)?Oo.create({kernelSpec:f,interpreter:this.interpreter,id:xi(f,this.interpreter)}):pd.create({kernelSpec:f,interpreter:this.interpreter,id:xi(f,this.interpreter)});g&&!this._kernels.has(g.id)&&(this._kernels.set(g.id,g),this._onDidChangeKernels.fire({added:[g],removed:[]})),g&&!i.has(g.id)&&i.set(g.id,g)}),[a]=await Promise.all([this.jupyterPaths.getKernelSpecTempRegistrationFolder(),ide(this.interpreter,t,this.jupyterPaths,this.kernelSpecFinder,o)]);if(o.dispose(),s.dispose(),t.isCancellationRequested)return;let c=await ws(this.interpreter,a);if(t.isCancellationRequested)return;let u=Oo.create({kernelSpec:c,interpreter:this.interpreter,id:xi(c,this.interpreter)});this._kernels.has(u.id)||(this._kernels.set(u.id,u),this._onDidChangeKernels.fire({added:[u],removed:[]})),i.has(u.id)||i.set(u.id,u);let d=Array.from(this._kernels.keys()).filter(f=>!i.has(f)).map(f=>this._kernels.get(f));d.forEach(f=>this._kernels.delete(f.id)),this._onDidChangeKernels.fire({added:[],removed:d})}},M_=class n{constructor(e,t,r,i){this.interpreterService=e;this.kernelSpecsFromKnownLocations=t;this.extensionChecker=r;this.trustedKernels=i;this.kernelsPerInterpreter=new Map;this.disposables=[];this.cancelToken=new Gn.CancellationTokenSource;this.lastKnownGlobalPythonKernelSpecs=[];t.onDidChangeKernels(()=>{let o=this.lastKnownGlobalPythonKernelSpecs,s=this.listGlobalPythonKernelSpecs();if(o.length!==s.length||!Xs(o,s)){this.kernelSpecPromise=void 0;return}})}static{this.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo=new Set}dispose(){z(this.disposables),this.cancelToken.dispose()}async listKernelSpecs(e){return this.extensionChecker.isPythonExtensionInstalled?!e&&this.kernelSpecPromise?this.kernelSpecPromise:(this.clear(),this.cancelToken=new Gn.CancellationTokenSource,this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise):[]}clear(){this.kernelsPerInterpreter.clear(),this.cancelToken.cancel(),this.cancelToken.dispose(),this.kernelSpecPromise=void 0}async findMatchingInterpreter(e,t,r){let i=this.extensionChecker.isPythonExtensionInstalled?oo():[],o=e&&Array.isArray(e.argv)&&e.argv.length>0?e.argv[0]:void 0,s=e.language||"",a=e.specFile?await ct(e.specFile):"",l=!!Rn(e);if(e.language&&e.language!==ge){!l&&o&&e.specFile&&VD(o)&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:Se(o)!==o,argv0:Se(o),language:s,isCreatedByUs:l});return}let c=i.find(u=>e.metadata?.interpreter?.path&&Ko(Gn.Uri.file(e.metadata.interpreter.path),u.executable.uri)?(p.trace(`Kernel ${e.name} matches ${jt(u.id)} based on metadata.interpreter.`),!0):!1);if(c)return wi(c);if(o&&Se(o)===o&&e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!1,argv0:Se(o),language:s,isCreatedByUs:l}),o&&Se(o)!==o){let u=Gn.Uri.file(o),d=i.find(f=>Ko(u,f.executable.uri)?(p.trace(`Kernel ${e.name} matches ${jt(f.id)} based on argv.`),!0):!1);if(d)return e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Se(o),pythonEnvFound:"found",language:s,isCreatedByUs:l}),wi(d);if(!e.specFile||this.trustedKernels.isTrusted(Gn.Uri.file(e.specFile))){let f=await this.interpreterService.getInterpreterDetails(u,r);if(r?.isCancellationRequested)return;if(f)return e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Se(o),pythonEnvFound:"foundViaGetEnvDetails",language:s,isCreatedByUs:l}),f;e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Se(o),pythonEnvFound:"notFound",language:s,isCreatedByUs:l})}else e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Se(o),pythonEnvFound:"notTrusted",language:s,isCreatedByUs:l})}if(e.interpreterPath){let u=Gn.Uri.file(e.interpreterPath),d=i.find(f=>e.interpreterPath&&Ko(u,f.executable.uri)?(p.trace(`Kernel ${e.name} matches ${jt(f.id)} based on interpreterPath.`),!0):!1);if(d)return wi(d);if(!e.specFile||this.trustedKernels.isTrusted(Gn.Uri.file(e.specFile))){let f=await this.interpreterService.getInterpreterDetails(u,r);if(f)return f}}if(!r?.isCancellationRequested)return wi(i.find(u=>e.display_name===lr(u)?.environment?.name?(p.trace(`Kernel ${e.name} matches ${jt(u.id)} based on display name`),R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:o?Se(o):"",pythonEnvFound:"matchDisplayName",language:s,isCreatedByUs:l}),!0):!1))}listGlobalPythonKernelSpecs(){return this.lastKnownGlobalPythonKernelSpecs=this.kernelSpecsFromKnownLocations.kernels.filter(e=>e.kernelSpec.language===ge)}warnAboutPythonKernelSpecWithInvalidPythonExec(e){let t=e.specFile||JSON.stringify(e);n.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.has(t)||(n.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.add(t),p.warn(`Kernel Spec for '${e.display_name}' (${jt(e.specFile)}) hidden, as we cannot find a matching interpreter argv = '${e.argv[0]}'. To resolve this, please change '${e.argv[0]}' to point to the fully qualified Python executable.`))}async listKernelSpecsImpl(){let e=this.cancelToken.token,t=this.listGlobalPythonKernelSpecs().filter(s=>!Rn(s.kernelSpec)),r=s=>{if(s.kernelSpec.language!==ge)return!1;let a=s.kernelSpec.argv.map(u=>u.toLowerCase()),l=a.indexOf("-m");if(l===-1)return!1;let c=a.length-1>=l?a[l+1]:void 0;return c?c!=="ipykernel_launcher":!1},i=new Map,o=new Set;return await Promise.all(t.filter(s=>{let a=Rn(s.kernelSpec);return!a&&(r(s)||Object.keys(s.kernelSpec.env||{}).length>0)||!a&&s.kernelSpec.language===ge&&!bC(s.kernelSpec)?!0:(p.trace(`Kernel Spec for '${s.kernelSpec.display_name}' (${jt(s.kernelSpec.specFile)}) is hidden. (isDefaultKernelSpec = ${bC(s.kernelSpec)}, language = ${s.kernelSpec.language}, registrationInfo = ${a})`),!1)}).map(async s=>{let a=await this.findMatchingInterpreter(s.kernelSpec,"startUsingLocalKernelSpec",e);if(e.isCancellationRequested)return;if(!a){let c=s.kernelSpec.argv.length?s.kernelSpec.argv[0].toLowerCase():"";if(VD(c)){this.warnAboutPythonKernelSpecWithInvalidPythonExec(s.kernelSpec);return}}let l=pd.create({kernelSpec:s.kernelSpec,interpreter:a,id:xi(s.kernelSpec,a)});i.set(l.id,l),l.kernelSpec.specFile&&o.add(l.kernelSpec.specFile)})),e.isCancellationRequested?[]:e.isCancellationRequested?[]:Array.from(i.values())}};var lu=class extends Ty{constructor(t,r,i,o,s,a,l,c,u){super(r,o,a,l,c,i);this.interpreterService=t;this.kernelSpecsFromKnownLocations=s;this._kernels=new Map;this._kernelsExcludingCachedItems=new Map;this._kernelsFromCache=[];this.cachedInformationForPythonInterpreter=new Map;this.updateCachePromise=Promise.resolve();this.discoveredKernelSpecFiles=new Set;this.lastKnownGlobalPythonKernelSpecs=[];this.interpreterKernelSpecs=new Map;this.globalPythonKernelSpecFinder=new M_(this.interpreterService,this.kernelSpecsFromKnownLocations,this.extensionChecker,u),this.disposables.push(this._onDidChangeKernels),t.onDidChangeInterpreters(()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(h)},this,this.disposables),t.onDidRemoveInterpreter(async d=>{if(await vi(1e3),lr(d))return;p.debug(`Interpreter removed ${d.id}`);let f=[];this._kernels.forEach(g=>{g.interpreter?.id===d.id&&(p.debug(`Interpreter ${d.id} deleted, hence deleting corresponding kernel ${g.kind}:'${g.id}`),f.push(g),this._kernels.delete(g.id))}),f.length&&(p.debug(`Local Python connection deleted ${f.map(g=>`${g.kind}:'${g.id}: (interpreter id=${jt(g.interpreter?.id)})'`)}`),this.updateCache().catch(h))},this,this.disposables)}activate(){this.listKernelsFirstTimeFromMemento(RO()).then(t=>{t.length&&(t.filter(r=>!this._kernels.has(r.id)).forEach(r=>{this._kernelsFromCache.push(r),this._kernels.set(r.id,r)}),this._onDidChangeKernels.fire())}).finally(async()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(h),this.kernelSpecsFromKnownLocations.onDidChangeKernels(()=>{let t=this.lastKnownGlobalPythonKernelSpecs,r=this.listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs();(t.length!==r.length||!Xs(t,r))&&(this.refreshCancellation?.cancel(),this.refreshData().catch(h))},this,this.disposables)}).catch(h)}get kernels(){return Array.from(this._kernels.values())}dispose(){z(this.disposables)}async refresh(){this.globalPythonKernelSpecFinder.clear(),this.clearCache(),this.cachedInformationForPythonInterpreter.clear(),this.discoveredKernelSpecFiles.clear(),this.interpreterService.refreshInterpreters(!0).catch(h),await this.refreshData(!0)}refreshData(t=!1){if(!t&&this.refreshCancellation&&!this.refreshCancellation.token.isCancellationRequested&&this.previousRefresh)return this.previousRefresh;this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose();let r=this.refreshCancellation=new o5.CancellationTokenSource,i=(async()=>{if(await this.listKernelsImplementation(r.token,t).catch(o=>p.error("Failure in listKernelsImplementation",o)),!r.token.isCancellationRequested){if(this.interpreterService.status==="idle"){let o=this._kernelsFromCache.filter(c=>!this._kernelsExcludingCachedItems.has(c.id)),s=[];o.length&&(p.warn(`Kernels ${o.map(c=>`${c.kind}:'${c.id}'`).join(", ")} found in cache but not discovered in current session ${Array.from(this._kernelsExcludingCachedItems.values()).map(c=>`${c.kind}:'${c.id}'`).join(", ")}`),o.forEach(c=>{this._kernels.delete(c.id),s.push(c)}));let a=new Set(oo().map(c=>c.id)),l=Array.from(this._kernels.values()).filter(c=>!!(c.interpreter&&!a.has(c.interpreter.id)));l.length&&(p.warn(`The following kernels use interpreters that are no longer valid or not recognized by Python extension, Kernels ${l.map(c=>`${c.kind}:'id=${c.id}'(interpreterId='${jt(c.interpreter?.id)}')`).join(",")} and valid interpreter ids include ${Array.from(a).join(", ")}`),l.forEach(c=>{this._kernels.delete(c.id),s.push(c)})),s.length&&(p.debug(`Local Python connection deleted ${s.map(c=>`${c.kind}:'${c.id}: (interpreter id=${jt(c.interpreter?.id)})'`)}`),await this.updateCache())}t&&(this._kernelsFromCache=[])}})().catch(o=>p.error("Failed to discover kernels in interpreters",o)).finally(()=>{r===this.refreshCancellation&&(this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose(),this.refreshCancellation=void 0)});return this.previousRefresh=i,this.promiseMonitor.push(i),i}async updateCache(){this._onDidChangeKernels.fire();let t=Array.from(this._kernels.values());return this.updateCachePromise=this.updateCachePromise.finally(()=>this.writeToMementoCache(t,RO())),this.updateCachePromise}async listKernelsImplementation(t,r){let i=this.extensionChecker.isPythonExtensionInstalled?oo():[],o=Promise.all(i.map(async a=>{let l=this.interpreterKernelSpecs.get(a.id);l||(l=new N_(wi(a),this.interpreterService,this.jupyterPaths,this.extensionChecker,this.kernelSpecFinder),this.disposables.push(l),this.interpreterKernelSpecs.set(a.id,l),l.onDidChangeKernels(c=>{c.removed.forEach(u=>this._kernels.delete(u.id)),this.appendNewKernels(c.added),!c.added.length&&c.removed.length&&this.updateCache()},this,this.disposables)),await tr(t,[],l.listKernelSpecs(r))})),s=tr(t,[],this.globalPythonKernelSpecFinder.listKernelSpecs(r)).then(a=>this.appendNewKernels(a));await Promise.all([o,s])}async appendNewKernels(t){if(t.length)return t.forEach(r=>{dt(r)&&r.kernelSpec.specFile?(this._kernelsExcludingCachedItems.set(r.id,r),this._kernels.has(r.id)?this._kernels.set(r.id,r):this._kernels.set(r.id,r)):p.warn(`Found a kernel ${r.kind}:'${r.id}', but excluded as specFile is undefined`)}),this.updateCache()}listGlobalPythonKernelSpecs(t){return this.kernelSpecsFromKnownLocations.kernels.filter(i=>i.kernelSpec.language===ge).filter(i=>t?!0:!Rn(i.kernelSpec))}listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs(){return this.lastKnownGlobalPythonKernelSpecs=this.listGlobalPythonKernelSpecs(!0)}};lu=v([(0,Po.injectable)(),m(0,(0,Po.inject)(et)),m(1,(0,Po.inject)(dr)),m(2,(0,Po.inject)(Lr)),m(3,(0,Po.inject)($e)),m(4,(0,Po.inject)(Xo)),m(5,(0,Po.inject)(Le)),m(5,(0,Po.named)(ri)),m(6,(0,Po.inject)(M)),m(7,(0,Po.inject)(Tl)),m(8,(0,Po.inject)(sp))],lu);var af=class extends Jn{constructor(t,r,i,o,s,a){super();this.nonPythonKernelFinder=t;this.pythonKernelFinder=r;this.disposables=o;this.extensionChecker=s;this.interpreters=a;this._status="idle";this._onDidChangeStatus=new DE.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new ao;this.kind="localKernelSpec";this.id="localKernelSpec";this.displayName=y.localKernelSpecs;this._onDidChangeKernels=new DE.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.wasPythonInstalledWhenFetchingControllers=!1;this.cache=[];this.disposables.push(this),i.registerKernelFinder(this),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this._onDidChangeKernels),this.disposables.push(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete&&this.interpreters.status==="idle"&&this.nonPythonKernelFinder.status==="idle"&&this.pythonKernelFinder.status==="idle"?"idle":"discovering"}),this.updateCache();let t,r=()=>{[this.nonPythonKernelFinder.status,this.pythonKernelFinder.status,this.interpreters.status==="refreshing"?"discovering":"idle"].includes("discovering")?t||(t=re(),this.promiseMonitor.push(t.promise)):(t?.resolve(),t=void 0)};r(),this.nonPythonKernelFinder.onDidChangeStatus(r,this,this.disposables),this.pythonKernelFinder.onDidChangeStatus(r,this,this.disposables),this.interpreters.onDidChangeStatus(r,this,this.disposables),this.updateCache(),this.interpreters.onDidChangeInterpreters(this.updateCache,this,this.disposables),DE.extensions.onDidChange(()=>{!this.wasPythonInstalledWhenFetchingControllers&&this.extensionChecker.isPythonExtensionInstalled&&this.updateCache()},this,this.disposables),this.nonPythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.pythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.wasPythonInstalledWhenFetchingControllers=this.extensionChecker.isPythonExtensionInstalled}async refresh(){let t=(async()=>{await this.nonPythonKernelFinder.refresh(),await this.pythonKernelFinder.refresh(),this.updateCache()})();this.promiseMonitor.push(t),await t}updateCache(){try{let t=[],r=this.nonPythonKernelFinder.kernels.filter(o=>this.extensionChecker.isPythonExtensionInstalled?o.kernelSpec.language!==ge:!0),i=this.pythonKernelFinder.kernels.filter(o=>dg(o));t=t.concat(r).concat(i),this.writeToCache(t)}catch(t){p.error("Exception Saving loaded kernels",t)}}get kernels(){let t=new Set,r=[];return this.pythonKernelFinder.kernels.forEach(i=>{let o=Rn(i.kernelSpec);i.kernelSpec.specFile&&o==="registeredByNewVersionOfExtForCustomKernelSpec"&&(t.add(i.kernelSpec.specFile),r.push(i))}),this.cache.forEach(i=>{i.kernelSpec.specFile&&t.has(i.kernelSpec.specFile)||r.push(i)}),r}writeToCache(t){let r=new Set;t=t.filter(u=>r.has(u.id)?!1:(r.add(u.id),!0));let i=this.cache,o=new Map(i.map(u=>[u.id,u])),s=new Map(t.map(u=>[u.id,u])),a=t.filter(u=>!o.has(u.id)),l=t.filter(u=>o.has(u.id)&&!Xs(u,o.get(u.id))),c=i.filter(u=>!s.has(u.id));this.cache=t,(a.length||l.length||c.length)&&this._onDidChangeKernels.fire({removed:c})}};v([Nh("List kernels failed")],af.prototype,"updateCache",1),af=v([(0,cu.injectable)(),m(0,(0,cu.inject)(Xo)),m(1,(0,cu.inject)(lu)),m(2,(0,cu.inject)(Dr)),m(3,(0,cu.inject)(M)),m(4,(0,cu.inject)($e)),m(5,(0,cu.inject)(et))],af);var Ry=k(N());var _E=require("vscode"),a5=require("os");function s5(n){let e=Ve(n);return!!(l5(n)&&(e==="Unknown"||e==="Pyenv"||e==="Conda"))}function l5(n){let e=Ji(n)?.major??3,t=Ji(n)?.minor??6;return e>=3&&t>=6}var uu=class{constructor(e,t,r){this.pythonExecutionFactory=e;this.disposableRegistry=t;this.context=r;this.messages=new Map;this.requestCounter=0}async createInterrupter(e,t){try{return await this.createInterrupterImpl(e,t)}catch(r){return p.error("Failed to create interrupter, trying again",r),this.createInterrupterImpl(e,t)}}async createInterrupterImpl(e,t){let r=await this.sendCommand({command:"INITIALIZE_INTERRUPT"},e,t);if(!r)throw p.error("Unable to initialize interrupt handle"),new Error("Unable to initialize interrupt handle");return{handle:r,interrupt:async()=>{await this.sendCommand({command:"INTERRUPT",handle:r},e,t)},dispose:()=>{this.sendCommand({command:"DISPOSE_INTERRUPT_HANDLE",handle:r},e,t).catch(i=>p.error(`Failed to dispose interrupt handle for ${e.id}`,i))}}}async getInterpreter(e){if(e&&s5(e))return e;let t=oo();return t.length===0?e:wi(t.find(s5))||wi(t.find(l5))||e}async initializeInterrupter(e,t){if(this.startupPromise)return this.startupPromise;let r=(async()=>{let i=await this.getInterpreter(e),o=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:i,resource:t}),s=_E.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers"),a=_E.Uri.joinPath(s,"kernel_interrupt_daemon.py"),l=o.execObservable([a.fsPath,"--ppid",process.pid.toString()],{cwd:s.fsPath});return await new Promise((c,u)=>{let d=!1,f=l.out.onDidChange(g=>{if(p.ci(`Output from interrupt daemon started = ${d}, output (${g.source}) = ${g.out} ('END)`),g.source==="stdout"&&g.out.trim().includes("DAEMON_STARTED:")&&!d)d=!0,c();else if(g.source==="stderr"&&g.out.includes("INTERRUPT:")&&g.out.includes("ERROR: handling command :INITIALIZE_INTERRUPT:")&&d)Ue(g.out,{trim:!0,removeEmptyEntries:!0}).filter(b=>b.includes("INTERRUPT:")).forEach(b=>{try{let I=b.split(":"),w=parseInt(I[I.indexOf("INITIALIZE_INTERRUPT")+1],10),D=this.messages.get(w);D&&(p.error(`Failed to initialize interrupt daemon for ${w}, ${g.out}`),D.deferred.reject(new Error(`Failed to start interrupt daemon ${g.out}`)),this.messages.delete(w))}catch(I){p.error(`Failed to parse interrupt daemon response, ${g.out}`,I)}});else if(g.source==="stdout"&&g.out.includes("INTERRUPT:")&&d)Ue(g.out,{trim:!0,removeEmptyEntries:!0}).filter(b=>b.includes("INTERRUPT:")).forEach(b=>{try{let[I,w,D]=b.split(":"),A=this.messages.get(parseInt(w,10));A?(p.trace(`Got a response of ${D} for ${I}:${w}`),A.deferred.resolve(D),this.messages.delete(parseInt(w,10))):p.error(`Got a response of ${D} for ${I}:${w} but no command entry found in ${g.out}`)}catch(I){p.error(`Failed to parse interrupt daemon response, ${g.out}`,I)}});else if(g.out.includes("ERROR: handling command")){if(p.warn(`Error output in interrupt daemon response ${g.out} ('END')`),!d)return u(new Error(`Interrupt daemon failed to start, ${g.out}`));try{let b=g.out.split(":")[2],I=this.messages.get(parseInt(b,10));if(I){I.deferred.reject(new Error(g.out)),this.messages.delete(parseInt(b,10));return}}catch(b){p.error(`Failed to parse interrupt daemon response, ${g.out}`,b)}}});this.disposableRegistry.push(f)}),this.disposableRegistry.push(new _E.Disposable(()=>ei(()=>l.proc?.kill()))),l.proc?.on("close",()=>{p.ci("Interrupt daemon closed"),this.startupPromise=void 0}),l.proc?.on("exit",()=>{p.ci("Interrupt daemon exited"),this.startupPromise=void 0}),l})();return r.catch(i=>p.error(`Failed to start interrupt daemon for (${e.id})`,i)),this.startupPromise=r,r}async sendCommand(e,t,r){let i=re(),o=this.requestCounter++;this.messages.set(o,{command:e,deferred:i});let s=e.command==="INITIALIZE_INTERRUPT"?`${e.command}:${o}`:`${e.command}:${o}:${e.handle}`,{proc:a}=await this.initializeInterrupter(t,r);if(!a||!a.stdin)throw p.error("No process or stdin"),new Error("No process or stdin");a.stdin.write(`${s}${a5.EOL}`),p.ci(`Sending Interrupt Request id=${o}, Command ${e.command} for ${t.id}`);let l=await i.promise;if(p.ci(`Got Interrupt Response id=${o}, Command ${e.command} for ${t.id}`),e.command==="INITIALIZE_INTERRUPT")return parseInt(l,10)}};uu=v([(0,Ry.injectable)(),m(0,(0,Ry.inject)(Fr)),m(1,(0,Ry.inject)(M)),m(2,(0,Ry.inject)(Ze))],uu);var K_=k(N());var TE=require("vscode");var Ql=class{constructor(e){this.platform=e;this.programData=process.env.PROGRAMDATA?TE.Uri.file(cn(process.env.PROGRAMDATA)):void 0}get trustedKernelSpecs(){return TE.workspace.getConfiguration("jupyter",void 0).get("kernels.trusted",[])}isTrusted(e){let t=this.isTrustedImpl(e);return!t&&!Ql.IsKernelSpecHidden.completed&&Ql.IsKernelSpecHidden.resolve(!0),t}isTrustedImpl(e){return e.scheme!=="file"||this.trustedKernelSpecs.map(t=>this.platform.isWindows?t.toLowerCase():t).map(t=>TE.Uri.file(t).path).includes(this.platform.isWindows?e.path.toLowerCase():e.path)?!0:this.platform.isWindows&&this.programData?!e.path.toLowerCase().startsWith(this.programData.path.toLowerCase()):!0}};Ql.IsKernelSpecHidden=re(),Ql=v([(0,K_.injectable)(),m(0,(0,K_.inject)(wr))],Ql);var bq=k(Jo()),es=k(N()),Iq=k(require("os"));var Sq=require("util"),Cq=k(So()),Y_=require("vscode");var VO=require("process"),iq=k(Jo()),oq=k(require("crypto")),Ly=k(require("os"));var Uy=require("vscode");var jO=k(C5());var tq="To connect another client to this kernel, use:",rq=["NOTE: When using the `ipython kernel` entry point, Ctrl-C will not work.","To exit, you will have to explicitly quit this process, by either sending",'"quit" from a client, or using Ctrl-\\ in UNIX-like environments.',"To read more about this, see https://github.com/ipython/ipython/issues/2049","It seems that frozen modules are being used, which may","make the debugger miss breakpoints. Please pass -Xfrozen_modules=off","to python to disable frozen modules","Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION"],J_=class{static async waitUntilFree(e,t,r){await(await Promise.resolve().then(()=>k(WO()))).default.waitUntilFree(e,t,r)}static async waitUntilUsed(e,t,r){await(await Promise.resolve().then(()=>k(WO()))).default.waitUntilUsed(e,t,r)}},Fy=class extends Jn{constructor(t,r,i,o,s,a,l,c,u,d,f,g,b){super();this.processExecutionFactory=t;this._connection=r;this.fileSystem=o;this.resource=s;this.extensionChecker=a;this.kernelEnvVarsService=l;this.pythonExecFactory=c;this.outputChannel=u;this.jupyterSettings=d;this.jupyterPaths=f;this.pythonKernelInterruptDaemon=g;this.platform=b;this.exitEvent=new Uy.EventEmitter;this.exitEventFired=!1;this._kernelConnectionMetadata=i}get pid(){return this._pid}get exited(){return this.exitEvent.event}get kernelConnectionMetadata(){return this._kernelConnectionMetadata}get connection(){return this._connection}get isPythonKernel(){return nt(this.kernelConnectionMetadata)&&qm(this.kernelConnectionMetadata)}get canInterrupt(){return this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"}async interrupt(){if(this.canInterrupt)if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&!this.interrupter)p.info("Interrupting kernel via SIGINT"),this._process.pid&&(await this.interruptChildProcesses(this._process.pid),(0,VO.kill)(this._process.pid,"SIGINT"));else{if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&this.interrupter&&nt(this._kernelConnectionMetadata))return p.info("Interrupting kernel via custom event (Win32)"),this.interrupter.interrupt();p.error("No process to interrupt in KernleProcess.ts")}else throw new Error("Kernel interrupt not supported in KernelProcess.ts")}async launch(t,r,i){if(this.launchedOnce)throw new Error("Kernel has already been launched.");this.launchedOnce=!0;let o=Pn(this.resource),s=o?.updateConnection();await this.updateConnectionArgs(),s?.stop(),vn.throwIfCanceled(i);let a=o?.spawn(),l=await this.launchAsObservable(t,i);a?.stop();let c=l.proc;if(i.isCancellationRequested)throw new Uy.CancellationError;p.debug(`Kernel process ${c?.pid}.`);let u="",d=null,f=re();if(f.promise.catch(h),c){let b=c.pid;c.on("exit",w=>{if(w=w||d,this.isDisposed){p.debug(`KernelProcess Exited ${b}, Exit Code - ${w}`);return}p.debug(`KernelProcess Exited ${b}, Exit Code - ${w}`,u),this.exitEventFired||(this.exitEvent.fire({exitCode:w||void 0,reason:Uh(u)||u,stderr:u}),this.exitEventFired=!0),i.isCancellationRequested||(p.ci("KernelProcessExitedError raised",u),f.reject(new Jl(w||-1,u,this.kernelConnectionMetadata)))});let I=!1;c.stdout?.on("data",w=>{let D=(w||"").toString();nt(this.kernelConnectionMetadata)&&!I&&(D=nq(D),D.includes(tq)&&(D=D.trimStart())),D.includes(tq)&&(I=!0),p.debug(`Kernel output ${b}: ${D}`),this.sendToOutput(D)}),c.stderr?.on("data",w=>{let D=nq((w||"").toString());u+=D,D.trim().length&&!D.includes("It seems that frozen modules are being used, which may")&&!D.includes("make the debugger miss breakpoints. Please pass -Xfrozen_modules=off")&&!D.includes("to python to disable frozen modules")&&!D.includes("Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION")&&(p.debug(`KernelProcess error ${b}: ${D}`),this.sendToOutput(D))})}l.out.done.catch(b=>{if(this.isDisposed){p.warn("Kernel died",b,u);return}p.error("Kernel died",b,u),f.reject(b)});let g=Pn(this.resource)?.portUsage();try{f.rejected&&await f.promise;let b=ve.instance.get(sd).inExperiment("DoNotWaitForZmqPortsToBeUsed"),I=new Fe,w=b?Promise.resolve():Promise.all([J_.waitUntilUsed(this.connection.shell_port,200,r),J_.waitUntilUsed(this.connection.iopub_port,200,r)]).catch(D=>{if(!(i.isCancellationRequested||f.rejected)&&(p.warn(`Waited ${I.elapsedTime}ms for kernel to start`,D),!b))return Promise.reject(new jv(this.kernelConnectionMetadata))});await rr(i,w,f.promise)}catch(b){let I=(u||"").trim();if(!i?.isCancellationRequested&&!er(b)&&(p.error("Disposing kernel process due to an error",b),b&&b instanceof Error&&I.length&&b.message.includes(I)||p.error(I)),await this.dispose(),!i?.isCancellationRequested&&b instanceof qe)throw b;{i?.isCancellationRequested&&p.debug("User cancelled the kernel launch");let w=WP(I)||I.substring(0,100);throw p.ci("KernelDiedError raised",w,u+`
`+u+`
`),new Qd(y.kernelDied(w),u+`
`+u+`
`,b,this.kernelConnectionMetadata)}}finally{g?.stop()}}dispose(){if(this._disposingPromise||this.isDisposed)return;let t=this._process?.pid;p.debug(`Dispose Kernel process ${t}.`),this._disposingPromise=(async()=>{await br(1e3,this.killChildProcesses(this._process?.pid).catch(h));try{this.interrupter?.dispose(),this._process?.kill(),this.exitEventFired||this.exitEvent.fire({stderr:""})}catch(r){p.error(`Error disposing kernel process ${t}`,r)}this.connectionFile&&await this.fileSystem.delete(this.connectionFile).catch(r=>p.warn(`Failed to delete connection file ${this.connectionFile} for pid ${t}`,r)),p.debug(`Disposed Kernel process ${t}.`)})(),this._disposingPromise.finally(()=>super.dispose()).catch(h)}async killChildProcesses(t){if(!(!t||!ma.isAlive(t)))try{if(this.platform.isWindows){let r=process.env.WINDIR||"C:\\Windows",i=We(r,"System32","taskkill.exe");await new ma().exec(i,["/F","/T","/PID",t.toString()])}else await new Promise(r=>{(0,jO.default)(t,(i,o)=>{i?p.warn(`Failed to kill children for ${t}`,i):o.forEach(s=>ma.kill(s)),r()})})}catch(r){p.warn(`Failed to kill children for ${t}`,r)}}async interruptChildProcesses(t){if(ma.isAlive(t))try{if(this.platform.isWindows)return;await new Promise(r=>{(0,jO.default)(t,(i,o)=>{i?p.warn(`Failed to interrupt children for ${t}`,i):o.forEach(s=>(0,VO.kill)(s,"SIGINT")),r()})})}catch(r){p.warn(`Failed to interrupt children for ${t}`,r)}}sendToOutput(t){this.outputChannel&&this.outputChannel.append(t)}get launchKernelSpec(){if(this._launchKernelSpec)return this._launchKernelSpec;let t=this._kernelConnectionMetadata.kernelSpec;if(!t)throw new Error("KernelSpec cannot be empty in KernelProcess.ts");return Array.isArray(t.argv)?this._launchKernelSpec={...t,argv:[...t.argv]}:(p.error("KernelSpec.argv in KernelProcess is undefined"),this._launchKernelSpec=void 0),this._launchKernelSpec}async updateConnectionArgs(){let t=Kj(this.launchKernelSpec);if(t===-1)throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.isPythonKernel&&t===0&&this.launchKernelSpec.argv[t-1]!=="-f")throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);let r=await this.jupyterPaths.getRuntimeDir(),i=`kernel-v3${oq.randomBytes(20).toString("hex")}.json`;if(this.connectionFile=Uy.Uri.joinPath(r,i),this.isPythonKernel)this.launchKernelSpec.argv.splice(t-1,2),this.launchKernelSpec.argv.push(...this.addPythonConnectionArgs(this.connectionFile)),await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));else{await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));let o=this.connectionFile.fsPath.includes(" ")?`"${this.connectionFile.fsPath}"`:this.connectionFile.fsPath;this.launchKernelSpec.argv[t].includes("--connection-file")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(vm,o):this.launchKernelSpec.argv[t].includes(`=${vm}`)&&!this.launchKernelSpec.argv[t].trim().startsWith("=")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(vm,o):this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(vm,this.connectionFile.fsPath)}}addPythonConnectionArgs(t){let r=[],i=t.fsPath.includes(" ")?`"${t.fsPath}"`:t.fsPath;return r.push(`--f=${i}`),r}async launchAsObservable(t,r){let i;if(p.debug(`Launching kernel ${this.kernelConnectionMetadata.id} for ${U(this.resource)} in ${U(t)} with ports ${this.connection.control_port}, ${this.connection.hb_port}, ${this.connection.iopub_port}, ${this.connection.shell_port}, ${this.connection.stdin_port}`),this.isPythonKernel&&this.extensionChecker.isPythonExtensionInstalled&&this._kernelConnectionMetadata.interpreter){let o=Pn(this.resource),[s,a,l]=[o?.pythonEnvVars(),o?.envVars(),Ly.platform()==="win32"?o?.interruptHandle():void 0],c=this.pythonExecFactory.createActivatedEnvironment({resource:this.resource,interpreter:this._kernelConnectionMetadata.interpreter}),u=Ly.platform()==="win32"?this.getWin32InterruptHandle().finally(()=>l?.stop()):l?.stop(),[d,f,g]=await Promise.all([c.finally(()=>s?.stop()),iq.pathExists(t),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this._kernelConnectionMetadata.kernelSpec,r).finally(()=>a?.stop())]);if(vn.throwIfCanceled(r),Ly.platform()==="win32"&&u){g=g||process.env;try{let I=await u;g.JPY_INTERRUPT_EVENT=`${I}`,p.ci(`Got interrupt handle kernel id ${I} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`)}catch(I){p.error(`Failed to get interrupt handle kernel id ${this._kernelConnectionMetadata.id} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`,I)}}vn.throwIfCanceled(r);let b=this.launchKernelSpec.argv.slice(1);this.jupyterSettings.enablePythonKernelLogging&&b.push("--debug"),i=d.execObservable(b,{cwd:f?t:process.cwd(),env:g}),vn.throwIfCanceled(r)}else{let o=this.launchKernelSpec.argv[0];p.info(`Launching Raw Kernel ${this.launchKernelSpec.display_name} # ${o}`);let[s,a]=await Promise.all([this.processExecutionFactory.create(this.resource,r),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this.launchKernelSpec,r)]);vn.throwIfCanceled(r);let l=this.launchKernelSpec.argv.slice(1);i=s.execObservable(o,l,{env:a,cwd:t})}if(!i.proc)throw new Error("KernelProcess failed to launch");return this._process=i.proc,this._pid=i.proc.pid,i}async getWin32InterruptHandle(){return this.interrupter||(this.interrupter=await this.pythonKernelInterruptDaemon.createInterrupter(this._kernelConnectionMetadata.interpreter,this.resource)),this.interrupter.handle}};v([cr("DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH")],Fy.prototype,"launch",1),v([m(1,od())],Fy.prototype,"launchAsObservable",1);function nq(n){let e=Ue(n,{trim:!0,removeEmptyEntries:!0});return e.some(t=>t.includes("FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0."))&&e.some(t=>t.trim()==="warn(")&&e.some(t=>t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0."))||e.some(t=>rq.some(r=>t.includes(r)))?e.filter(t=>!t.endsWith(`FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0. You can use 'hmac-sha256' instead of '"hmac-sha256"' if you require traitlets >=5.`)&&t.trim()!=="warn("&&!t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0. Use")&&rq.every(r=>!t.includes(r))).join(Ly.EOL).trimStart():n}var Npe="kernelLauncherPortStart_{0}.tmp",Us=class{constructor(e,t,r,i,o,s,a,l,c,u){this.processExecutionFactory=e;this.fs=t;this.extensionChecker=r;this.kernelEnvVarsService=i;this.disposables=o;this.pythonExecFactory=s;this.configService=a;this.jupyterPaths=l;this.pythonKernelInterruptDaemon=c;this.platformService=u}static async computeStartPort(){if(kr()){let e=9e3,t=0;for(;t===0&&e<65e3;)try{let r=We(Iq.tmpdir(),FS(Npe,e.toString()));await bq.open(r,"wx"),t=e}catch{e+=1e3}return p.trace(`Computed port start for KernelLauncher is : ${t}`),t}else return 9e3}async launch(e,t,r,i,o){Mpe(r,e,this.pythonExecFactory,o).catch(h);let s=new Fe,a=Pn(r)?.getConnection(),l=await rr(o,this.getKernelConnection(e));a?.stop();let c=r?Se(r.fsPath):"",u=this.configService.getSettings(r),d=u.logKernelOutputSeparately||u.development?Y_.window.createOutputChannel(y.kernelConsoleOutputChannel(c),"log"):void 0;d?.clear();let f=HD(l.control_port,l.hb_port,l.iopub_port,l.shell_port,l.stdin_port),g=new Fy(this.processExecutionFactory,l,e,this.fs,r,this.extensionChecker,this.kernelEnvVarsService,this.pythonExecFactory,d,u,this.jupyterPaths,this.pythonKernelInterruptDaemon,this.platformService);la(g.onDidDispose)(()=>f.dispose(),this,this.disposables),la(g.exited)(()=>d?.dispose(),this,this.disposables);try{await rr(o,g.launch(i,t,o))}catch(I){throw await g.dispose(),vn.throwIfCanceled(o),I}let b=la(g.exited)(({exitCode:I,reason:w})=>{It(r,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",I?{exitCode:I}:void 0,{exitReason:Uh(w)}),Fs.delete(l.control_port),Fs.delete(l.hb_port),Fs.delete(l.iopub_port),Fs.delete(l.shell_port),Fs.delete(l.stdin_port),b.dispose()},this,this.disposables);if(o?.isCancellationRequested)throw await g.dispose(),new Y_.CancellationError;return R("DS_INTERNAL.KERNEL_LAUNCHER_PERF",{duration:s.elapsedTime},{resourceType:$i(r)}),g}async chainGetConnectionPorts(){return this.portChain&&await this.portChain,this.portChain=this.getConnectionPorts(),this.portChain}static async findNextFreePort(e){let r=await(0,Sq.promisify)((await Promise.resolve().then(()=>k(yq()))).getPorts)(5,{host:"127.0.0.1",port:e});if(r.some(i=>Fs.has(i))){let i=Math.max(...Fs,...r);return Us.findNextFreePort(i)}return r.forEach(i=>Fs.add(i)),r}async getConnectionPorts(){let e=await Us.startPortPromise;return Us.findNextFreePort(e)}async getKernelConnection(e){let t=await this.chainGetConnectionPorts();return{key:(0,Cq.default)(),signature_scheme:"hmac-sha256",transport:"tcp",ip:"127.0.0.1",hb_port:t[0],control_port:t[1],shell_port:t[2],stdin_port:t[3],iopub_port:t[4],kernel_name:e.kernelSpec?.name||"python"}}};Us.startPortPromise=Us.computeStartPort(),Us=v([(0,es.injectable)(),m(0,(0,es.inject)(mo)),m(1,(0,es.inject)(dr)),m(2,(0,es.inject)($e)),m(3,(0,es.inject)(Ia)),m(4,(0,es.inject)(M)),m(5,(0,es.inject)(Fr)),m(6,(0,es.inject)(ie)),m(7,(0,es.inject)(Lr)),m(8,(0,es.inject)(uu)),m(9,(0,es.inject)(wr))],Us);async function Mpe(n,e,t,r){let i=e.interpreter;if(!dt(e)||!nt(e)||!i)return;let s=await(await t.createActivatedEnvironment({interpreter:i,resource:n})).exec(["-c",'import ipykernel; print(ipykernel.__version__); print("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d"); print(ipykernel.__file__)'],{token:r});if(r.isCancellationRequested)return;let a=U(i.uri);if(s.stdout){let l=s.stdout.trim().split("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d").map(c=>c.trim()).filter(c=>c.length>0);l.length===2?p.trace(`ipykernel version & path ${l[0]}, ${u3(l[1])} for ${a}`):p.trace(`ipykernel version & path ${s.stdout.trim()} for ${a}`)}if(s.stderr){let l=Ue(s.stderr.trim(),{removeEmptyEntries:!0,trim:!0}).map((c,u)=>u===0?c:`    ${c}`).join(`
`);p.warn(`Stderr output when getting ipykernel version & path ${l} for ${a}`)}}var xa=k(require("vscode"));var Jy=k(N());var Eq=require("vscode"),X_=class extends gy{constructor(t,r,i){super("localRaw",t);this.resource=r;this.kernelConnectionMetadata=i;this.shutdownInProgress=!1;this._register(new Eq.Disposable(()=>this.session.dispose())),this.initializeKernelSocket()}get status(){return this.terminatingStatus&&!this.isDisposed?this.terminatingStatus:this.isDisposed?"dead":this.session.kernel?this.session.kernel.status:(p.ci(`Real kernel is ${this.session.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.shutdown().finally(()=>super.dispose())}async waitForIdle(t,r){try{await hy(this.kernelConnectionMetadata,this.resource,this.session,t,r)}catch(i){throw p.ci("Error waiting for idle",i),await this.shutdown().catch(h),i}}async shutdown(){if(this.isDisposed||this.shutdownInProgress)return;this.shutdownInProgress=!0,this.terminatingStatus="terminating",this.statusChanged.emit("terminating");let t=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata?.id}`;p.debug(`Shutdown session ${t} - start called from ${new Error("").stack}`),fy(this.session.kernel),await br(1e3,this.session.shutdown().catch(h)),this.didShutdown.fire(),this.dispose(),p.debug(`Shutdown session ${t} - shutdown complete`)}};var Ws=k(p_()),Mq=k(So());var iT=k(So());var nT=k(xq()),Nq=k(So());var du=k(Jo());var eT=k(require("os"));var Dq=k(Jo()),zO=k(require("os"));var Lpe=["AlmaLinux","Alt","Amazon","Arch","ArchLinux","Asahi","Asahi Linux","Asianux","Alpine","Berry","BlackArch","BlackArch Linux","Cent","CentOS","Clear","Clear Linux","Clear","ClearOS","Debian","Elementary","Endeavour","EndeavourOS","Easy","EasyOS","Fedora","Fermi","Fuduntu","FreeBSD","Gecko","Gentoo","Kali","KDE","Knoppix","Kubuntu","Linux","LinuxMint","Mageia","Manjaro","Mint","Miracle","MX","MX Linux","Navy","Navy Linux","Nitrux","NixOS","openSUSE","Oracle","Pop!_OS","RasPiOS","Raspbian","Red Hat Enterprise Linux","Red Hat Linux","Red Hat","Rocks","Rocky","Rocky Linux","Rosa","Scientific","Scientific Linux","Slackware","SmartOS","SUSE","SUSE Linux","SUSE Liberty Linux","Ubuntu","VZLinux","Xubuntu","Zorin"],Upe=new RegExp(/^[0-9 .]*$/);async function _q(){let n={id:"",version_id:""};if(zO.platform()==="darwin"||zO.platform()==="win32")return n;try{let e=await Dq.readFile("/etc/os-release","utf-8");Ue(e).forEach(t=>{let r=t.toUpperCase().trim().startsWith("ID="),i=t.toUpperCase().trim().startsWith("VERSION_ID=");if(r||i){let o=t.substring(t.indexOf("=")+1).replace(/"/g,"").toUpperCase();if(r)n.id=Lpe.filter(s=>o.includes(s.toUpperCase())).join(", ");else{let s=parseFloat(o)||"";n.version_id=Upe.test(o)?o:s.toString()}}})}catch(e){p.error("Failed to read distro info",e)}return n}var Wpe="zeromq";function tT(){try{let n=require(Wpe);return n.context.blocky=!1,QO(!1).catch(h),n}catch(n){try{let e=require(We(Bo,"dist","node_modules","zeromqold"));return p.info("ZMQ loaded via fallback mechanism."),QO(!1,!0,n.message||n.toString()).catch(h),e}catch(e){throw QO(!0,!0,n.message||n.toString(),e.message||e.toString()).catch(h),p.warn("Exception while attempting zmq :",n.message||n),p.warn("Exception while attempting zmq (fallback) :",e.message||e),e}}}async function Vpe(){try{let n=We(Bo,"dist","node_modules","zeromq","prebuilds");if(!await du.pathExists(We(Bo,"dist","node_modules")))return;let e=await du.readdir(n).then(r=>r.map(async i=>{let o=We(n,i);return(await du.stat(o)).isDirectory()?du.readdir(o).then(a=>a.map(l=>We(o,l))):[]}));return(await Promise.all(e.flat())).flat().map(r=>r.substring(r.lastIndexOf("prebuilds")+9+1).replace(/\\/g,"<sep>").replace(/\//g,"<sep>"))}catch(n){return p.warn("Failed to determine local zmq binaries.",n),["Failed to determine local zmq binaries."]}}var Tq=!1;async function QO(n,e=!1,t="",r=""){if(Tq)return;Tq=!0;let[i,o]=await Promise.all([_q().catch(()=>({id:"",version_id:""})),Vpe()]),s=jpe();R("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:n,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch}),R("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:n,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch,errorMessage:t,zmqBinaries:o,fallbackErrorMessage:r})}function Rq(n){return n==="linux"&&du.existsSync("/etc/alpine-release")}function jpe(){try{let n=process.config&&process.config.variables||{},t=(process.env.npm_config_arch||"").trim()||eT.arch(),r=process.env.npm_config_platform||eT.platform(),i=Rq(r),o=process.env.LIBC||(Rq(r)?"musl":"glibc"),s=process.env.ARM_VERSION||(t==="arm64"?"8":n.arm_version)||"";return{alpine:i,libc:String(o),armv:String(s),zmqarch:t}}catch(n){return p.warn("Failed to determine platform information used to load zeromq binary.",n),{}}}function Jpe(n,e){let t=n.transport==="tcp"?":":"-",r=n[`${e}_port`];if(!r)throw new Error(`Port not found for channel "${e}"`);return`${n.transport}://${n.ip}${t}${r}`}var rT=class{constructor(e,t){this.connection=e;this.serialize=t;this.onopen=h;this.onerror=h;this.onclose=h;this.onmessage=h;this.receiveHooks=[];this.sendHooks=[];this.msgChain=Promise.resolve();this.sendChain=Promise.resolve();this.closed=!1;this.protocol="";this.channels=this.generateChannels(e)}dispose(){this.closed||this.close()}close(){this.closed=!0;let e=t=>{try{t.close()}catch(r){p.error("Error during socket shutdown",r)}};e(this.channels.control),e(this.channels.iopub),e(this.channels.shell),e(this.channels.stdin)}emit(e,...t){switch(e){case"message":this.onmessage({data:t[0],type:"message",target:this});break;case"close":this.onclose({wasClean:!0,code:0,reason:"",target:this});break;case"error":this.onerror({error:"",message:"to do",type:"error",target:this});break;case"open":this.onopen({target:this});break;default:break}return!0}send(e,t){this.sendMessage(e,!1)}addReceiveHook(e){this.receiveHooks.push(e)}removeReceiveHook(e){this.receiveHooks=this.receiveHooks.filter(t=>t!==e)}addSendHook(e){this.sendHooks.push(e)}removeSendHook(e){this.sendHooks=this.sendHooks.filter(t=>t!==e)}generateChannel(e,t,r){let i=r();return i.connect(Jpe(e,t)),this.processSocketMessages(t,i).catch(o=>p.error(`Failed to read messages from channel ${t}`,o)),i}async processSocketMessages(e,t){for await(let r of t){if(this.closed)break;this.onIncomingMessage(e,r)}}generateChannels(e){let t=tT(),r=(0,Nq.default)(),i={iopub:this.generateChannel(e,"iopub",()=>new t.Subscriber({maxMessageSize:-1,receiveHighWaterMark:0})),shell:this.generateChannel(e,"shell",()=>new t.Dealer({routingId:r,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),control:this.generateChannel(e,"control",()=>new t.Dealer({routingId:r,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),stdin:this.generateChannel(e,"stdin",()=>new t.Dealer({routingId:r,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1}))};return i.iopub.subscribe(),i}onIncomingMessage(e,t){let r=this.closed?{}:nT.decode(t,this.connection.key,this.connection.signature_scheme);r.channel=e,this.receiveHooks.length?this.msgChain=this.msgChain.then(()=>{let i=this.serialize(r);return Promise.all(this.receiveHooks.map(o=>o(i)))}).then(()=>this.fireOnMessage(r,e)):this.msgChain=this.msgChain.then(()=>this.fireOnMessage(r,e))}fireOnMessage(e,t){if(!this.closed)try{$pe(e,t),this.onmessage({data:e,type:"message",target:this})}catch(r){p.error(`Failed to handle message in Jupyter Kernel package ${JSON.stringify(e)}`,r)}}sendMessage(e,t){let r=nT.encode(e,this.connection.key,this.connection.signature_scheme);if(!t&&this.sendHooks.length){let i=this.serialize(e);this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(i,h)))).then(async()=>{try{await this.postToSocket(e.channel,r)}catch(o){p.error(`Failed to write data to the kernel channel ${e.channel}`,r,o)}})}else this.sendChain=this.sendChain.then(()=>{this.postToSocket(e.channel,r)});this.sendChain.catch(h)}postToSocket(e,t){let r=this.channels[e];r?r.send(t).catch(i=>{p.error("Error communicating with the kernel",i)}):p.error(`Attempting to send message on invalid channel: ${e}`)}},Bpe=["username","version","session","msg_id","msg_type"],Aq={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function $pe(n,e){let t=n.header;Bpe.forEach(r=>{typeof t[r]!="string"&&(t[r]="")}),typeof n.channel!="string"&&(n.channel=e),n.content||(n.content={}),n.metadata||(n.metadata={}),n.channel==="iopub"&&qpe(n)}function qpe(n){if(n.channel!=="iopub")return;let e=n.header.msg_type;if(e in Aq){let t=Aq[e];if(t===void 0)return;let r=Object.keys(t),i=n.content;for(let o=0;o<r.length;o++){let s=t[r[o]];Array.isArray(s)||(s=[s]);let a=r[o];if(!(a in i)||typeof i[a]!==s[0])switch(s[0]){case"string":i[a]="";break;case"boolean":i[a]=!1;break;case"object":i[a]={};break;case"number":i[a]=0;break}}}}var pu=k(p_()),lp=require("vscode");var YO,oT=class{constructor(e,t,r,i,o){this.resource=e;this.kernelLauncher=t;this.workingDirectory=r;this.launchTimeout=i;this.kernelConnectionMetadata=o;this.statusChanged=new pu.Signal(this);this.connectionStatusChanged=new pu.Signal(this);this.iopubMessage=new pu.Signal(this);this.unhandledMessage=new pu.Signal(this);this.anyMessage=new pu.Signal(this);this.disposed=new pu.Signal(this);this.pendingInput=new pu.Signal(this);this.id=(0,iT.default)();this.clientId=(0,iT.default)();this.username=(0,iT.default)();this.infoDeferred=re();this.name=ug(o)||"python3",this.model={name:this.name,id:this.id}}get connectionStatus(){return this.realKernel?this.realKernel.connectionStatus:"connecting"}get serverSettings(){return this.realKernel.serverSettings}get status(){return this.isDisposed||this.hasShutdown?"dead":this.isRestarting?"restarting":this.isShuttingDown?"terminating":this.realKernel?this.realKernel.status:"starting"}get info(){return this.realKernel?this.realKernel.info:this.infoDeferred.promise}get handleComms(){return this.realKernel.handleComms}get hasPendingInput(){return this.realKernel.hasPendingInput}get isDisposed(){return this._isDisposed||this.realKernel?.isDisposed===!0}async restart(){this.stopHandlingKernelMessages(),this._isDisposed=!1,this.isShuttingDown=!1,this.hasShutdown=!1,this.isRestarting=!0,this.restartToken=new lp.CancellationTokenSource;try{this.statusChanged.emit("restarting"),await this.start(this.restartToken.token)}finally{this.restartToken.dispose()}}async start(e){let t=[],r=yg(e);t.push(r);let i;try{let o=this.kernelProcess;this.kernelProcess=void 0,o?.dispose(),ei(()=>this.socket?.dispose()),ei(()=>this.realKernel?.dispose());let s=this.kernelProcess=await lt.wrapAndReportProgress(this.resource,y.connectingToKernel(ot(this.kernelConnectionMetadata)),()=>this.kernelLauncher.launch(this.kernelConnectionMetadata,this.launchTimeout,this.resource,this.workingDirectory.fsPath,e));if(e.isCancellationRequested)throw new lp.CancellationError;this.hookupKernelProcessExitHandler(s);let a=Gpe(this.kernelProcess,this.clientId,this.username,this.model);this.kernelProcess=a.kernelProcess,this.realKernel=a.realKernel,this.socket=a.socket,a.realKernel.info.then(c=>this.infoDeferred.resolve(c),c=>this.infoDeferred.reject(c)),Kt(this.kernelProcess.exited)(c=>{i=new Jl(c.exitCode||-1,c.stderr,this.kernelConnectionMetadata),r.cancel()},this,t);let l=setTimeout(()=>r.cancel(),this.launchTimeout);if(t.push({dispose:()=>clearTimeout(l)}),await lt.wrapAndReportProgress(this.resource,y.waitingForJupyterSessionToBeIdle,()=>{let c=Pn(this.resource)?.kernelReady();return Hpe(r.token,this.launchTimeout,this.resource,this.kernelConnectionMetadata,a.realKernel).finally(()=>c?.stop())}),i)throw i;if(e.isCancellationRequested)throw new lp.CancellationError;this.startHandleKernelMessages(),this.isRestarting=!1,this.statusChanged.emit(this.status)}catch(o){throw await Promise.all([this.kernelProcess?Is(this.kernelProcess):Promise.resolve(),this.realKernel?.shutdown().catch(s=>p.warn(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,s))]),i||(er(o)&&r.token.isCancellationRequested&&!e.isCancellationRequested?new jm(this.kernelConnectionMetadata):(er(o)||e.isCancellationRequested?p.debug("Starting of raw session cancelled by user"):p.error(`Failed to connect raw kernel session: ${o}`),o))}finally{z(t)}}hookupKernelProcessExitHandler(e){let t=this.exitHandler;this.exitHandler=void 0,t?.dispose(),this.exitHandler=e.exited(r=>{e!==this.kernelProcess||this.isDisposing||!this.kernelProcess||this.status==="dead"||this.status==="terminating"||(p.error(`Disposing session as kernel process died ExitCode: ${r.exitCode}, Reason: ${r.reason}`),It(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",r.exitCode?{exitCode:r.exitCode}:void 0,{exitReason:Uh(r.reason)}),this.shutdown().catch(h))},this)}dispose(){this.isDisposed||this.isDisposing||(this.isDisposing=!0,this.shutdown().finally(()=>{this._isDisposed=!0,this.disposed.emit(),pu.Signal.disconnectAll(this)}).catch(h))}async shutdown(){this.isShuttingDown||this.hasShutdown||(this.isShuttingDown=!0,this.restartToken?.cancel(),this.restartToken?.dispose(),fy(this.realKernel),await(this.kernelProcess?Is(this.kernelProcess).catch(h):Promise.resolve()),this.socket.dispose(),this.stopHandlingKernelMessages(),this.isShuttingDown=!1,this.hasShutdown=!0,this.isDisposing&&(this._isDisposed=!0),this.statusChanged.emit(this.status),this.connectionStatusChanged.emit("disconnected"))}createComm(e,t){return this.realKernel.createComm(e,t)}hasComm(e){return this.realKernel.hasComm(e)}removeInputGuard(){this.realKernel.removeInputGuard()}clone(e){return this}get spec(){if(dg(this.kernelConnectionMetadata)){let e=JSON.parse(JSON.stringify(this.kernelConnectionMetadata.kernelSpec)),t="resources"in e?e.resources:{};return{...e,resources:t}}return p.error("Fetching kernel spec from raw kernel using JLab API"),this.realKernel.spec}sendShellMessage(e,t,r){return this.realKernel.sendShellMessage(e,t,r)}sendControlMessage(e,t,r){return this.realKernel.sendControlMessage(e,t,r)}reconnect(){throw new Error("Reconnect is not supported for Local Kernels as connections cannot be lost.")}async interrupt(){if(this.kernelProcess?.canInterrupt)return this.kernelProcess?.interrupt();if(this.kernelConnectionMetadata.kernelSpec.interrupt_mode==="message"){p.info("Interrupting kernel with a shell message");let t=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"interrupt_request",channel:"shell",username:this.realKernel.username,session:this.realKernel.clientId,content:{}});await this.realKernel.sendShellMessage(t,!0,!0).done.catch(r=>p.error("Failed to interrupt via a message",r))}else p.error("Kernel interrupt not supported")}requestKernelInfo(){return this.realKernel.requestKernelInfo()}requestComplete(e){return this.realKernel.requestComplete(e)}requestInspect(e){return this.realKernel.requestInspect(e)}requestHistory(e){return this.realKernel.requestHistory(e)}requestExecute(e,t,r){return this.realKernel.requestExecute(e,t,r)}requestDebug(e,t){return this.realKernel.requestDebug(e,t)}requestIsComplete(e){return this.realKernel.requestIsComplete(e)}requestCommInfo(e){return this.realKernel.requestCommInfo(e)}sendInputReply(e,t){return this.realKernel.sendInputReply(e,t)}registerCommTarget(e,t){return this.realKernel.registerCommTarget(e,t)}removeCommTarget(e,t){return this.realKernel.removeCommTarget(e,t)}registerMessageHook(e,t){this.realKernel.registerMessageHook(e,t)}removeMessageHook(e,t){this.realKernel.removeMessageHook(e,t)}startHandleKernelMessages(){this.realKernel.anyMessage.connect(this.onAnyMessage,this),this.realKernel.iopubMessage.connect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.connect(this.onUnhandledMessage,this),this.realKernel.statusChanged.connect(this.onStatusChanged,this),this.realKernel.pendingInput.connect(this.onPendingInput,this),this.realKernel.disposed.connect(this.onDisposed,this)}stopHandlingKernelMessages(){this.realKernel.anyMessage.disconnect(this.onAnyMessage,this),this.realKernel.iopubMessage.disconnect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.realKernel.pendingInput.disconnect(this.onPendingInput,this),this.realKernel.statusChanged.disconnect(this.onStatusChanged,this),this.realKernel.disposed.disconnect(this.onDisposed,this)}onAnyMessage(e,t){this.anyMessage.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onPendingInput(e,t){this.pendingInput.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};async function Hpe(n,e,t,r,i){try{p.debug("Waiting for Raw Session to be ready in postStartRawSession"),await rr(n,zpe(i,r,e)),p.debug("Successfully waited for Raw Session to be ready in postStartRawSession")}catch(u){throw p.error("Failed waiting for Raw Session to be ready",u),er(u)||n.isCancellationRequested?new lp.CancellationError:u}p.debug(`Kernel status is '${i?.status}' before requesting kernel info and after ready`);let o=re(),s=re(),a=()=>o.resolve(!0);o.promise.catch(h),s.promise.catch(h),i.iopubMessage.connect(a);let l=()=>{let d=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"kernel_info_request",channel:"control",username:i.username,session:i.clientId,content:{}});i.sendControlMessage(d,!0,!0).done.then(()=>s.resolve(!0)).catch(h)},c=()=>{i.requestKernelInfo().then(()=>s.resolve(!0)).catch(h)};try{let u=new Fe,d=0;for(;u.elapsedTime<e*1e3;){d+=1;try{p.debug("Sending request for kernelInfo"),l(),c(),await rr(n,Promise.all([o.promise,s.promise]),vi(Math.min(e,500)).then(h))}catch(f){throw p.error("Failed to request kernel info",f),f}if(o.completed&&s.completed){p.trace("Got response for requestKernelInfo");break}else{p.trace("Did not get a response for requestKernelInfo");continue}}o.completed&&s.completed?p.debug(`Successfully completed postStartRawSession after ${d} attempt(s) in ${u.elapsedTime}ms`):p.warn(`Didn't get response for requestKernelInfo after ${d} attempt(s) in ${u.elapsedTime}ms.`),It(t,"DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",{duration:u.elapsedTime,attempts:d},{timedout:!o.completed||!s.completed})}finally{i.iopubMessage.disconnect(a)}}function Gpe(n,e,t,r){let i=require("@jupyterlab/services"),o=require("@jupyterlab/services/lib/kernel/serialize"),s;class a extends rT{constructor(){super(n.connection,o.serialize),s=this}}let l=i.ServerConnection.makeSettings({WebSocket:a,wsUrl:"RAW",serializer:{deserialize:u=>u,serialize:u=>u}});YO||(YO=require("@jupyterlab/services/lib/kernel/default"));let c=new YO.KernelConnection({serverSettings:l,clientId:e,handleComms:!0,username:t,model:r});return lp.workspace.getConfiguration("jupyter").get("enablePythonKernelLogging",!1)&&c.anyMessage.connect((u,d)=>{p.trace(`[AnyMessage Event] [${d.direction}] [${n.pid}] ${JSON.stringify(d.msg)}`)}),ci.set(c.id,s),s.emit("open"),{realKernel:c,socket:s,kernelProcess:n}}async function zpe(n,e,t){p.debug(`Waiting for Raw session to be ready, status: ${n.connectionStatus}`);let r=re(),i=(s,a)=>{a=="connected"?(p.trace("Raw session connected"),r.resolve(a)):p.trace(`Raw session not connected, status: ${a}`)};n.connectionStatusChanged.connect(i),n.connectionStatus==="connected"&&(p.trace("Raw session connected"),r.resolve(n.connectionStatus));let o=await br(t,r.promise);if(n.connectionStatusChanged.disconnect(i),p.debug(`Waited for Raw session to be ready & got status: ${o}`),o!=="connected")throw new jm(e)}var sT=class{constructor(e,t,r,i,o,s){this.resource=e;this.kernelConnectionMetadata=i;this.type=s;this.isDisposed=!1;this.statusChanged=new Ws.Signal(this);this.kernelChanged=new Ws.Signal(this);this.terminated=new Ws.Signal(this);this.iopubMessage=new Ws.Signal(this);this.unhandledMessage=new Ws.Signal(this);this.anyMessage=new Ws.Signal(this);this.disposed=new Ws.Signal(this);this.connectionStatusChanged=new Ws.Signal(this);this.pendingInput=new Ws.Signal(this);this.propertyChanged=new Ws.Signal(this);this._didShutDownOnce=!1;this.id=(0,Mq.default)(),this.name=ug(this.kernelConnectionMetadata)||"python3",this.path=this.resource?.fsPath||this.kernelConnectionMetadata.interpreter?.uri.fsPath||"kernel_path",this._kernel=new oT(e,t,r,o,i),this._kernel.statusChanged.connect(this.onKernelStatus,this),this._kernel.iopubMessage.connect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.connect(this.onUnhandledMessage,this),this._kernel.anyMessage.connect(this.onAnyMessage,this),this._kernel.disposed.connect(this.onDisposed,this),this._kernel.disposed.connect(this.onDisposed,this)}get connectionStatus(){return this._kernel?.connectionStatus||"disconnected"}get serverSettings(){return require("@jupyterlab/services").ServerConnection.makeSettings({wsUrl:"RAW"})}get model(){return{id:this.id,name:this.name,path:this.path,type:"notebook",kernel:{id:this._kernel?.id,name:this.name}}}get status(){return this.isDisposed?"dead":this.isTerminating?"terminating":this.kernel?.status??"unknown"}get kernel(){return this._kernel}async startKernel(e){await qi(this.resource,{kernelConnection:this.kernelConnectionMetadata}),await this._kernel.start(e.token)}dispose(){this._isDisposing=!0;let e=new Error().stack;It(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",void 0,{stacktrace:e});try{this._kernel.statusChanged.disconnect(this.onKernelStatus,this),this._kernel.iopubMessage.disconnect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.disconnect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this._kernel.anyMessage.disconnect(this.onAnyMessage,this),this._kernel.disposed.disconnect(this.onDisposed,this)}catch{}this.shutdown().catch(h).finally(()=>{this._kernel.dispose(),this.isDisposed=!0,this.disposed.emit(),Ws.Signal.disconnectAll(this)})}async shutdown(){this._didShutDownOnce||(this._didShutDownOnce=!0,this.isTerminating=!0,this.statusChanged.emit("terminating"),await this._kernel.shutdown().catch(e=>p.warn(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,e)),this.isTerminating=!1,this._isDisposing&&(this.isDisposed=!0),this.terminated.emit(),this.statusChanged.emit(this.status))}onKernelStatus(e,t){p.ci(`RawSession status changed to ${t}`),this.statusChanged.emit(t)}setPath(e){throw new Error("Not yet implemented")}setName(e){throw new Error("Not yet implemented")}setType(e){throw new Error("Not yet implemented")}changeKernel(e){throw new Error("Not yet implemented")}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onKernelConnectionStatus(e,t){this.connectionStatusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};var jy=class{constructor(e,t,r){this.configService=e;this.kernelLauncher=t;this.fs=r}async create(e){p.trace(`Creating raw notebook for resource '${U(e.resource)}'`);let t,r=Pn(e.resource)?.computeCwd(),[i,o]=await Promise.all([rr(e.token,nE(e.resource).then(a=>xa.Uri.file(a))),dt(e.kernelConnection)?rr(e.token,Qpe(e.resource,this.configService,this.fs).then(a=>a?xa.Uri.file(a):void 0)):void 0,rr(e.token,qi(e.resource,{kernelConnection:e.kernelConnection}))]);r?.stop();let s=this.configService.getSettings(e.resource).jupyterLaunchTimeout;t=new sT(e.resource,this.kernelLauncher,o||i,e.kernelConnection,s,(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console");try{await rr(e.token,t.startKernel(e))}catch(a){throw er(a)||e.token.isCancellationRequested?p.debug("Starting of raw session cancelled by user"):p.error(`Failed to connect raw kernel session: ${a}`),t?.shutdown().catch(l=>p.error(`Failed to dispose of raw session on launch error: ${l} `)).finally(()=>t?.dispose()).catch(h),a}return new X_(t,e.resource,e.kernelConnection)}};jy=v([(0,Jy.injectable)(),m(0,(0,Jy.inject)(ie)),m(1,(0,Jy.inject)(xD)),m(2,(0,Jy.inject)(tt))],jy);async function Qpe(n,e,t){let r=await Ype(n,e,t);if(r&&await t.exists(xa.Uri.file(r)))return r;if(n&&n.scheme!=="untitled"&&await t.exists(n)){let i=r&&r.includes("${")?r:r?Re(xa.Uri.file(r)):void 0,o=fk(i,n,e.getSettings(n));if(await t.exists(xa.Uri.file(o)))return o}}async function Ype(n,e,t){let r,i=e.getSettings(n),o=t3(i.notebookFileRoot);if(o&&xa.workspace.workspaceFolders?.length){let s=xa.Uri.file(o),a=xa.workspace.workspaceFolders[0].uri;if(zw(o))await t.exists(s)?r=s.fsPath:r=a.fsPath;else if(o.includes("${"))r=o;else{let l=xa.Uri.joinPath(a,o);await t.exists(l)?r=l.fsPath:r=a.fsPath}}return r}var aT=k(N());var By=class{constructor(e){this.configuration=e}get isSupported(){return this.isSupportedForLocalLaunch()}isSupportedForLocalLaunch(){return!this.isZQMDisabled()&&this.zmqSupported()}isZQMDisabled(){return this.configuration.getSettings().disableZMQSupport}zmqSupported(){if(typeof this._isSupported=="boolean")return this._isSupported;if((process.env.VSC_JUPYTER_NON_RAW_NATIVE_TEST||"").toLowerCase()==="true")return!1;try{tT(),this._isSupported=!0}catch{this._isSupported=!1}return this._isSupported}};By=v([(0,aT.injectable)(),m(0,(0,aT.inject)(ie))],By);var mu=k(N()),Kq=require("vscode");var yn=Symbol("IJupyterVariables"),lT=Symbol("IKernelVariableRequester"),cT=Symbol("IJupyterVariablesProvider");var uf=class{constructor(e,t,r){this.kernelVariables=t;this.debuggerVariables=r;this.refreshEventEmitter=new Kq.EventEmitter;e.push(r.refreshRequired(this.fireRefresh.bind(this))),e.push(t.refreshRequired(this.fireRefresh.bind(this)))}get refreshRequired(){return this.refreshEventEmitter.event}getAllVariableDiscriptions(e,t,r,i){return this.variableHandler.getAllVariableDiscriptions(e,t,r,i)}async getVariables(e,t){return this.variableHandler.getVariables(e,t)}async getFullVariable(e,t){return this.variableHandler.getFullVariable(e,t)}async getMatchingVariable(e,t,r){return this.variableHandler.getMatchingVariable(e,t,r)}async getDataFrameInfo(e,t,r,i){return this.variableHandler.getDataFrameInfo(e,t,r,i)}async getVariableValueSummary(e,t,r){return this.variableHandler.getVariableValueSummary(e,t,r)}async getDataFrameRows(e,t,r,i,o){return this.variableHandler.getDataFrameRows(e,t,r,i,o)}get variableHandler(){return this.debuggerVariables.active?this.debuggerVariables:this.kernelVariables}fireRefresh(){this.refreshEventEmitter.fire()}};v([cr("DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME")],uf.prototype,"getVariables",1),uf=v([(0,mu.injectable)(),m(0,(0,mu.inject)(M)),m(1,(0,mu.inject)(yn)),m(1,(0,mu.named)(Je.KERNEL_VARIABLES)),m(2,(0,mu.inject)(yn)),m(2,(0,mu.named)(Je.DEBUGGER_VARIABLES))],uf);var df=k(N());var Fq=require("vscode");var Oq=1e3*60*60*24*2,Da=class extends $t{constructor(t,r,i,o){super();this.serverStorage=r;this.context=i;this.fs=o;this.executedCells=new WeakMap;this.chainedPromises=Promise.resolve();i.globalStorageUri,t.push(this),this.storageFile=Fq.Uri.joinPath(this.context.globalStorageUri,"lastExecutedRemoteCell.json")}activate(){this._register(this.serverStorage.onDidRemove(this.onDidRemoveServers,this))}async getLastTrackedCellExecution(t,r){if(t.isUntitled||!xt(r.kernelConnectionMetadata)||!r.session?.id)return;if(this.staleState&&this.staleState[t.uri.toString()])return this.staleState[t.uri.toString()];let i=await this.getStorageFile(),o={};try{let s=await this.fs.readFile(i);o=JSON.parse(s.toString()),this.staleState=o}catch{return}return o[t.uri.toString()]}trackCellExecution(t,r){if(!xt(r.kernelConnectionMetadata)||t.document.isUntitled)return;this.executedCells.delete(t);let i=[],o=(a,l)=>{if(l.direction==="send"){let c=l.msg;if(c.header.msg_type==="execute_request"&&c.metadata&&typeof c.metadata=="object"&&c.metadata&&"cellId"in c.metadata&&typeof c.metadata.cellId=="string"&&c.metadata.cellId===t.document.uri.toString()){let u=c.header.msg_id;this.executedCells.set(t,{msg_id:u,kernelId:r.session?.kernel?.id||"",cellIndex:t.index})}}else if(l.direction==="recv"){let c=l.msg,u=this.executedCells.get(t);if(u?.msg_id&&ou(c)===u.msg_id){if(!u.startTime){u.startTime=new Date().getTime();try{u.startTime=new Date(c.header.date).getTime()}catch{}this.executedCells.set(t,u)}"execution_count"in c.content&&typeof c.content.execution_count=="number"&&!u.executionCount&&u.executionCount!==c.content.execution_count&&(u.executionCount=c.content.execution_count,this.executedCells.set(t,u),this.trackLastExecution(t,r,u),z(i))}}},s=()=>{let a=r.session;a&&(a.anyMessage.connect(o),i.push({dispose:()=>ei(()=>a.anyMessage?.disconnect(o))}))};r.onStarted(()=>s(),i),r.session&&s()}deleteTrackedCellExecution(t,r){t.notebook.isUntitled||!xt(r.kernelConnectionMetadata)||!r.session?.id||(this.chainedPromises=this.chainedPromises.finally(async()=>{let i={};try{let s=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));i=JSON.parse(s.toString())}catch{return}let o=t.notebook.uri.toString();i[o].cellIndex===t.index&&(delete i[o],this.staleState=i,await this.fs.writeFile(this.storageFile,JSON.stringify(i)))}))}getStorageFile(){return this.ensureStorageExistsPromise=this.ensureStorageExistsPromise||(async()=>(await this.fs.createDirectory(this.context.globalStorageUri),this.storageFile))(),this.ensureStorageExistsPromise}trackLastExecution(t,r,i){if(!i.executionCount||!i.msg_id||!i.startTime||!xt(r.kernelConnectionMetadata)||!r.session?.id)return;let o={cellIndex:t.index,executionCount:i.executionCount,kernelId:r.session?.kernel?.id||"",msg_id:i.msg_id,serverId:Mt(r.kernelConnectionMetadata.serverProviderHandle),sessionId:r.session?.id,startTime:i.startTime};this.chainedPromises=this.chainedPromises.finally(async()=>{let s={};try{let l=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));s=JSON.parse(l.toString())}catch{}let a=t.notebook.uri.toString();s[a]=o,this.removeOldItems(s),this.staleState=s,await this.fs.writeFile(this.storageFile,JSON.stringify(s))})}onDidRemoveServers(t){t.length!==0&&(this.chainedPromises=this.chainedPromises.finally(async()=>{await this.getStorageFile();let r={};try{let s=await this.fs.readFile(this.storageFile);r=JSON.parse(s.toString())}catch{}let i=!1,o=new Set(t.map(s=>Mt(s)));Object.keys(r).forEach(s=>{let a=r[s];(o.has(a.serverId)||Date.now()-a.startTime>Oq)&&(delete r[s],i=!0)}),i&&(this.removeOldItems(r),this.staleState=r,await this.fs.writeFile(this.storageFile,JSON.stringify(r)))}))}removeOldItems(t){Object.keys(t).forEach(r=>{let i=t[r];i&&Date.now()-i.startTime>Oq&&delete t[r]})}};Da=v([(0,df.injectable)(),m(0,(0,df.inject)(M)),m(1,(0,df.inject)(Ht)),m(2,(0,df.inject)(Ze)),m(3,(0,df.inject)(tt))],Da);var qy=k(N());var NE=require("vscode");var $y=class{constructor(e,t,r){this.serverUriStorage=e;this.registrations=t;this.disposables=r}activate(){this.disposables.push(NE.commands.registerCommand(J.ClearSavedJupyterUris,async()=>{await this.serverUriStorage.clear().catch(h),await Promise.all(this.registrations.jupyterCollections.filter(e=>e.id.startsWith("_builtin")||e.extensionId===Ae).map(async e=>{if(!e.serverProvider||!e.serverProvider.removeJupyterServer)return;let t=new NE.CancellationTokenSource,r=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await Promise.all((r||[]).map(i=>e.serverProvider.removeJupyterServer(i).catch(h)))})).catch(h),await NE.commands.executeCommand("dataScience.ClearUserProviderJupyterServerCache").then(h,h)},this))}};$y=v([(0,qy.injectable)(),m(0,(0,qy.inject)(Ht)),m(1,(0,qy.inject)(Vt)),m(2,(0,qy.inject)(M))],$y);var uT=k(N());var Hy=class{constructor(e){this.registry=e;this.priority=0}activate(){this.registry.register(this,bt),this.registry.register(this,Yt)}async getCode(e){return nt(e.kernelConnectionMetadata)?[Wj]:[]}};Hy=v([(0,uT.injectable)(),m(0,(0,uT.inject)(Rc))],Hy);function Lq(n,e){n.addSingleton(me,Lv),n.addSingleton(me,Vv),n.addSingleton(ai,By),n.addSingleton(Go,Go),n.addSingleton(DD,jy),n.addSingleton(xD,Us),n.addSingleton(Ia,Ia),n.addSingleton(Dr,Iy),n.addSingleton(me,af),n.addSingleton(me,Uv),n.addSingleton(Lr,Lr),n.addSingleton(sp,Ql),n.addSingleton(Xo,Xo),n.addBinding(Xo,me),n.addSingleton(lu,lu),n.addSingleton(me,_y),n.addSingleton(yn,uf,Je.ALL_VARIABLES),n.addSingleton(Es,np),n.addSingleton(me,nf),n.addSingleton(me,ky),n.addSingleton(me,yy),n.addSingleton(me,by),n.addSingleton(me,Dy),n.addSingleton(we,wy),n.addSingleton(hm,Py),n.addSingleton(me,$y),n.addSingleton(Da,Da),n.addBinding(Da,me),G8(n,e),Vh("isInsiderExtension",lh()?"true":"false");let t=n.get($e);Vh("isPythonExtensionInstalled",t.isPythonExtensionInstalled?"true":"false");let r=n.get(ai);Vh("rawKernelSupported",r.isSupported?"true":"false"),n.addSingleton(me,Qr),n.addSingleton(Rc,xy),n.addSingleton(uu,uu),n.addSingleton(me,Hy)}var cp=k(N()),pf=require("vscode");var Gy=class{constructor(e,t,r,i,o){this.disposables=e;this.extensionChecker=t;this.progressReporter=r;this.pythonApi=i;this.errorHandler=o}activate(){this.disposables.push(pf.commands.registerCommand(J.InstallPythonExtensionViaKernelPicker,this.installPythonExtensionViaKernelPicker,this)),this.disposables.push(pf.commands.registerCommand(J.InstallPythonViaKernelPicker,this.installPythonViaKernelPicker,this))}async installPythonViaKernelPicker(){R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.installedOnceBefore?[le.downloadAndInstall,le.reload]:[le.downloadAndInstall],t=await pf.window.showErrorMessage(y.pythonNotInstalled,{modal:!0},...e);t===le.downloadAndInstall?(this.installedOnceBefore=!0,R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"download"}),await pf.commands.executeCommand("python.installPython")):t===le.reload?(R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"reload"}),await pf.commands.executeCommand("jupyter.reloadVSCode",y.reloadRequired)):R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtensionViaKernelPicker(){if(!this.extensionChecker.isPythonExtensionInstalled){R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.progressReporter.createProgressIndicator(y.installingPythonExtension);try{await this.extensionChecker.directlyInstallPythonExtension();let t="hooked",r=await br(6e4,"timeout",this.pythonApi.pythonExtensionHooked.then(()=>t));if(this.extensionChecker.isPythonExtensionInstalled&&r===t)return p.debug("Python Extension installed via Kernel Picker command"),R("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"success"}),!0;p.error("Failed to install Python Extension via Kernel Picker command"),R("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"failed"}),this.errorHandler.handleError(new Error(y.failedToInstallPythonExtension)).then(h,h)}finally{e.dispose()}}}};Gy=v([(0,cp.injectable)(),m(0,(0,cp.inject)(M)),m(1,(0,cp.inject)($e)),m(2,(0,cp.inject)(Ho)),m(3,(0,cp.inject)(Qt)),m(4,(0,cp.inject)(Br))],Gy);var zy=k(N()),ff=require("vscode");var mf=class{constructor(e,t,r){this.disposables=e;this.controllerRegistration=t;this.preferredRemoteKernelIdProvider=r}activate(){ff.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook,this,this.disposables),ff.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebook(e))}async onDidOpenNotebook(e){if(!Pt(e))return;let t=await this.preferredRemoteKernelIdProvider.getPreferredRemoteKernelId(e);if(!t)return;let r=()=>{let o=this.controllerRegistration.getSelected(e),s=this.controllerRegistration.registered.find(a=>a.id===t);return s&&o?.id!==s.id?(this.switchKernel(e,s.connection).catch(h),!0):!1};if(r())return;let i=this.controllerRegistration.onDidChange(o=>{o.added.length&&r()&&i.dispose()},this,this.disposables);this.controllerRegistration.onControllerSelected(o=>{o.notebook===e&&i.dispose()},this,this.disposables)}async switchKernel(e,t){p.debug(`Using notebook.selectKernel to force remote kernel for ${U(e.uri)} to ${t.id}`),await ff.commands.executeCommand("notebook.selectKernel",{id:t.id,extension:Ae}),await Lw(async()=>{if(ff.window.activeNotebookEditor?.notebook===e){let i=this.controllerRegistration.getSelected(e);if(i?.connection.id===t.id)return i.restoreConnection(e).catch(h),!0}return!1},2e3,100)?p.debug(`Successfully switched remote kernel for ${U(e.uri)} to ${t.id}`):p.warn(`Failed to switch remote kernel for ${U(e.uri)} to ${t.id}`)}};v([qr()],mf.prototype,"onDidOpenNotebook",1),mf=v([(0,zy.injectable)(),m(0,(0,zy.inject)(M)),m(1,(0,zy.inject)(it)),m(2,(0,zy.inject)(Go))],mf);var Yy=k(N()),dp=require("vscode");var xo=require("vscode");function Xl(n){if(typeof n!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof n}\``);var e=Wq();let t=e;return t.default&&(t=t.default),n.replace(t(),"")}var KE=k(N()),rF=require("vscode");var eF=k(So()),tF=require("vscode");function XO(n){if(!n||!Array.isArray(n)||n.length===0)return;let e=[];for(let t=0;t<n.length;t+=1){let r=n[t];if("buffer"in r&&"byteOffset"in r){let i=Array.apply(null,new Uint8Array(r.buffer));e.push({...r,byteLength:r.byteLength,byteOffset:r.byteOffset,buffer:i})}else e.push([...new Uint8Array(r)])}return e}function ZO(n){if(!Array.isArray(n)||n.length===0)return n;let e=[];for(let t=0;t<n.length;t+=1){let r=n[t];if("buffer"in r&&"byteOffset"in r){let i=new Uint8Array(r.buffer).buffer,o=new DataView(i,r.byteOffset,r.byteLength);e.push(o)}else{let i=new Uint8Array(r).buffer;e.push(i)}}return e}var ME=new WeakMap;function Vq(n,e){let t=ME.get(n);t&&(t.targets.add(e),t.registerCommTarget(e))}function jq(n,e){ME.get(n)?.targets?.delete?.(e)}var dT=class{constructor(e,t){this.kernelProvider=e;this.document=t;this.commTargetsRegistered=new Set;this.pendingTargetNames=new Set;this._postMessageEmitter=new tF.EventEmitter;this._onDisplayMessage=new tF.EventEmitter;this.onDisplayMessage=this._onDisplayMessage.event;this.messageHooks=new Map;this.pendingHookRemovals=new Map;this.messageHookRequests=new Map;this.disposables=[];this.disposed=!1;this.pendingMessages=[];this.subscribedToKernelSocket=!1;this.waitingMessageIds=new Map;this.outputWidgetIds=new Set;this.isUsingIPyWidgets=!1;this.kernelSocketHandlers=new WeakMap;this.pendingTargetNames.add("jupyter.widget"),e.onDidStartKernel(i=>{i.notebook===t&&this.initialize()},this,this.disposables),this.mirrorSend=this.mirrorSend.bind(this),this.onKernelSocketMessage=this.onKernelSocketMessage.bind(this);let r=require("@jupyterlab/services/lib/kernel/serialize");this.deserialize=r.deserialize}get postMessage(){return this._postMessageEmitter.event}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}receiveMessage(e){switch(e.message){case"IPyWidgets_logMessage":{let t=e.payload;t.category==="error"?p.error(`Widget Error: ${t.message}`):p.trace(`Widget Message: ${t.message}`);break}case"IPyWidgets_Ready":this.sendKernelOptions(),this.initialize();break;case"IPyWidgets_msg":this.sendRawPayloadToKernelSocket(e.payload);break;case"IPyWidgets_binary_msg":this.sendRawPayloadToKernelSocket(ZO(e.payload)[0]);break;case"IPyWidgets_msg_received":this.onKernelSocketResponse(e.payload);break;case"IPyWidgets_registerCommTarget":this.registerCommTarget(e.payload);break;case"IPyWidgets_RegisterMessageHook":this.registerMessageHook(e.payload);break;case"IPyWidgets_RemoveMessageHook":this.possiblyRemoveMessageHook(e.payload);break;case"IPyWidgets_MessageHookResult":this.handleMessageHookResponse(e.payload);break;case"IPyWidgets_iopub_msg_handled":this.iopubMessageHandled(e.payload);break;default:break}}sendRawPayloadToKernelSocket(e){this.pendingMessages.push(e),this.sendPendingMessages()}registerCommTarget(e){this.pendingTargetNames.add(e),this.initialize()}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services"));let e=this.getKernel();e&&(this.subscribeToKernelSocket(e),this.registerCommTargets(e))}raisePostMessage(e,t){this._postMessageEmitter.fire({message:e,payload:t})}subscribeToKernelSocket(e){if(this.subscribedToKernelSocket||!e.session)return;this.subscribedToKernelSocket=!0,this.subscribeToKernelSocketImpl(e);let t=e.session.kernel?.id;e.session.onDidKernelSocketChange(()=>{this.subscribeToKernelSocketImpl(e,t),t=e.session?.kernel?.id||""})}subscribeToKernelSocketImpl(e,t){let r=t?ci.get(t):void 0,i=r?this.kernelSocketHandlers.get(r):void 0;if(i?.receiveHook&&r?.removeReceiveHook(i.receiveHook),i?.sendHook&&r?.removeSendHook(i.sendHook),this.kernelWasConnectedAtLeastOnce){for(;this.pendingMessages.length;)this.pendingMessages.shift();this.waitingMessageIds.forEach(l=>l.resultPromise.resolve()),this.waitingMessageIds.clear(),this.messageHookRequests.forEach(l=>l.resolve(!1)),this.messageHookRequests.clear(),this.messageHooks.clear(),this.sendRestartKernel()}if(!e.session?.kernel?.id||!ci.get(e.session?.kernel?.id))return;ME.has(e.session.kernel)||ME.set(e.session.kernel,{targets:new Set,registerCommTarget:l=>{this.raisePostMessage("IPyWidgets_registerCommTarget",l)}}),this.kernelWasConnectedAtLeastOnce=!0;let o=e.session.kernel?.id,s=o?ci.get(o):void 0,a=s?.protocol||"";if(s){let l=this.onKernelSocketMessage.bind(this,a),c=this.mirrorSend.bind(this,a);s.addReceiveHook(l),s.addSendHook(c),this.kernelSocketHandlers.set(s,{receiveHook:l,sendHook:c})}this.sendKernelOptions(a),this.registerCommTargets(e),this.sendPendingMessages(a)}sendKernelOptions(e=""){let t=this.kernel?.session?.kernel;t&&(e||(e=ci.get(t.id)?.protocol||""),this.raisePostMessage("IPyWidgets_kernelOptions",{id:t.id,clientId:t.clientId||"",userName:t.username||"",model:t.model||{id:"",name:""},protocol:e}))}async mirrorSend(e,t,r){if(typeof t=="string"&&t.includes("shell")&&t.includes("execute_request")){let i=typeof t=="string"?JSON.parse(t):this.deserialize(t);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!EE(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o}}else if(typeof t!="string")try{let i=this.deserialize(t,e);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!EE(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o}}catch(i){p.error("Failed to mirror message to kernel",i)}}sendRestartKernel(){this.raisePostMessage("IPyWidgets_onRestartKernel",void 0)}mirrorExecuteRequest(e){let t=re();return this.waitingMessageIds.set(e.header.msg_id,{startTime:Date.now(),resultPromise:t}),this.raisePostMessage("IPyWidgets_mirror_execute",{id:e.header.msg_id,msg:e}),t.promise}messageNeedsFullHandle(e){return e.channel==="iopub"&&e.header?.msg_type==="comm_msg"&&e.content?.data?.method==="update"&&this.outputWidgetIds.has(e.content?.comm_id)}iopubMessageHandled(e){let t=e.id;this.fullHandleMessage&&this.fullHandleMessage.id===t&&(this.fullHandleMessage.promise.resolve(),this.fullHandleMessage=void 0)}async onKernelSocketMessage(e,t){let r=(0,eF.default)(),i=re();this.waitingMessageIds.set(r,{startTime:Date.now(),resultPromise:i});let o;if(typeof t=="string")EE(t)&&(this.raisePostMessage("IPyWidgets_msg",{id:r,data:t}),t.includes("display_data")&&(o=this.deserialize(t,e),require("@jupyterlab/services").KernelMessage.isDisplayDataMsg(o)&&this._onDisplayMessage.fire(o)));else{let a=XO([t]),l=ZO(a);console.error(a,l),this.raisePostMessage("IPyWidgets_binary_msg",{id:r,data:XO([t])})}if(typeof t!="string"||t.includes(Li)||t.includes(Je.DefaultCommTarget)||t.includes("comm_open")||t.includes("comm_close")||t.includes("comm_msg")){let a=o||this.deserialize(t,e);if(!EE(a))return;a&&a.content&&a.content.data&&(a.content.data[Li]||a.content.target_name===Je.DefaultCommTarget)&&(this.isUsingIPyWidgets=!0);let l=a.header?.msg_type==="comm_open"&&a.content?.data?.state?._model_module==="@jupyter-widgets/output"&&a.content?.data?.state?._model_name==="OutputModel",c=a.header?.msg_type==="comm_close"&&this.outputWidgetIds.has(a.content?.comm_id);l?this.outputWidgetIds.add(a.content.comm_id):c?this.outputWidgetIds.delete(a.content.comm_id):this.messageNeedsFullHandle(a)&&(this.fullHandleMessage={id:a.header.msg_id,promise:re()},await i.promise,await this.fullHandleMessage.promise.promise,this.fullHandleMessage=void 0)}}onKernelSocketResponse(e){let t=this.waitingMessageIds.get(e.id);t&&(this.waitingMessageIds.delete(e.id),t.resultPromise.resolve())}sendPendingMessages(e=""){if(this.kernel?.session?.kernel)for(e||(e=ci.get(this.kernel.session.kernel.id)?.protocol||"");this.pendingMessages.length;)try{let t=this.pendingMessages[0],r=typeof t=="string"?JSON.parse(t):this.deserialize(t,e);r.buffers?.length&&(r.buffers=r.buffers.map(i=>i instanceof DataView?i.buffer:i)),r.channel==="control"?this.kernel.session.kernel.sendControlMessage(r):this.kernel.session.kernel.sendShellMessage(r),this.pendingMessages.shift()}catch(t){p.error("Failed to send message to Kernel",t);return}}registerCommTargets(e){for(;this.pendingTargetNames.size>0;){let r=Array.from([...this.pendingTargetNames.values()]).shift();if(r){if(this.commTargetsRegistered.has(r))return;p.trace(`Registering commtarget ${r}`),this.commTargetsRegistered.add(r),this.pendingTargetNames.delete(r),e.session?.kernel&&r!==Je.DefaultCommTarget&&!ME.get(e.session.kernel)?.targets?.has(r)&&e.session.kernel.registerCommTarget(r,h)}}}getKernel(){return this.document&&!this.kernel?.session&&(this.kernel=this.kernelProvider.get(this.document),this.kernel?.onDisposed(()=>this.kernel=void 0)),this.kernel&&!this.kernelRestartHandlerAttached&&(this.kernelRestartHandlerAttached=!0,this.disposables.push(this.kernel.onRestarted(this.handleKernelRestarts,this))),this.kernel}async handleKernelRestarts(){this.disposed||this.commTargetsRegistered.size===0||!this.kernel?.session||(Array.from(this.commTargetsRegistered.keys()).forEach(e=>{this.commTargetsRegistered.delete(e),this.pendingTargetNames.add(e)}),this.subscribeToKernelSocket(this.kernel),this.registerCommTargets(this.kernel))}registerMessageHook(e){try{if(this.kernel?.session?.kernel&&!this.messageHooks.has(e)){let t=this.messageHookCallback.bind(this);this.messageHooks.set(e,t),this.kernel.session.kernel.registerMessageHook(e,t)}}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e,type:"IPyWidgets_RegisterMessageHook"})}}possiblyRemoveMessageHook(e){try{e.lastHookedMsgId?this.pendingHookRemovals.set(e.lastHookedMsgId,e.hookMsgId):this.removeMessageHook(e.hookMsgId)}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e.hookMsgId,type:"IPyWidgets_RemoveMessageHook"})}}removeMessageHook(e){if(this.kernel?.session?.kernel&&this.messageHooks.has(e)){let t=this.messageHooks.get(e);this.messageHooks.delete(e),this.kernel.session.kernel.removeMessageHook(e,t)}}async messageHookCallback(e){let t=re(),r=(0,eF.default)(),i=e.parent_header.msg_id;if(this.messageHooks.has(i)?(this.messageHookRequests.set(r,t),this.raisePostMessage("IPyWidgets_MessageHookCall",{requestId:r,parentId:i,msg:e})):t.resolve(!0),this.pendingHookRemovals.has(e.header.msg_id)){let o=this.pendingHookRemovals.get(e.header.msg_id);this.pendingHookRemovals.delete(e.header.msg_id),this.removeMessageHook(o)}return t.promise}handleMessageHookResponse(e){let t=this.messageHookRequests.get(e.requestId);t&&(this.messageHookRequests.delete(e.requestId),t.resolve(e.msgType.includes("comm")?!0:e.result))}};var nF=class{constructor(e,t){this.baseMulticaster=e;this.oldMessages=t;this._postMessageEmitter=new rF.EventEmitter;this._onDisplayMessage=new rF.EventEmitter;this.onDisplayMessage=this._onDisplayMessage.event;this.disposables=[];e.postMessage(this.raisePostMessage,this,this.disposables),e.onDisplayMessage(r=>{this._onDisplayMessage.fire(r)},this,this.disposables)}get postMessage(){return this._postMessageEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}initialize(){return this.baseMulticaster.initialize()}receiveMessage(e){this.baseMulticaster.receiveMessage(e)}raisePostMessage(e){this.oldMessages.forEach(t=>{this._postMessageEmitter.fire(t)}),this.oldMessages=[],this._postMessageEmitter.fire(e)}},_a=class{constructor(e,t){this.kernelProvider=t;this.messageDispatchers=new WeakMap;this.messagesPerNotebook=new WeakMap;this.disposed=!1;this.disposables=[];e.push(this),t.onDidDisposeKernel(this.trackDisposingOfKernels,this,e)}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}create(e){let t=this.messageDispatchers.get(e);t||(t=new dT(this.kernelProvider,e),this.messageDispatchers.set(e,t),this.disposables.push(t.postMessage(o=>this.onMessage(o,e),this)));let r=[];e&&this.messagesPerNotebook.get(e)&&(r=this.messagesPerNotebook.get(e)||[]);let i=new nF(t,r);return this.disposables.push(i),i}trackDisposingOfKernels(e){if(this.disposed)return;let t=e.notebook,r=this.messageDispatchers.get(t);this.messageDispatchers.delete(t),r?.dispose()}onMessage(e,t){t&&(this.messagesPerNotebook.set(t,this.messagesPerNotebook.get(t)||[]),(e.message==="IPyWidgets_kernelOptions"||e.message==="IPyWidgets_registerCommTarget")&&this.messagesPerNotebook.get(t).push(e))}};_a=v([(0,KE.injectable)(),m(0,(0,KE.inject)(M)),m(1,(0,KE.inject)(we))],_a);var Bq=require("vscode");var Jq=require("vscode");var Qy=class Qy extends $t{constructor(t,r,i,o,s,a){super();this.kernel=t;this.localResourceUriConverter=r;this.configurationSettings=i;this.sourceProviderFactory=o;this.isWebViewOnline=s;this.cdnScriptProvider=a;this.id="all";this.scriptProviders=this.sourceProviderFactory.getProviders(this.kernel,this.localResourceUriConverter),this.scriptProviders.forEach(l=>this._register(l)),this.monitorKernel()}get configuredScriptSources(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}static{this.trackedWidgetModuleNames=new Set}async getBaseUrl(){let t=this.scriptProviders.find(r=>r.getBaseUrl);if(t)return t.getBaseUrl()}async getWidgetScriptSources(){let t=[];return await Promise.all(this.scriptProviders.map(async r=>{r.getWidgetScriptSources&&t.push(...await r.getWidgetScriptSources())})),t}async getWidgetScriptSource(t,r){let i=await this.isWebViewOnline,o=this.scriptProviders.slice(),s={moduleName:t};for(;o.length;){let a=o.shift();if(!a)continue;let l=await a.getWidgetScriptSource(t,r,i);if(l.scriptUri){s=l;break}else p.warn(`Widget Script Source not found for ${t}@${r} from ${a.id}`)}return this.sendTelemetryForWidgetModule(t,r,"",s.source).catch(h),s.scriptUri?p.trace(`Script source for Widget ${t}@${r} was found from source ${s.source} and ${s.scriptUri}`):p.error(`Script source for Widget ${t}@${r} not found in ${this.scriptProviders.map(a=>a.id).join(", ")}`),s}async sendTelemetryForWidgetModule(t,r,i,o){let s=`${t}.${t}@${r}`;if(Qy.trackedWidgetModuleNames.has(s))return;Qy.trackedWidgetModuleNames.add(s);let a=t.toLowerCase().startsWith("@jupyter-widgets"),l=o==="cdn"||a||await this.cdnScriptProvider.isOnCDN(t),c=l?t.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0,u=l?i.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0;R("DS_INTERNAL.IPYWIDGET_USED_BY_USER",void 0,{hashedName:await ct(t),moduleName:c,modelName:u,source:o,moduleVersion:l?r:void 0,cdnSearched:this.configuredScriptSources.length>0})}monitorKernel(){this.hookKernelEvents(),this._register(this.kernel.onStarted(this.hookKernelEvents,this)),this._register(this.kernel.onRestarted(this.hookKernelEvents,this)),this._register(this.kernel.onDidKernelSocketChange(()=>this.hookKernelEvents(),this))}hookKernelEvents(){let t=this.kernel.session?.kernel;t&&(t.anyMessage.connect(this.onAnyMessage,this),this._register(new Jq.Disposable(()=>t.anyMessage.disconnect(this.onAnyMessage,this))))}onAnyMessage(t,r){if(r.direction==="recv"&&r.msg.header.msg_type==="comm_open"){let o=r.msg.content.data;o.state?._model_module&&o.state._model_name&&this.sendTelemetryForWidgetModule(o.state?._model_module,o.state?._model_module_version||"",o.state?._model_name).catch(h)}}};v([qr()],Qy.prototype,"sendTelemetryForWidgetModule",1),v([qr()],Qy.prototype,"onAnyMessage",1);var mT=Qy;var fT=class{constructor(e,t){this.isWebExtension=e;this.converter=t}async asWebviewUri(e){return this.isWebExtension?e:this.converter(e)}};var hT=class{constructor(e,t,r,i,o,s){this.document=e;this.kernelProvider=t;this.configurationSettings=i;this.sourceProviderFactory=o;this.cdnScriptProvider=s;this.postEmitter=new Bq.EventEmitter;this.disposables=[];this.isWebViewOnline=re();this.widgetSources=new Map;this.pendingModuleRequests=new Map;this.uriTranslationRequests=new fo;this.uriConverter=new fT(Mr(),a=>(this.uriTranslationRequests.has(a)||this.uriTranslationRequests.set(a,re()),this.postEmitter.fire({message:"ConvertUriForUseInWebViewRequest",payload:a}),this.uriTranslationRequests.get(a).promise)),this.isWebViewOnline.promise.catch(h),r.push(this),this.kernelProvider.onDidStartKernel(a=>{a.notebook===this.document&&this.initialize()},this,this.disposables)}get postMessage(){return this.postEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}onMessage(e,t){if(e==="ConvertUriForUseInWebViewResponse"){let r=t;r&&this.uriTranslationRequests.has(r.request)&&this.uriTranslationRequests.get(r.request).resolve(r.response)}else if(e==="IPyWidgets_Ready")this.sendBaseUrl(),this.sendWidgetScriptSources().catch(h);else if(e==="IPyWidgets_IsOnline"){let r=t.isOnline;this.isWebViewOnline.resolve(r)}else e==="IPyWidgets_WidgetScriptSourceRequest"&&t&&this.onRequestWidgetScript(t).catch(h)}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services")),this.kernel||(this.kernel=this.kernelProvider.get(this.document)),this.kernel?.session&&(this.scriptProvider&&!this.scriptProvider.isDisposed||(this.scriptProvider=new mT(this.kernel,this.uriConverter,this.configurationSettings,this.sourceProviderFactory,this.isWebViewOnline.promise,this.cdnScriptProvider),this.kernel.onDisposed(()=>this.dispose()),this.handlePendingRequests(),this.sendBaseUrl(),p.trace("IPyWidgetScriptSource.initialize")))}sendBaseUrl(){this.scriptProvider&&this.scriptProvider.getBaseUrl().then(e=>{e&&this.postEmitter.fire({message:"IPyWidgets_BaseUrl_Response",payload:e.toString()})}).catch(e=>p.error("Failed to get baseUrl",e))}async sendWidgetScriptSources(){if(this.scriptProvider&&!this.allWidgetScriptsSent)try{(await this.scriptProvider.getWidgetScriptSources()).forEach(t=>{this.widgetSources.get(t.moduleName)?.source!=="cdn"&&this.widgetSources.set(t.moduleName,t),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:t})})}catch(e){p.warn("Failed to fetch script sources",e)}finally{this.allWidgetScriptsSent=!0}}async onRequestWidgetScript(e){let{moduleName:t,moduleVersion:r,requestId:i}=e;if(p.trace(`\x1B[32mFetch Script for ${JSON.stringify(e)}`),await this.sendWidgetSource(t,r,i).catch(o=>p.error("Failed to send widget sources upon ready",o)),this.scriptProvider&&!this.allWidgetScriptsSent)try{await this.sendWidgetScriptSources()}finally{this.sendWidgetSource(t,r,i).catch(o=>p.error("Failed to send widget sources upon ready",o))}}async sendWidgetSource(e,t="*",r){if(!e||e.startsWith("@jupyter"))return;if(!this.kernel||!this.scriptProvider){this.pendingModuleRequests.set(e,{moduleVersion:t,requestId:r});return}let i={moduleName:e,requestId:r};try{p.trace(`\x1B[32mFetch Script for ${e}`),i=await this.scriptProvider.getWidgetScriptSource(e,t),this.widgetSources.get(i.moduleName)?.source!=="cdn"&&this.widgetSources.set(i.moduleName,i)}catch(o){p.error("Failed to get widget source due to an error",o),R("DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED")}finally{p.trace(`\x1B[32mScript for ${e}, is ${i.scriptUri} from ${i.source}`),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:i})}}handlePendingRequests(){let e=Array.from(this.pendingModuleRequests.keys());for(;e.length;){let t=e.shift();if(t){let{moduleVersion:r,requestId:i}=this.pendingModuleRequests.get(t);this.pendingModuleRequests.delete(t),this.sendWidgetSource(t,r,i).catch(o=>p.error(`Failed to send WidgetScript for ${t}`,o))}}}};var vT=Symbol("IWidgetScriptSourceProviderFactory"),yT=Symbol("INbExtensionsPathProvider"),bT=Symbol("IIPyWidgetScriptManagerFactory"),Vrt=Symbol("IIPyWidgetScriptManager");var hf=k(N()),ko=require("vscode");var Hq="https://unpkg.com/",oF="https://cdn.jsdelivr.net/npm/",IT="IPYWidgetCDNConfigured",$q="IPYWidgetNotFoundOnCDN",qq="IPYWidgetNoNetWorkAccess";function Zpe(n,e,t){let r=e,i="index",o=e.indexOf("/");return o!==-1&&e[0]==="@"&&(o=e.indexOf("/",o+1)),o!==-1&&(i=e.substr(o+1),r=e.substr(0,o)),n===oF&&(t.startsWith("^")&&(t=t.slice(1)),i.endsWith(".js")||(i=i.concat(".js"))),`${n}${r}@${t}/dist/${i}`}function eme(n){switch(n){case"unpkg.com":return Hq;case"jsdelivr.com":return oF;default:break}}var Ta=class{constructor(e,t){this.globalMemento=e;this.configurationSettings=t;this.id="cdn";this.cache=new Map;this.isOnCDNCache=new Map;this.notifiedUserAboutWidgetScriptNotFound=new Set}get cdnProviders(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}dispose(){this.cache.clear()}async isOnCDN(e){let t=`MODULE_VERSION_ON_CDN_${e}`;if(this.isOnCDNCache.has(t))return this.isOnCDNCache.get(t);if(this.globalMemento.get(t,!1))return!0;let r=(async()=>{let i=new jl,o=Xi(i.exists(`${Hq}${e}`)),s=Xi(i.exists(`${oF}${e}`));return await Promise.race([o.promise,s.promise]),o.value||s.value?!0:(await Promise.all([o.promise,s.promise]),!!(o.value||s.value))})();return r.then(i=>{if(i)return this.globalMemento.update(t,!0)}).then(h,h),this.isOnCDNCache.set(t,r),r}async getWidgetScriptSource(e,t,r){if(r===!1)return p.ci(`Webview is offline, cannot use CDN for ${e}`),this.warnIfNoAccessToInternetFromWebView(e).catch(h),{moduleName:e};if(this.cdnProviders.length===0&&this.globalMemento.get(IT,!1))return p.ci("No CDN providers and user configured CDN"),{moduleName:e};let i=this.getModuleKey(e,t);return this.cache.get(i)||this.cache.set(i,this.getWidgetScriptSourceImplementation(e,t)),this.cache.get(i)}async generateDownloadUri(e,t,r){let i=eme(r);if(i)return Zpe(i,e,t)}getModuleKey(e,t){return`${e}${t}`}async getWidgetScriptSourceImplementation(e,t){if(p.trace(`\x1B[32mSearching for Widget Script ${e}#${t} using cdns ${this.cdnProviders.join(" ")}`),await this.configureWidgets(),this.cdnProviders.length===0)return{moduleName:e};let i=(await Promise.all(this.cdnProviders.map(o=>this.getValidUri(e,t,o)))).find(o=>o);return i?(p.trace(`\x1B[32mWidget Script ${e}#${t} found at URI: ${i}`),{moduleName:e,scriptUri:i,source:"cdn"}):(p.error(`Widget Script ${e}#${t} was not found on on any cdn`),this.handleWidgetSourceNotFound(e,t).catch(h),{moduleName:e})}async getValidUri(e,t,r){try{let i=await this.generateDownloadUri(e,t,r),o=new jl;if(i&&await o.exists(i))return i}catch{p.trace(`Failed downloading ${e}:${t} from ${r}`);return}}async warnIfNoAccessToInternetFromWebView(e){if(this.globalMemento.get(qq,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await ko.window.showWarningMessage(y.cdnWidgetScriptNotAccessibleWarningMessage(e,JSON.stringify(this.cdnProviders)),le.ok,le.doNotShowAgain,le.moreInfo)){case le.doNotShowAgain:return this.globalMemento.update(qq,!0);case le.moreInfo:return ko.env.openExternal(ko.Uri.parse("https://aka.ms/PVSCIPyWidgets"));default:}}async configureWidgets(){if(this.cdnProviders.length!==0||this.globalMemento.get(IT,!1))return;if(this.configurationPromise)return this.configurationPromise.promise;this.configurationPromise=re(),R("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN");let e=await ko.window.showInformationMessage(y.useCDNForWidgetsNoInformation,{modal:!0},le.ok,le.doNotShowAgain,le.moreInfo),t="dismissed";switch(e){case le.ok:{t="ok",await Promise.all([this.updateScriptSources(["jsdelivr.com","unpkg.com"]),this.globalMemento.update(IT,!0)]);break}case le.doNotShowAgain:{t="doNotShowAgain",await Promise.all([this.updateScriptSources([]),this.globalMemento.update(IT,!0)]);break}case le.moreInfo:{ko.env.openExternal(ko.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break}default:t=e===le.cancel?"cancel":"dismissed";break}R("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",void 0,{selection:t}),this.configurationPromise.resolve()}async updateScriptSources(e){let t="widgetScriptSources";await this.configurationSettings.updateSetting(t,e,void 0,ko.ConfigurationTarget.Global)}async handleWidgetSourceNotFound(e,t){if(this.globalMemento.get($q,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await ko.window.showWarningMessage(y.widgetScriptNotFoundOnCDNWidgetMightNotWork(e,t,JSON.stringify(this.cdnProviders)),le.ok,le.doNotShowAgain,le.reportThisIssue)){case le.doNotShowAgain:return this.globalMemento.update($q,!0);case le.reportThisIssue:return ko.env.openExternal(ko.Uri.parse("https://aka.ms/CreatePVSCDataScienceIssue"));default:}}};Ta=v([(0,hf.injectable)(),m(0,(0,hf.inject)(Le)),m(0,(0,hf.named)(ut)),m(1,(0,hf.inject)(ie))],Ta);var OE=class{constructor(e,t){this.document=e;this.serviceContainer=t;this.cachedMessages=[];this.postEmitter=new xo.EventEmitter;this.attachedWebviews=new WeakSet;this.modulesForWhichWeHaveDisplayedWidgetErrorMessage=new Set;this.queuedMessages=[];this.disposables=this.serviceContainer.get(M),this.jupyterOutput=this.serviceContainer.get(Mo,Wu),this.configService=this.serviceContainer.get(ie),this.initialize()}get postMessage(){return this.listeningToPostMessageEvent=!0,this.postEmitter.event}dispose(){this.cachedMessages=[],this.ipyWidgetMessageDispatcher?.dispose(),this.ipyWidgetScriptSource?.dispose()}attach(e){if(this.attachedWebviews.has(e))return;this.attachedWebviews.add(e),this.postMessage(i=>{if(p.ci(`\x1B[32mWidget Coordinator sent ${i.message}`),i.message==="ConvertUriForUseInWebViewRequest")this.onMessage(e,"ConvertUriForUseInWebViewResponse",{request:i.payload,response:e.asWebviewUri(i.payload)});else{if(!this.readyMessageReceived){this.queuedMessages.push({type:i.message,payload:i.payload});return}this.sendPendingWebViewMessages(e),e.postMessage({type:i.message,payload:i.payload}).then(h,h)}},this,this.disposables);let t=re(),r=async()=>{let i=new Fe;if(!t.completed){let s=[],a=this.serviceContainer.get(we),l=re();a.get(this.document)?l.resolve(a.get(this.document)):a.onDidCreateKernel(u=>{u.notebook===this.document&&l.resolve(u)},this,s);let c=await l.promise;c&&(nt(c.kernelConnectionMetadata)?c.ipywidgetsVersion?t.completed||t.resolve(c.ipywidgetsVersion):c.onIPyWidgetVersionResolved(()=>{c.ipywidgetsVersion&&(t.completed||t.resolve(c.ipywidgetsVersion),z(s))},this,s):t.completed||t.resolve(AS)),s.length&&this.disposables.push(...s)}let o=await t.promise;p.trace(`Version of IPyWidgets ${o} determined after ${i.elapsedTime/1e3}s`),e.postMessage({type:"IPyWidgets_Reply_Widget_Version",payload:o}).then(h,h)};e.onDidReceiveMessage(async i=>{p.ci(`\x1B[32mWidget Coordinator received ${i.type}`),this.onMessage(e,i.type,i.payload),i.type==="IPyWidgets_Request_Widget_Version"&&await r(),i.type==="IPyWidgets_Window_Alert"&&xo.window.showInformationMessage(i.message),i.type==="IPyWidgets_Window_Open"&&xo.env.openExternal(xo.Uri.parse(i.url)),i.type==="IPyWidgets_Ready"&&(p.trace("Web view is ready to receive widget messages"),this.readyMessageReceived=!0,this.sendPendingWebViewMessages(e))},this,this.disposables),e.postMessage({type:"IPyWidgets_IsReadyRequest",payload:void 0}).then(h,h),r().catch(h)}onMessage(e,t,r){t==="ipywidget_load_success"?this.sendLoadSucceededTelemetry(r).catch(h):t==="ipywidget_load_failure"?this.handleWidgetLoadFailure(e,r).catch(h):t==="ipywidget_widget_version_not_supported"?this.sendUnsupportedWidgetVersionFailureTelemetry(r).catch(h):t==="ipywidget_render_failure"?this.sendRenderFailureTelemetry(r):t==="ipywidget_unhandled_kernel_message"&&this.handleUnhandledMessage(r),this.getIPyWidgetMessageDispatcher().receiveMessage({message:t,payload:r}),this.getIPyWidgetScriptSource().onMessage(t,r)}sendPendingWebViewMessages(e){if(this.readyMessageReceived)for(;this.queuedMessages.length;)e.postMessage(this.queuedMessages.shift()).then(h,h)}initialize(){this.getIPyWidgetScriptSource().initialize(),this.getIPyWidgetMessageDispatcher().initialize()}async sendLoadSucceededTelemetry(e){try{R("DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",0,{moduleHash:await ct(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}async handleWidgetLoadFailure(e,t){try{let r=t.error.toString(),i=this.configService.getSettings(void 0).widgetScriptSources,o=i.length>0,s=`${t.moduleName}:${t.moduleVersion}`;if(!t.isOnline)r=y.loadClassFailedWithNoInternet(t.moduleName,t.moduleVersion),xo.window.showErrorMessage(r).then(h,h);else if(!o&&!this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.has(s)){this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.add(s);let a=le.moreInfo,l=y.enableCDNForWidgetsButton;r=y.enableCDNForWidgetsSetting(t.moduleName,t.moduleVersion),xo.window.showErrorMessage(r,{modal:!0},l,a).then(c=>{switch(c){case a:xo.env.openExternal(xo.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break;case l:this.enableCDNForWidgets(e).catch(h);break;default:break}},h)}p.error(`Widget load failure ${r}`,i,t),R("DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",0,{isOnline:t.isOnline,moduleHash:await ct(t.moduleName),moduleVersion:t.moduleVersion,timedout:t.timedout})}catch{}}async enableCDNForWidgets(e){await xo.commands.executeCommand(J.EnableLoadingWidgetsFrom3rdPartySource),await e.postMessage({type:"IPyWidgets_AttemptToDownloadFailedWidgetsAgain"})}async sendUnsupportedWidgetVersionFailureTelemetry(e){try{R("DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",0,{moduleHash:await ct(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}sendRenderFailureTelemetry(e){try{p.error("Error rendering a widget: ",e),R("DS_INTERNAL.IPYWIDGET_RENDER_FAILURE")}catch{}}handleUnhandledMessage(e){if(e.header.msg_type!=="status")try{if(e.header.msg_type==="error"){let t=e;t.content.traceback=t.content.traceback.map(Xl)}p.trace(`Unhandled widget kernel message: ${e.header.msg_type} ${e.content}`),this.jupyterOutput.appendLine(y.unhandledMessage(e.header.msg_type,JSON.stringify(e.content))),R("DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",void 0,{msg_type:e.header.msg_type})}catch{}}getIPyWidgetMessageDispatcher(){return this.ipyWidgetMessageDispatcher||(this.ipyWidgetMessageDispatcher=this.serviceContainer.get(_a).create(this.document),this.disposables.push(this.ipyWidgetMessageDispatcher.postMessage(this.cacheOrSend,this))),this.ipyWidgetMessageDispatcher}getIPyWidgetScriptSource(){return this.ipyWidgetScriptSource||(this.ipyWidgetScriptSource=new hT(this.document,this.serviceContainer.get(we),this.serviceContainer.get(M),this.serviceContainer.get(ie),this.serviceContainer.get(vT),this.serviceContainer.get(Ta)),this.disposables.push(this.ipyWidgetScriptSource.postMessage(this.cacheOrSend,this))),this.ipyWidgetScriptSource}cacheOrSend(e){if(!this.listeningToPostMessageEvent){p.ci("\x1B[32mQueuing messages (no listeners)"),this.cachedMessages.push(e);return}this.cachedMessages.forEach(t=>this.postEmitter.fire(t)),this.cachedMessages=[],this.postEmitter.fire(e)}};v([qr()],OE.prototype,"enableCDNForWidgets",1);var sF=class{constructor(e,t){this.editor=e;this.pendingMessages=[];this.disposables=[];this._onDidReceiveMessage=new dp.EventEmitter;this.changeController(t)}get controller(){if(!this._controller)throw new Error("No controller defined");return this._controller.controller}changeController(e){this._controller?.id!==e.id&&(this.controllerMessageHandler?.dispose(),this._controller=e,this.controllerMessageHandler=e.onDidReceiveMessage(t=>{t.editor===this.editor&&this.controller?.id===e.id&&(this.eventHandlerListening?(this.sendPendingMessages(),this._onDidReceiveMessage.fire(t.message)):this.pendingMessages.push(t.message))},this,this.disposables))}dispose(){z(this.disposables)}get onDidReceiveMessage(){return this.eventHandlerListening=!0,setTimeout(()=>this.sendPendingMessages(),0),this._onDidReceiveMessage.event}postMessage(e){return this.controller.postMessage(e,this.editor)}asWebviewUri(e){return this.controller.asWebviewUri(e)}sendPendingMessages(){if(this.pendingMessages.length){let e=this.pendingMessages.shift();for(;e;)this._onDidReceiveMessage.fire(e),e=this.pendingMessages.shift()}}},up=class{constructor(e,t,r){this.serviceContainer=e;this.disposableRegistry=t;this.controllerManager=r;this.messageCoordinators=new WeakMap;this.notebookDisposables=new WeakMap;this.notebookCommunications=new WeakMap;this.notebookEditors=new WeakMap}activate(){dp.window.onDidChangeVisibleNotebookEditors(this.onDidChangeVisibleNotebookEditors,this,this.disposableRegistry),dp.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebookDocument,this,this.disposableRegistry),this.controllerManager.onControllerSelected(this.onDidSelectController,this,this.disposableRegistry)}onDidSelectController(e){let t=this.messageCoordinators.get(e.notebook);t&&(this.messageCoordinators.delete(e.notebook),dp.window.visibleNotebookEditors.filter(r=>r.notebook===e.notebook).forEach(r=>{let i=this.notebookCommunications.get(r);this.notebookCommunications.delete(r),i&&i.controller!==e.controller.controller&&(this.notebookCommunications.delete(r),i&&i.dispose())}),t?.dispose()),dp.window.visibleNotebookEditors.filter(r=>r.notebook===e.notebook).forEach(r=>this.initializeNotebookCommunication(r,e.controller))}initializeNotebookCommunication(e,t){if(e.notebook.isClosed||!Pt(e.notebook))return;let r=e.notebook;if(!t){p.trace(`No controller, hence notebook communications cannot be initialized for editor ${U(e.notebook.uri)}`);return}if(this.notebookCommunications.has(e))return;let i=new sF(e,t);this.addNotebookDisposables(r,[i]),this.notebookCommunications.set(e,i);let o=this.messageCoordinators.get(r);o||(o=new OE(r,this.serviceContainer),this.messageCoordinators.set(r,o)),o.attach(i)}addNotebookDisposables(e,t){let r=this.notebookDisposables.get(e)||[];r.push(...t),this.notebookDisposables.set(e,r)}async onDidChangeVisibleNotebookEditors(e){e.forEach(t=>{let r=this.controllerManager.getSelected(t.notebook);this.initializeNotebookCommunication(t,r)})}onDidCloseNotebookDocument(e){let t=this.notebookEditors.get(e)||[];z(this.notebookDisposables.get(e)||[]),t.forEach(r=>this.notebookCommunications.get(r)?.dispose()),this.messageCoordinators.get(e)?.dispose(),this.messageCoordinators.delete(e)}};up=v([(0,Yy.injectable)(),m(0,(0,Yy.inject)(st)),m(1,(0,Yy.inject)(M)),m(2,(0,Yy.inject)(it))],up);var pp=k(N());var Xy=class{constructor(e,t,r,i,o){this.disposables=e;this.kernelProvider=t;this.controllers=r;this.liveKernelTracker=i;this.preferredRemoteKernelIdProvider=o}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.controllers.onControllerSelectionChanged(this.onNotebookControllerSelectionChanged,this,this.disposables)}onNotebookControllerSelectionChanged({selected:e,notebook:t,controller:r}){t.isClosed||(r.connection.kind==="connectToLiveRemoteKernel"&&r.connection.kernelModel.id&&(e?this.liveKernelTracker.trackKernelIdAsUsed(t.uri,r.connection.serverProviderHandle,r.connection.kernelModel.id):this.liveKernelTracker.trackKernelIdAsNotUsed(t.uri,r.connection.serverProviderHandle,r.connection.kernelModel.id)),dt(r.connection)&&this.preferredRemoteKernelIdProvider.clearPreferredRemoteKernelId(t.uri).catch(h))}onDidStartKernel(e){if(!e.resourceUri)return;let t=e.resourceUri;if(e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")return;let r=e.kernelConnectionMetadata.serverProviderHandle,i=()=>{let o=e.session?.kernel?.id;!e.disposed&&!e.disposing&&o&&(p.debug(`Updating preferred kernel for remote notebook ${o}`),this.preferredRemoteKernelIdProvider.storePreferredRemoteKernelId(t,o).catch(h),this.liveKernelTracker.trackKernelIdAsUsed(t,r,o))};i(),e.onDidKernelSocketChange(i,this,this.disposables)}};Xy=v([(0,pp.injectable)(),m(0,(0,pp.inject)(M)),m(1,(0,pp.inject)(we)),m(2,(0,pp.inject)(it)),m(3,(0,pp.inject)(Im)),m(4,(0,pp.inject)(Go))],Xy);var vf=k(N());var Gq=require("vscode");var gf=class{constructor(e,t,r,i){this.disposables=e;this.uriStorage=t;this.controllers=r;this.serverProviderRegistry=i;this.handledServerProviderChanges=new WeakSet}activate(){this.serverProviderRegistry.jupyterCollections.forEach(e=>this.checkExpiredServersInJupyterCollection(e)),this.serverProviderRegistry.onDidChangeCollections(({added:e,removed:t})=>{e.forEach(r=>this.checkExpiredServersInJupyterCollection(r)),t.forEach(r=>this.removeControllersBelongingToDisposedProvider(r.extensionId,r.id))},this,this.disposables)}async checkExpiredServersInJupyterCollection(e){!this.handledServerProviderChanges.has(e.serverProvider)&&e.serverProvider.onDidChangeServers&&(this.handledServerProviderChanges.add(e.serverProvider),e.serverProvider.onDidChangeServers(()=>this.checkExpiredServersInJupyterCollection(e).catch(h),this,this.disposables));let t=new Gq.CancellationTokenSource;this.disposables.push(t);try{let r=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await this.removeControllersAndUriStorageBelongingToInvalidServers(e.extensionId,e.id,(r||[]).map(i=>i.id))}finally{t.dispose()}}async removeControllersAndUriStorageBelongingToInvalidServers(e,t,r){let i=this.uriStorage.all;await Promise.all(i.filter(o=>o.provider.extensionId===e&&o.provider.id===t).map(async o=>{r.includes(o.provider.handle)||await this.uriStorage.remove(o.provider)})),this.controllers.registered.forEach(o=>{let s=o.connection;dt(s)||s.serverProviderHandle.extensionId!==e||s.serverProviderHandle.id!==t||r.includes(s.serverProviderHandle.handle)||(p.warn(`Deleting controller ${o.id} as it is associated with a server Id that has been removed`),o.dispose())})}removeControllersBelongingToDisposedProvider(e,t){this.controllers.registered.forEach(r=>{let i=r.connection;dt(i)||i.serverProviderHandle.extensionId!==e||i.serverProviderHandle.id!==t||(p.warn(`Deleting controller ${r.id} as it is associated with a Provider Id that has been removed`),r.dispose())})}};v([qr("Failed to check what servers were shutdown in Controller Watcher")],gf.prototype,"checkExpiredServersInJupyterCollection",1),gf=v([(0,vf.injectable)(),m(0,(0,vf.inject)(M)),m(1,(0,vf.inject)(Ht)),m(2,(0,vf.inject)(it)),m(3,(0,vf.inject)(Vt))],gf);var yf=k(N());var zq=require("vscode");var ST=class{constructor(e,t,r,i,o,s){this.label=e;this._description=t;this.detail=r;this.category=i;this.serverDisplayName=o;this.getDescription=s;this._onDidChange=new zq.EventEmitter;this.onDidChange=this._onDidChange.event}get description(){return this.getDescription?.()||this._description}set description(e){this._description=e}dispose(){this._onDidChange.dispose()}triggerChange(){this._onDidChange.fire(this)}};function Qq(n){switch(n.kind){case"connectToLiveRemoteKernel":return y.kernelCategoryForJupyterSession;case"startUsingRemoteKernelSpec":return y.kernelCategoryForRemoteJupyterKernel;default:return CT(n)}}function CT(n){switch(n.kind){case"startUsingLocalKernelSpec":return y.kernelCategoryForJupyterKernel;case"startUsingPythonInterpreter":{if(Rn(n.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return y.kernelCategoryForJupyterKernel;switch(Ve(n.interpreter)){case"Conda":return Jr(n.interpreter)?y.kernelCategoryForCondaWithoutPython:y.kernelCategoryForConda;case"PipEnv":return y.kernelCategoryForPipEnv;case"Poetry":return y.kernelCategoryForPoetry;case"Pyenv":return y.kernelCategoryForPyEnv;case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return y.kernelCategoryForVirtual;default:return y.kernelCategoryForGlobal}}default:return""}}var Zy=class{constructor(e,t,r,i){this.platform=e;this.jupyterUriProviderRegistration=t;this.disposables=r;this.interpreters=i;this.details=new Map}getDisplayData(e){if(!this.details.get(e.id)){let i=ot(e),o=xN(e,this.platform);e.kind==="connectToLiveRemoteKernel"&&(o=kN(e));let s=CT(e),a=e.kind==="connectToLiveRemoteKernel"?()=>kN(e):void 0,l=new ST(i,o,"",s,void 0,a);if(this.disposables.push(l),this.details.set(e.id,l),e.kind==="startUsingPythonInterpreter"&&Jr(e.interpreter)){let c=u=>{let d=u.find(g=>g.id===e.interpreter?.id),f=wi(oo().find(g=>g.id===d?.id));if(e.kind==="startUsingPythonInterpreter"&&f){e.updateInterpreter(f);let g=ot(e),b=xN(e,this.platform),I=CT(e),w=!1;g!==l.label&&(l.label=g,w=!0),b!==l.description&&(l.description=b,w=!0),I!==l.category&&(l.category=I,w=!0),w&&l.triggerChange()}};this.interpreters.onDidChangeInterpreter(u=>u?c([u]):void 0,this,this.disposables)}}let t=this.details.get(e.id);if(this.details.set(e.id,t),e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"){let i=Jv(e.serverProviderHandle,this.jupyterUriProviderRegistration,y.kernelDefaultRemoteDisplayName);t.serverDisplayName!==i&&(t.serverDisplayName=i,t.triggerChange())}let r=Qq(e);return t.category!==r&&(t.category=r,t.triggerChange()),t}};Zy=v([(0,yf.injectable)(),m(0,(0,yf.inject)(wr)),m(1,(0,yf.inject)(Vt)),m(2,(0,yf.inject)(M)),m(3,(0,yf.inject)(et))],Zy);var fu=k(N()),tb=require("vscode");var mp=k(N()),Zq=require("vscode");var Yq=require("vscode");function ET(n){try{return kk(lo(n))||n.getCells().find(t=>t.kind===Yq.NotebookCellKind.Code)?.document.languageId}catch(e){p.warn("Failed to determine language of first cell",e)}}var Xq="DATASCIENCE.LAST_SAVED_CELL_LANGUAGE",ts=class{constructor(e,t,r){this.disposables=e;this.globalMemento=t;this.pythonExtensionChecker=r}getPreferredLanguage(e){let t=e?.language_info?.name||e?.kernelspec?.language||this.lastSavedNotebookCellLanguage,r=this.pythonExtensionChecker.isPythonExtensionInstalled?ge:"plaintext";return yl(t||r)}activate(){Zq.workspace.onDidSaveNotebookDocument(this.onDidSaveNotebookDocument,this,this.disposables)}getSupportedLanguages(e){if(nt(e))return UU;{let t=yl(uo(e)||"");return t&&RS.includes(t.toLowerCase())?[t,"raw"]:[]}}get lastSavedNotebookCellLanguage(){return this.globalMemento.get(Xq)}async onDidSaveNotebookDocument(e){if(!Pt(e))return;let t=ET(e);t&&t!==this.lastSavedNotebookCellLanguage&&await this.globalMemento.update(Xq,t)}};v([qr("Saving last saved cell language")],ts.prototype,"onDidSaveNotebookDocument",1),ts=v([(0,mp.injectable)(),m(0,(0,mp.inject)(M)),m(1,(0,mp.inject)(Le)),m(1,(0,mp.named)(ut)),m(2,(0,mp.inject)($e))],ts);function eH(n){let e={kernelSpecCount:0,localKernelSpecCount:0,remoteKernelSpecCount:0,kernelInterpreterCount:0,kernelLiveCount:0};n.forEach(t=>{switch(t.kind){case"connectToLiveRemoteKernel":e.kernelLiveCount+=1;break;case"startUsingRemoteKernelSpec":e.localKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingLocalKernelSpec":e.remoteKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingPythonInterpreter":{e.kernelInterpreterCount+=1;break}default:break}}),R("DS_INTERNAL.KERNEL_COUNT",{...e})}var Jt=require("vscode");var Zl=require("vscode");var tH=require("vscode");async function rH(n,e){let t=e?.findNotebookEditor(n);return t?tH.commands.executeCommand("notebook.selectKernel",{notebookEditor:t}):(p.error("Unable to select kernel as the Notebook document could not be identified"),!1)}var nH=require("vscode");var wT=class extends Cl{constructor(e){super(y.failedToStartAnUntrustedKernelSpec(ot(e),e.kernelSpec.specFile?U(nH.Uri.file(e.kernelSpec.specFile)):""),void 0,e)}};var Vs=class n{static async switchController(e,t){let i=t.get(An).findNotebookEditor(e),o=t.get(it),s,a=re(),l=o.onControllerSelected(u=>a.resolve(u.controller));return await rH(e,t.get(An))&&i&&(s=await a.promise),l.dispose(),s?{controller:s.controller,metadata:s.connection}:void 0}static async notifyAndRestartDeadKernel(e){let t=await Zl.window.showErrorMessage(y.cannotRunCellKernelIsDead(ot(e.kernelConnectionMetadata)),{modal:!0},y.showJupyterLogs,y.restartKernel),r=!1;switch(t){case y.restartKernel:{await e.restart(),r=!0;break}case y.showJupyterLogs:Zl.commands.executeCommand(J.ViewJupyterOutput).then(h,h)}return r}static async handleKernelError(e,t,r,i,o,s,a,l){let c=e.get(Le,ut),u=e.get(Br);a.interpreter&&r==="start"&&Q3(c,19,a.interpreter).catch(h);let d=await u.handleKernelError(t,r,a,i,l),f=dt(a);switch(e.tryGet(ai)?.isSupported&&f&&r==="start"&&It(i,"DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",{reason:d}),o.dispose().catch(h),d){case 1:case 2:throw t;case 3:{let I=await n.switchController(i,e);if(!I)throw t;s=I.controller,a=I.metadata;break}}return{controller:s,metadata:a}}static convertContextToFunction(e,t){switch(e){case"start":case"execution":return r=>r.start(t);case"interrupt":return r=>r.interrupt();case"restart":return r=>r.restart()}}static{this.connectionsByNotebook=new WeakMap}static{this.connectionsByUri=new Map}static async verifyKernelState(e,t,r,i,o,s,a,l){let c=await i,{kernel:u,deadKernelAction:d}=c;if(P_(u)){if(this.deleteKernelInfo(t,i),d==="deadKernelWasNoRestarted")throw new ya(u.kernelConnectionMetadata);if(d==="deadKernelWasRestarted")throw new ya(u.kernelConnectionMetadata);if(l?.kernelWasRestartedDueToDeadKernel.value===!0)throw new ya(u.kernelConnectionMetadata);c.deadKernelAction="deadKernelWasRestarted";let f=re();return f.resolve(!0),l=l||{kernelWasRestartedDueToDeadKernel:f},n.wrapKernelMethod(u.kernelConnectionMetadata,"start",o,e,t,r,a,s,l)}return u}static async wrapKernelMethod(e,t,r,i,o,s,a,l=()=>void 0,c){let u=this.getKernelInfo(o);if(!s.disableUI&&u?.options.disableUI&&(u.options.disableUI=!1),!s.disableUI&&u?.kernel.resolved&&(u?.kernel.value?.kernel?.disposed||u?.kernel.value?.kernel?.disposing)&&(this.deleteKernelInfo(o),u=void 0),u&&t!=="restart"&&t!=="interrupt")return n.verifyKernelState(i,o,s,u.kernel.promise,r,l,a);p.debug(`${t} the kernel, options.disableUI=${s.disableUI} for ${U("notebook"in o?o.notebook.uri:o.resource)}`),c=c||{kernelWasRestartedDueToDeadKernel:re()};let d=n.wrapKernelMethodImpl(e,t,i,o,s,r,l,c);c?.kernelWasRestartedDueToDeadKernel.resolved&&c.kernelWasRestartedDueToDeadKernel.resolve(!0);let f=Xi(d);return f.promise.catch(h),d.then(g=>{g.kernel.onDisposed(()=>{this.deleteKernelInfo(o,f.promise)},void 0,a)}).catch(()=>{this.deleteKernelInfo(o,f.promise)}),this.setKernelInfo(o,f,s),n.verifyKernelState(i,o,s,f.promise,r,l,a,c)}static getKernelInfo(e){return"notebook"in e?n.connectionsByNotebook.get(e.notebook):n.connectionsByUri.get(e.resource.toString())}static setKernelInfo(e,t,r){"notebook"in e?n.connectionsByNotebook.set(e.notebook,{kernel:t,options:r}):n.connectionsByUri.set(e.resource.toString(),{kernel:t,options:r})}static deleteKernelInfo(e,t){if(!t){"notebook"in e?n.connectionsByNotebook.delete(e.notebook):n.connectionsByUri.delete(e.resource.toString());return}"notebook"in e&&n.connectionsByNotebook.get(e.notebook)?.kernel.promise===t?n.connectionsByNotebook.delete(e.notebook):e.resource&&n.connectionsByUri.get(e.resource.toString())?.kernel.promise===t&&n.connectionsByUri.delete(e.resource.toString())}static verifyWeCanStartKernel(e,t){if(!dt(e)||!e.kernelSpec.specFile)return;if(!t.get(sp).isTrusted(Zl.Uri.file(e.kernelSpec.specFile)))throw new wT(e)}static async wrapKernelMethodImpl(e,t,r,i,o,s,a,l){let c=r.get(we),u=r.get(hm),d,f=n.convertContextToFunction(t,o),g=t,b="controller"in i?i.controller:void 0;for(t==="start"&&n.verifyWeCanStartKernel(e,r);d===void 0;){if("notebook"in i&&i.notebook.isClosed)throw new Zl.CancellationError;d="notebook"in i?c.getOrCreate(i.notebook,{metadata:e,controller:b||i.controller,resourceUri:i.resource}):u.getOrCreate(i.resource,{metadata:e,resourceUri:i.resource});let I=!1;try{if(t!=="restart"&&P_(d)&&!o.disableUI){I=!0;let w=await n.notifyAndRestartDeadKernel(d);return w&&l&&l.kernelWasRestartedDueToDeadKernel.resolve(!0),{kernel:d,deadKernelAction:w?"deadKernelNeedsToBeRestarted":"deadKernelWasNoRestarted"}}else{if(a(g,d),await f(d),"notebook"in i&&i.notebook.isClosed)throw new Zl.CancellationError;P_(d)&&!o.disableUI&&g!=="interrupt"&&await n.notifyAndRestartDeadKernel(d)}}catch(w){if(I&&l&&l.kernelWasRestartedDueToDeadKernel.resolve(!0),er(w)||p.warn(`Error occurred while trying to ${g} the kernel, options.disableUI=${o.disableUI}`,w),o.disableUI)throw w;if("notebook"in i&&i.notebook.isClosed)throw new Zl.CancellationError;let D=await n.handleKernelError(r,w,g,i.resource,d,b,e,s);if(b=D.controller,e=D.metadata,f=A=>A.start(o),g="start",s==="3rdPartyExtension")throw w;d=void 0}}return{kernel:d}}static async connectToNotebookKernel(e,t,r,i,o,s="jupyterExtension",a=()=>void 0){return n.wrapKernelMethod(e,"start",s,t,r,i,o,a)}static async connectToKernel(e,t,r,i,o,s="jupyterExtension",a=()=>void 0){return n.wrapKernelMethod(e,"start",s,t,r,i,o,a)}};var bf=class{constructor(e){this.controller=e}get id(){return this.controller.id}createNotebookCellExecution(e){return this.controller.createNotebookCellExecution(e)}};var kT=require("vscode");var PT=class extends $t{constructor(t,r,i){super();this.kernel=t;this.controller=r;this.notebook=i}initialize(){let t=this.kernel,r=this.controller,i=this.notebook;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||t.status!=="busy"&&t.status!=="unknown"||!r.createNotebookExecution)return;this._register(kT.workspace.onDidCloseNotebookDocument(s=>{s===i&&this.dispose()},this)),this._register(r.onDidChangeSelectedNotebooks(s=>{s.notebook===i&&s.selected===!1&&this.dispose()},this)),this._register(t.onStatusChanged(s=>{s!=="busy"&&s!=="unknown"&&this.dispose()},this));let o=r.createNotebookExecution(i);o.start(),this._register(new kT.Disposable(()=>o.end()))}};var xT=class n{constructor(e,t,r,i,o,s,a,l,c,u,d){this.kernelConnection=e;this._viewType=r;this.kernelProvider=i;this.context=o;this.languageService=a;this.configuration=l;this.extensionChecker=c;this.serviceContainer=u;this.displayDataProvider=d;this._onNotebookControllerSelectionChanged=new Jt.EventEmitter;this._onConnecting=new Jt.EventEmitter;this.pendingCellAdditions=new WeakMap;this._onDidDispose=new Jt.EventEmitter;this.disposables=[];this.notebookKernels=new WeakMap;this.isDisposed=!1;this.runningCellExecutions=new WeakMap;this.associatedDocuments=new WeakMap;this.restoredConnections=new WeakSet;this.cellQueue=new WeakMap;nj(e.id,e.interpreter?.id),s.push(this),this.displayData=this.displayDataProvider.getDisplayData(this.connection),this.controller=Jt.notebooks.createNotebookController(t,r,this.displayData.label,this.handleExecution.bind(this),this.getRendererScripts()),this.displayData.onDidChange(this.updateDisplayData,this,this.disposables),this.updateDisplayData(),this.controller.interruptHandler=this.handleInterrupt.bind(this),this.controller.supportsExecutionOrder=!0,this.controller.supportedLanguages=this.languageService.getSupportedLanguages(e),this.controller.onDidChangeSelectedNotebooks(this.onDidChangeSelectedNotebooks,this,this.disposables),Jt.workspace.onDidCloseNotebookDocument(f=>{this.associatedDocuments.delete(f)},this,this.disposables)}get id(){return this.controller.id}get label(){return this.controller.label}get connection(){return this.kernelConnection}get viewType(){return this._viewType}get onNotebookControllerSelectionChanged(){return this._onNotebookControllerSelectionChanged.event}get onConnecting(){return this._onConnecting.event}get onDidReceiveMessage(){return this.controller.onDidReceiveMessage}get onDidDispose(){return this._onDidDispose.event}isAssociatedWithDocument(e){return this.associatedDocuments.has(e)}static create(e,t,r,i,o,s,a,l,c,u,d,f){let g=new n(e,t,r,i,o,s,a,l,c,u,d);try{g.controller.variableProvider=f}catch(b){p.warn("Failed to attach variable provider",b)}return g}async restoreConnection(e){if(this.restoredConnections.has(e))return;this.restoredConnections.add(e);let t=await this.connectToKernel(e,new Ft(!0));if(this.kernelConnection.kind==="connectToLiveRemoteKernel"){let u=new PT(t,this.controller,e);this.disposables.push(u),u.initialize()}let r=this.kernelProvider.getKernelExecution(t),o=await this.serviceContainer.get(Da).getLastTrackedCellExecution(e,t);if(!t.session?.kernel||r.pendingCells.length||!o||e.cellCount<o.cellIndex||e.cellAt(o.cellIndex).kind!==Jt.NotebookCellKind.Code)return;ua(t.resourceUri,t.kernelConnectionMetadata);let s=!1,a=[],l,c=(u,d)=>{if(!(d.direction==="send"||s)&&ou(d.msg)===o.msg_id){if("msg_type"in d.msg&&d.msg.msg_type==="status"&&"execution_state"in d.msg.content&&d.msg.content.execution_state==="idle")return;s=!0,r.resumeCellExecution(e.cellAt(o.cellIndex),{msg_id:o.msg_id,startTime:o.startTime,executionCount:o.executionCount}).catch(h),z(a)}};t.session.kernel.anyMessage.connect(c),l=new Jt.Disposable(()=>{ei(()=>t.session?.kernel?.anyMessage.disconnect(c))}),a.push(l),this.disposables.push(l)}updateConnection(e){e.kind!=="connectToLiveRemoteKernel"&&(this.controller.label=ot(e))}asWebviewUri(e){return this.controller.asWebviewUri(e)}postMessage(e,t){let r=e&&"message"in e?e.message:"";return p.ci(`\x1B[32mPosting message to Notebook UI ${r}`),this.controller.postMessage(e,t)}setPendingCellAddition(e,t){if(this.viewType!==Yt)throw new Error("setPendingCellAddition only applies to the Interactive Window");this.pendingCellAdditions.set(e,t)}dispose(){if(this.isDisposed)return;let e=Jt.workspace.notebookDocuments.filter(t=>this.associatedDocuments.has(t)).map(t=>t.uri.toString());p.debug(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""}`),p.ci(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""} called from ${new Error("").stack}`),this.isDisposed=!0,this._onNotebookControllerSelectionChanged.dispose(),this._onConnecting.dispose(),this.controller.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose(),z(this.disposables)}updateDisplayData(){this.controller.label=this.displayData.label;let e=this.connection.kind==="connectToLiveRemoteKernel"?"":this.displayData.description;this.controller.description=e,this.displayData.serverDisplayName&&(this.controller.description=e?`${e} (${this.displayData.serverDisplayName})`:this.displayData.serverDisplayName)}async handleExecution(e,t){if(e.length<1)return;let r=Pn(t);r?.cellExecutionCount(e.length);let i=r?.preExecuteCellTelemetry();if(this.pendingCellAdditions.has(t)&&await this.pendingCellAdditions.get(t),e=e.filter(s=>s.index<0?(p.warn(`Attempting to run a cell with index ${s.index}, kind ${s.kind}, text = ${s.document.getText()}`),!1):!0),!Jt.workspace.isTrusted)return;p.debug(`Handle Execution of Cells ${e.map(s=>s.index)} for ${U(t.uri)}`),await ua(t.uri,this.connection),i?.stop();let o=this.cellQueue.get(t)||[];this.cellQueue.set(t,o.concat(e)),await this.executeQueuedCells(t)}async onDidChangeSelectedNotebooks(e){if(p.ci(`NotebookController selection event called for notebook ${e.notebook.uri.toString()} & controller ${this.connection.kind}:${this.id}. Selected ${e.selected} `),this.associatedDocuments.has(e.notebook)&&e.selected)return;if(!e.selected){let r=this.kernelProvider.get(e.notebook);r?.kernelConnectionMetadata.id===this.kernelConnection.id&&(p.info(`Disposing kernel ${this.kernelConnection.id} for notebook ${U(e.notebook.uri)} due to selection of another kernel or closing of the notebook`),r.dispose().catch(h)),this.associatedDocuments.delete(e.notebook),this._onNotebookControllerSelectionChanged.fire({controller:this,notebook:e.notebook,selected:e.selected});return}if(!Pt(e.notebook)&&e.notebook.notebookType!==Yt||!Jt.workspace.isTrusted)return;Pn(e.notebook)?.kernelSelected(this.kernelConnection.id,this.kernelConnection.interpreter?.id),tme(this.kernelConnection);let t=re();p.ci(`Controller ${this.connection.kind}:${this.id} associated with nb ${U(e.notebook.uri)}`),this.associatedDocuments.set(e.notebook,t.promise),await this.onDidSelectController(e.notebook),await this.updateCellLanguages(e.notebook),this._onNotebookControllerSelectionChanged.fire({controller:this,notebook:e.notebook,selected:e.selected}),p.debug("Controller selection change completed"),t.resolve()}async updateCellLanguages(e){let t=this.controller.supportedLanguages;if(!t||t?.length===0)return;let i=nt(this.kernelConnection)?ge:t[0];await Promise.all(e.getCells().filter(o=>o.kind===Jt.NotebookCellKind.Code).map(async o=>{t.includes(o.document.languageId)||await Jt.languages.setTextDocumentLanguage(o.document,i).then(h,h)}))}getRendererScripts(){return this.context.extensionMode===Jt.ExtensionMode.Development||this.context.extensionMode===Jt.ExtensionMode.Test?[new Jt.NotebookRendererScript(Jt.Uri.joinPath(this.context.extensionUri,"dist","webviews","webview-side","widgetTester","widgetTester.js"))]:[]}handleInterrupt(e){p.debug(`VS Code interrupted kernel for ${U(e.uri)}`),e.getCells().forEach(t=>at(t,"Cell cancellation requested")),Jt.commands.executeCommand(J.InterruptKernel,{notebookEditor:{notebookUri:e.uri}}).then(h,t=>p.error("Failed to interrupt",t))}createCellExecutionIfNecessary(e,t){let r=this.runningCellExecutions.get(e.notebook);if(!r||r.cell===e){r?.end(void 0,void 0),r=ki.getOrCreate(e,t,!0),this.runningCellExecutions.set(e.notebook,r);let i=r.end.bind(r);r.end=(o,s)=>{this.runningCellExecutions.delete(e.notebook),i(o,s)}}return r}async executeQueuedCells(e){if(!this.cellQueue.has(e))return;let t=(this.cellQueue.get(e)||[]).map(u=>{let d=this.createCellExecutionIfNecessary(u,new bf(this.controller));return{cell:u,exec:d}});this.cellQueue.delete(e);let r=t.length?t[0].cell:void 0;if(!r)return;p.trace(`Execute Notebook ${U(e.uri)}. Step 1`);let i="start",o=new bf(this.controller),s=this.serviceContainer.get(Da),a;try{if(p.trace(`Connect to Kernel ${U(e.uri)}. Step 2`),a=await this.connectToKernel(e,new Ft(!1)),p.trace(`Connected to Kernel ${U(e.uri)}. Step 3`),a.disposing)throw new Jt.CancellationError;a&&a.controller.id!==o.id&&(o=a.controller,t.forEach(u=>u.exec=this.createCellExecutionIfNecessary(u.cell,o))),i="execution",a.controller.id===this.id&&this.updateKernelInfoInNotebookWhenAvailable(a,e)}catch(u){if(u instanceof su)return;er(u)||p.error("Error in notebook cell execution",u),t.forEach(({cell:g,exec:b})=>{b.start(),b.clearOutput(g).then(h,h)});let d=this.serviceContainer.get(Br);u=Gr.unwrap(u);let f=er(u)||u instanceof ya;await Ac(r,o,await d.getErrorMessageForDisplayInCellOutput(u,i,e.uri),f)}if(!a)return;let l=this.kernelProvider.getKernelExecution(a),c=new xr;await Promise.all(t.map(async({cell:u})=>{try{let d=Pn(e)?.executeCell();d&&c.add(new Jt.Disposable(()=>d.stop())),s.trackCellExecution(u,a),p.trace(`executeCell ${u.index}. Step 4`),await l.executeCell(u),kS.isExiting||s.deleteTrackedCellExecution(u,a)}catch(d){if(d instanceof su)return;er(d)||p.error("Error in cell execution",d);let f=this.serviceContainer.get(Br);d=Gr.unwrap(d);let g=er(d)||d instanceof ya;await Ac(u,o,await f.getErrorMessageForDisplayInCellOutput(d,i,e.uri),g)}})).catch(h)}async connectToKernel(e,t){let r=Pn(e)?.startKernel();return this._onConnecting.fire(),Vs.connectToNotebookKernel(this.kernelConnection,this.serviceContainer,{resource:e.uri,notebook:e,controller:this.controller},t,this.disposables).finally(()=>r?.stop())}updateKernelInfoInNotebookWhenAvailable(e,t){if(this.notebookKernels.get(t)===e)return;this.notebookKernels.set(t,e);let r=[];Jt.workspace.onDidCloseNotebookDocument(s=>{s===t&&z(r)},this,r);let i=e.onDisposed(()=>z(r)),o=e.onStatusChanged(async()=>{e.disposed||!e.info||this.associatedDocuments.has(t)&&(await iH(t,e.kernelConnectionMetadata,e.info),e.info.status==="ok"&&z(r))});r.push({dispose:()=>o.dispose()}),r.push({dispose:()=>i?.dispose()})}async onDidSelectController(e){let t=this.connection,r=this.kernelProvider.get(e);if(r&&Lj(r.kernelConnectionMetadata,t)){p.info("Switch kernel did not change kernel.");return}if(It(e.uri,"DS_INTERNAL.SWITCH_KERNEL"),r&&Jt.window.visibleNotebookEditors.filter(s=>s.notebook===e).forEach(s=>this.postMessage({message:"IPyWidgets_onKernelChanged",payload:void 0},s)),await iH(e,t),e.notebookType===Yt)return;let i=this.kernelProvider.getOrCreate(e,{metadata:t,controller:this.controller,resourceUri:e.uri});if(p.debug(`KernelProvider switched kernel to id = ${i.kernelConnectionMetadata.id}`),nt(this.kernelConnection)&&!this.extensionChecker.isPythonExtensionInstalled)return;let o=this.serviceContainer.get(sp);!this.configuration.getSettings(void 0).disableJupyterAutoStart&&dt(this.kernelConnection)&&this.kernelConnection.kernelSpec.specFile&&o.isTrusted(Jt.Uri.file(this.kernelConnection.kernelSpec.specFile))&&this.connectToKernel(e,new Ft(!0))}};async function iH(n,e,t){let r=lo(n)||{},{changed:i}=await Aj(r,e,t);i&&await q2(n,r)}async function tme(n){let e=await rd(n.interpreter,!0),t=e?.major||0,r=e?.minor||0;!e||t>=4||t<=0||r<=-1||n.kind!=="startUsingLocalKernelSpec"&&n.kind!=="startUsingPythonInterpreter"||(t<3||t===3&&r<=5)&&Jt.window.showWarningMessage(y.warnWhenSelectingKernelWithUnSupportedPythonVersion,le.learnMore).then(i=>{if(i===le.learnMore)return Rd("https://aka.ms/jupyterUnSupportedPythonKernelVersions")},h)}var eb=class{constructor(e,t,r,i,o,s){this.disposables=e;this.pythonEnvFilter=t;this.extensionChecker=r;this.serviceContainer=i;this.serverUriStorage=o;this.kernelFinder=s;this.registeredControllers=new Map;this.changeEmitter=new tb.EventEmitter;this.registeredMetadatas=new Map;this.selectedEmitter=new tb.EventEmitter;this.selectionChangedEmitter=new tb.EventEmitter;this.selectedControllers=new WeakMap;this._activeInterpreterControllerIds=new Set}get onDidChange(){return this.changeEmitter.event}get registered(){return[...this.registeredControllers.values()]}get all(){return this.metadatas}get metadatas(){return[...this.registeredMetadatas.values()]}get onControllerSelected(){return this.selectedEmitter.event}get onControllerSelectionChanged(){return this.selectionChangedEmitter.event}activate(){this.kernelFinder.onDidChangeKernels(()=>this.loadControllers(),this,this.disposables),this.kernelFinder.registered.forEach(e=>this.monitorDeletionOfConnections(e)),this.kernelFinder.onDidChangeRegistrations(e=>e.added.forEach(t=>this.monitorDeletionOfConnections(t)),this,this.disposables),this.pythonEnvFilter.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeUri,this,this.disposables),this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables),this.loadControllers()}loadControllers(){this.controllersPromise=this.loadControllersImpl(),eH(this.registered.map(e=>e.connection)),p.ci(`Providing notebook controllers with length ${this.registered.length}.`)}get loaded(){return this.controllersPromise}async loadControllersImpl(){let e=this.kernelFinder.kernels;this.createNotebookControllers(e),Array.from(this.registered).filter(r=>{let i=e.some(o=>o.id===r.connection.id)||Un&&this._activeInterpreterControllerIds.has(r.id);return!i&&r.connection.kind==="connectToLiveRemoteKernel"?!0:this.canControllerBeDisposed(r)?(i||p.debug(`Controller ${r.connection.kind}:'${r.id}' for view = '${r.viewType}' is no longer a valid`),!i):!1}).forEach(r=>{p.warn(`Disposing old controller ${r.connection.kind}:'${r.id}' for view = '${r.viewType}'`),r.dispose()})}createNotebookControllers(e){if(e.length!==0)try{this.batchAdd(e,[bt,Yt])}catch(t){if(!er(t,!0))throw t}}async monitorDeletionOfConnections(e){let t=e.onDidChangeKernels(({removed:r})=>{let i=new Set((r||[]).map(o=>o.id));this.registered.filter(o=>i.has(o.connection.id)).forEach(o=>{p.warn(`Deleting controller ${o.id} as it is associated with a connection that has been deleted ${o.connection.kind}:${o.id}`),o.dispose()})},this,this.disposables);this.kernelFinder.onDidChangeRegistrations(r=>{r.removed.includes(e)&&t.dispose()})}onDidChangeUri(){this.onDidChangeFilter()}async onDidRemoveServers(e){e.forEach(t=>{this.registered.forEach(r=>{xt(r.connection)&&r.connection.serverProviderHandle.id===t.id&&r.connection.serverProviderHandle.handle===t.handle&&(p.warn(`Deleting controller ${r.id} as it is associated with a connection that has been removed`),r.dispose())})}),this.onDidChangeFilter()}onDidChangeFilter(){this.all.forEach(t=>this.addOrUpdate(t,[bt,Yt]))}batchAdd(e,t){let r=[];e.forEach(i=>{let{added:o}=this.addImpl(i,t,!1);r.push(...o)}),r.length&&this.changeEmitter.fire({added:r,removed:[]})}trackActiveInterpreterControllers(e){e.forEach(t=>this._activeInterpreterControllerIds.add(t.id))}canControllerBeDisposed(e){return!this._activeInterpreterControllerIds.has(e.id)&&!this.isControllerAttachedToADocument(e)}getSelected(e){return this.selectedControllers.get(e)}addOrUpdate(e,t){let{added:r,existing:i}=this.addImpl(e,t,!0);return r.concat(i)}addImpl(e,t,r){let i=[],o=[];p.ci(`Create Controller for ${e.kind} and id '${e.id}' for view ${t.join(", ")}`);try{t.map(s=>{let a=this.getControllerId(e,s);return this.registeredMetadatas.set(e.id,e),[a,s]}).filter(([s])=>{let a=this.registeredControllers.get(s);return a?(a.updateConnection(e),o.push(a),p.ci(`Found existing controller '${a.id}', not creating a new one just updating it`),!1):(p.ci(`Existing controller not found for '${s}', hence creating a new one`),!0)}).forEach(([s,a])=>{let l=xT.create(e,s,a,this.serviceContainer.get(we),this.serviceContainer.get(Ze),this.disposables,this.serviceContainer.get(ts),this.serviceContainer.get(ie),this.extensionChecker,this.serviceContainer,this.serviceContainer.get(gd),this.serviceContainer.get(cT)),c=[];l.onDidDispose(()=>{p.trace(`Deleting controller '${l.id}' associated with view ${a} from registration as it was disposed`),this.registeredControllers.delete(l.id),c.forEach(u=>u.dispose())},this,this.disposables),this.disposables.push(l),this.registeredControllers.set(l.id,l),i.push(l),l.onNotebookControllerSelectionChanged(u=>{u.selected&&(p.ci(`Controller ${u.controller?.id} selected for ${u.notebook.uri.toString()}`),this.selectedControllers.set(u.notebook,u.controller),this.selectedEmitter.fire(u))},this,c),l.onNotebookControllerSelectionChanged(u=>this.selectionChangedEmitter.fire({...u,controller:l}),this,c)}),r&&i.length&&this.changeEmitter.fire({added:i,removed:[]})}catch(s){if(er(s,!0))return p.warn(`Cancel creation of notebook controller for ${e.id}`,s),{added:i,existing:o};p.error(`Failed to create notebook controller for ${e.id}`,s)}return{added:i,existing:o}}get(e,t){let r=this.getControllerId(e,t);return this.registeredControllers.get(r)}getControllerId(e,t){return t===bt?e.id:`${e.id}${Qj}`}isControllerAttachedToADocument(e){return tb.workspace.notebookDocuments.some(t=>e.isAssociatedWithDocument(t))}};eb=v([(0,fu.injectable)(),m(0,(0,fu.inject)(M)),m(1,(0,fu.inject)(ii)),m(2,(0,fu.inject)($e)),m(3,(0,fu.inject)(st)),m(4,(0,fu.inject)(Ht)),m(5,(0,fu.inject)(Dr))],eb);var fp=k(N());var DT=class{constructor(e,t,r){this.kernel=e;this.localResourceUriConverter=t;this.scriptManagerFactory=r;this.id="local"}async getWidgetScriptSource(e){return(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase())||{moduleName:e}}dispose(){}async getWidgetScriptSources(){let t=await this.scriptManagerFactory.getOrCreate(this.kernel).getWidgetModuleMappings();return t&&Object.keys(t).length?await Promise.all(Object.keys(t).map(async i=>{let o=(await this.localResourceUriConverter.asWebviewUri(t[i])).toString();return{moduleName:i,scriptUri:o,source:"local"}})):[]}async getBaseUrl(){let e=this.scriptManagerFactory.getOrCreate(this.kernel);if(!e.getBaseUrl)return;let t=await e.getBaseUrl();if(t)return this.localResourceUriConverter.asWebviewUri(t)}};var oH=require("vscode"),_T=class{constructor(e,t){this.id="remote";if(e.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage of this class, can only be used with remtoe kernels");this.kernelConnection=e.kernelConnectionMetadata,this.scriptManager=t.getOrCreate(e)}static{this.validUrls=new Map}dispose(){}async getBaseUrl(){return oH.Uri.parse(this.kernelConnection.baseUrl)}async getWidgetScriptSource(e){let r=(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase());if(!r&&e.includes("/")){let i=await this.getBaseUrl();return{moduleName:e,scriptUri:`${i.toString()}${e}`,source:"remote"}}return r||{moduleName:e}}async getWidgetScriptSources(){let e=await this.scriptManager.getWidgetModuleMappings();return e&&Object.keys(e).length?await Promise.all(Object.keys(e).map(async r=>({moduleName:r,scriptUri:e[r].toString(),source:"remote"}))):[]}};var rb=class{constructor(e,t,r){this.configurationSettings=e;this.widgetScriptManagerFactory=t;this.globalMemento=r}getProviders(e,t){let r=[];switch(r.push(new Ta(this.globalMemento,this.configurationSettings)),e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":r.push(new _T(e,this.widgetScriptManagerFactory));break;default:r.push(new DT(e,t,this.widgetScriptManagerFactory))}return r}};rb=v([(0,fp.injectable)(),m(0,(0,fp.inject)(ie)),m(1,(0,fp.inject)(bT)),m(2,(0,fp.inject)(Le)),m(2,(0,fp.named)(ut))],rb);var sH=k(N()),TT=require("vscode");var nb=class{async getNbExtensionsParentPath(e){switch(e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":return TT.Uri.parse(e.kernelConnectionMetadata.baseUrl);case"startUsingPythonInterpreter":{let t=await oa(e.kernelConnectionMetadata.interpreter);return t?TT.Uri.joinPath(TT.Uri.file(t),"share","jupyter"):void 0}default:return}}};nb=v([(0,sH.injectable)()],nb);var hu=k(N());var If=require("vscode");var cF=require("vscode");var bH=k(vH());var yH=["require.config({","requirejs?.config({","window.requirejs?.config({","requirejs.config({",'["require"].config({',"['require'].config({",'["requirejs"].config({',"['requirejs'].config({",'["require"]["config"]({',"['require']['config']({",'["requirejs"]["config"]({',"['requirejs']['config']({"];async function ome(n,e,t){let r=[...yH],i=await ct(e),o=0,s;for(;o<=0&&r.length&&(s=r.pop(),!!s);)o=t.indexOf(s);if(o<0){let f=[...yH].map(g=>g.substring(0,g.length-2));for(;o<=0&&f.length&&(s=f.pop(),!!s);)o=t.indexOf(s)}if(o<0){R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigStart"});return}let a=t.indexOf(")",o);if(a<=0||!s){R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigEnd"});return}let l=t.indexOf("{",o),c=t.substring(l,a);c=(0,bH.default)(c,{language:"javascript"}),c=Ue(c,{trim:!0,removeEmptyEntries:!0}).join("");let u=c.split("{")[c.split("{").length-1].split("}")[0].split(",").map(f=>f.trim()).filter(f=>f.length&&f.includes(":")),d={};if(u.forEach(f=>{let g=f.split(":"),b=Yp(g[0].replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim(),I=Yp(f.substring(f.indexOf(":")+1).replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim();d[b]=I.startsWith("http")?cF.Uri.parse(I):cF.Uri.joinPath(n,I)}),!d||!Object.keys(d).length){R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"noRequireConfigEntries"});return}return R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",{requireEntryPointCount:Object.keys(d).length},{widgetFolderNameHash:i,patternUsedToRegisterRequireConfig:s}),d}var ib=class{constructor(e){this.kernel=e;this.disposables=[];e.onRestarted(this.onKernelRestarted,this,this.disposables)}dispose(){z(this.disposables)}async getWidgetModuleMappings(){return this.widgetModuleMappings||(this.widgetModuleMappings=this.getWidgetModuleMappingsImpl()),this.widgetModuleMappings}onKernelRestarted(){this.widgetModuleMappings=void 0}async getConfigFromWidget(e,t,r){let i=await this.getWidgetScriptSource(t);try{let o=await ome(e,r,i);if(!o){let s=`Failed to extract require.config from widget for ${r} from ${U(t)}`;Un&&(s+=`with contents ${i}`),p.warn(s)}return o}catch(o){p.error(`Failed to extract require.config entry for ${r} from ${U(t)}`,o)}}async getWidgetModuleMappingsImpl(){let e=new Fe,[t,r]=await Promise.all([this.getWidgetEntryPoints(),this.getNbExtensionsParentPath()]);if(!r)return;let o=(await Promise.all(t.map(s=>this.getConfigFromWidget(r,s.uri,s.widgetFolderName)))).reduce((s,a)=>Object.assign(s||{},a),{});return o&&Object.keys(o).length&&(delete o["jupyter-js-widgets"],delete o["@jupyter-widgets/base"],delete o["@jupyter-widgets/controls"],delete o["@jupyter-widgets/output"]),R("DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",{duration:e.elapsedTime},{type:dt(this.kernel.kernelConnectionMetadata)?"local":"remote"}),o&&Object.keys(o).length?o:void 0}};var MT=class extends ib{constructor(t,r,i,o){super(t);this.context=r;this.fs=i;this.connection=o;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&t.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage, can only be used for remote kernels");this.kernelConnection=t.kernelConnectionMetadata,this.getWidgetEntryPoints().catch(h)}getBaseUrl(){return this.getNbExtensionsParentPath()}async getNbExtensionsParentPath(){return If.Uri.parse(this.kernelConnection.baseUrl)}onKernelRestarted(){this.widgetEntryPointsPromise=void 0,super.onKernelRestarted()}async getWidgetEntryPoints(){return this.widgetEntryPointsPromise||(this.widgetEntryPointsPromise=this.getWidgetEntryPointsImpl()),this.widgetEntryPointsPromise}getCodeToExecute(){return this.code||(this.code=this.fs.readFile(If.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyWidgetEntryPoints.py"))),this.code}async getWidgetEntryPointsImpl(){if(!nt(this.kernelConnection))return[];let t=await this.getCodeToExecute();if(!this.kernel.session?.kernel)return p.ci("No Kernel session to get list of widget entry points"),[];let r=[];r.push(mn(this.kernel.session.kernel,t,{traceErrors:!0,traceErrorsMessage:"Failed to get widget entry points from remote kernel"})),!Un&&this.context.extensionMode===If.ExtensionMode.Production&&r.push(vi(1e4).then(()=>[])),r.forEach(s=>s.catch(h));let i=await Promise.race(r);if(i.length===0)return p.ci("Unable to get widget entry points, no outputs after running the code"),[];let o=i[0];if(o.output_type!=="stream"||o.name!=="stdout")return p.ci("Unable to get widget entry points, no stream/stdout outputs after running the code"),[];try{return p.trace(`Widget Outputs include, ${o.text}`),o.text.trim().substring(1).slice(0,-1).split(",").map(a=>Yp(a.trim()).replace(/\\\\/g,"/").replace(/\\/g,"/")).map(a=>({uri:If.Uri.joinPath(If.Uri.parse(this.kernelConnection.baseUrl),"nbextensions",a),widgetFolderName:rt(a)}))}catch(s){return p.error(`Failed to parse output to get list of IPyWidgets, output is ${o.text}`,s),[]}}async getWidgetScriptSource(t){let r=this.getWidgetScriptSourceUsingHttpClient(t),i=this.getWidgetScriptSourceUsingFetch(t),o=r.catch(()=>i);return o.catch(s=>{r.catch(a=>p.error(`Failed to download widget script source from ${t.toString(!0)}`,a)),p.error(`Failed to download widget script source from ${t.toString(!0)}`,s)}),o}async getWidgetScriptSourceUsingHttpClient(t){let r=t.toString(!0),o=await new jl().downloadFile(r);if(o.status===200)return o.text();throw new Error(`Error downloading from ${r}: ${o.statusText}`)}async getWidgetScriptSourceUsingFetch(t){let r=await this.connection.createConnectionInfo(this.kernelConnection.serverProviderHandle),i=t.toString(!0),s=await new jl(r.settings.fetch).downloadFile(i);if(s.status===200)return s.text();throw new Error(`Error downloading from ${i} using custom fetch: ${s.statusText}`)}};var ob=require("vscode");var KT=class n extends ib{constructor(t,r,i,o,s){super(t);this.fs=r;this.nbExtensionsPathProvider=i;this.context=o;this.jupyterPaths=s;this.overwriteExistingFiles=!0;this.overwriteExistingFiles=!n.nbExtensionsCopiedKernelConnectionList.has(t.kernelConnectionMetadata.id)}static{this.nbExtensionsCopiedKernelConnectionList=new Set}getBaseUrl(){return this.getNbExtensionsParentPath()}onKernelRestarted(){this.nbExtensionsParentPath=void 0,this.overwriteExistingFiles=!0,super.onKernelRestarted()}async getNbExtensionsParentPath(){return this.nbExtensionsParentPath||(this.nbExtensionsParentPath=this.getNbExtensionsParentPathImpl()),this.nbExtensionsParentPath}async getNbExtensionsParentPathImpl(){let t=this.overwriteExistingFiles;try{let r=new Fe;if(this.sourceNbExtensionsPath=await this.nbExtensionsPathProvider.getNbExtensionsParentPath(this.kernel),!this.sourceNbExtensionsPath){p.warn(`No nbextensions folder found for kernel ${this.kernel.kernelConnectionMetadata.id}`);return}let i=await ct(this.kernel.kernelConnectionMetadata.id),o=ob.Uri.joinPath(this.context.extensionUri,"temp","scripts",i,"jupyter"),s=ob.Uri.joinPath(o,"nbextensions"),[a]=await Promise.all([this.jupyterPaths.getDataDirs({resource:this.kernel.resourceUri,interpreter:this.kernel.kernelConnectionMetadata.interpreter}),this.fs.createDirectory(s)]),l=a.map(c=>ob.Uri.joinPath(c,"nbextensions"));l.reverse();for(let c of l)await this.fs.exists(c)&&await this.fs.copy(c,s,{overwrite:t});return this.overwriteExistingFiles=!1,n.nbExtensionsCopiedKernelConnectionList.add(this.kernel.kernelConnectionMetadata.id),R("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",{duration:r.elapsedTime}),o}catch(r){throw R("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",void 0,void 0,r),r}}async getWidgetEntryPoints(){let t=await this.getNbExtensionsParentPath();if(!t)return[];let r=ob.Uri.joinPath(t,"nbextensions");return(await this.fs.searchLocal("**/extension.js",r.fsPath,!0)).map(o=>({uri:ob.Uri.joinPath(r,o),widgetFolderName:rt(o)}))}getWidgetScriptSource(t){return this.fs.readFile(t)}};var sb=class{constructor(e,t,r,i,o,s){this.nbExtensionsPathProvider=e;this.fs=t;this.context=r;this.jupyterPaths=i;this.disposables=o;this.connection=s;this.managers=new WeakMap}getOrCreate(e){if(!this.managers.has(e))if(e.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"||e.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec"){let t=new MT(e,this.context,this.fs,this.connection);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}else{let t=new KT(e,this.fs,this.nbExtensionsPathProvider,this.context,this.jupyterPaths);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}return this.managers.get(e)}};sb=v([(0,hu.injectable)(),m(0,(0,hu.inject)(yT)),m(1,(0,hu.inject)(dr)),m(2,(0,hu.inject)(Ze)),m(3,(0,hu.inject)(Lr)),m(4,(0,hu.inject)(M)),m(5,(0,hu.inject)(sn))],sb);var OT=k(N()),Ra=require("vscode");var js=class{constructor(e){this.disposables=[];e.push(this)}dispose(){z(this.disposables)}activate(){let e=new us(1e3);this.disposables.push(e),Ra.workspace.onDidChangeNotebookDocument(t=>{e.trigger(()=>this.onDidChangeNotebookDocument(t))},this,this.disposables)}onDidChangeNotebookDocument(e){Pt(e.notebook)&&e.cellChanges.some(t=>t.outputs&&t.outputs.some(r=>r.items&&r.items.some(i=>i.mime===Li)))&&this.checkRendererExtensionVersion()}checkRendererExtensionVersion(){if(!Ra.workspace.isTrusted)return;let e=Ra.extensions.getExtension(Vu);if(!e){this.displayNotInstalledMessage();return}let t=e.packageJSON.version;if(!t){this.displayUpdateMessage();return}let r=t.split("."),i=parseInt(r[0],10),o=parseInt(r[1],10),s=parseInt(r[2],10);(i<1||i===1&&o===0&&s<15)&&this.displayUpdateMessage()}displayNotInstalledMessage(){js.messageDisplayed||(js.messageDisplayed=!0,Ra.window.showInformationMessage(y.rendererExtensionRequired,{modal:!0},le.bannerLabelYes).then(e=>{e===le.bannerLabelYes&&Ra.commands.executeCommand("extension.open",Vu).then(h,h)}).then(h,h))}displayUpdateMessage(){js.messageDisplayed||(js.messageDisplayed=!0,Ra.window.showInformationMessage(y.rendererExtension1015Required,{modal:!0},le.bannerLabelYes).then(e=>{e===le.bannerLabelYes&&Ra.commands.executeCommand("extension.open",Vu).then(h,h)}).then(h,h))}};js.messageDisplayed=!1,js=v([(0,OT.injectable)(),m(0,(0,OT.inject)(M))],js);function IH(n,e){n.addSingleton(_a,_a),n.addSingleton(vT,rb),n.addSingleton(bT,sb),n.addSingleton(yT,nb),n.addSingleton(Ta,Ta),n.addSingleton(me,js)}var Sf=require("vscode");var SH=k(N());var lb=require("vscode");var ab=class{constructor(e,t){this.notebook=e;this.disposables=[];ve.instance.get(it).onControllerSelected(i=>{i.notebook===this.notebook&&(i.controller.connection.kind!=="startUsingPythonInterpreter"||!i.controller.connection.interpreter||i.controller.connection.interpreter.id!==this.createdEnvId)&&this.cancelTokeSource.cancel()},this,this.disposables),this.cancelTokeSource=yg(t)}dispose(){this.cancelTokeSource.dispose(),z(this.disposables)}async createPythonEnvFromKernelPicker(){let e,t=await this.createPythonEnvironment();if(this.cancelTokeSource.token.isCancellationRequested||t.action)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:t.action||"Cancel"};if(!t.interpreter)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};e=t.interpreter,p.debug(`Python Environment created ${e.id}`);let r=await this.waitForPythonKernel(t.interpreter);if(this.cancelTokeSource.token.isCancellationRequested)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};if(!r)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"kernelConnectionNotCreated"}),p.debug(`Python Environment ${e.id} not found as a kernel`),{action:"Cancel"};p.debug(`Python Environment ${e.id} found as a kernel ${r.kind}:${r.id}`);let o=await ve.instance.get(Es).installMissingDependencies({resource:this.notebook.uri,kernelConnection:r,ui:new Ft(!1),token:this.cancelTokeSource.token,ignoreCache:!0,cannotChangeKernels:!0,installWithoutPrompting:!0}),s=!0;return o!==0&&(s=!1,p.warn(`Dependencies not installed for new Python Env ${U(e.uri)} for notebook ${U(this.notebook.uri)}`)),R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{dependenciesInstalled:s,envType:Ve(t.interpreter)}),{kernelConnection:r}}async waitForPythonKernel(e){let r=ve.instance.get(Dr).registered.find(i=>i.kind==="localPythonEnvironment");if(r)return this.waitForPythonKernelFromFinder(e,r)}async waitForPythonKernelFromFinder(e,t){let r=t.kernels.find(i=>i.interpreter.id===e.id);return r||new Promise(i=>{let o=[];o.push(t.onDidChangeKernels(()=>{if(this.cancelTokeSource.token.isCancellationRequested)return;let s=t.kernels.find(a=>a.interpreter.id===e.id);if(s)return z(o),i(s)},this,this.disposables)),o.push(this.cancelTokeSource.token.onCancellationRequested(()=>{z(o)}))}).then(i=>{if(!this.cancelTokeSource.token.isCancellationRequested)return i||p.warn(`New Python Environment ${U(e.uri)} not found as a kernel`),i})}async createPythonEnvironment(){let e=ve.instance.get(et),t=new lb.CancellationTokenSource;try{let r=await lb.commands.executeCommand("python.createEnvironment",{showBackButton:!0,selectEnvironment:!0});if(r?.action==="Cancel")return{action:"Cancel"};if(r?.action==="Back")return{action:"Back"};let i=r?.path;if(this.cancelTokeSource.token.isCancellationRequested)return{action:"Cancel"};if(!i)return p.warn("Python Environment not created, either user cancelled the creation or there was an error in the Python Extension"),{action:"Cancel"};this.createdEnvId=i,p.debug(`Python Environment created ${i}`);let o=await e.getInterpreterDetails({path:i});return this.cancelTokeSource.token.isCancellationRequested?{action:"Cancel"}:(o||p.warn(`No interpreter details for New Python Environment ${U(lb.Uri.file(i))}`),this.createdEnvId=o?.id,{interpreter:o})}finally{t.cancel(),t.dispose()}}};var cb=class{activate(){Sf.commands.registerCommand("jupyter.createPythonEnvAndSelectController",async()=>{let e=Sf.window.activeNotebookEditor;if(!e)return;let t=new xr,r=t.add(new Sf.CancellationTokenSource).token,o=await t.add(new ab(e.notebook,r)).createPythonEnvFromKernelPicker();!o||"action"in o||await Sf.commands.executeCommand("notebook.selectKernel",{editor:e,id:o.kernelConnection.id,extension:Ae})})}};cb=v([(0,SH.injectable)()],cb);var gp=k(N()),Ur=require("vscode");var ub=class{constructor(e,t,r,i,o){this.controllerRegistration=e;this.kernelFinder=t;this.notebookEditorProvider=r;this.kernelDependency=i;this.localDisposables=[];this.providerMappings=new Map;this.kernelSpecsSourceRegistered=!1;o.push(this)}dispose(){z(this.localDisposables)}activate(){if(!Mr()){this.localDisposables.push(Ur.notebooks.registerKernelSourceActionProvider(bt,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Ur.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]})),this.localDisposables.push(Ur.notebooks.registerKernelSourceActionProvider(Yt,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Ur.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]}));let t=[],r=new Ur.EventEmitter;this.localDisposables.push(Ur.notebooks.registerKernelSourceActionProvider(bt,{onDidChangeNotebookKernelSourceActions:r.event,provideNotebookKernelSourceActions:()=>t})),this.localDisposables.push(Ur.notebooks.registerKernelSourceActionProvider(Yt,{onDidChangeNotebookKernelSourceActions:r.event,provideNotebookKernelSourceActions:()=>t}));let i=()=>{this.kernelSpecsSourceRegistered||this.kernelFinder.kernels.some(o=>dg(o))&&(this.kernelSpecsSourceRegistered=!0,t=[{label:y.localKernelSpecs,documentation:Ur.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerJupyterKernels"),command:"jupyter.kernel.selectLocalKernelSpec"}],r.fire())};i(),this.kernelFinder.onDidChangeKernels(()=>i(),this,this.localDisposables),this.localDisposables.push(Ur.commands.registerCommand("jupyter.kernel.selectLocalKernelSpec",this.onSelectLocalKernel.bind(this,"localKernelSpec"),this)),this.localDisposables.push(Ur.commands.registerCommand("jupyter.kernel.selectLocalPythonEnvironment",this.onSelectLocalKernel.bind(this,"localPythonEnvironment"),this))}this.localDisposables.push(Ur.commands.registerCommand("jupyter.kernel.selectJupyterServerKernel",this.onSelectRemoteKernel,this)),ve.instance.get(Vt).onDidChangeCollections(this.registerUriCommands,this,this.localDisposables),this.registerUriCommands()}registerUriCommands(){let e=ve.instance.get(Vt),t=new Set;e.jupyterCollections.map(r=>{let i=`${r.extensionId}:${r.id}`;if(r.id===Aw||(t.add(i),this.providerMappings.has(i)))return;let o=Ur.notebooks.registerKernelSourceActionProvider(bt,{provideNotebookKernelSourceActions:()=>[{get label(){return r.label},get documentation(){return r.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[r.extensionId,r.id],title:r.label}}]}),s=Ur.notebooks.registerKernelSourceActionProvider(Yt,{provideNotebookKernelSourceActions:()=>[{get label(){return r.label},get documentation(){return r.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[r.extensionId,r.id],title:r.label}}]});this.localDisposables.push(o),this.localDisposables.push(s),this.providerMappings.set(i,{disposables:[o,s],provider:r})}),this.providerMappings.forEach(({disposables:r},i)=>{t.has(i)||(z(r),this.providerMappings.delete(i))})}async onSelectLocalKernel(e,t){if(t=t||Ur.window.activeNotebookEditor?.notebook,!!t)if(e==="localPythonEnvironment"){let i=await ve.instance.get(ym).selectLocalKernel(t);return this.getSelectedController(t,i)}else{let i=await ve.instance.get(Nk).selectLocalKernel(t);return this.getSelectedController(t,i)}}async onSelectRemoteKernel(e,t,r){if(r=r||Ur.window.activeNotebookEditor?.notebook,!r&&Ur.window.activeTextEditor&&(r=this.notebookEditorProvider.findNotebookEditor(Ur.window.activeTextEditor.document.uri)?.notebook),!r)return;let i=`${e}:${t}`,o=this.providerMappings.get(i)?.provider;if(!o)return;let a=await ve.instance.get(Ak).selectRemoteKernel(r,o);return this.getSelectedController(r,a)}async getSelectedController(e,t){if(!t)return;let r=this.controllerRegistration.addOrUpdate(t,[e.notebookType]);if(!Array.isArray(r)||r.length===0){p.warn(`No controller created for selected kernel connection ${t.kind}:${t.id}`);return}ua(e.uri,t).finally(()=>It(e.uri,"DS_INTERNAL.SWITCH_KERNEL",void 0,{newKernelPicker:!0})).catch(h),r.find(o=>o.viewType===e.notebookType)?.controller.updateNotebookAffinity(e,Ur.NotebookControllerAffinity.Preferred);let i=r[0];return await this.onControllerSelected(e,i),i.controller.id}async onControllerSelected(e,t){if(ej(e),dt(t.connection)&&nt(t.connection)&&Jr(t.connection.interpreter)&&!Mr()){let r=[];try{let i=new Ur.CancellationTokenSource;r.push(i);let o=new Ft(!1);r.push(o),await this.kernelDependency.installMissingDependencies({resource:e.uri,kernelConnection:t.connection,token:i.token,ui:o,cannotChangeKernels:!0,ignoreCache:!0,installWithoutPrompting:!0})}catch(i){p.error(`Failed to install missing dependencies for Conda kernel ${t.connection.id}`,i)}finally{z(r)}}}};ub=v([(0,gp.injectable)(),m(0,(0,gp.inject)(it)),m(1,(0,gp.inject)(Dr)),m(2,(0,gp.inject)(An)),m(3,(0,gp.inject)(Es)),m(4,(0,gp.inject)(M))],ub);var Cf=k(N()),WT=require("vscode");var ec=require("vscode");var FT=require("vscode");var vp=class{constructor(e){this.jupyterConnection=e;this.disposables=[]}dispose(){z(this.disposables)}async findPreferredRemoteKernelConnection(e,t,r){return this.findPreferredRemoteKernelConnectionImpl(e,t,r,!1)}async findPreferredRemoteKernelConnectionImpl(e,t,r,i){let o=await ve.instance.get(Go).getPreferredRemoteKernelId(e),s=async()=>{let l=t.kernels.find(u=>u.kind==="connectToLiveRemoteKernel"&&u.id===o);if(l)return l;if(t.status==="idle")return;let c=await new Promise(u=>t.onDidChangeKernels(()=>{let d=t.kernels.find(f=>f.kind==="connectToLiveRemoteKernel"&&f.id===o);d&&u(d),(t.status==="idle"||r.isCancellationRequested)&&u(void 0)},this,this.disposables));if(c)return c};if(o){let l=await s();if(l||i)return l}let a=t.kernels.find(l=>xt(l))?.serverProviderHandle;if(a){let l=await this.jupyterConnection.createConnectionInfo(a),c=(e.uri,void 0),u=c&&t.kernels.find(d=>xt(d)&&d.kind==="connectToLiveRemoteKernel"&&d.kernelModel.model&&d.kernelModel.model.path===c.path&&d.kernelModel.model.name===c.name);if(u)return u}return this.findPreferredKernelSpecConnection(e,t,r,i)}async findPreferredLocalKernelSpecConnection(e,t,r){return this.findPreferredKernelSpecConnection(e,t,r,!1)}async findPreferredKernelSpecConnection(e,t,r,i){let s=lo(e)?.kernelspec?.name,a=()=>{let u=s?t.kernels.filter(f=>(f.kind==="startUsingLocalKernelSpec"||f.kind==="startUsingRemoteKernelSpec")&&f.kernelSpec.name===s):[];if(u.length||i)return u;let d=ET(e);if(d)return t.kernels.filter(f=>(f.kind==="startUsingLocalKernelSpec"||f.kind==="startUsingRemoteKernelSpec")&&f.kernelSpec.language&&(f.kernelSpec.language===d||yl(f.kernelSpec.language)===yl(d)))},l=a();if(Array.isArray(l)&&l.length)return i&&l.length>1?void 0:l[0];if(t.status==="idle")return;let c=[];return new Promise(u=>t.onDidChangeKernels(()=>{if(r.isCancellationRequested)return u(void 0);let d=a();if(Array.isArray(d)&&d.length)return i&&d.length>1?u(void 0):u(d[0]);t.status==="idle"&&u(void 0)},this,this.disposables)).finally(()=>z(c))}async findPreferredPythonKernelConnection(e,t,r){return this.findPreferredPythonKernelConnectionImpl(e,t,r)}async findPreferredPythonKernelConnectionImpl(e,t,r){t=t||ve.instance.get(Dr).registered.find(c=>c.kind==="localPythonEnvironment");let i=ve.instance.get(et),o=uF(e,t);if(o)return o;let s=await i.getActiveInterpreter(e.uri);if(!s)return;let a=()=>{if(!r.isCancellationRequested)return t.kernels.filter(c=>c.kind==="startUsingPythonInterpreter").map(c=>c).find(c=>c.interpreter.id===s.id)},l=a();if(l)return l;if(t.status==="discovering")return await new Promise(c=>{t.onDidChangeStatus(()=>t.status==="idle"&&c(),this,this.disposables),t.onDidChangeKernels(()=>(uF(e,t)||a())&&c(),this,this.disposables)}),uF(e,t)||a()}};function uF(n,e){let t=FT.workspace.getWorkspaceFolder(n.uri)?.uri||(FT.workspace.workspaceFolders?.length===1?FT.workspace.workspaceFolders[0].uri:void 0),r=CH(bi(n.uri),e);if(r)return r;if(t)return CH(t,e)}function CH(n,e){let r=e.kernels.filter(a=>a.kind==="startUsingPythonInterpreter").map(a=>a).filter(a=>eg(lr(a.interpreter)?.environment?.folderUri?.fsPath||a.interpreter.uri.fsPath,n.fsPath)),i=r.find(a=>Ve(a.interpreter)==="Venv"&&No(a.interpreter)?.toLowerCase()===".venv");if(i)return i;let o=r.find(a=>Ve(a.interpreter)==="Conda"&&No(a.interpreter)?.toLowerCase()===".venv");if(o)return o;let s=r.find(a=>No(a.interpreter)?.toLowerCase()===".venv");return s||(r.length?r[0]:void 0)}var LT=class{constructor(e,t,r,i,o){this.notebook=e;this.pythonEnvFilter=i;this.connection=o;this._onDidRefresh=new ec.EventEmitter;this.onDidRefresh=this._onDidRefresh.event;this._onDidChange=new ec.EventEmitter;this.onDidChange=this._onDidChange.event;this.kernels=[];this._onDidChangeStatus=new ec.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeRecommended=new ec.EventEmitter;this.onDidChangeRecommended=this._onDidChangeRecommended.event;this._onDidFailToListKernels=new ec.EventEmitter;this.onDidFailToListKernels=this._onDidFailToListKernels.event;this.status="idle";this.disposables=[];this.refresh=async()=>{this.refreshInvoked=!0},this.title=y.kernelPickerSelectKernelTitle,this.kind=t,this.disposables.push(this._onDidRefresh),Ju(r)?r.then(s=>this.setupFinder(s)).catch(s=>p.error(`Failed to setup finder for ${this.title}`,s)):this.setupFinder(r)}dispose(){z(this.disposables)}setupFinder(e){switch(this.refresh=async()=>e.refresh(),this.status!==e.status&&!this.refreshInvoked&&(this.status=e.status,this._onDidChangeStatus.fire()),this.refreshInvoked?e.refresh().catch(i=>p.error(`Failed to refresh finder for ${this.title}`,i)):e.kind==="remote"&&e.status==="idle"&&this.filteredKernels(e.kernels).length===0&&e.refresh().catch(i=>p.error(`Failed to refresh finder for ${this.title}`,i)),e.kind){case"localKernelSpec":this.title=y.kernelPickerSelectLocalKernelSpecTitle;break;case"localPythonEnvironment":this.title=y.quickPickSelectPythonEnvironmentTitle;break;default:this.title=y.kernelPickerSelectKernelFromRemoteTitle(e.displayName);break}e.onDidChangeKernels(()=>{this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire()},this,this.disposables),e.onDidChangeStatus(()=>{this.status=e.status,this._onDidChangeStatus.fire(),this.status==="idle"&&e.lastError&&this.filteredKernels(e.kernels).length===0&&(this.kernels.length=0,this._onDidFailToListKernels.fire(e.lastError))}),this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire(),this._onDidChangeStatus.fire();let t=new ec.CancellationTokenSource;this.disposables.push(new ec.Disposable(()=>t.cancel())),this.disposables.push(t);let r=new vp(this.connection);this.disposables.push(r),e.kind==="remote"?this.computePreferredRemoteKernel(e,r,t.token):this.computePreferredLocalKernel(e,r,t.token)}filteredKernels(e){let t=this.pythonEnvFilter;return t?e.filter(r=>r.kind!=="startUsingPythonInterpreter"||!t.isPythonEnvironmentExcluded(r.interpreter)):e}computePreferredRemoteKernel(e,t,r){t.findPreferredRemoteKernelConnection(this.notebook,e,r).then(i=>{this.recommended=i,this._onDidChangeRecommended.fire()}).catch(i=>p.error(`Preferred connection failure ${U(this.notebook.uri)}`,i))}computePreferredLocalKernel(e,t,r){let i=()=>{this.recommended&&!this.kernels.find(s=>s.id===this.recommended?.id)&&(this.recommended=void 0),(e.kind==="localKernelSpec"?t.findPreferredLocalKernelSpecConnection.bind(t):t.findPreferredPythonKernelConnection.bind(t))(this.notebook,e,r).then(s=>{this.recommended?.id!==s?.id&&(this.recommended=s,this._onDidChangeRecommended.fire())}).catch(s=>p.error(`Preferred connection failure ${U(this.notebook?.uri)}`,s))};i(),e.onDidChangeKernels(i,this,this.disposables)}};var yp=require("vscode");function tc(n){return"connection"in n}function sme(n){return"command"in n}function ame(n,e,t){let r=t?[t]:n.activeItems.length?[n.activeItems[0]]:[];if(r.length&&!e.includes(r[0])){let i=r[0],o=tc(i)&&e.find(s=>tc(s)&&s.connection.id===i.connection.id);o?r[0]=o:r.length=0}n.items=e,n.activeItems=r}var dF=class extends Error{},UT=class extends $t{constructor(t,r){super();this.provider=t;this.token=r;this.recommendedItems=[];this.existingItems=new Set;this.quickPickItems=[];this.displayDataProvider=ve.instance.get(gd)}async selectKernel(t){return this.selectKernelImpl(t,{quickPick:void 0})}async selectKernelImpl(t,r){if(this.token.isCancellationRequested)return;let i=this.provider.kernels.map(o=>this.connectionToQuickPick(o));return this.quickPickItems.push({kind:yp.QuickPickItemKind.Separator,label:y.kernelCategoryForJupyterKernel}),i.sort((o,s)=>o.label.localeCompare(s.label)),this.quickPickItems.push(...i),this.existingItems=new Set(i),this.selectKernelImplInternal(t,r)}async selectKernelImplInternal(t,r){let i={iconPath:new yp.ThemeIcon("refresh"),tooltip:le.refresh},o={iconPath:new yp.ThemeIcon("loading~spin"),tooltip:le.refreshing},{quickPick:s,selection:a}=t({title:this.provider.title,items:this.quickPickItems,buttons:[i],onDidTriggerButton:async u=>{if(u===i){let d=s.buttons;s.buttons=d.filter(f=>f!==i).concat(o),await this.provider.refresh().catch(h),s.buttons=d}}});r.quickPick=s,this.provider.status==="discovering"&&(s.busy=!0);let l;this._register(this.provider.onDidChangeStatus(()=>{switch(l&&clearTimeout(l),this.provider.status){case"discovering":s.busy=!0;break;case"idle":l=setTimeout(()=>s.busy=!1,500),this._register(new yp.Disposable(()=>l&&clearTimeout(l)));break}},this)),this.updateRecommended(s),this.updateQuickPickItems(s),this._register(this.provider.onDidChangeRecommended(()=>this.updateRecommended(s),this)),this._register(this.provider.onDidChange(()=>this.updateQuickPickItems(s),this));let c=await a;if(!this.token.isCancellationRequested){if(sme(c))try{let u=await c.command();return u?{selection:"controller",connection:u}:void 0}catch(u){if(u instanceof dF)return{selection:"userPerformedSomeOtherAction"};if(u===xe.back)return this.selectKernelImplInternal(t,r);throw u}if(c&&"connection"in c)return{selection:"controller",connection:c.connection};if(c&&"error"in c)throw xe.back}}updateQuickPickItems(t){t.title=this.provider.title;let r=new Set(t.items.filter(u=>tc(u)).map(u=>u).map(u=>u.connection.id)),i=this.provider.kernels.filter(u=>!r.has(u.id)).map(u=>this.connectionToQuickPick(u));this.updateQuickPickWithLatestConnection(t),this.removeMissingKernels(t),this.updateRecommended(t),i.sort((u,d)=>u.label.localeCompare(d.label));let o=0,s=this.existingItems,a=new Map(Array.from(s).map(u=>[u.connection.id,u])),l=s.size;i.forEach(u=>{let d=a.get(u.connection.id);d&&s.delete(d),s.add(u)});let c=Array.from(s);c.sort((u,d)=>u.label.localeCompare(d.label)),this.quickPickItems.splice(o+1,l,...c),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let r=this.recommendedItems.find(a=>tc(a)),i=new Set(this.recommendedItems.filter(tc).map(a=>a.connection.id)),o=this.quickPickItems.filter(a=>!tc(a)||!i.has(a.connection.id)),s=t.activeItems.length?t.activeItems[0]:void 0;r&&tc(r)&&s&&(tc(s)?s.connection.id!==r.connection.id&&(r=void 0):r=void 0),ame(t,this.recommendedItems.concat(o),r)}removeMissingKernels(t){let r=t.items.filter(s=>tc(s)).map(s=>s).map(s=>s.connection.id),i=new Map(this.provider.kernels.map(s=>[s.id,s])),o=r.filter(s=>!i.has(s));if(o.length){let s=[];this.existingItems.forEach(a=>{o.includes(a.connection.id)&&(this.existingItems.delete(a),s.push(a))}),this.quickPickItems=this.quickPickItems.filter(a=>!s.includes(a)),this.rebuildQuickPickItems(t)}}updateRecommended(t){if(!this.provider.recommended){this.recommendedItems.length=0;return}this.recommendedItems.length||this.recommendedItems.push({label:y.recommendedItemCategoryInQuickPick,kind:yp.QuickPickItemKind.Separator});let r=this.connectionToQuickPick(this.provider.recommended,!0);this.recommendedItems.length===2?this.recommendedItems[1]=r:this.recommendedItems.push(r),this.rebuildQuickPickItems(t)}updateQuickPickWithLatestConnection(t){let r=new Map(this.provider.kernels.map(i=>[i.id,i]));this.recommendedItems.concat(this.quickPickItems).forEach(i=>{if(!tc(i)||!r.has(i.connection.id))return;let o=r.get(i.connection.id);o&&(i.label=this.connectionToQuickPick(o,i.isRecommended).label,i.tooltip=this.connectionToQuickPick(o,i.isRecommended).tooltip,i.detail=this.connectionToQuickPick(o,i.isRecommended).detail,i.description=this.connectionToQuickPick(o,i.isRecommended).description,i.isRecommended=this.connectionToQuickPick(o,i.isRecommended).isRecommended,i.connection=o)}),this.rebuildQuickPickItems(t)}connectionToQuickPick(t,r=!1){let i=r?"$(star-full) ":"",o=(l,c,u)=>{l.label=`${i}${c.label}`,l.detail=c.detail,l.description=c.description,this.quickPickItems.forEach(d=>{"connection"in d&&d.connection.id===u.id&&(d.label=c.label,d.detail=c.detail,d.description=c.description)})},s=this.displayDataProvider.getDisplayData(t),a={label:"",detail:"",description:"",isRecommended:r,connection:t};return o(a,s,t),this._register(s.onDidChange(l=>o(a,l,t),this)),a}};var db=class{constructor(e,t,r,i){this.kernelFinder=e;this.multiStepFactory=t;this.pythonEnvFilter=r;this.jupyterConnection=i;this.localDisposables=[]}async selectLocalKernel(e){if(e.notebookType!==bt&&e.notebookType!==Yt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new WT.CancellationTokenSource;let t=this.multiStepFactory.create(),r={disposables:[],notebook:e},i=this.kernelFinder.registered.find(o=>o.id==="localKernelSpec");try{if(await t.run(this.selectKernelFromKernelFinder.bind(this,i,this.cancellationTokenSource.token,t,r),r)===xe.cancel||r.selection?.type==="userPerformedSomeOtherAction")throw new WT.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){z(r.disposables);return}if(r.selection?.type==="connection")return r.selection.connection}finally{z(r.disposables)}}selectKernelFromKernelFinder(e,t,r,i){let o=new LT(i.notebook,e.kind,e,this.pythonEnvFilter,this.jupyterConnection);return i.disposables.push(o),this.selectKernel(o,t,r,i)}async selectKernel(e,t,r,i){if(t.isCancellationRequested)return;let o=new UT(e,t);i.disposables.push(o);let s=l=>{let{quickPick:c,selection:u}=r.showLazyLoadQuickPick({...l,placeholder:"",matchOnDescription:!0,matchOnDetail:!0,supportBackInFirstStep:!0,activeItem:void 0,ignoreFocusOut:!1});return{quickPick:c,selection:u}},a=await o.selectKernel(s);a?.selection==="controller"?i.selection={type:"connection",connection:a.connection}:a?.selection==="userPerformedSomeOtherAction"&&(i.selection={type:"userPerformedSomeOtherAction"})}};db=v([(0,Cf.injectable)(),m(0,(0,Cf.inject)(Dr)),m(1,(0,Cf.inject)(vx)),m(2,(0,Cf.inject)(ii)),m(3,(0,Cf.inject)(sn))],db);var vu=k(N()),Ef=require("vscode");var gu=require("vscode");var VT=class extends $t{constructor(t,r){super();this.notebook=t;this.token=r;let i=ve.instance.get(ii),o=ve.instance.get($e),s=ve.instance.get(Qt),a=ve.instance.get(Ig);this.provider=ve.instance.get(Ts).withFilter(b=>!i.isPythonEnvironmentExcluded(b)),this.pythonEnvPicker=this._register(new Gd(Promise.resolve(this.provider),SD,CD,{supportsBack:!0},void 0,y.quickPickSelectPythonEnvironmentTitle));let l,c=()=>{if(l)return;let b=(gu.workspace.workspaceFolders||[])?.length>0,I=!this.pythonEnvPicker.recommended&&b;l=this.pythonEnvPicker.addCommand({label:`$(add) ${y.createPythonEnvironmentInQuickPick}`},this.createNewEnvironment.bind(this),I)};this.provider.items.length&&c();let u={dispose:h},d=this._register(this.provider.onDidChange(()=>{this.provider.items.length&&(c(),u.dispose(),d.dispose())}));this.provider.refresh().finally(()=>{this.provider.items.length||(u=this.pythonEnvPicker.addCommand({label:y.installPythonQuickPickTitle,tooltip:y.installPythonQuickPickToolTip,description:y.pleaseReloadVSCodeOncePythonHasBeenInstalled},()=>{throw setTimeout(()=>gu.commands.executeCommand(J.InstallPythonViaKernelPicker).then(h,h)),new gu.CancellationError}))}).catch(h);let f=()=>{!this.pythonApi||r.isCancellationRequested||(this.pythonEnvPicker.recommended=oj(this.notebook,this.pythonApi,i,a),l?.dispose(),l=void 0,c())},g=b=>{b&&(this.pythonApi=b,f(),this._register(b.environments.onDidChangeActiveEnvironmentPath(f)),this._register(b.environments.onDidChangeEnvironments(f)))};o.isPythonExtensionInstalled?s.getNewApi().then(g).catch(h):this._register(o.onPythonExtensionInstallationStatusChanged(()=>s.getNewApi().then(g),this)),f()}async selectKernel(){let t=re();gu.extensions.getExtension(Zn)||gu.commands.executeCommand(J.InstallPythonExtensionViaKernelPicker).then(l=>{l===!0?this.provider.refresh().catch(h):t.resolve()},l=>{p.error("Failed to install the Python extension",l),t.resolve()});let r=await Promise.race([this.pythonEnvPicker.selectItem(this.token),t.promise]);if(!r||r instanceof xe)return r||xe.cancel;let i=ve.instance.get(et),o=ve.instance.get(Lr),s=await i.getInterpreterDetails(r.path);if(!s)return xe.cancel;let a=await ws(s,await o.getKernelSpecTempRegistrationFolder());return Oo.create({kernelSpec:a,interpreter:s,id:xi(a,s)})}async createNewEnvironment(){let t=ve.instance.get(Qt);if(!ve.instance.get($e).isPythonExtensionInstalled)return;let o=await this._register(new ab(this.notebook,this.token)).createPythonEnvFromKernelPicker();return o?"action"in o?o.action==="Back"?xe.back:xe.cancel:(await t.getNewApi())?.environments.known.find(a=>a.id===o.kernelConnection.interpreter.id):xe.cancel}};var pb=class extends Jn{constructor(t,r,i,o,s,a){super();this.pythonApi=r;this.filter=i;this.jupyterPaths=o;this.checker=s;this.kind="localPythonEnvironment";this.id="localPythonEnvironment";this.displayName=y.localPythonEnvironments;this._onDidChangeKernels=this._register(new Ef.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._kernels=new Map;this._onDidChangeStatus=this._register(new Ef.EventEmitter);this._status="idle";this.promiseMonitor=new ao;this.onDidChangeStatus=this._onDidChangeStatus.event;this.previousCancellationTokens=[];this.apiHooked=!1;t.push(this),a.registerKernelFinder(this)}get status(){return this._status}set status(t){this._status=t,this._onDidChangeStatus.fire()}get kernels(){return Array.from(this._kernels.values())}activate(){this._register(this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this)),this.checker.isPythonExtensionInstalled?(this.getKernelSpecsDir().catch(h),this.hookupPythonApi().catch(h)):this._register(this.checker.onPythonExtensionInstallationStatusChanged(()=>{this.checker.isPythonExtensionInstalled&&(this.getKernelSpecsDir().catch(h),this.hookupPythonApi().catch(h))},this))}async selectLocalKernel(t){let r=new Ef.CancellationTokenSource,i=[r];try{let o=new VT(t,r.token);i.push(o);let s=await o.selectKernel();if(s instanceof Error){if(s instanceof xe&&s===xe.back)return;throw new Ef.CancellationError}return this.addUpdateKernel(s),s}finally{z(i)}}async getKernelConnection(t){let r=ve.instance.get(et),i=ve.instance.get(Lr),o=await r.getInterpreterDetails(t.path);if(!o){p.warn(`Python Env ${U(t.id)} not found}`);return}if(!o||this.filter.isPythonEnvironmentExcluded(o)){p.warn(`Python Env hidden via filter: ${U(o.id)}`);return}let s=await ws(o,await i.getKernelSpecTempRegistrationFolder()),a=Oo.create({kernelSpec:s,interpreter:o,id:xi(s,o)}),l=this._kernels.get(a.id);return l||(this.addUpdateKernel(a),a)}addUpdateKernel(t){let r=this._kernels.get(t.id);r?(r.updateInterpreter(t.interpreter),this._kernels.set(t.id,Object.assign(r,t)),this._onDidChangeKernels.fire({})):(this._kernels.set(t.id,t),this._onDidChangeKernels.fire({}))}async refresh(){this.previousCancellationTokens.forEach(t=>t.cancel()),z(this.previousCancellationTokens),this.previousCancellationTokens=[],this._kernels.clear(),this.pythonApi.getNewApi().then(t=>{t&&(this.promiseMonitor.push(t.environments.refreshEnvironments({forceRefresh:!0}).catch(h)),t.environments.known.forEach(r=>this.buildDummyEnvironment(r).catch(h)))}).catch(h)}getKernelSpecsDir(){return this.tempDirForKernelSpecs||(this.tempDirForKernelSpecs=this.jupyterPaths.getKernelSpecTempRegistrationFolder()),this.tempDirForKernelSpecs}async hookupPythonApi(){if(this.apiHooked)return;this.apiHooked=!0;let t=await this.pythonApi.getNewApi();t&&(t.environments.known.map(r=>this.buildDummyEnvironment(r).catch(h)),this._register(t.environments.onDidChangeEnvironments(r=>{if(r.type==="remove"){let i=this._kernels.get(r.env.id);i&&(this._kernels.delete(r.env.id),this._onDidChangeKernels.fire({removed:[i]}))}else this.buildDummyEnvironment(r.env).catch(h)},this)))}async buildDummyEnvironment(t){let r=aj(t);if(!r||this.filter.isPythonEnvironmentExcluded(r))return;let i=await ws(r,await this.getKernelSpecsDir()),o=Oo.create({kernelSpec:i,interpreter:r,id:xi(i,r)});this._kernels.get(t.id)||(this._kernels.set(t.id,o),this._onDidChangeKernels.fire({}))}};pb=v([(0,vu.injectable)(),m(0,(0,vu.inject)(M)),m(1,(0,vu.inject)(Qt)),m(2,(0,vu.inject)(ii)),m(3,(0,vu.inject)(Lr)),m(4,(0,vu.inject)($e)),m(5,(0,vu.inject)(Dr))],pb);var rc=k(N()),Kn=require("vscode");function jT(n){return n===Ae||n===uh}var mb=class{constructor(e,t,r,i,o,s,a){this.kernelFinder=e;this.serverUriStorage=t;this.serverSelector=r;this.jupyterConnection=i;this.displayDataProvider=o;this.kernelFinderController=s;this.jupyterServerRegistry=a;this.localDisposables=[]}async selectRemoteKernel(e,t){if(e.notebookType!==bt&&e.notebookType!==Yt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new Kn.CancellationTokenSource;let r=new DC,i={disposables:[],notebook:e};try{if(await r.run(this.getRemoteServersFromProvider.bind(this,t,this.cancellationTokenSource.token),i)===xe.cancel||i.selection?.type==="userPerformedSomeOtherAction")throw new Kn.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){z(i.disposables);return}if(i.selection?.type==="connection")return i.selection.connection}finally{z(i.disposables)}}async getRemoteServersFromProvider(e,t,r,i){let o=this.kernelFinder.registered.filter(T=>T.kind==="remote"),s=[],a=[],l=[],c=this.jupyterServerRegistry.jupyterCollections.find(T=>T.extensionId===e.extensionId&&T.id===e.id)?.serverProvider,u=c?.provideJupyterServers?Promise.resolve(c.provideJupyterServers.bind(c)(t)).then(T=>T||[]):Promise.resolve([]),d=new Set,f=await u,g=new Set(f.map(T=>T.id));if(o.filter(T=>T.serverProviderHandle.id===e.id).filter(T=>g.has(T.serverProviderHandle.id)).map(T=>{let $=this.serverUriStorage.all.find(ne=>Mt(ne.provider)===Mt(T.serverProviderHandle));d.add(Mt(T.serverProviderHandle)),l.push({server:T,time:$?.time})}),l.sort((T,$)=>!T.time&&!$.time?T.server.displayName.localeCompare($.server.displayName):!T.time&&$.time?1:T.time&&!$.time||(T.time||0)>($.time||0)?-1:1),l.filter(({time:T})=>(T||0)>0).forEach(({server:T,time:$})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,description:$?y.jupyterServerLastConnectionForQuickPickDescription(new Date($)):void 0,buttons:c?.removeJupyterServer&&jT(e.extensionId)?[{iconPath:new Kn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),l.filter(({time:T})=>!T).forEach(({server:T})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,buttons:c?.removeJupyterServer&&jT(e.extensionId)?[{iconPath:new Kn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),f.sort((T,$)=>T.label.localeCompare($.label)).forEach(T=>{let $=Mt({extensionId:e.extensionId,id:e.id,handle:T.id});d.has($)||s.push({type:"jupyterServer",label:T.label,idAndHandle:{extensionId:e.extensionId,id:e.id,handle:T.id},server:T,buttons:c?.removeJupyterServer&&jT(e.extensionId)?[{iconPath:new Kn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),e.commandProvider){let T=(await Promise.resolve(e.commandProvider.provideCommands(void 0,t))||[]).map($=>({...$,provider:e,type:"uriProviderQuickPick",command:$}));s.length>0&&T.length&&a.push({label:"",kind:Kn.QuickPickItemKind.Separator}),a.push(...T)}let b=s.concat(a),I=new Kn.EventEmitter,w=b.length===1&&"command"in b[0]&&b[0].command.canBeAutoSelected?b[0]:void 0;if(c){let T=b.filter($=>"type"in $);T.length===1&&T.every($=>$.type!=="uriProviderQuickPick")?w=T[0]:T.every($=>$.type==="uriProviderQuickPick")&&T.filter($=>$.picked).length===1&&(w=b.filter($=>$.picked)[0])}let D,A;if(w)A=w;else{let{quickPick:T,selection:$}=r.showLazyLoadQuickPick({items:b,placeholder:e.extensionId===Ae||e.extensionId===uh?y.enterOrSelectRemoteJupyterPlaceholder:y.selectRemoteJupyterPlaceholder,title:y.quickPickTitleForSelectionOfJupyterServer,supportBackInFirstStep:!0,onDidTriggerItemButton:async ne=>{if("type"in ne.item&&(ne.item.type==="finder"||ne.item.type==="jupyterServer")){let H=ne.item.idAndHandle.handle,oe=f.find(ae=>ae.id===H);c?.removeJupyterServer&&oe&&jT(e.extensionId)&&(T.busy=!0,this.serverUriStorage.remove({extensionId:e.extensionId,id:e.id,handle:H}).catch(h),await c.removeJupyterServer(oe),T.busy=!1,b.splice(b.indexOf(ne.item),1),I.fire(b.concat([])))}},onDidChangeItems:I.event});T.onDidChangeValue(async ne=>{if(!e.commandProvider?.provideCommands)return;let H=[];s.length>0&&H.push({label:"",kind:Kn.QuickPickItemKind.Separator});let ae=(await Promise.resolve(e.commandProvider.provideCommands(ne,t))||[]).map(Y=>({...Y,provider:e,type:"uriProviderQuickPick",command:Y}));T.items=s.concat(H).concat(ae)},this),D=T,A=await $}if(!t.isCancellationRequested&&A&&"type"in A)switch(A.type){case"finder":{let T=await this.selectRemoteKernelFromPicker(i.notebook,Promise.resolve(A.kernelFinderInfo),t).catch($=>p.error("Failed to select a kernel",$));if(T&&T===xe.back){if(A===w)throw xe.back;return this.getRemoteServersFromProvider(e,t,r,i)}if(!T||T instanceof xe)throw new Kn.CancellationError;i.selection={type:"connection",connection:T};return}case"jupyterServer":{let T=(async()=>{let ne={id:e.id,handle:A.server.id,extensionId:e.extensionId};return e.extensionId.toLowerCase()===qa.toLowerCase()&&await rr(t,this.serverSelector.addJupyterServer(ne)),this.kernelFinderController.getOrCreateRemoteKernelFinder(ne,A.server.label)})(),$=await this.selectRemoteKernelFromPicker(i.notebook,T,t).catch(ne=>p.error("Failed to select a kernel",ne));if($&&$===xe.back){if(A===w)throw xe.back;return this.getRemoteServersFromProvider(e,t,r,i)}if(!$||$ instanceof xe)throw new Kn.CancellationError;i.selection={type:"connection",connection:$};return}case"uriProviderQuickPick":{let T=Kn.notebooks.createNotebookControllerDetectionTask(bt);try{D&&(D.busy=!0);let $=await this.selectRemoteServerFromRemoteKernelFinder(A,i,t);return D&&(D.busy=!1),$}catch($){if($===xe.back&&!w)return this.getRemoteServersFromProvider(e,t,r,i);throw $}finally{T.dispose()}}default:break}}async selectRemoteServerFromRemoteKernelFinder(e,t,r){if(!e.provider.commandProvider?.handleCommand||r.isCancellationRequested)return;let i=await Promise.resolve(e.provider.commandProvider.handleCommand(e.command,r));if(!i)throw xe.back;if(r.isCancellationRequested)throw new Kn.CancellationError;let o=(async()=>{let a={id:e.provider.id,handle:i.id,extensionId:e.provider.extensionId};return a.extensionId.toLowerCase()===qa.toLowerCase()&&await rr(r,this.serverSelector.addJupyterServer(a)),this.kernelFinderController.getOrCreateRemoteKernelFinder(a,i.label)})(),s=await this.selectRemoteKernelFromPicker(t.notebook,o,r).catch(a=>p.error("Failed to select a kernel",a));if(s&&s===xe.back)throw xe.back;if(!s||s instanceof xe)throw new Kn.CancellationError;t.selection={type:"connection",connection:s}}async selectRemoteKernelFromPicker(e,t,r){let i,o=u=>{let d=this.displayDataProvider.getDisplayData(u);return{label:`${u===i?"$(star-full) ":""}${d.label}`,description:d.description,detail:d.detail}},s=u=>({label:this.displayDataProvider.getDisplayData(u).category||"Other"}),a=u=>({label:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel,detail:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail}),l=new Gd(t,o,s,{supportsBack:!0},a),c=new vp(this.jupyterConnection);return t.then(u=>c.findPreferredRemoteKernelConnection(e,u,r)).then(u=>{i=u,u?.kind==="startUsingRemoteKernelSpec"&&(l.recommended=u),l.selected=u}).catch(u=>p.error("Failed to determine preferred remote kernel",u)),l.selectItem(r)}};mb=v([(0,rc.injectable)(),m(0,(0,rc.inject)(Dr)),m(1,(0,rc.inject)(Ht)),m(2,(0,rc.inject)(da)),m(3,(0,rc.inject)(sn)),m(4,(0,rc.inject)(gd)),m(5,(0,rc.inject)(IE)),m(6,(0,rc.inject)(Vt))],mb);function EH(n,e){n.addSingleton(it,eb),n.addBinding(it,me),n.addSingleton(gd,Zy),n.addSingleton(Ak,mb),n.addSingleton(Nk,db),n.addSingleton(ym,pb),n.addBinding(ym,me),n.addSingleton(me,ub),n.addSingleton(me,cb),IH(n,e)}var LE=k(N()),wf=require("vscode");var Aa=Symbol("IJupyterDebugService"),bp=Symbol("INotebookDebuggingManager");var JT=Symbol("IDebugLocationTrackerFactory"),BT=Symbol("IDebugLocationTracker");var fb=class{constructor(e,t){this.debuggingManager=e;this.disposables=t}activate(){this.disposables.push(wf.commands.registerCommand(J.RunByLine,this.runByLine,this)),this.disposables.push(wf.commands.registerCommand(J.RunByLineNext,this.runByLineNext,this)),this.disposables.push(wf.commands.registerCommand(J.RunByLineStop,this.runByLineStop,this)),this.disposables.push(wf.commands.registerCommand(J.RunAndDebugCell,this.runAndDebugCell,this))}async runByLine(e){R("DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(0,e)}async runByLineNext(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineNext(e)}async runByLineStop(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineStop(e)}async runAndDebugCell(e){R("DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(1,e)}getCellFromActiveEditor(){let e=wf.window.activeNotebookEditor;if(e){let t=e.selections[0];if(t)return e.notebook.cellAt(t.start)}}dispose(){this.disposables.forEach(e=>e.dispose())}};fb=v([(0,LE.injectable)(),m(0,(0,LE.inject)(bp)),m(1,(0,LE.inject)(M))],fb);var yu=k(N());var hb=class{constructor(e,t,r){this.debugService=e;this.disposables=t;this.debugVariables=r}activate(){this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(ge,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory("debugpy",this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(ZS,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(eC,this))}createDebugAdapterTracker(e){return this.debugVariables}};hb=v([(0,yu.injectable)(),m(0,(0,yu.inject)(Aa)),m(0,(0,yu.named)(Je.MULTIPLEXING_DEBUGSERVICE)),m(1,(0,yu.inject)(M)),m(2,(0,yu.inject)(yn)),m(2,(0,yu.named)(Je.DEBUGGER_VARIABLES))],hb);var Na=k(N());var UE=require("vscode");var pF=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]);function qT(n){return{name:n.evaluateName??n.name,type:n.type,count:0,shape:"",size:0,supportsDataExplorer:pF.has(n.type||""),value:n.value,truncated:!0,frameId:n.variablesReference}}function HT(n){let e=n.index,t=n.columns;return{data:n.data.map((o,s)=>{let a={index:e[s]};return t.forEach((l,c)=>{a[l]=o[c]}),a})}}var mF=require("vscode"),gb=class{constructor(e){this._sessionId=e;this.topMostFrameId=0;this.sequenceNumbersOfRequestsPendingResponses=new Set;this.waitingForStackTrace=!1;this.debugLocationUpdatedEvent=new mF.EventEmitter;this.sessionEndedEmitter=new mF.EventEmitter;this.DebugLocation=void 0}get sessionId(){return this._sessionId}get sessionEnded(){return this.sessionEndedEmitter.event}get debugLocationUpdated(){return this.debugLocationUpdatedEvent.event}get debugLocation(){return this._debugLocation}onDidSendMessage(e){if(this.isResponseForRequestToFetchAllFrames(e)){let t=e.body?.stackFrames[0];this.topMostFrameId=t?.id,this.sequenceNumbersOfRequestsPendingResponses.delete(e.request_seq),this.waitingForStackTrace&&(this.DebugLocation={lineNumber:t?.line,fileName:this.normalizeFilePath(t?.source?.path),column:t.column},this.waitingForStackTrace=!1)}this.isStopEvent(e)&&(this.waitingForStackTrace=!0),this.isContinueEvent(e)&&(this.DebugLocation=void 0,this.waitingForStackTrace=!1)}onWillStopSession(){this.sessionEndedEmitter.fire(this)}onWillReceiveMessage(e){this.isRequestToFetchAllFrames(e)&&this.sequenceNumbersOfRequestsPendingResponses.add(e.seq)}set DebugLocation(e){let t=this._debugLocation;this._debugLocation=e,this._debugLocation!==t&&this.debugLocationUpdatedEvent.fire()}normalizeFilePath(e){return process.platform!=="win32"?e.replace(/\\/g,"/"):e}isStopEvent(e){return e.type==="event"&&e.event==="stopped"}isContinueEvent(e){if(e.type==="event"){if(e.event==="continue")return!0}else if(e.type==="response"&&e.command==="continue")return!0;return!1}isResponseForRequestToFetchAllFrames(e){return e.type==="response"&&e.command==="stackTrace"&&e.body?.stackFrames[0]&&this.sequenceNumbersOfRequestsPendingResponses.has(e.request_seq)}isRequestToFetchAllFrames(e){return e.type==="request"&&e.command==="stackTrace"&&(e.arguments.startFrame===0||e.arguments.startFrame===void 0)}};var lme=new Set(["In","Out","exit","quit"]),GT=100,vb=class extends gb{constructor(t,r,i,o,s,a){super(void 0);this.debugService=t;this.debuggingManager=r;this.configService=i;this.varScriptGenerator=o;this.dfScriptGenerator=s;this.kernelProvider=a;this.refreshEventEmitter=new UE.EventEmitter;this.lastKnownVariables=[];this.importedGetVariableInfoScriptsIntoKernel=new Set;this.watchedNotebooks=new Map;this.debuggingStarted=!1;this.currentVariablesReference=0;this.currentSeqNumsForVariables=new Set;this.debuggingManager.onDoneDebugging(()=>this.refreshEventEmitter.fire(),this)}get refreshRequired(){return this.refreshEventEmitter.event}get active(){return(this.debugService.activeDebugSession!==void 0||this.activeNotebookIsDebugging())&&this.debuggingStarted}getAllVariableDiscriptions(){throw new Error("Method not implemented.")}async getVariables(t,r){r&&this.watchKernel(r);let i=r&&this.kernelProvider.getKernelExecution(r),o={executionCount:i?i.executionCount:t.executionCount,pageStartIndex:0,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(this.active){let s=t.sortColumn,a=(u,d)=>{let f=u[s]?u[s]:"",g=d[s]?d[s]:"";return t.sortAscending?f.localeCompare(g,void 0,{sensitivity:"base"}):g.localeCompare(f,void 0,{sensitivity:"base"})};this.lastKnownVariables.sort(a);let l=t.startIndex?t.startIndex:0,c=t.pageSize?t.pageSize:GT;o.pageStartIndex=l;for(let u=l;u<l+c&&u<this.lastKnownVariables.length;u+=1){let d=this.lastKnownVariables[u].truncated?await this.getFullVariable(this.lastKnownVariables[u]):this.lastKnownVariables[u];this.lastKnownVariables[u]=d,o.pageResponse.push(d)}o.totalCount=this.lastKnownVariables.length}return o}async getMatchingVariable(t,r){if(this.active){let i=this.lastKnownVariables.find(o=>o.name===t);return i&&r?.resourceUri&&Yu(r?.resourceUri).toLowerCase()===".ipynb"&&R("DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER"),i}}async getVariableValueSummary(t){}async getDataFrameInfo(t,r,i,o){if(!this.active)return t;o&&(t=await this.getFullVariable(t)),r&&this.watchKernel(r);let s=t.name;i&&(s=`${t.name}${i}`);let{cleanupCode:a,initializeCode:l,code:c}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!0,variableName:s}),u=await this.evaluate({code:c,cleanupCode:a,initializeCode:l,frameId:t.frameId}),d=r?.notebook,f=d?Se(d.uri.path):"";return!f&&this.debugLocation?.fileName&&(f=Se(this.debugLocation.fileName)),u?{...t,...JSON.parse(u.result),maximumRowChunkSize:GT,fileName:f}:t}async getDataFrameRows(t,r,i,o,s){if(i-r>GT)throw new Error(`Debugger cannot provide more than ${GT} rows at once`);if(!this.debugService.activeDebugSession||t.columns===void 0)return{data:[]};o&&this.watchKernel(o);let a=t.name;s&&(a=`${t.name}${s}`);let{cleanupCode:l,initializeCode:c,code:u}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!0,variableName:a,startIndex:r,endIndex:i}),d=await this.evaluate({code:u,cleanupCode:l,initializeCode:c,frameId:t.frameId});return HT(JSON.parse(d.result))}onWillReceiveMessage(t){super.onWillReceiveMessage(t),t.type==="request"&&t.command==="variables"&&t.arguments&&this.currentVariablesReference===t.arguments.variablesReference&&this.currentSeqNumsForVariables.add(t.seq)}onDidSendMessage(t){if(super.onDidSendMessage(t),t.type==="response"&&t.command==="initialize")this.debuggingStarted=!0;else if(t.type==="event"&&t.event==="stopped"&&this.activeNotebookIsDebugging())this.handleNotebookVariables(t).catch(h);else if(t.type==="response"&&t.command==="scopes"&&t.body&&t.body.scopes){let i=t.body.scopes[0].variablesReference;i!==this.currentVariablesReference&&(this.currentVariablesReference=i,this.currentSeqNumsForVariables.clear())}else if(t.type==="response"&&t.command==="variables"&&t.body)this.currentSeqNumsForVariables.has(t.request_seq)&&this.updateVariables(void 0,t),this.monkeyPatchDataViewableVariables(t);else if(t.type==="event"&&t.event==="terminated"){this.lastKnownVariables=[],this.topMostFrameId=0,this.debuggingStarted=!1,this.refreshEventEmitter.fire();let r=this.debugService.activeDebugSession?.id;r&&this.importedGetVariableInfoScriptsIntoKernel.delete(r)}}watchKernel(t){let r=t.notebook?.uri.toString();if(r&&!this.watchedNotebooks.has(r)){let i=[];i.push(t.onRestarted(this.resetImport.bind(this,r))),i.push(t.onDisposed(()=>{this.resetImport(r),i.forEach(o=>o.dispose()),this.watchedNotebooks.delete(r)})),this.watchedNotebooks.set(r,i)}}resetImport(t){this.importedGetVariableInfoScriptsIntoKernel.delete(t)}async evaluate({code:t,cleanupCode:r,frameId:i,initializeCode:o}){if(this.debugService.activeDebugSession){i=this.topMostFrameId||i;let s={frameId:i,context:"repl",format:{rawString:!0}};p.debug(`Evaluating in debugger : ${this.debugService.activeDebugSession.id}: ${t}`);try{o&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:o});let a=await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:t});if(a&&a.result!=="None")return a;p.error(`Cannot evaluate ${t}`);return}finally{r&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:r})}}throw Error("Debugger is not active, cannot evaluate.")}async getFullVariable(t){let{initializeCode:r,code:i,cleanupCode:o}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!0,variableName:t.name}),s=await this.evaluate({code:i,initializeCode:r,cleanupCode:o,frameId:t.frameId});return s&&s.result?{...t,truncated:!1,...JSON.parse(s.result)}:t}monkeyPatchDataViewableVariables(t){t.body.variables.forEach(r=>{r.type&&pF.has(r.type)&&r.evaluateName&&(r.__vscodeVariableMenuContext="viewableInDataViewer")})}updateVariables(t,r){let i=this.configService.getSettings(t).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],o=r.body.variables.filter(s=>!(!s.name||!s.type||!s.value||i&&i.includes(s.type)||s.name.startsWith("_")||lme.has(s.name)||s.type==="NoneType"));this.lastKnownVariables=o.map(s=>qT(s)),this.refreshEventEmitter.fire()}activeNotebookIsDebugging(){let t=UE.window.activeNotebookEditor;return!!t&&this.debuggingManager.isDebugging(t.notebook)}async handleNotebookVariables(t){let r=UE.window.activeNotebookEditor?.notebook,i=t.body.threadId;if(r){let o=this.debuggingManager.getDebugSession(r);if(o){let s=await o.customRequest("stackTrace",{threadId:i,startFrame:0,levels:1});if(s&&s.stackFrames[0]){let a=s.stackFrames[0],l=this.debuggingManager.getDebugMode(r),c;if(l===0){let u=this.debuggingManager.getDebugCell(r);a.source&&u&&a.source.path===u.document.uri.toString()&&(c=await o.customRequest("scopes",{frameId:a.id}))}else{let u=Se(r.uri.toString());a.source&&a.source.path&&a.source.path.includes(u)&&(c=await o.customRequest("scopes",{frameId:a.id}))}c&&(c.scopes.forEach(u=>{o.customRequest("variables",{variablesReference:u.variablesReference}).then(h,h)}),this.refreshEventEmitter.fire())}}}}};vb=v([(0,Na.injectable)(),m(0,(0,Na.inject)(Aa)),m(0,(0,Na.named)(Je.MULTIPLEXING_DEBUGSERVICE)),m(1,(0,Na.inject)(bp)),m(2,(0,Na.inject)(ie)),m(3,(0,Na.inject)(Oh)),m(4,(0,Na.inject)(Fh)),m(5,(0,Na.inject)(we))],vb);var bu=k(N()),Ip=require("vscode");var wH=require("vscode"),ir=class{constructor(e){this.name=e}get value(){return this.lastValue}async set(e){this.lastValue!==e&&(this.lastValue=e,await wH.commands.executeCommand("setContext",this.name,this.lastValue))}};var TH=require("vscode");var WE=(o=>(o[o.Unknown=0]="Unknown",o[o.Ok=1]="Ok",o[o.Outdated=2]="Outdated",o[o.NotInstalled=3]="NotInstalled",o[o.ControllerNotSelected=4]="ControllerNotSelected",o))(WE||{});async function PH(n){let e="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",t=`import builtins
import ipykernel
builtins.print("${e}" + ipykernel.__version__ + "${e}")`,r=await n.executeHidden(t),i=/^(\d+)\.\d+\.\d+$/;for(let o of r){if(o.output_type!=="stream")continue;let s=o.text?.toString().trim()??"";if(!s.includes(e))continue;let a=s.split(e)[1].trim().match(i);if(a){let l=a[1];return Number(l)>=6?1:2}}return 0}function VE(n){let e=n;if(typeof e.__notebookUri>"u"||typeof e.__mode>"u"||(e.__mode===1||e.__mode===2||e.__mode===0)&&typeof e.__cellIndex>"u")throw new Error("Invalid launch configuration")}function kH(n){if(VE(n),n.__mode!==2)throw new Error("Invalid launch configuration")}function zT(n,e){switch(n.type){case"event":let t=n;switch(t.event){case"output":e(t.body);break;case"loadedSource":e(t.body);break;case"breakpoint":e(t.body.breakpoint);break;default:break}break;case"request":let r=n;switch(r.command){case"setBreakpoints":let o=r.arguments,s=o.breakpoints;if(s&&s.length){let a=s[0].line;s.forEach(c=>{e(c,{...o.source})});let l={source:o.source,line:a};e(l),o.source=l.source}break;case"breakpointLocations":e(r.arguments);break;case"source":e(r.arguments);break;case"gotoTargets":e(r.arguments);break;default:break}break;case"response":let i=n;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(o=>{e(o)});break;case"loadedSources":i.body.sources.forEach(o=>{let s={source:o};e(s),o.path=s.source.path});break;case"scopes":i.body.scopes.forEach(o=>{e(o)});break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;case"setBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;default:break}break}}function xH(n){return/~\d+\\/.test(n)}function DH(n,e){return new RegExp(n.replace(/\\/g,"\\\\").replace(/~\d+\\\\/g,"[^\\\\]+\\\\"),"i").test(e)}async function Pf(n,e){let t=`import debugpy
debugpy.debug_this_thread()`;await n.executeHidden(t),await e.dumpAllCells()}function _H(n){return!!n.header&&n.header.msg_type==="debug_event"}function jE(n){return n.includes("Frame skipped from debugging during step-in")}function fF(n){return n.event==="debugpyAttach"}var QT=class{constructor(e,t,r){this.debugAdapter=e;this.debugCell=t;this.execution=r;R("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){p.debug(`[Debug-Cell] ${e}: ${t}`)}async willSendEvent(e){return fF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&jE(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){e.command==="configurationDone"&&(await Pf(this.execution,this.debugAdapter),TH.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(h,h))}};var JE=class{constructor(e,t,r,i){this.mode=e;this.debugAdapter=t;this.debugCell=r;this.serviceContainer=i;this.debuggingManager=this.serviceContainer.get(bp)}trace(e,t){p.debug(`[Debug-Restart] ${e}: ${t}`)}error(e,t){p.error(`[Debug-Restart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Handling restart request"),setTimeout(()=>{this.debugAdapter.disconnect().then(()=>(this.trace("restart","doRestart"),this.debuggingManager.tryToStartDebugging(this.mode,this.debugCell,!0))).catch(t=>{this.error("restart",`Error restarting: ${t}`)})},0),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var BE=require("vscode");var YT=class{constructor(e,t,r,i){this.debugAdapter=e;this.debugCell=t;this.execution=r;this.settings=i;R("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE")}continue(){if(typeof this.lastPausedThreadId!="number"){p.debug("No paused thread, can't do RBL"),this.stop();return}this.debugAdapter.stepIn(this.lastPausedThreadId).then(h,h)}stop(){p.ci("RunbylineController::stop()"),this.execution.executeHidden("pass").then(h,h),this.debugAdapter.disconnect().then(h,h)}getMode(){return this.debugAdapter.getConfiguration().__mode}async willSendEvent(e){return e.event==="stopped"&&(this.lastPausedThreadId=e.body.threadId,await this.handleStoppedEvent(this.lastPausedThreadId))?(this.trace("intercepted","handled stop event"),!0):e.event==="output"&&jE(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){p.ci(`willSendRequest: ${e.command}`),e.command==="configurationDone"&&await this.initializeExecute()}async handleStoppedEvent(e){return await this.shouldStepIn(e)?(this.debugAdapter.stepIn(e).then(h,h),!0):!1}async shouldStepIn(e){let t=await this.debugAdapter.stackTrace({threadId:e,startFrame:0,levels:1});if(t&&t.stackFrames[0]){let r=t.stackFrames[0],i=new BE.Position(r.line,r.column);return this.lastPausePosition?.isEqual(i)?(this.trace("intercept","working around duplicate stop event"),!0):(this.lastPausePosition=i,!!r.source&&r.source.path!==this.debugCell.document.uri.toString())}return!1}trace(e,t){p.debug(`[Debug-RBL] ${e}: ${t}`)}async initializeExecute(){await Pf(this.execution,this.debugAdapter);let e=Ue(this.debugCell.document.getText(),{trim:!1,removeEmptyEntries:!1}),t=[];if(pm(e,()=>void 0,(r,i)=>{r.trim().length!==0&&t.push(i)}),t.sort(),t.length!==0){let r={line:t[0]+1};await this.debugAdapter.setBreakpoints({source:{name:Se(this.debugCell.notebook.uri.path),path:this.debugCell.document.uri.toString()},breakpoints:[r],sourceModified:!1}),this.settings.getSettings(this.debugCell.notebook.uri).showVariableViewWhenDebugging&&BE.commands.executeCommand(J.OpenVariableView).then(h,h)}BE.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(h,h)}};var yb=class{constructor(e,t,r){this.document=e;this.config=t;this.session=r}};var On=require("vscode");var bb=class{constructor(e,t,r){this.kernelProvider=e;this.controllerRegistration=t;this.serviceContainer=r;this.notebookToDebugger=new Map;this.notebookToDebugAdapter=new Map;this.notebookInProgress=new Set;this.disposables=[];this._doneDebugging=new On.EventEmitter}activate(){this.disposables.push(On.debug.onDidTerminateDebugSession(this.endSession.bind(this)),On.workspace.onDidCloseNotebookDocument(async e=>{let t=this.notebookToDebugger.get(e);t&&(await On.debug.stopDebugging(t.session),this.onDidStopDebugging(e))}))}getDebugCell(e){return this.notebookToDebugAdapter.get(e)?.debugCell}get onDoneDebugging(){return this._doneDebugging.event}dispose(){this.disposables.forEach(e=>e.dispose())}isDebugging(e){return this.notebookToDebugger.has(e)}getDebugSession(e){let t=this.notebookToDebugger.get(e);if(t)return t.session}getDebugAdapter(e){return this.notebookToDebugAdapter.get(e)}onDidStopDebugging(e){}async startDebuggingConfig(e,t){p.ci(`Attempting to start debugging with config ${JSON.stringify(e)}`);try{await On.debug.startDebugging(void 0,e,t)}catch(r){p.error(`Can't start debugging (${r})`),On.window.showErrorMessage(y.cantStartDebugging).then(h,h)}}trackDebugAdapter(e,t){this.notebookToDebugAdapter.set(e,t),this.disposables.push(t.onDidEndSession(this.endSession.bind(this)))}async endSession(e){p.info(`Ending debug session ${e.id}`),this._doneDebugging.fire();for(let[t,r]of this.notebookToDebugger.entries())if(r&&e.id===r.session.id){this.notebookToDebugger.delete(t),this.notebookToDebugAdapter.delete(t),this.onDidStopDebugging(t);break}}getDebuggerByUri(e){for(let[t,r]of this.notebookToDebugger.entries())if(e===t)return r}async ensureKernelIsRunning(e){let t=this.controllerRegistration.getSelected(e),r=this.kernelProvider.get(e);return t&&(!r||r&&r.status==="unknown")&&(r=await Vs.connectToNotebookKernel(t.connection,this.serviceContainer,{notebook:e,controller:t.controller,resource:e.uri},new Ft(!1),this.disposables,"jupyterExtension")),r}findEditorForCell(e){let t=e.notebook.uri.toString();return On.window.visibleNotebookEditors.find(r=>r.notebook.uri.toString()===t)}async checkIpykernelAndPrompt(e,t=!0){let r=this.findEditorForCell(e);if(!r)return On.window.showErrorMessage(y.noNotebookToDebug).then(h,h),0;let i=await this.checkForIpykernel6(r.notebook);switch(i){case 3:break;case 2:case 0:{this.promptInstallIpykernel6().then(h,h);break}case 4:if(t)return await On.commands.executeCommand("notebook.selectKernel",{notebookEditor:r}),await this.checkIpykernelAndPrompt(e,!1)}return i}async checkForIpykernel6(e){try{let t=this.kernelProvider.get(e);if(!t){let s=this.controllerRegistration.getSelected(e);if(!s)return 4;t=this.kernelProvider.getOrCreate(e,{metadata:s.connection,controller:s?.controller,resourceUri:e.uri})}let r=t.kernelConnectionMetadata;if(xt(r)){if(r.kind==="startUsingRemoteKernelSpec"&&r.kernelSpec.metadata?.debugger)return 1;if(r.kind==="connectToLiveRemoteKernel"&&r.kernelModel.metadata?.debugger)return 1}let i=this.kernelProvider.getKernelExecution(t),o=await PH(i);return R("DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",void 0,{status:o===1?"installed":"notInstalled"}),o}catch(t){p.error("Debugging: Could not check for ipykernel 6",t)}return 0}async promptInstallIpykernel6(){await On.window.showInformationMessage(y.needIpykernel6,{modal:!0},y.setup)===y.setup?(R("DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP"),On.env.openExternal(On.Uri.parse("https://github.com/microsoft/vscode-jupyter/wiki/Setting-Up-Run-by-Line-and-Debugging-for-Notebooks"))):R("DATASCIENCE.DEBUGGING.CLOSED_MODAL")}};var Ma=require("vscode");var XT=class{constructor(e){this.debugAdapter=e}trace(e,t){p.debug(`[Debug-Reset] ${e}: ${t}`)}async willSendRequest(e){e.command==="attach"&&(this.trace("attach","Continuing paused kernel threads if needed"),(await this.debugAdapter.debugInfo()).stoppedThreads.forEach(r=>this.debugAdapter.continueDirect(r)))}};var Ib=class{constructor(e,t,r,i,o,s){this.session=e;this.notebookDocument=t;this.jupyterSession=r;this.kernel=i;this.platformService=o;this.debugService=s;this.fileToCell=new Map;this.sendMessage=new Ma.EventEmitter;this.endSession=new Ma.EventEmitter;this.disposables=[];this.delegates=[];this.onDidSendMessage=this.sendMessage.event;this.onDidEndSession=this.endSession.event;this.disconnected=!1;p.ci("Creating kernel debug adapter for debugging notebooks");let a=this.session.configuration;VE(a),this.configuration=a,this.debugCell=t.cellAt(a.__cellIndex),this.addDebuggingDelegates([new XT(this)]),this.jupyterSession.kernel?.iopubMessage.connect(this.onIOPubMessage,this),this.disposables.push(new Ma.Disposable(()=>this.jupyterSession.kernel?.iopubMessage.disconnect(this.onIOPubMessage,this))),this.kernel&&(this.kernel.addHook("willRestart",()=>this.disconnect(),this,this.disposables),this.kernel.addHook("interruptCompleted",()=>this.disconnect(),this,this.disposables),this.disposables.push(this.kernel.onDisposed(()=>{this.disconnected||(Ma.debug.stopDebugging(this.session).then(h,h),this.disconnect().catch(h),R("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"onKernelDisposed"}))}))),this.disposables.push(nr.onDidChangeNotebookCellExecutionState(l=>{this.configuration.__cellIndex===l.cell.index&&l.state===1&&!this.disconnected&&(R("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"normally"}),this.disconnect().catch(h))},this,this.disposables)),this.disposables.push(Ma.workspace.onDidChangeNotebookDocument(l=>{l.contentChanges.forEach(c=>{c.removedCells.forEach(u=>{u===this.debugCell&&this.disconnect().catch(h)})})},this,this.disposables)),this.disposables.push(this.debugService.onDidTerminateDebugSession(l=>{(l===this.session||l===this.session)&&this.disconnect().catch(h)}))}addDebuggingDelegates(e){this.delegates.push(...e)}trace(e,t){p.debug(`[Debug] ${e}: ${t}`)}async onIOPubMessage(e,t){if(p.ci(`Debug IO Pub message: ${JSON.stringify(t)}`),_H(t)){this.trace("event",JSON.stringify(t));for(let r of this.delegates??[])if(await r?.willSendEvent?.(t.content))return;this.sendMessage.fire(t.content)}}handleMessage(e){this.handleClientMessageAsync(e).catch(h)}async handleClientMessageAsync(e){try{if(p.ci(`KernelDebugAdapter::handleMessage ${JSON.stringify(e,void 0," ")}`),e.type==="request"&&e.command==="setBreakpoints"){let t=e.arguments;if(t.source&&t.source.path&&t.source.path.indexOf("vscode-notebook-cell:")===0){let r=this.notebookDocument.getCells().find(i=>i.document.uri.toString()===t.source.path);r&&await this.dumpCell(r.index)}}if(e.type==="request")for(let t of this.delegates??[]){let r=await t?.willSendRequest?.(e);if(r){this.trace("response",JSON.stringify(r)),this.sendMessage.fire(r);return}}await this.sendMessageToJupyterSession(e)}catch(t){p.error(`KernelDebugAdapter::handleMessage failure: ${t}`)}}getConfiguration(){return this.configuration}stepIn(e){return this.session.customRequest("stepIn",{threadId:e})}async debugInfo(){return await this.session.customRequest("debugInfo")}continueDirect(e){if(!this.jupyterSession.kernel)throw new pn;this.jupyterSession.kernel.requestDebug({seq:0,type:"request",command:"continue",arguments:{threadId:e}})}async disconnect(){if(!this.disconnected){if(this.disconnected=!0,this.debugService.activeDebugSession===this.session||this.debugService.activeDebugSession?.id===this.session.id)try{await Promise.all([this.deleteDumpedFiles().catch(e=>p.warn("Error deleting temporary debug files.",e)),this.session.customRequest("disconnect",{restart:!1})])}catch(e){p.error("Failed to disconnect debug session",e)}this.endSession.fire(this.session)}}dispose(){this.disposables.forEach(e=>e.dispose())}stackTrace(e){return this.session.customRequest("stackTrace",e)}setBreakpoints(e){return this.session.customRequest("setBreakpoints",e)}async dumpAllCells(){await Promise.all(this.notebookDocument.getCells().map(async e=>{e.kind===Ma.NotebookCellKind.Code&&await this.dumpCell(e.index)}))}lookupCellByLongName(e){if(this.platformService.isWindows){e=cn(e);for(let[t,r]of this.fileToCell.entries())if(xH(t)&&DH(t,e))return r}}async sendMessageToJupyterSession(e){if(this.jupyterSession.isDisposed||this.jupyterSession.status==="dead"||!this.jupyterSession.kernel){p.info(`Skipping sending message ${e.type} because session is disposed`);return}if(this.trace("to kernel",JSON.stringify(e)),e.type==="request"){let t=await this.sendRequestToJupyterSession(e);t&&this.sendMessage.fire(t)}else if(e.type==="response"){zT(e,this.translateRealLocationToDebuggerLocation.bind(this));let t=e;return this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command},!0).done}else p.error(`Unknown message type to send ${e.type}`)}async sendRequestToJupyterSession(e){if(zT(e,this.translateRealLocationToDebuggerLocation.bind(this)),!this.jupyterSession.kernel)throw new pn;this.trace("to kernel, mapped",JSON.stringify(e));let t=e,o=(await this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command,arguments:t.arguments},!0).done).content;zT(o,this.translateDebuggerLocationToRealLocation.bind(this));for(let s of this.delegates??[])await s?.willSendResponse?.(o);return this.trace("response",JSON.stringify(o)),o}translateDebuggerLocationToRealLocation(e,t){if(t=e?.source??t,t&&t.path){let r=this.fileToCell.get(t.path)??this.lookupCellByLongName(t.path);r&&(t.name=Se(r.path),t.path=r.toString())}}async deleteDumpedFiles(){let e=this.getDumpFilesForDeletion();if(this.jupyterSession.kernel&&e.length){let r=`import os as _VSCODE_os
_VSCODE_fileList = [${e.map(i=>'"'+i.replace(/\\/g,"\\\\")+'"').join(",")}]
for file in _VSCODE_fileList:
    try:
        _VSCODE_os.remove(file)
    except:
        pass
del _VSCODE_fileList
del _VSCODE_os`;await mn(this.jupyterSession.kernel,r,{traceErrors:!0,traceErrorsMessage:"Error deleting temporary debugging files"})}}};var ZT=class extends Ib{constructor(){super(...arguments);this.cellToFile=new Map;this.lineOffsets=new WeakMap}async dumpCell(t){let r=this.notebookDocument.cellAt(t);try{let i=await this.session.customRequest("dumpCell",{code:r.document.getText().replace(/\r\n/g,`
`)}),o=cn(i.sourcePath);this.fileToCell.set(o,r.document.uri),this.cellToFile.set(r.document.uri.toString(),o),this.lineOffsets.set(r,cme(r))}catch(i){p.error(i)}}translateDebuggerLocationToRealLocation(t,r){if(r=t?.source??r,!r?.path||!this.fileToCell.size)return;let i=this.fileToCell.get(r.path)??this.lookupCellByLongName(r.path);if(!i)return;let o=this.notebookDocument.getCells().find(a=>a.document.uri.toString()===i.toString()),s=o?this.lineOffsets.get(o)??0:0;r.name=Se(i.path),r.path=i.toString(),s&&typeof t?.endLine=="number"&&(t.endLine=t.endLine+s),s&&typeof t?.line=="number"&&(t.line=t.line+s)}translateRealLocationToDebuggerLocation(t,r){if(r=t?.source??r,!r?.path||!this.cellToFile.size)return;let i=this.cellToFile.get(r.path);if(!i)return;let o=this.notebookDocument.getCells().find(a=>a.document.uri.toString()===r.path),s=o?this.lineOffsets.get(o)??0:0;r.path=i,s&&typeof t.line=="number"&&(t.line<s?t.line=s:t.line>s&&(t.line-=s)),s&&typeof t.endLine=="number"&&(t.endLine<s?t.endLine=s:t.endLine>s&&(t.endLine-=s))}getDumpFilesForDeletion(){return Array.from(this.cellToFile.values())}};function cme(n){for(let e=0;e<n.document.lineCount;e+=1)if(n.document.lineAt(e).text.trim().length>0)return e;return 0}var Sb=class extends bb{constructor(t,r,i,o,s,a){super(t,r,a);this.configurationService=i;this.platform=o;this.debugService=s;this.notebookToRunByLineController=new Map;this.runByLineCells=new ir(yr.RunByLineCells),this.runByLineDocuments=new ir(yr.RunByLineDocuments),this.debugDocuments=new ir(yr.DebugDocuments)}activate(){super.activate(),this.disposables.push(Ip.debug.registerDebugAdapterDescriptorFactory(ZS,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return this.notebookToRunByLineController.get(t)?.getMode()}onDidStopDebugging(t){super.onDidStopDebugging(t),this.notebookToRunByLineController.delete(t),this.updateRunByLineContextKeys(),this.updateDebugContextKey()}updateRunByLineContextKeys(){let t=[],r=[];this.notebookToRunByLineController.forEach(i=>{t.push(i.debugCell.document.uri),r.push(i.debugCell.notebook.uri)}),this.runByLineCells.set(t).catch(h),this.runByLineDocuments.set(r).catch(h)}updateDebugContextKey(){let t=new Dl;this.notebookToDebugAdapter.forEach((r,i)=>t.add(i.uri)),this.notebookInProgress.forEach(r=>t.add(r.uri)),this.debugDocuments.set(Array.from(t.values())).catch(h)}async tryToStartDebugging(t,r,i=!1){if(p.info(`Starting debugging with mode ${t}`),!i){let o=await this.checkIpykernelAndPrompt(r);if(o!==1){p.info(`Ipykernel check failed: ${WE[o]}`);return}}(t===0||t===1)&&await this.startDebuggingCell(t,r)}runByLineNext(t){let r=this.notebookToRunByLineController.get(t.notebook);r&&r.debugCell.document.uri.toString()===t.document.uri.toString()&&r.continue()}runByLineStop(t){let r=this.notebookToRunByLineController.get(t.notebook);r&&(R("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"withKeybinding"}),r.stop())}async startDebuggingCell(t,r){let i=r.notebook,o=this.configurationService.getSettings(i.uri),s={type:ZS,name:Se(i.uri.toString()),request:"attach",justMyCode:t===1?o.debugJustMyCode:!0,__mode:t,__cellIndex:r.index,__notebookUri:i.uri.toString()},a=t===0?{suppressDebugStatusbar:!0,suppressDebugToolbar:!0,suppressDebugView:!0,suppressSaveBeforeStart:!0}:{suppressSaveBeforeStart:!0};return this.startDebuggingConfig(s,a)}async createDebugAdapterDescriptor(t){let r=t.configuration;VE(r);let i=r.__notebookUri,o=Ip.workspace.notebookDocuments.find(s=>s.uri.toString()===i);if(!o){p.info(`Cannot start debugging. Notebook ${i} not found.`);return}if(this.notebookInProgress.has(o)){p.info("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(o)){p.info("Cannot start debugging. Already debugging this notebook document.");return}this.notebookToDebugger.set(o,new yb(o,r,t));try{return this.notebookInProgress.add(o),this.updateDebugContextKey(),await this.doCreateDebugAdapterDescriptor(r,t,o)}finally{this.notebookInProgress.delete(o),this.updateDebugContextKey()}}async doCreateDebugAdapterDescriptor(t,r,i){let o=await this.ensureKernelIsRunning(i);if(o?.session){let s=new ZT(r,i,o.session,o,this.platform,this.debugService);if(t.__mode===0&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),l=new YT(s,a,this.kernelProvider.getKernelExecution(o),this.configurationService);s.addDebuggingDelegates([l,new JE(0,s,a,this.serviceContainer)]),this.notebookToRunByLineController.set(i,l),this.updateRunByLineContextKeys()}else if(t.__mode===1&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),l=new QT(s,a,this.kernelProvider.getKernelExecution(o));s.addDebuggingDelegates([l,new JE(1,s,a,this.serviceContainer)])}return this.trackDebugAdapter(i,s),this.updateDebugContextKey(),new Ip.DebugAdapterInlineImplementation(s)}else Ip.window.showInformationMessage(y.kernelWasNotStarted).then(h,h)}};Sb=v([(0,bu.injectable)(),m(0,(0,bu.inject)(we)),m(1,(0,bu.inject)(it)),m(2,(0,bu.inject)(ie)),m(3,(0,bu.inject)(wr)),m(4,(0,bu.inject)(_i)),m(5,(0,bu.inject)(st))],Sb);var $E=k(N()),RH=require("vscode");var Cb=class{constructor(e,t){this.disposableRegistry=t;this.activeTrackers=new WeakMap;this.activeTrackersById=new Map;this.updatedEmitter=new RH.EventEmitter;t.push(e.registerDebugAdapterTrackerFactory("python",this))}createDebugAdapterTracker(e){let t=new gb(e.id);return this.activeTrackers.set(e,t),this.activeTrackersById.set(e.id,t),t.sessionEnded(()=>{this.activeTrackers.delete(e),this.activeTrackersById.delete(e.id)},this,this.disposableRegistry),t.debugLocationUpdated(this.onLocationUpdated,this,this.disposableRegistry),this.onLocationUpdated(),t}get updated(){return this.updatedEmitter.event}getLocation(e){let t=this.activeTrackers.get(e)||this.activeTrackersById.get(e.id);if(t)return t.debugLocation}onLocationUpdated(){this.updatedEmitter.fire()}};Cb=v([(0,$E.injectable)(),m(0,(0,$E.inject)(_i)),m(1,(0,$E.inject)(M))],Cb);var t0=k(N()),MH=k(require("net"));var KH=k(So()),kf=require("vscode");var NH=require("events"),AH=`\r
\r
`,e0=class{constructor(){this.rawData=Buffer.concat([]);this.contentLength=-1;this.disposed=!1;this.dataCallbackHandler=e=>{this.handleData(e)};this.events=new NH.EventEmitter}dispose(){this.stream&&(this.stream.removeListener("data",this.dataCallbackHandler),this.stream=void 0)}connect(e){this.stream=e,e.addListener("data",this.dataCallbackHandler)}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}dispatch(e){let t=JSON.parse(e);switch(t.type){case"event":{let r=t;typeof r.event=="string"&&this.events.emit(`${t.type}_${r.event}`,r);break}case"request":{let r=t;typeof r.command=="string"&&this.events.emit(`${t.type}_${r.command}`,r);break}case"response":{let r=t;typeof r.command=="string"&&this.events.emit(`${t.type}_${r.command}`,r);break}default:this.events.emit(`${t.type}`,t)}this.events.emit("data",t)}handleData(e){if(!this.disposed)for(this.rawData=Buffer.concat([this.rawData,e]);;){if(this.contentLength>=0){if(this.rawData.length>=this.contentLength){let t=this.rawData.toString("utf8",0,this.contentLength);this.rawData=this.rawData.slice(this.contentLength),this.contentLength=-1,t.length>0&&this.dispatch(t);continue}}else{let t=this.rawData.indexOf(AH);if(t!==-1){let i=this.rawData.toString("utf8",0,t).split(`\r
`);for(let o of i){let s=o.split(/: +/);s[0]==="Content-Length"&&(this.contentLength=+s[1])}this.rawData=this.rawData.slice(t+AH.length);continue}}break}}};var hF=class{constructor(e,t,r){this._id=e;this._configuration=t;this.customRequestHandler=r;this._name="JupyterDebugSession";}get id(){return this._id}get type(){return"python"}get name(){return this._name}get workspaceFolder(){}get configuration(){return this._configuration}customRequest(e,t){return this.customRequestHandler(e,t)}getDebugProtocolBreakpoint(e){return Promise.resolve(void 0)}},Eb=class{constructor(e){this.sequence=1;this.breakpointEmitter=new kf.EventEmitter;this.debugAdapterTrackerFactories=[];this.debugAdapterTrackers=[];this.sessionChangedEvent=new kf.EventEmitter;this.sessionStartedEvent=new kf.EventEmitter;this.sessionTerminatedEvent=new kf.EventEmitter;this.sessionCustomEvent=new kf.EventEmitter;this.breakpointsChangedEvent=new kf.EventEmitter;this._breakpoints=[];e.push(this),this.protocolParser=new e0}dispose(){this.socket&&(this.socket.end(),this.socket=void 0)}get activeDebugSession(){return this.session}get activeDebugConsole(){return{append(e){},appendLine(e){}}}get breakpoints(){return this._breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.breakpointsChangedEvent.event}registerDebugConfigurationProvider(e,t){return{dispose:()=>{}}}registerDebugAdapterTrackerFactory(e,t){return this.debugAdapterTrackerFactories.push(t),{dispose:()=>{this.debugAdapterTrackerFactories=this.debugAdapterTrackerFactories.filter(r=>r!==t)}}}startRunByLine(e){return this.startDebugging(void 0,e)}startDebugging(e,t,r){let i=t;return i.port?(this.session=new hF((0,KH.default)(),i,this.sendCustomRequest.bind(this)),this.sessionChangedEvent.fire(this.session),this.debugAdapterTrackers=this.debugAdapterTrackerFactories.map(o=>o.createDebugAdapterTracker(this.session)),this.socket=MH.createConnection(i.port),this.protocolParser.connect(this.socket),this.protocolParser.on("event_stopped",this.onBreakpoint.bind(this)),this.protocolParser.on("event_output",this.onOutput.bind(this)),this.protocolParser.on("event_terminated",this.sendToTrackers.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("close",this.onClose.bind(this)),this.sendStartSequence(i,this.session.id).then(()=>!0)):Promise.resolve(!0)}addBreakpoints(e){this._breakpoints=this._breakpoints.concat(e)}removeBreakpoints(e){}get onBreakpointHit(){return this.breakpointEmitter.event}async continue(){await this.sendMessage("continue",{threadId:0}),this.sendToTrackers({type:"event",event:"continue"})}async step(){await this.sendMessage("stepIn",{threadId:this._stoppedThreadId?this._stoppedThreadId:1}),this.sendToTrackers({type:"event",event:"stepIn"})}async getStack(){let e=re();return this.protocolParser.once("response_stackTrace",t=>{this.sendToTrackers(t);let r=t,i=r.body.stackFrames?r.body.stackFrames:[];e.resolve(i),this._topFrameId=i[0]?.id}),await this.emitMessage("stackTrace",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,startFrame:0,levels:1}),e.promise}async requestVariables(){await this.getStack();let e=re(),t=0;return this.protocolParser.once("response_scopes",r=>{this.sendToTrackers(r);let i=r;i&&(t=i.body.scopes[0].variablesReference),this.emitMessage("variables",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,variablesReference:t}).catch(h)}),this.protocolParser.once("response_variables",r=>{this.sendToTrackers(r),e.resolve()}),await this.emitMessage("scopes",{frameId:this._topFrameId?this._topFrameId:1}),e.promise}stop(){this.onClose()}sendToTrackers(e){switch(e.type){case"request":this.debugAdapterTrackers.forEach(t=>{t.onWillReceiveMessage&&t.onWillReceiveMessage(e)});break;default:this.debugAdapterTrackers.forEach(t=>t.onDidSendMessage(e));break}}sendCustomRequest(e,t){return this.sendMessage(e,t)}async sendStartSequence(e,t){p.info("Sending debugger initialize..."),await this.sendInitialize(),this._breakpoints.length>0&&(p.info("Sending breakpoints"),await this.sendBreakpoints()),p.info("Sending debugger attach...");let r=this.sendAttach(e,t);return p.info("Sending configuration done"),await this.sendConfigurationDone(),p.info("Session started."),r.then(()=>{this.sessionStartedEvent.fire(this.session)})}sendBreakpoints(){let e=this._breakpoints.map(r=>r),t=e[0].location.uri.fsPath;return this.sendMessage("setBreakpoints",{source:{name:Se(t),path:t},lines:e.map(r=>r.location.range.start.line),breakpoints:e.map(r=>({line:r.location.range.start.line})),sourceModified:!0})}sendAttach(e,t){return this.sendMessage("attach",{debugOptions:["RedirectOutput","FixFilePathCase","WindowsClient","ShowReturnValue"],workspaceFolder:Bo,__sessionId:t,...e})}sendConfigurationDone(){return this.sendMessage("configurationDone")}sendInitialize(){return this.sendMessage("initialize",{clientID:"vscode",clientName:"Visual Studio Code",adapterID:"python",pathFormat:"path",linesStartAt1:!0,columnsStartAt1:!0,supportsVariableType:!0,supportsVariablePaging:!0,supportsRunInTerminalRequest:!0,locale:"en-us"})}sendDisconnect(){return this.sendMessage("disconnect",{})}sendMessage(e,t){let r=re(),i=this.sessionTerminatedEvent.event(()=>{r.resolve({body:{}})}),o=this.sequence;return this.protocolParser.on(`response_${e}`,s=>{s.request_seq===o&&(this.sendToTrackers(s),p.info(`Received response from debugger: ${JSON.stringify(t)}`),i.dispose(),r.resolve(s.body))}),this.socket?.on("error",s=>r.reject(s)),this.emitMessage(e,t).catch(s=>{p.error(`Exception attempting to emit ${e} to debugger: `,s)}),r.promise}emitMessage(e,t){return new Promise((r,i)=>{try{if(this.socket){let o={command:e,arguments:t,type:"request",seq:this.sequence};this.sequence+=1;let s=JSON.stringify(o);p.info(`Sending request to debugger: ${s}`);let a=`Content-Length: ${s.length}\r
\r
${s}`;this.socket.write(a,l=>{this.sendToTrackers(o),r()})}}catch(o){i(o)}})}onBreakpoint(e){this._stoppedThreadId=e.body.threadId,this.sendToTrackers(e),this.breakpointEmitter.fire()}onOutput(e){this.sendToTrackers(e),p.info(JSON.stringify(e))}onError(e){this.sendToTrackers(e),p.info(JSON.stringify(e))}onClose(){this.socket&&(this.sessionTerminatedEvent.fire(this.activeDebugSession),this.session=void 0,this.sessionChangedEvent.fire(void 0),this.debugAdapterTrackers.forEach(e=>e.onExit?e.onExit(0,void 0):void 0),this.debugAdapterTrackers=[],this.sendDisconnect().catch(h),this.socket.destroy(),this.socket=void 0)}};Eb=v([(0,t0.injectable)(),m(0,(0,t0.inject)(M))],Eb);var nc=k(N()),xf=require("vscode");var wb=class{constructor(e,t,r){this.vscodeDebugService=t;this.jupyterDebugService=r;this.sessionChangedEvent=new xf.EventEmitter;this.sessionStartedEvent=new xf.EventEmitter;this.sessionTerminatedEvent=new xf.EventEmitter;this.sessionCustomEvent=new xf.EventEmitter;e.push(t.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(t.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(t.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(t.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))),r&&(e.push(r.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(r.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(r.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(r.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))))}get activeDebugSession(){return this.activeService.activeDebugSession}get activeDebugConsole(){return this.activeService.activeDebugConsole}get breakpoints(){return this.activeService.breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.activeService.onDidChangeBreakpoints}get onBreakpointHit(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.onBreakpointHit}startRunByLine(e){if(this.lastStartedService=this.jupyterDebugService,!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.startRunByLine(e)}registerDebugConfigurationProvider(e,t){let r=this.vscodeDebugService.registerDebugConfigurationProvider(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugConfigurationProvider(e,t);return this.combineDisposables(r,i)}return r}registerDebugAdapterTrackerFactory(e,t){let r=this.vscodeDebugService.registerDebugAdapterTrackerFactory(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugAdapterTrackerFactory(e,t);return this.combineDisposables(r,i)}return r}startDebugging(e,t,r){return this.lastStartedService=this.vscodeDebugService,this.vscodeDebugService.startDebugging(e,t,r)}addBreakpoints(e){return this.activeService.addBreakpoints(e)}removeBreakpoints(e){return this.activeService.removeBreakpoints(e)}getStack(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.getStack();throw new Error("Requesting jupyter specific stack when not debugging.")}step(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.step();throw new Error("Requesting jupyter specific step when not debugging.")}continue(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.continue();throw new Error("Requesting jupyter specific step when not debugging.")}requestVariables(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.requestVariables();throw new Error("Requesting jupyter specific variables when not debugging.")}stop(){this.jupyterDebugService&&this.lastStartedService===this.jupyterDebugService?this.jupyterDebugService.stop():xf.commands.executeCommand("workbench.action.debug.stop").then(h,h)}get activeService(){return this.lastStartedService?this.lastStartedService:this.vscodeDebugService}combineDisposables(e,t){return{dispose:()=>{e.dispose(),t.dispose()}}}endedDebugSession(e){this.sessionTerminatedEvent.fire(e),this.lastStartedService=void 0}startedDebugSession(e){this.sessionStartedEvent.fire(e)}changedDebugSession(e){this.sessionChangedEvent.fire(e)}gotCustomEvent(e){this.sessionCustomEvent.fire(e)}};wb=v([(0,nc.injectable)(),m(0,(0,nc.inject)(M)),m(1,(0,nc.inject)(_i)),m(2,(0,nc.optional)()),m(2,(0,nc.inject)(Aa)),m(2,(0,nc.named)(Je.RUN_BY_LINE_DEBUGSERVICE))],wb);var Su=k(N());var o0=require("vscode");var Pb=Symbol("IFileConverter"),Sp=Symbol("IExportBase"),$ht=Symbol("IExport"),Cp=Symbol("IExportUtil");var i0=k(N()),OH=k(require("os"));var FH=k(So());var kb=require("vscode");var qE=require("vscode");var ume={PDF:["pdf"]},dme={HTML:["html","htm"]},pme={Python:["py"]},Ka=class{async showDialog(e,t,r){let i={},o;switch(e){case"python":i=pme,o=".py";break;case"pdf":o=".pdf",i=ume;break;case"html":o=".html",i=dme;break;case"ipynb":o=".ipynb";let l=y.exportDialogFilter;i[l]=["ipynb"];break;default:return}let s=r||!t?r||"":`${Se(t.path,Ui(t.path))}${o}`,a={defaultUri:await this.getDefaultUri(t,s),saveLabel:y.exportButtonTitle,filters:i};return qE.window.showSaveDialog(a)}async getDefaultUri(e,t){if(e&&e.scheme==="untitled"&&Mr())return;if(!e||e.scheme==="file"||e.scheme==="untitled"||e.scheme==="vscode-interactive"){let i=ve.instance.get(Zk);return qE.Uri.file(We(await i.computeWorkingDirectory(e),t))}let r=We(rt(e.path),t);return qE.Uri.parse(`${e.scheme}://${r}`).with({authority:e.authority})}};var r0=class{async getContent(e){let t=kb.extensions.getExtension("vscode.ipynb");if(!t)throw new Error("Unable to export notebook as the built-in vscode.ipynb extension is currently unavailable.");t.isActive||await t.activate();let i=e.getCells().map(s=>{let a=new kb.NotebookCellData(s.kind,s.document.getText(),s.document.languageId);return a.metadata=s.metadata,a.mime=s.mime,a.outputs=[...s.outputs],a}),o=new kb.NotebookData(i);return o.metadata=JSON.parse(JSON.stringify(e.metadata)),t.exports.exportNotebook(o)}async getTargetFile(e,t,r){return await new Ka().showDialog(e,t,r)}};var n0=require("vscode");var xb=class extends r0{constructor(t){super();this.fs=t}async getTargetFile(t,r,i){let o;return t!=="python"?o=await new Ka().showDialog(t,r,i):o=n0.Uri.file((await this.fs.createTemporaryLocalFile(".py")).filePath),o}};xb=v([(0,i0.injectable)(),m(0,(0,i0.inject)(dr))],xb);var HE=class{async generateTempDir(){let e=n0.Uri.file(We(OH.tmpdir(),(0,FH.default)())),t=ve.instance.get(dr);return await t.createDirectory(e),{path:Re(e),dispose:async()=>{let r=0;for(;r<10;)try{await t.delete(e),r=10}catch{await vi(3e3),r+=1}}}}async makeFileInDirectory(e,t,r){let i=We(r,t);return await ve.instance.get(dr).writeFile(n0.Uri.file(i),e),i}};async function LH(n){let e=JSON.parse(n);for(let t of e.cells){let r="outputs"in t?t.outputs:void 0;r&&Array.isArray(r)&&mme(r)}return JSON.stringify(e,void 0,4)}function mme(n){let e="image/svg+xml",t="image/png";for(let r of n)if("data"in r){let i=r.data;if(!(e in i))continue;t in i&&delete i[e]}}var Db=k(N());var Iu=class{constructor(e,t,r){this.dependencyManager=e;this.nbConvertDependencyChecker=t;this.jupyterInterpreterService=r}async getExportInterpreter(e){if(e&&await this.checkNotebookInterpreter(e))return e;let t=await this.jupyterInterpreterService.getSelectedInterpreter();if(t||await this.jupyterInterpreterService.selectInterpreter(),t){if(await this.checkNotebookInterpreter(t))return t;if(await this.dependencyManager.installMissingDependencies(),await this.checkNotebookInterpreter(t))return t}throw new Error(y.jupyterNbConvertNotSupported)}async checkNotebookInterpreter(e){return this.nbConvertDependencyChecker.isNbConvertInstalled(e)}};Iu=v([(0,Db.injectable)(),m(0,(0,Db.inject)(bd)),m(1,(0,Db.inject)(hg)),m(2,(0,Db.inject)(si))],Iu);var Df=class{constructor(e,t,r,i,o,s){this.pythonExecutionFactory=e;this.jupyterService=t;this.fs=r;this.exportUtil=i;this.importer=o;this.exportInterpreterFinder=s}async export(e,t,r,i){}async executeCommand(e,t,r,i,o){if(o.isCancellationRequested)return;if(i=await this.exportInterpreterFinder.getExportInterpreter(i),r==="python"){let g=await this.importer.importFromFile(e.uri,i);await this.fs.writeFile(t,g);return}let s=await this.exportUtil.getContent(e);r==="pdf"&&(s=await LH(s));let a=await new HE().generateTempDir(),l=await this.makeSourceFile(t,s,a),c=await this.getExecutionService(l,i);if(!c||o.isCancellationRequested)return;let u=await this.fs.createTemporaryLocalFile(Ui(t.fsPath)),d=[l.fsPath,"--to",r,"--output",Se(u.filePath),"--output-dir",rt(u.filePath),"--debug"],f=await c.execModule("jupyter",["nbconvert"].concat(d),{throwOnStdErr:!1,encoding:"utf8",token:o});if(o.isCancellationRequested){u.dispose();return}try{if((await this.fs.stat(o0.Uri.file(u.filePath))).size>1)await this.fs.copy(o0.Uri.file(u.filePath),t);else throw new Error("File size is zero during conversion. Outputting error.")}catch{throw new Error(f.stderr)}finally{u.dispose()}}async makeSourceFile(e,t,r){let i=Se(e.fsPath,Ui(e.fsPath)),o=await new HE().makeFileInDirectory(t,`${i}.ipynb`,r.path);return o0.Uri.file(o)}async getExecutionService(e,t){return this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t})}};v([yv("PerformingExport")],Df.prototype,"executeCommand",1),Df=v([(0,Su.injectable)(),m(0,(0,Su.inject)(Fr)),m(1,(0,Su.inject)(Hd)),m(2,(0,Su.inject)(dr)),m(3,(0,Su.inject)(Cp)),m(4,(0,Su.inject)(Uk)),m(5,(0,Su.inject)(Iu))],Df);var _f=k(N());var Cu=require("vscode");var _b=class{constructor(){this.fs=ve.instance.get(tt)}async openFile(e,t,r=!1){if(e==="python")await this.openPythonFile(t,r),R("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:!0});else{let i=await this.askOpenFile(t,r);R("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:i})}}async openPythonFile(e,t){let r;if(t)r=await Cu.window.showTextDocument(e);else{let i=await this.fs.readFile(e);await this.fs.delete(e);let o=await Cu.workspace.openTextDocument({language:ge,content:i});r=await Cu.window.showTextDocument(o)}await r.edit(i=>{i.insert(new Cu.Position(r.document.lineCount,0),`
`)})}async askOpenFile(e,t){let r=y.openExportFileYes,i=y.openExportFileNo,o=[r,i];return await Cu.window.showInformationMessage(y.openExportedFileMessage,...o).then(a=>a)===r?(t?Cu.window.showTextDocument(e).then(h,h):Rd(e.toString()),!0):!1}};var u0=k(N()),d0=require("vscode");var s0=class{async export(e,t,r,i){await ve.instance.get(Sp).executeCommand(e,t,"python",r,i)}};var a0=class{async export(e,t,r,i){await ve.instance.get(Sp).executeCommand(e,t,"pdf",r,i)}};var l0=class{async export(e,t,r,i){await ve.instance.get(Sp).executeCommand(e,t,"html",r,i)}};var gF=require("vscode");var c0=class{constructor(){this.fs=ve.instance.get(tt),this.configuration=ve.instance.get(ie),this.platform=ve.instance.get(wr)}async writeFile(e,t){await this.fs.writeFile(e,t)}getEOL(){return this.platform.isWindows?`\r
`:`
`}async export(e,t,r){if(r.isCancellationRequested)return;let i=this.exportDocument(e);await this.writeFile(t,i)}exportDocument(e){return e.getCells().filter(t=>!t.metadata?.isInteractiveWindowMessageCell).reduce((t,r)=>t+this.exportCell(r),"")}exportCell(e){if(e.document.lineCount){let t=this.cellMarker(e),r=this.getEOL();switch(e.kind){case gF.NotebookCellKind.Code:return`${t}${r}${this.exportCodeCell(e)}${r}${r}`;case gF.NotebookCellKind.Markup:return`${t} [markdown]${r}${this.exportMarkdownCell(e)}${r}${r}`}}return""}exportCodeCell(e){let t=Ue(e.document.getText(),{trim:!1,removeEmptyEntries:!1}),r=this.configuration.getSettings(e.notebook.uri).pythonExportMethod==="commentMagics";return Yh(t,this.getEOL(),r?fme:void 0).join("")}exportMarkdownCell(e){let t=Ue(e.document.getText(),{trim:!1,removeEmptyEntries:!1});return Yh(t,this.getEOL(),hme).join("")}cellMarker(e){let t=this.configuration.getSettings(e.notebook.uri);return e.metadata.interactiveWindowCellMarker??t.defaultCellMarker}};function fme(n){return/^\s*!/.test(n)||/^\s*%/.test(n)?`# ${n}`:n}function hme(n){return`# ${n}`}var Tb=class{constructor(e,t,r){this.exportUtil=e;this.progressReporter=t;this.configuration=r}async importIpynb(e){let t=this.progressReporter.createProgressIndicator(y.importingIpynb,!0);try{let r=await d0.workspace.openNotebookDocument(e);await this.exportImpl("python",r,void 0,t.token)}finally{t.dispose()}}async export(e,t,r,i){let o=this.progressReporter.createProgressIndicator(y.exportingToFormat(e.toString()),!0);try{await this.exportImpl(e,t,r,o.token,i)}finally{o.dispose()}if(o.token.isCancellationRequested){R("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,cancelled:!0});return}}async exportImpl(e,t,r,i,o){try{let s=await this.exportUtil.getTargetFile(e,t.uri,r);if(!s)return;await this.performExport(e,t,s,i,o)}catch(s){p.error("Export failed",s),R("DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",void 0,{format:e}),e==="pdf"&&p.error(y.exportToPDFDependencyMessage),this.showExportFailed(y.exportFailedGeneralMessage)}}async performExport(e,t,r,i,o){e==="python"&&this.configuration.getSettings(t.uri).pythonExportMethod!=="nbconvert"?await this.performPlainExport(e,t,r,i):await this.performNbConvertExport(t,e,r,o,i),r&&this.openExportedFile(e,r).catch(h)}async openExportedFile(e,t){await new _b().openFile(e,t,!0).catch(h)}async performPlainExport(e,t,r,i){if(r)switch(e){case"python":await new c0().export(t,r,i);break}return r}async performNbConvertExport(e,t,r,i,o){try{return await this.exportToFormat(e,r,t,i,o)}finally{}}async exportToFormat(e,t,r,i,o){switch(r){case"python":return new s0().export(e,t,i,o);case"pdf":return new a0().export(e,t,i,o);case"html":return new l0().export(e,t,i,o);default:break}}showExportFailed(e){d0.window.showErrorMessage(`${y.failedExportMessage} ${e}`)}};Tb=v([m(0,(0,u0.inject)(Cp)),m(1,(0,u0.inject)(Ho)),m(2,(0,u0.inject)(ie))],Tb);var Rb=class extends Tb{constructor(t,r,i,o){super(t,i,o);this.exportUtil=t;this.fs=r}async openExportedFile(t,r){await new _b().openFile(t,r).catch(h)}};Rb=v([(0,_f.injectable)(),m(0,(0,_f.inject)(Cp)),m(1,(0,_f.inject)(dr)),m(2,(0,_f.inject)(Ho)),m(3,(0,_f.inject)(ie))],Rb);var zE=k(N()),Tf=require("vscode");var GE=require("vscode");var vF=new WeakMap;async function oc(n,e){let t=n;if(n.isClosed)return!0;let r=vF.has(t)?vF.get(t):Promise.resolve(),i=re(),o=r.finally(async()=>{let s=new GE.WorkspaceEdit,a=e(s);Ju(a)&&await a,await GE.workspace.applyEdit(s).then(l=>i.resolve(l),l=>i.reject(l))}).catch(h);return vF.set(t,o),i.promise}var Ab=class{constructor(e,t){this.disposables=e;this.controllerRegistration=t}activate(){this.controllerRegistration.onControllerSelected(this.onDidChangeNotebookController,this,this.disposables)}async onDidChangeNotebookController(e){let t=e.notebook,r=e.controller.connection;if(!Pt(t))return;let i=Tf.window.visibleNotebookEditors.find(u=>u.notebook===t);if(!i)return;let o=t.getCells().filter(u=>u.kind===Tf.NotebookCellKind.Code&&u.document.getText().trim().length===0),s=t.getCells().filter(u=>u.kind===Tf.NotebookCellKind.Code).length;if(o.length===0||o.length!==s)return;let a,l=r.kind;switch(r.kind){case"connectToLiveRemoteKernel":{a=r.kernelModel.language;break}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":{a=r.kernelSpec.language;break}case"startUsingPythonInterpreter":{a=ge;break}default:{p.error(`Unsupported kernel kind encountered ${l}`);return}}if(!a)return;let c=yl(a);oc(i.notebook,async()=>{await o.map(async u=>{if(c.toLowerCase()!==u.document.languageId)return Tf.languages.setTextDocumentLanguage(u.document,c).then(h,h)})}).then(h,h)}};Ab=v([(0,zE.injectable)(),m(0,(0,zE.inject)(M)),m(1,(0,zE.inject)(it))],Ab);var Oa=k(N()),gr=require("vscode");var Nb=class{constructor(e,t,r,i,o,s,a,l){this.disposableRegistry=e;this.languageService=t;this.configurationService=r;this.kernelProvider=i;this.controllerRegistration=o;this.errorHandler=s;this.notebookEditorProvider=a;this.serviceContainer=l;this.kernelInterruptedDontAskToRestart=!1;this.pendingRestartInterrupt=new WeakMap}register(){this.disposableRegistry.push(gr.commands.registerCommand(J.NotebookEditorRemoveAllCells,()=>this.removeAllCells())),this.disposableRegistry.push(gr.commands.registerCommand(J.NotebookEditorRunAllCells,()=>this.runAllCells())),this.disposableRegistry.push(gr.commands.registerCommand(J.NotebookEditorAddCellBelow,()=>this.addCellBelow())),this.disposableRegistry.push(gr.commands.registerCommand(J.RestartKernelAndRunUpToSelectedCell,()=>this.restartKernelAndRunUpToSelectedCell())),this.disposableRegistry.push(gr.commands.registerCommand(J.RestartKernel,e=>e&&"notebookEditor"in e?this.restartKernel(e?.notebookEditor?.notebookUri).catch(h):this.restartKernel(e).catch(h))),this.disposableRegistry.push(gr.commands.registerCommand(J.InterruptKernel,e=>this.interruptKernel(e?.notebookEditor?.notebookUri))),this.disposableRegistry.push(gr.commands.registerCommand(J.RestartKernelAndRunAllCells,e=>{e&&"notebookEditor"in e?this.restartKernelAndRunAllCells(e?.notebookEditor?.notebookUri).catch(h):this.restartKernelAndRunAllCells(e).catch(h)}))}runAllCells(){gr.window.activeNotebookEditor&&gr.commands.executeCommand("notebook.execute").then(h,h)}addCellBelow(){gr.window.activeNotebookEditor&&gr.commands.executeCommand("notebook.cell.insertCodeCellBelow").then(h,h)}removeAllCells(){let e=gr.window.activeNotebookEditor?.notebook;if(!e)return;let t=this.languageService.getPreferredLanguage(lo(e));oc(e,r=>{let i=gr.NotebookEdit.replaceCells(new gr.NotebookRange(0,e.cellCount),[new gr.NotebookCellData(gr.NotebookCellKind.Code,"",t)]);r.set(e.uri,[i])}).then(h,h)}async interruptKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,r=gr.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(r===void 0)return;p.debug(`Command interrupted kernel for ${U(r.uri)}`);let i=this.kernelProvider.get(r);if(!i){p.info("Interrupt requested & no kernel.");return}await this.wrapKernelMethod("interrupt",i)}async restartKernelAndRunAllCells(e){await this.restartKernel(e),this.runAllCells()}async restartKernelAndRunUpToSelectedCell(){let e=this.notebookEditorProvider.activeNotebookEditor;e&&(await this.restartKernel(e.notebook.uri),gr.commands.executeCommand("notebook.cell.execute",{ranges:[{start:0,end:e.selection.end}],document:e.notebook.uri}).then(h,h))}async restartKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,r=gr.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(r===void 0)return;let i=this.kernelProvider.get(r);if(i)if(p.debug(`Restart kernel command handler for ${U(r.uri)}`),await this.shouldAskForRestart(r.uri)){let o=y.restartKernelMessage,s=y.restartKernelMessageYes,a=y.restartKernelMessageDontAskAgain,l=await gr.window.showInformationMessage(o,{modal:!0},s,a);l===a?(await this.disableAskForRestart(r.uri),this.wrapKernelMethod("restart",i).catch(h)):l===s&&this.wrapKernelMethod("restart",i).catch(h)}else this.wrapKernelMethod("restart",i).catch(h)}async wrapKernelMethod(e,t){let r=t.notebook,i=this.pendingRestartInterrupt.get(t);if(i)return i;let o=(async()=>{let s=this.kernelProvider.getKernelExecution(t).pendingCells[0],a=this.controllerRegistration.getSelected(r);try{if(!a)throw new Error("No kernel associated with the notebook");await Vs.wrapKernelMethod(a.connection,e,t.creator,this.serviceContainer,{resource:t.resourceUri,notebook:r,controller:a.controller},new Ft(!1),this.disposableRegistry)}catch(l){s?await Ac(s,t.controller,await this.errorHandler.getErrorMessageForDisplayInCellOutput(l,e,t.resourceUri),!1):gr.window.showErrorMessage(l.toString()).then(h,h)}})();return o.finally(()=>{this.pendingRestartInterrupt.get(t)===o&&this.pendingRestartInterrupt.delete(t)}).catch(h),this.pendingRestartInterrupt.set(t,o),o}async shouldAskForRestart(e){if(this.kernelInterruptedDontAskToRestart)return!1;let t=this.configurationService.getSettings(e);return t&&t.askForKernelRestart===!0}async disableAskForRestart(e){this.configurationService.getSettings(e)&&this.configurationService.updateSetting("askForKernelRestart",!1,void 0,gr.ConfigurationTarget.Global).catch(h)}};Nb=v([(0,Oa.injectable)(),m(0,(0,Oa.inject)(M)),m(1,(0,Oa.inject)(ts)),m(2,(0,Oa.inject)(ie)),m(3,(0,Oa.inject)(we)),m(4,(0,Oa.inject)(it)),m(5,(0,Oa.inject)(Br)),m(6,(0,Oa.inject)(An)),m(7,(0,Oa.inject)(st))],Nb);var UH=k(N()),Ep=require("vscode");var Mb=class{constructor(){this.providers=new Set}registerEmbedNotebookProvider(e){this.providers.add(e)}findNotebookEditor(e){let t=e?un(e,!0):"false",r=$i(e)==="notebook"?Ep.workspace.notebookDocuments.find(o=>un(o.uri,!0)===t):void 0,i=r&&Ep.window.activeNotebookEditor?.notebook===r?Ep.window.activeNotebookEditor:void 0;if(i)return i;for(let o of this.providers){let s=o.findNotebookEditor(e);if(s)return s}}get activeNotebookEditor(){return this.findNotebookEditor(Ep.window.activeNotebookEditor?.notebook.uri)||this.findNotebookEditor(Ep.window.activeTextEditor?.document.uri)}findAssociatedNotebookDocument(e){let t=Kr()==="Windows",r=Ep.workspace.notebookDocuments.find(i=>t?i.uri.path.toLowerCase()===e.path.toLowerCase():i.uri.path===e.path);if(r)return r;for(let i of this.providers){let o=i.findAssociatedNotebookDocument(e);if(o)return o}}};Mb=v([(0,UH.injectable)()],Mb);var Ob=k(N()),WH=require("vscode"),VH=k(Jo());var Kb=class extends $t{constructor(t,r,i){super();this.controllerRegistration=t;this.kernelProvider=r;this.notebookEditorProvider=i;this._onDidChangeEnvironment=this._register(new WH.EventEmitter);this.onDidChangeEnvironment=this._onDidChangeEnvironment.event;this.notebookWithRemoteKernelsToMonitor=new WeakSet;this.notebookPythonEnvironments=new WeakMap;this.monitorRemoteKernelStart(),this._register(this.controllerRegistration.onControllerSelected(o=>{if(!nt(o.controller.connection)){this.notebookWithRemoteKernelsToMonitor.delete(o.notebook),this.notebookPythonEnvironments.has(o.notebook)&&(this.notebookPythonEnvironments.delete(o.notebook),this._onDidChangeEnvironment.fire(o.notebook.uri));return}xt(o.controller.connection)?this.notebookWithRemoteKernelsToMonitor.add(o.notebook):(this.notebookWithRemoteKernelsToMonitor.delete(o.notebook),this.notifyLocalPythonEnvironment(o.notebook,o.controller))}))}getPythonEnvironment(t){let r=this.notebookEditorProvider.findAssociatedNotebookDocument(t);return r?this.notebookPythonEnvironments.get(r):void 0}monitorRemoteKernelStart(){let t=async r=>{if(!(!this.notebookWithRemoteKernelsToMonitor.has(r.notebook)||!xt(r.kernelConnectionMetadata)||!nt(r.kernelConnectionMetadata)))try{let i=await this.resolveRemotePythonEnvironment(r.notebook);if(this.controllerRegistration.getSelected(r.notebook)?.controller!==r.controller){p.trace(`Remote Python Env for ${jt(r.notebook.uri)} not determined as controller changed`);return}if(!i){p.trace(`Remote Python Env for ${jt(r.notebook.uri)} not determined as exe is empty`);return}this.notebookPythonEnvironments.set(r.notebook,i),this._onDidChangeEnvironment.fire(r.notebook.uri)}catch(i){p.error(`Failed to get Remote Python Env for ${jt(r.notebook.uri)}`,i)}};this._register(this.kernelProvider.onDidCreateKernel(t)),this._register(this.kernelProvider.onDidStartKernel(t))}notifyLocalPythonEnvironment(t,r){let i=this.kernelProvider.get(t)?.kernelConnectionMetadata||r.connection,o=i.interpreter;if(!nt(i)||xt(i)||!o)return;let s=lr(o);if(s){this.notebookPythonEnvironments.set(t,s),this._onDidChangeEnvironment.fire(t.uri);return}this.resolveAndNotifyLocalPythonEnvironment(t,r,o)}async resolveAndNotifyLocalPythonEnvironment(t,r,i){let o=await FA(i);if(!o){p.error(`Failed to get interpreter information for ${jt(t.uri)} && ${jt(i.uri)}`);return}if(this.controllerRegistration.getSelected(t)?.controller!==r.controller){p.trace(`Python Env for ${jt(t.uri)} not determined as controller changed`);return}this.notebookPythonEnvironments.set(t,o),this._onDidChangeEnvironment.fire(t.uri)}async resolveRemotePythonEnvironment(t){let r=this.kernelProvider.get(t);if(!r||!r.startedAtLeastOnce)return;let i=this.kernelProvider.getKernelExecution(r),o=`
import os as _VSCODE_os
import sys as _VSCODE_sys
import builtins as _VSCODE_builtins

if _VSCODE_os.path.exists("${__filename}"):
    _VSCODE_builtins.print(f"EXECUTABLE{_VSCODE_sys.executable}EXECUTABLE")

del _VSCODE_os, _VSCODE_sys, _VSCODE_builtins
`,a=(await i.executeHidden(o).catch(h)||[]).find(f=>f.output_type==="stream"&&f.name==="stdout");if(!a||!(a.text||"").toString().includes("EXECUTABLE"))return;let l=(a.text||"").toString();l=l.substring(l.indexOf("EXECUTABLE"));let c=l.split("EXECUTABLE").filter(f=>f.trim().length),u=c.length?c[0].trim():"";if(!u||!await VH.pathExists(u))return;p.debug(`Remote Interpreter for Notebook URI "${jt(t.uri)}" is ${jt(u)}`);let d=lr(u)||await FA({id:u});if(d)return d;p.error(`Failed to get remote interpreter information for ${jt(t.uri)} && ${jt(u)}`)}};Kb=v([(0,Ob.injectable)(),m(0,(0,Ob.inject)(it)),m(1,(0,Ob.inject)(we)),m(2,(0,Ob.inject)(An))],Kb);var p0=k(N()),Lb=require("vscode");var Fb=class{constructor(e){this.sentMimeTypes=new Set;this.disposables=[];e.push(this)}activate(){this.isTelemetryDisabled=BP(),Lb.workspace.onDidOpenNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Lb.workspace.onDidCloseNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Lb.workspace.onDidSaveNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables),this.disposables.push($P(e=>this.isTelemetryDisabled=e))}dispose(){z(this.disposables)}async onDidChangeNotebookCellExecutionState(e){!Pt(e.cell.notebook)||this.isTelemetryDisabled||e.state!==1||this.checkCell(e.cell,"onExecution")}onDidOpenCloseDocument(e){!Pt(e)||this.isTelemetryDisabled||e.getCells().forEach(t=>this.checkCell(t,"onOpenCloseOrSave"))}checkCell(e,t){if(e.kind===Lb.NotebookCellKind.Markup||e.document.languageId==="raw")return;let r=e.notebook.notebookType===bt?"notebook":"interactive";e.outputs.map(i=>i.items.map(o=>o.mime)).flat().map(i=>this.sendTelemetry(i,t,r))}sendTelemetry(e,t,r){let i=`${e}-${t}`;this.sentMimeTypes.has(i)||(this.sentMimeTypes.add(i),e=e.replace(/\//g,"_").replace(/\\/g,"_"),R("DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",void 0,{mimeType:e,when:t,resourceType:r}))}};Fb=v([(0,p0.injectable)(),m(0,(0,p0.inject)(M))],Fb);var m0=k(N());var gme=/(;32m[ ->]*?)(\d+)(.*)/g,Ub=class{constructor(e){this.configurationService=e}format(e,t){return e.notebook.notebookType!==bt?t:t.map(r=>this.modifyTracebackFrameIPython(e,r))}modifyTracebackFrameIPython(e,t){return(this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1)&&/^[Cell|Input|File].*?\n.*/.test(t)?this.modifyTracebackFrameIPython8(e,t):t}modifyTracebackFrameIPython8(e,t){t=t.replace(/\u001b\[4\dm/g,""),t=t.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),t=t.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(s,a,l,c)=>(c=c.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${a}${l}${c}
`)),p.ci(`Trace frame to match: ${t}`);let r=(s,a)=>{let l=s.replace(gme,(u,d,f,g)=>{let b=parseInt(f,10);return`${d}<a href='${e.document.uri.toString()}?line=${b-1}'>${b}</a>${g}`}),c=y.cellAtFormat(Re(e.document.uri),e.index+1);return l.replace(/.*?\n/,`\x1B[1;32m${c}\x1B[0m line \x1B[0;36m${a}
`)},i=/^Input.*?\[.*32mIn\s+\[(\d+).*?0;36m(.*?)\n.*/.exec(t);if(i&&i.length>1)return r(t,i[2]);let o=/Cell.*?\[.*32mIn\s*\[(\d+)\]\,\s+line\s+([(\d+)])(.*?)\n.*/gm.exec(t);return o&&o.length>1?r(t,o[2]):t}};Ub=v([(0,m0.injectable)(),m(0,(0,m0.inject)(ie))],Ub);var Fa=k(N());var Wb=class{constructor(e,t,r,i,o,s){this.packages=e;this.installer=t;this.pythonExtensionChecker=r;this.disposables=i;this.interpreterService=o;this.notebookControllerManager=s}activate(){this.notebookControllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables),this.installer?.onInstalled(this.onDidInstallPackage,this,this.disposables)}async onNotebookControllerSelected(e){e.controller.connection.interpreter&&(await qi(e.notebook.uri,{kernelConnection:e.controller.connection}),await this.packages.trackPackages(e.controller.connection.interpreter))}async onDidInstallPackage(e){if(this.pythonExtensionChecker.isPythonExtensionActive)if(Bu(e.resource)){let t=await this.interpreterService.getActiveInterpreter(e.resource);await this.packages.trackPackages(t,!0)}else await this.packages.trackPackages(e.resource,!0)}};Wb=v([(0,Fa.injectable)(),m(0,(0,Fa.inject)(vd)),m(1,(0,Fa.inject)(Ai)),m(1,(0,Fa.optional)()),m(2,(0,Fa.inject)($e)),m(3,(0,Fa.inject)(M)),m(4,(0,Fa.inject)(et)),m(5,(0,Fa.inject)(it))],Wb);function jH(n,e){EH(n,e),n.addSingleton(me,mf),n.addSingleton(Kh,Nb),n.addSingleton(An,Mb),n.addSingleton(me,gf),n.addSingleton(ig,Ub),n.addSingleton(Aa,Eb,Je.RUN_BY_LINE_DEBUGSERVICE),n.addSingleton(up,up),n.addBinding(up,me),n.addSingleton(me,Xy),n.addSingleton(me,Wb),n.addSingleton(me,Gy),n.addSingleton(ts,ts),n.addBinding(ts,me),n.addSingleton(me,Ab),n.addSingleton(bp,Sb,void 0,[me]),n.addSingleton(me,hb),n.addSingleton(yn,vb,Je.DEBUGGER_VARIABLES),n.addSingleton(Aa,wb,Je.MULTIPLEXING_DEBUGSERVICE),n.addSingleton(BT,Cb,void 0,[JT]),n.addSingleton(me,fb),n.addSingleton(me,Fb),n.addSingleton(Pb,Rb),n.addSingleton(Iu,Iu),n.addSingleton(Sp,Df),n.addSingleton(Cp,xb),n.addSingleton(Ig,Kb)}var bn=k(N()),Ge=require("vscode");var wp=Symbol("IDataScienceCodeLensProvider"),f0=Symbol("ICodeWatcher"),h0=Symbol("ICodeLensFactory"),Pp=Symbol("ICellRangeCache"),eIt=Symbol("IGeneratedCodeStore"),Js=Symbol("IGeneratedCodeStorageFactory"),Vb=Symbol("ICodeGeneratorFactory");var g0=Symbol("IInteractiveWindowDebugger"),zn=Symbol("IInteractiveWindowProvider"),v0=Symbol("IInteractiveControllerHelper"),y0=Symbol("IInteractiveWindowDebuggingManager");var b0=require("vscode");async function I0(n){let e=await b0.workspace.openNotebookDocument(n);await b0.window.showNotebookDocument(e)}var Bs=require("vscode");var Do=class{constructor(e){this.codeMatchRegEx=this.createRegExp(e?e.codeRegularExpression:void 0,zp.PythonCellMarker),this.markdownMatchRegEx=this.createRegExp(e?e.markdownRegularExpression:void 0,zp.PythonMarkdownCellMarker),this.codeExecRegEx=new RegExp(`${this.codeMatchRegEx.source}(.*)`),this.markdownExecRegEx=new RegExp(`${this.markdownMatchRegEx.source}(.*)`),this.defaultCellMarker=e?.defaultCellMarker?e.defaultCellMarker:"# %%"}isCell(e){return this.isCode(e)||this.isMarkdown(e)}isMarkdown(e){return this.markdownMatchRegEx.test(e.trim())}isCode(e){return this.codeMatchRegEx.test(e.trim())||e.trim()===this.defaultCellMarker}getCellType(e){return this.isMarkdown(e)?"markdown":"code"}isEmptyCell(e){return this.stripFirstMarker(e).trim().length===0}stripFirstMarker(e){let t=Ue(e,{trim:!1,removeEmptyEntries:!1});return t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0]))?t.slice(1).join(`
`):e}stripFirstMarkerNoConcat(e){return e.length>0&&(this.isCode(e[0])||this.isMarkdown(e[0]))?e.slice(1):e}getFirstMarker(e){let t=Ue(e,{trim:!1,removeEmptyEntries:!1});if(t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0])))return t[0]}createRegExp(e,t){try{if(e)return new RegExp(e)}catch{}return t}};var rs=require("vscode");function JH(n,e){let t=ot(n);return t?e==1?y.restartingKernelCustomHeader(t):y.startingNewKernelCustomHeader(t):e==1?y.restartingKernelHeader:y.startingNewKernelHeader}function BH(n,e){let t=ot(n);return e==1?y.restartedKernelHeader(t||""):y.connectedKernelHeader(t||"")}function QE(n){return n.kind===rs.NotebookCellKind.Markup&&n.metadata?.isInteractiveWindowMessageCell===!0}var S0=class{constructor(e,t,r){this.interactiveWindow=e;this.notebookDocument=t;this.isDeleted=!1;this.sysInfoCellPromise=this.getOrUpdate(r)}async resolveCell(){return await this.sysInfoCellPromise}async getOrUpdate(e){let t=await this.interactiveWindow.getAppendIndex()-1;if(t>=0){let r=this.notebookDocument.cellAt(t);if(QE(r))return this.updateMessage(e)}return this.sysInfoCellPromise=this.createCell(e)}async createCell(e){let t;return await oc(this.notebookDocument,async r=>{let i=new rs.NotebookCellData(rs.NotebookCellKind.Markup,e,DS);i.metadata={isInteractiveWindowMessageCell:!0},t=await this.interactiveWindow.getAppendIndex();let o=rs.NotebookEdit.insertCells(t,[i]);r.set(this.notebookDocument.uri,[o])}),this.notebookDocument.cellAt(t)}async updateMessage(e){let t=await this.sysInfoCellPromise;return await oc(this.notebookDocument,r=>{if(t.index>=0&&!this.isDeleted&&QE(t)){r.replace(t.document.uri,new rs.Range(0,0,t.document.lineCount,0),e),r.set(this.notebookDocument.uri,[rs.NotebookEdit.updateCellMetadata(t.index,{isInteractiveWindowMessageCell:!0})]);return}}),t}async deleteCell(){this.isDeleted=!0;let e=await this.sysInfoCellPromise;await oc(this.notebookDocument,t=>{if(e.index>=0&&QE(e)){let r=rs.NotebookEdit.deleteCells(new rs.NotebookRange(e.index,e.index+1));t.set(this.notebookDocument.uri,[r]);return}})}};function C0(n){return/^#\s*!/.test(n)?/^#\s*!\s*%%?/.test(n)?n.replace(/^#\s*!\s*/,""):n.replace(/^#\s*/,""):n}function $H(n,e){let t=e.isCell(n[0])&&n.length>1?n.slice(1):n;return new Bs.NotebookCellData(Bs.NotebookCellKind.Code,t.join(`
`),"python")}function qH(n){return new Bs.NotebookCellData(Bs.NotebookCellKind.Markup,sk(n).join(`
`),"markdown")}function yme(n,e,t){let r=Ue(e,{trim:!1}),i=r[0],o=new Do(n);if(o.isMarkdown(i)){let s=-1;return pm(r,(a,l)=>void 0,(a,l)=>{a&&a.length>0&&s===-1&&(s=t?l:-1)}),s>=0?[qH(r.slice(0,s)),$H(r.slice(s),o)]:[qH(r)]}else return[$H(r,o)]}function yF(n,e){let t=new Do(e),r=[];for(let i=0;i<n.lineCount;i+=1){let o=n.lineAt(i);if(t.isCell(o.text)){if(r.length>0){let s=r[r.length-1];s.range=new Bs.Range(s.range.start,n.lineAt(i-1).range.end)}r.push({range:o.range,cell_type:t.getCellType(o.text)})}}if(r.length>=1){let i=n.lineAt(n.lineCount-1),o=r[r.length-1];o.range=new Bs.Range(o.range.start,i.range.end)}return r}function bF(n,e){let t=yF(n,e);return Array.prototype.concat(...t.map(r=>{let i=n.getText(r.range);return yme(e,i,!1)}))}function HH(n){return n.getCells().filter(e=>!QE(e)).map(e=>{let t=Ue(e.document.getText(),{trim:!1,removeEmptyEntries:!1});e.metadata.interactiveWindowCellMarker!==void 0&&t.unshift(e.metadata.interactiveWindowCellMarker+`
`);let r=new Bs.NotebookCellData(e.kind,t.join(`
`),e.kind===Bs.NotebookCellKind.Code?e.document.languageId:"markdown");return e.kind===Bs.NotebookCellKind.Code&&(r.outputs=[...e.outputs]),r.metadata=ld(e),r})}var YE=require("vscode");var IF=class{constructor(e,t,r){this.disposed=!1;this.dispose=()=>{this.disposed||(this.disposed=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.disposeCallback(),this.deferred.completed||this.deferred.resolve())};this.promise=()=>this.deferred.promise;this.reject=()=>{this.deferred.reject(),this.dispose()};this.deferred=re(),this.disposeCallback=t,r&&(this.timeout=setTimeout(this.dispose,r))}},E0=class{constructor(){this.statusCount=0;this.incrementCount=()=>{this.statusCount+=1};this.decrementCount=()=>{let e=this.statusCount-1;this.statusCount=Math.max(e,0)}}set(e,t,r){this.incrementCount();let i=new IF(e,()=>this.decrementCount(),t),o={location:r?YE.ProgressLocation.Notification:YE.ProgressLocation.Window,title:e,cancellable:r!==void 0};return YE.window.withProgress(o,(s,a)=>(a&&r&&a.onCancellationRequested(()=>{r(),i.reject()}),i.promise())).then(h,h),i}async waitWithStatus(e,t,r,i){let o=this.set(t,r,i),s;try{s=await e()}finally{o.dispose()}return s}};var _o=class{constructor(e,t,r,i,o,s,a,l,c,u,d,f,g){this.disposables=e;this.jupyterExporter=t;this.jupyterServerHelper=r;this.fileSystem=i;this.configuration=o;this.dataScienceCodeLensProvider=s;this.debugService=a;this.configService=l;this.interactiveWindowProvider=c;this.kernelProvider=u;this.dataScienceErrorHandler=d;this.ipynbProvider=f;this.fileConverter=g;this.statusProvider=new E0,Ge.workspace.isTrusted||Ge.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted(),this.registerCommand(J.InsertCellBelowPosition,this.insertCellBelowPosition),this.registerCommand(J.InsertCellBelow,this.insertCellBelow),this.registerCommand(J.InsertCellAbove,this.insertCellAbove),this.registerCommand(J.DeleteCells,this.deleteCells),this.registerCommand(J.SelectCell,this.selectCell),this.registerCommand(J.SelectCellContents,this.selectCellContents),this.registerCommand(J.ExtendSelectionByCellAbove,this.extendSelectionByCellAbove),this.registerCommand(J.ExtendSelectionByCellBelow,this.extendSelectionByCellBelow),this.registerCommand(J.MoveCellsUp,this.moveCellsUp),this.registerCommand(J.MoveCellsDown,this.moveCellsDown),this.registerCommand(J.ChangeCellToMarkdown,this.changeCellToMarkdown),this.registerCommand(J.ChangeCellToCode,this.changeCellToCode),this.registerCommand(J.GotoNextCellInFile,this.gotoNextCellInFile),this.registerCommand(J.GotoPrevCellInFile,this.gotoPrevCellInFile),this.registerCommand(J.AddCellBelow,this.addCellBelow),this.registerCommand(J.CreateNewNotebook,this.createNewNotebook),this.registerCommand(J.LatestExtension,this.openPythonExtensionPage),this.registerCommand(J.EnableLoadingWidgetsFrom3rdPartySource,this.enableLoadingWidgetScriptsFromThirdParty),this.registerCommand(J.CreateNewInteractive,e=>this.createNewInteractiveWindow(e)),this.registerCommand(J.ImportNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),this.registerCommand(J.ImportNotebookFile,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),Ge.commands.registerCommand(J.ExportFileAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFile(e);{let r=Ge.window.activeTextEditor;if(r&&r.document.languageId===ge)return this.exportFile(r.document.uri)}return Promise.resolve()})),this.registerCommand(J.ExportFileAndOutputAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFileAndOutput(e);{let r=Ge.window.activeTextEditor;if(r&&r.document.languageId===ge)return this.exportFileAndOutput(r.document.uri)}return Promise.resolve()})),this.registerCommand(J.ExpandAllCells,async e=>this.expandAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.CollapseAllCells,async e=>this.collapseAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.ExportOutputAsNotebook,()=>this.exportCells()),this.registerCommand(J.InteractiveExportAsNotebook,e=>this.export(e?.notebookEditor?.notebookUri)),this.registerCommand(J.InteractiveExportAs,e=>this.exportAs(e?.notebookEditor?.notebookUri)),this.registerCommand(J.ScrollToCell,(e,t)=>this.scrollToCell(e,t)),this.registerCommand(J.InteractiveClearAll,this.clearAllCellsInInteractiveWindow),this.registerCommand(J.InteractiveGoToCode,this.goToCodeInInteractiveWindow),this.registerCommand(J.InteractiveCopyCell,this.copyCellInInteractiveWindow)}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){Ge.workspace.isTrusted&&(this.registerCommand(J.RunAllCells,this.runAllCells),this.registerCommand(J.RunCell,this.runCell),this.registerCommand(J.RunCurrentCell,this.runCurrentCell),this.registerCommand(J.RunCurrentCellAdvance,this.runCurrentCellAndAdvance),this.registerCommand(J.ExecSelectionInInteractiveWindow,e=>{this.runSelectionOrLine(e).catch(h)}),this.registerCommand(J.RunAllCellsAbove,this.runAllCellsAbove),this.registerCommand(J.RunCellAndAllBelow,this.runCellAndAllBelow),this.registerCommand(J.RunAllCellsAbovePalette,this.runAllCellsAboveFromCursor),this.registerCommand(J.RunCellAndAllBelowPalette,this.runCellAndAllBelowFromCursor),this.registerCommand(J.RunCurrentCellAndAddBelow,this.runCurrentCellAndAddBelow),this.registerCommand(J.DebugCell,this.debugCell),this.registerCommand(J.DebugStepOver,this.debugStepOver),this.registerCommand(J.DebugContinue,this.debugContinue),this.registerCommand(J.DebugStop,this.debugStop),this.registerCommand(J.DebugCurrentCellPalette,this.debugCurrentCellFromCursor),this.registerCommand(J.OpenVariableView,this.openVariableView),this.registerCommand(J.OpenOutlineView,this.openOutlineView),this.registerCommand(J.RunToLine,this.runToLine),this.registerCommand(J.RunFromLine,this.runFromLine),this.registerCommand(J.RunFileInInteractiveWindows,this.runFileInteractive),this.registerCommand(J.DebugFileInInteractiveWindows,this.debugFileInteractive))}registerCommand(e,t){let r=Ge.commands.registerCommand(e,t,this);this.disposables.push(r)}getCodeWatcher(e){if(e&&this.dataScienceCodeLensProvider){let t=Ge.workspace.textDocuments.filter(r=>yi(r.uri,e));if(t&&t.length===1)return this.dataScienceCodeLensProvider.getCodeWatcher(t[0]);if(t&&t.length>1)throw new Error(y.documentMismatch(Re(e)))}}async enableLoadingWidgetScriptsFromThirdParty(){this.configService.getSettings(void 0).widgetScriptSources.length>0||await this.configService.updateSetting("widgetScriptSources",["jsdelivr.com","unpkg.com"],void 0,Ge.ConfigurationTarget.Global).catch(h)}async runAllCells(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runAllCells()}async runFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runFileInteractive()}async debugFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.debugFileInteractive()}async runCell(e,t,r,i,o){let s=this.getCodeWatcher(e);if(s)return s.runCell(new Ge.Range(t,r,i,o))}async runAllCellsAbove(e,t,r){if(e){let i=this.getCodeWatcher(e);if(i)return i.runAllCellsAbove(t,r)}}async runCellAndAllBelow(e,t,r){if(e){let i=this.getCodeWatcher(e);if(i)return i.runCellAndAllBelow(t,r)}}async runToLine(){let e=this.getCurrentCodeWatcher(),t=Ge.window.activeTextEditor;if(e&&t&&t.selection)return e.runToLine(t.selection.start.line)}async runFromLine(){let e=this.getCurrentCodeWatcher(),t=Ge.window.activeTextEditor;if(e&&t&&t.selection)return e.runFromLine(t.selection.start.line)}async runCurrentCell(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCell()}async runCurrentCellAndAdvance(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCellAndAdvance()}async runSelectionOrLine(e){let t=this.getCurrentCodeWatcher();if(t)return t.runSelectionOrLine(Ge.window.activeTextEditor,Wn(e)?void 0:e)}async debugCell(e,t,r,i,o){if(e){let s=this.getCodeWatcher(e);if(s)return s.debugCell(new Ge.Range(t,r,i,o))}}async debugStepOver(){this.debugService?.activeDebugSession&&Ge.commands.executeCommand("workbench.action.debug.stepOver").then(h,h)}async debugStop(e){if(this.debugService?.activeDebugSession&&this.interactiveWindowProvider){let t=this.interactiveWindowProvider.get(e);if(t&&t.notebookDocument){let r=this.kernelProvider.get(t.notebookDocument);r&&(p.debug(`Interrupt kernel due to debug stop of IW ${e.toString()}`),await r.interrupt())}Ge.commands.executeCommand("workbench.action.debug.stop").then(h,h)}}async debugContinue(){this.debugService?.activeDebugSession&&Ge.commands.executeCommand("workbench.action.debug.continue").then(h,h)}async addCellBelow(){await this.getCurrentCodeWatcher()?.addEmptyCellToBottom()}async runCurrentCellAndAddBelow(){this.getCurrentCodeWatcher()?.runCurrentCellAndAddBelow()}async insertCellBelowPosition(){this.getCurrentCodeWatcher()?.insertCellBelowPosition()}async insertCellBelow(){this.getCurrentCodeWatcher()?.insertCellBelow()}async insertCellAbove(){this.getCurrentCodeWatcher()?.insertCellAbove()}async deleteCells(){this.getCurrentCodeWatcher()?.deleteCells()}async selectCell(){this.getCurrentCodeWatcher()?.selectCell()}async selectCellContents(){this.getCurrentCodeWatcher()?.selectCellContents()}async extendSelectionByCellAbove(){this.getCurrentCodeWatcher()?.extendSelectionByCellAbove()}async extendSelectionByCellBelow(){this.getCurrentCodeWatcher()?.extendSelectionByCellBelow()}async moveCellsUp(){this.getCurrentCodeWatcher()?.moveCellsUp()}async moveCellsDown(){this.getCurrentCodeWatcher()?.moveCellsDown()}async changeCellToMarkdown(){this.getCurrentCodeWatcher()?.changeCellToMarkdown()}async changeCellToCode(){this.getCurrentCodeWatcher()?.changeCellToCode()}async gotoNextCellInFile(){this.getCurrentCodeWatcher()?.gotoNextCell()}async gotoPrevCellInFile(){this.getCurrentCodeWatcher()?.gotoPreviousCell()}async runAllCellsAboveFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runAllCellsAbove(e.range.start.line,e.range.start.character)}else return}async runCellAndAllBelowFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runCellAndAllBelow(e.range.start.line,e.range.start.character)}else return}async debugCurrentCellFromCursor(){if(this.getCurrentCodeLens()){let t=this.getCurrentCodeWatcher();if(t)return t.debugCurrentCell()}else return}async createNewNotebook(){Ge.window.showInformationMessage('This command has been deprecated and will eventually be removed, please use ["Create: New Jupyter Notebook"](command:workbench.action.openGlobalKeybindings?%5B%22@command:ipynb.newUntitledIpynb%22%5D) instead.').then(h,h),await Ge.commands.executeCommand("ipynb.newUntitledIpynb")}getCurrentCodeLens(){let e=Ge.window.activeTextEditor,t=this.getCurrentCodeWatcher();if(e&&t)return t.getCodeLenses().find(r=>r.range.end.line>=e.selection.anchor.line&&r.range.start.line<=e.selection.anchor.line)}getCurrentCodeWatcher(){let e=Ge.window.activeTextEditor;if(!(!e||!e.document||!this.dataScienceCodeLensProvider))return this.dataScienceCodeLensProvider.getCodeWatcher(e.document)}openPythonExtensionPage(){Ge.env.openExternal(Ge.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter")).then(h,h)}async openVariableView(){return Ge.commands.executeCommand("jupyterViewVariables.focus")}async openOutlineView(){return Ge.commands.executeCommand("outline.focus")}async listenForErrors(e){let t;try{return t=await e(),t}catch(r){p.error("listenForErrors",r),this.dataScienceErrorHandler.handleError(r).then(h,h)}return t}async exportFile(e){let t=Re(e);if(t&&t.length>0&&this.jupyterExporter){let r=Ge.window.activeTextEditor;if(r&&this.fileSystem.arePathsSame(r.document.uri,e)){let i=bF(r.document,this.configuration.getSettings(r.document.uri));if(i){let o=await new Ka().showDialog("ipynb",e);if(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.serialize(i);await this.fileSystem.writeFile(o,s||"")}},y.exportingFormat,U(e)),o&&t){let s=y.exportOpenQuestion1;await Ge.window.showInformationMessage(y.exportDialogComplete(U(e)),s)===s&&await I0(o)}}}}}async exportFileAndOutput(e){let t=Re(e);if(t&&t.length>0&&this.jupyterExporter&&this.jupyterServerHelper&&await this.jupyterServerHelper.isJupyterServerSupported()){let r=Ge.window.activeTextEditor;if(r&&r.document&&this.fileSystem.arePathsSame(r.document.uri,e)){let i=bF(r.document,this.configuration.getSettings(r.document.uri));if(i){let o=await new Ka().showDialog("ipynb",e);return o?(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.serialize(i);await this.fileSystem.writeFile(o,s||"")}},y.exportingFormat,U(e)),await Ge.workspace.openNotebookDocument(o).then(s=>Ge.window.showNotebookDocument(s)),await Ge.commands.executeCommand("notebook.execute"),o):void 0}}}else this.jupyterServerHelper&&await this.dataScienceErrorHandler.handleError(new Yi(y.jupyterNotSupported(await this.jupyterServerHelper.getJupyterServerError())))}async expandAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);p.info(`Expanding all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.expandAllCells()}async collapseAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);p.info(`Collapsing all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.collapseAllCells()}exportCells(){let e=this.interactiveWindowProvider?.activeWindow;e&&e.export()}exportAs(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.exportAs()}export(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.export()}async createNewInteractiveWindow(e){await this.interactiveWindowProvider?.getOrCreate(void 0,e)}waitForStatus(e,t,r,i){let o=t(r||"");return this.statusProvider.waitWithStatus(e,o,void 0,i)}async importNotebook(){let e=y.importDialogFilter,t={};t[e]=["ipynb"];let r=await Ge.window.showOpenDialog({openLabel:y.importDialogTitle,filters:t});r&&r.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(r[0])},y.importingFormat,U(r[0]))}async importNotebookOnFile(e){let t=Re(e);t&&t.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(e)},y.importingFormat,U(e))}async scrollToCell(e,t){if(t&&e){let r=this.interactiveWindowProvider.getInteractiveWindowsWithSubmitter(e);for(let i=0;i<r.length;i+=1)if(await r[i].hasCell(t)){r[i].scrollToCell(t);break}}}async clearAllCellsInInteractiveWindow(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e?.notebookEditor?.notebookUri)?.notebookUri;if(!t)return;let r=Ge.workspace.notebookDocuments.find(s=>s.uri.toString()===t.toString());if(!r)return;let i=new Ge.WorkspaceEdit,o=Ge.NotebookEdit.deleteCells(new Ge.NotebookRange(0,r.cellCount));i.set(r.uri,[o]),await Ge.workspace.applyEdit(i)}async goToCodeInInteractiveWindow(e){if(e&&e.metadata?.interactive){let t=Ge.Uri.parse(e.metadata.interactive.uristring),r=e.metadata.interactive.lineIndex,i=await Ge.window.showTextDocument(t,{viewColumn:Ge.ViewColumn.One});i&&(i.revealRange(new Ge.Range(r,0,r,0)),i.selection=new Ge.Selection(new Ge.Position(r,0),new Ge.Position(r,0)))}}async copyCellInInteractiveWindow(e){if(e){let t=this.configuration.getSettings(e.notebook.uri),r=[e.metadata.interactiveWindowCellMarker??t.defaultCellMarker,e.document.getText()].join(`
`);await Ge.env.clipboard.writeText(r)}}};v([zr("DATASCIENCE.DEBUG_STEP_OVER")],_o.prototype,"debugStepOver",1),v([zr("DATASCIENCE.DEBUG_STOP")],_o.prototype,"debugStop",1),v([zr("DATASCIENCE.DEBUG_CONTINUE")],_o.prototype,"debugContinue",1),v([cr("DATASCIENCE.ADD_CELL_BELOW")],_o.prototype,"addCellBelow",1),v([zr("DATASCIENCE.EXPORT_PYTHON_FILE")],_o.prototype,"exportFile",1),v([zr("DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT")],_o.prototype,"exportFileAndOutput",1),v([zr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"command"})],_o.prototype,"importNotebook",1),v([zr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"file"})],_o.prototype,"importNotebookOnFile",1),_o=v([(0,bn.injectable)(),m(0,(0,bn.inject)(M)),m(1,(0,bn.inject)(fg)),m(1,(0,bn.optional)()),m(2,(0,bn.inject)(yd)),m(2,(0,bn.optional)()),m(3,(0,bn.inject)(tt)),m(4,(0,bn.inject)(ie)),m(5,(0,bn.inject)(wp)),m(5,(0,bn.optional)()),m(6,(0,bn.inject)(_i)),m(6,(0,bn.optional)()),m(7,(0,bn.inject)(ie)),m(8,(0,bn.inject)(zn)),m(9,(0,bn.inject)(we)),m(10,(0,bn.inject)(Br)),m(11,(0,bn.inject)(An)),m(12,(0,bn.inject)(Pb))],_o);var Jb=k(N());var sc=require("vscode");var w0=class{constructor(e,t,r,i){this.configService=e;this.storage=t;this.notebook=r;this.executionCount=0;this.cellIndexesCounted={};this.disposables=[];i.push(this),sc.workspace.onDidChangeTextDocument(this.onChangedDocument,this,this.disposables),nr.onDidChangeNotebookCellExecutionState(this.onDidCellStateChange,this,this.disposables)}dispose(){this.disposed||(this.disposed=!0,this.storage.clear(),this.disposables.forEach(e=>e.dispose()))}reset(){this.storage.clear(),this.executionCount=0}async generateCode(e,t,r,i){let{executableLines:o}=this.extractExecutableLines(e);if(this.executionCount+=1,this.cellIndexesCounted[t]=!0,o.length>0&&o.find(s=>s.trim().length>0))return this.generateCodeImpl(e,this.executionCount,r,i)}extractExecutableLines(e){let t=e.interactive.originalSource,r=this.configService.getSettings(this.notebook.uri),i=new Do(r),o=Qh(t);if(r.magicCommandsAsComments&&o.forEach((s,a)=>o[a]=C0(s)),e.interactiveWindowCellMarker&&o.length&&o[0].trim()===e.interactiveWindowCellMarker.trim()){let s=o.slice(1).filter(a=>a.trim().length>0);if(s.length>0&&s[0].trim().startsWith("%%")){let a=o.slice(o.indexOf(s[0]));return{lines:a,executableLines:a}}}return o.length>0&&(i.isCode(o[0])||i.isMarkdown(o[0]))?{lines:o,executableLines:o.slice(1)}:{lines:o,executableLines:o}}onDidCellStateChange(e){e.state===1&&(e.state!==1||e.cell.notebook!==this.notebook||!e.cell.executionSummary?.executionOrder||this.cellIndexesCounted[e.cell.index]||(this.executionCount+=1,this.cellIndexesCounted[e.cell.index]=!0))}async generateCodeImpl(e,t,r,i){let{lineIndex:o,uristring:s}=e.interactive,a=sc.workspace.textDocuments.find(Y=>Y.uri.toString()===s);if(!a)return;let{stripped:l,trueStartLine:c}=this.extractStrippedLines(e),u=a.lineAt(c),d=a.lineAt(Math.min(c+l.length-1,a.lineCount-1)),f=0;for(;f<l.length&&l[f].trim().length===0;)f+=1;let g=f+c,b=a.offsetAt(new sc.Position(o,0)),I=a.offsetAt(d.rangeIncludingLineBreak.end),w=(e.interactiveWindowCellMarker||"").length>0,{runtimeLine:D,debuggerStartLine:A}=this.addHiddenLines(r,l,c,g,w,i),T=l.join(""),$=a.getText(new sc.Range(new sc.Position(o,0),d.rangeIncludingLineBreak.end)),ne=(await ia(T,"SHA-1")).substring(0,12),H=this.getRuntimeFile(ne,t),oe=r?-1:0,ae={line:u?u.lineNumber+1:1,endLine:d?d.lineNumber+1:1,firstNonBlankLineIndex:g,debuggerStartLine:A,executionCount:t,startOffset:b,endOffset:I,deleted:!1,code:T,trimmedRightCode:l.map(Y=>Y.replace(/[ \t\r]+\n$/g,`
`)).join(""),realCode:$,runtimeLine:D,runtimeFile:H,id:e.id,timestamp:Date.now(),lineOffsetRelativeToIndexOfFirstLineInCell:oe,hasCellMarker:w};return p.info(`Generated code for ${t} = ${H} with ${l.length} lines`),this.storage.store(sc.Uri.parse(e.interactive.uristring),ae),ae}getRuntimeFile(e,t){return`<ipython-input-${t}-${e}>`}onChangedDocument(e){let t=this.storage.getFileGeneratedCode(e.document.uri);if(t){let r=e.document.getText();e.contentChanges.forEach(i=>{this.handleContentChange(r,i,t)})}}extractStrippedLines(e){let t=Qh(e.interactive.originalSource),{lines:r}=this.extractExecutableLines(e),i=e.interactive.lineIndex+1;if(!e.interactiveWindowCellMarker){i=e.interactive.lineIndex;for(let l=0;l<r.length;l+=1)if(r[l]!==t[l]){i+=l+1;break}}let o=0;for(;o<r.length&&r[o].trim().length===0;)o+=1;let s=r.length-1,a=r.length-2;for(;a>0;){let l=r[s],c=r[a];if((l.length===0||l===`
`)&&(c.length===0||c===`
`))r.splice(s,1),s-=1,a-=1;else break}!r[s].endsWith(`
`)&&r[s].length>0&&(r[s]=`${r[s]}
`);for(let l=0;l<r.length;l++)r[l]=r[l].replace(/\r\n/g,`
`);return{stripped:r,trueStartLine:i}}handleContentChange(e,t,r){let i=t.range.start.line-t.range.end.line+t.text.split(`
`).length-1,o=t.text.length-t.rangeLength,s=t.rangeLength<=0?t.rangeOffset:t.rangeOffset+t.rangeLength-1;r.forEach(a=>{a.endOffset<t.rangeOffset||(a.startOffset>s?(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.startOffset===s?a.deleted||t.rangeLength>0||i===0?a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode:(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode)})}addHiddenLines(e,t,r,i,o,s){let a=s||this.configService.getSettings(void 0).forceIPyKernelDebugger===!0;return e&&this.configService.getSettings(this.notebook.uri).stopOnFirstLineWhileDebugging?a?(t.splice(0,0,`breakpoint()
`),{runtimeLine:1,debuggerStartLine:r+1}):(t.splice(0,0,`breakpoint()
`),{runtimeLine:2,debuggerStartLine:r}):{runtimeLine:1,debuggerStartLine:o?i:i+1}}};var GH=require("vscode");var jb=class{constructor(e,t,r){this.configService=e;this.storageFactory=t;this.disposables=r;this.codeGenerators=new WeakMap}activate(){GH.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebook,this,this.disposables)}getOrCreate(e){let t=this.get(e);if(t)return t;let r=new w0(this.configService,this.storageFactory.getOrCreate(e),e,this.disposables);return this.codeGenerators.set(e,r),r}get(e){return this.codeGenerators.get(e)}onDidCloseNotebook(e){this.codeGenerators.get(e)?.dispose(),this.codeGenerators.delete(e)}};jb=v([(0,Jb.injectable)(),m(0,(0,Jb.inject)(ie)),m(1,(0,Jb.inject)(Js)),m(2,(0,Jb.inject)(M))],jb);var Eu=k(N()),kp=require("vscode");function ns(n){if(n.metadata.interactive!==void 0)return n.metadata}function zH(n,e,t){let r=Ue(n,{trim:!1,removeEmptyEntries:!1}),i=t.stripFirstMarkerNoConcat(r),o=G2(i),s=Yh(o,`
`,e.magicCommandsAsComments?C0:void 0);return yh(s.join(""))}var bme=y.runCurrentCellAndAddBelow,Ime=y.addCellBelowCommandTitle,Sme=y.debugCellCommandTitle,Cme=y.debugCellCommandTitle,Eme=y.debugStepOverCommandTitle,wme=y.debugContinueCommandTitle,Pme=y.debugStopCommandTitle,kme=y.runCellLensCommandTitle,xme=y.runAllCellsLensCommandTitle,Dme=y.runAllCellsAboveLensCommandTitle,QH=y.runCellAndAllBelowLensCommandTitle,_me=y.scrollToCellTitleFormatMessage,Bb=class{constructor(e,t,r,i,o,s){this.configService=e;this.generatedCodeStorageFactory=r;this.replTracker=o;this.cellRangeCache=s;this.updateEvent=new kp.EventEmitter;this.notebookData=new Map;this.codeLensCache=new Map;this.totalCodeLensUpdateTimeInMs=0;this.codeLensUpdateCount=0;this.maxCellCount=0;kp.workspace.onDidCloseTextDocument(this.onClosedDocument,this,t),kp.workspace.onDidGrantWorkspaceTrust(()=>this.codeLensCache.clear(),this,t),this.configService.getSettings(void 0).onDidChange(this.onChangedSettings,this,t),nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,t),i.onDidDisposeKernel(a=>{this.notebookData.delete(a.notebook.uri.toString())},this,t)}getPerfMeasures(){return{totalCodeLensUpdateTimeInMs:this.totalCodeLensUpdateTimeInMs,codeLensUpdateCount:this.codeLensUpdateCount,maxCellCount:this.maxCellCount}}get updateRequired(){return this.updateEvent.event}createCodeLenses(e){let t=this.getCodeLensCacheData(e);return[...t.documentLenses,...t.gotoCellLens]}getCellRanges(e){return this.getCodeLensCacheData(e).cellRanges}getCodeLensCacheData(e){let t=new Fe,r=!1,i=e.uri.toString(),o=this.codeLensCache.get(i),s=!1;o||(o={cachedDocumentVersion:void 0,cachedExecutionCounts:new Set,documentLenses:[],cellRanges:[],gotoCellLens:[]},s=!0,this.codeLensCache.set(i,o)),o.cachedDocumentVersion!==e.version&&(o.cellRanges=this.cellRangeCache.getCellRanges(e),o.documentLenses=[],o.gotoCellLens=[],o.cachedDocumentVersion=e.version,s=!0);let a=this.getDocumentExecutionCounts(i);if((a.length!==o.cachedExecutionCounts.size||a.find(l=>!o?.cachedExecutionCounts.has(l)))&&(o.gotoCellLens=[],o.cachedExecutionCounts=new Set(a),s=!0),o.documentLenses.length===0&&s&&o.cellRanges.length){r=!0;let l=this.enumerateCommands(e.uri);p.debug(`CodeLensFactory: Generating new code lenses for version ${e.version} of document ${e.uri} for commands ${l.join(", ")}`);let c=!0;o.cellRanges.forEach(u=>{l.forEach(d=>{let f=this.createCodeLens(e,u,d,c);f&&o.documentLenses.push(f)}),c=!1})}else p.ci(`NOT Generating new code lenses for version ${e.version} of document ${e.uri} - needUpdate: ${s}, cellRanges.length: ${o.cellRanges.length}`);if(s&&o.gotoCellLens.length===0&&o.cellRanges.length&&this.configService.getSettings(e.uri).addGotoCodeLenses){let l=this.generatedCodeStorageFactory.get({fileUri:e.uri}),c=l?l.all.find(u=>u.uri.toString()===e.uri.toString())?.generatedCodes:void 0;c&&c.length&&o.cellRanges.forEach(u=>{let d=this.createExecutionLens(e,u.range,c);d&&o?.gotoCellLens.push(d)})}return r&&(this.totalCodeLensUpdateTimeInMs+=t.elapsedTime,this.codeLensUpdateCount+=1,this.maxCellCount=Math.max(this.maxCellCount,o.cellRanges.length)),o}getDocumentExecutionCounts(e){return[...this.notebookData.values()].map(t=>t.documentExecutionCounts.get(e)).filter(t=>t!==void 0)}onDidChangeNotebookCellExecutionState(e){if(this.replTracker.isForReplEditor(e.cell.notebook)||e.state!==1||!e.cell.executionSummary?.executionOrder)return;let t=ns(e.cell),r=this.notebookData.get(e.cell.notebook.uri.toString());r||(r={cellExecutionCounts:new Map,documentExecutionCounts:new Map},this.notebookData.set(e.cell.notebook.uri.toString(),r)),r!==void 0&&t!==void 0&&(r.cellExecutionCounts.set(t.id,e.cell.executionSummary.executionOrder),r.documentExecutionCounts.set(t.interactive.uristring,e.cell.executionSummary.executionOrder),this.updateEvent.fire())}onClosedDocument(e){this.codeLensCache.delete(e.uri.toString())}onChangedSettings(){this.codeLensCache.clear(),this.cellRangeCache.clear(),this.updateEvent.fire()}enumerateCommands(e){let t,r=this.configService.getSettings(e).codeLenses;r?t=r.split(",").map(s=>s.trim()):t=ju.DefaultDesignLenses;let i=this.configService.getSettings(e).debugCodeLenses;i?t=t.concat(i.split(",").map(s=>s.trim())):t=t.concat(ju.DefaultDebuggingLenses);let o=[];return kp.workspace.isTrusted||(o=[...ju.DebuggerCommands,...ju.DebuggerCommands,J.RunAllCells,J.RunAllCellsAbove,J.RunAllCellsAbovePalette,J.RunCellAndAllBelowPalette,J.RunCurrentCell,J.RunCurrentCellAdvance,J.RunCurrentCellAndAddBelow,J.RunFileInInteractiveWindows,J.InterruptKernel,J.RunToLine,J.RunCell,J.DebugCell,J.DebugContinue,J.DebugStepOver,J.DebugStop,J.RunCellAndAllBelowPalette]),o&&(t=t.filter(s=>!o.includes(s))),t}createCodeLens(e,t,r,i){let{range:o,cell_type:s}=t;switch(r){case J.RunCurrentCellAndAddBelow:return this.generateCodeLens(o,J.RunCurrentCellAndAddBelow,bme);case J.AddCellBelow:return this.generateCodeLens(o,J.AddCellBelow,Ime,[e.uri,o.start.line]);case J.DebugCurrentCellPalette:return this.generateCodeLens(o,J.DebugCurrentCellPalette,Sme);case J.DebugCell:if(s!=="code")break;return this.generateCodeLens(o,J.DebugCell,Cme,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.DebugStepOver:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStepOver,Eme,[e.uri]);case J.DebugContinue:if(s!=="code")break;return this.generateCodeLens(o,J.DebugContinue,wme,[e.uri]);case J.DebugStop:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStop,Pme,[e.uri]);case J.RunCurrentCell:case J.RunCell:return this.generateCodeLens(o,J.RunCell,kme,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.RunAllCells:return this.generateCodeLens(o,J.RunAllCells,xme,[e.uri,o.start.line,o.start.character]);case J.RunAllCellsAbovePalette:case J.RunAllCellsAbove:return i?this.generateCodeLens(o,J.RunCellAndAllBelow,QH,[e.uri,o.start.line,o.start.character]):this.generateCodeLens(o,J.RunAllCellsAbove,Dme,[e.uri,o.start.line,o.start.character]);case J.RunCellAndAllBelowPalette:case J.RunCellAndAllBelow:return this.generateCodeLens(o,J.RunCellAndAllBelow,QH,[e.uri,o.start.line,o.start.character]);default:p.warn(`Invalid command for code lens ${r}`);break}}findMatchingCellExecutionCount(e){return[...this.notebookData.values()].find(r=>r.cellExecutionCounts.get(e))?.cellExecutionCounts.get(e)}createExecutionLens(e,t,r){if(r){let i=r.filter(o=>o.line-2===t.start.line).sort((o,s)=>o.timestamp-s.timestamp);if(i&&i.length){let o=i[i.length-1],s=this.findMatchingCellExecutionCount(o.id);if(s!==void 0)return this.generateCodeLens(t,J.ScrollToCell,_me(s),[e.uri,o.id])}}}generateCodeLens(e,t,r,i){return new kp.CodeLens(e,Tme(t,r,i))}};Bb=v([(0,Eu.injectable)(),m(0,(0,Eu.inject)(ie)),m(1,(0,Eu.inject)(M)),m(2,(0,Eu.inject)(Js)),m(3,(0,Eu.inject)(we)),m(4,(0,Eu.inject)(wo)),m(5,(0,Eu.inject)(Pp))],Bb);function Tme(n,e,t){return{arguments:t,title:e,command:n}}var ac=k(N()),La=k(require("vscode"));var $b=class{constructor(e,t,r,i,o){this.serviceContainer=e;this.debugLocationTracker=t;this.configuration=r;this.debugService=o;this.totalExecutionTimeInMs=0;this.totalGetCodeLensCalls=0;this.activeCodeWatchers=[];this.didChangeCodeLenses=new La.EventEmitter;i.push(this),i.push(La.workspace.onDidGrantWorkspaceTrust(()=>{this.activeCodeWatchers=z(this.activeCodeWatchers),this.didChangeCodeLenses.fire()})),i.push(this.debugService.onDidChangeActiveDebugSession(this.onChangeDebugSession.bind(this))),i.push(La.workspace.onDidCloseTextDocument(this.onDidCloseTextDocument.bind(this))),this.debugLocationTracker&&i.push(this.debugLocationTracker.updated(this.onDebugLocationUpdated.bind(this)))}dispose(){this.totalGetCodeLensCalls>0&&R("DS_INTERNAL.CODE_LENS_ACQ_TIME",{duration:this.totalExecutionTimeInMs/this.totalGetCodeLensCalls}),z(this.activeCodeWatchers)}get onDidChangeCodeLenses(){return this.didChangeCodeLenses.event}provideCodeLenses(e,t){return[Ys,ch].includes(e.uri.scheme)?[]:this.getCodeLensTimed(e)}getCodeWatcher(e){return this.matchWatcher(e.uri)}onDebugLocationUpdated(){this.didChangeCodeLenses.fire()}onChangeDebugSession(e){this.didChangeCodeLenses.fire()}onDidCloseTextDocument(e){let t=this.activeCodeWatchers.findIndex(r=>r.uri&&r.uri.toString()===e.uri.toString());t>=0&&this.activeCodeWatchers.splice(t,1)[0].dispose()}getCodeLensTimed(e){let t=new Fe,r=this.getCodeLens(e);return this.totalExecutionTimeInMs+=t.elapsedTime,this.totalGetCodeLensCalls+=1,this.configuration.getSettings(e.uri).enableCellCodeLens?this.adjustDebuggingLenses(e,r):[]}adjustDebuggingLenses(e,t){let r=ju.DebuggerCommands;if(this.debugLocationTracker&&this.debugService.activeDebugSession){let i=this.debugLocationTracker.getLocation(this.debugService.activeDebugSession),o;try{o=i?La.Uri.parse(i.fileName):void 0}catch{}if(i&&(yi(La.Uri.file(i.fileName),e.uri,!0)||o&&yi(o,e.uri,!0)))return t.filter(a=>{let l=new La.Position(i.lineNumber-1,i.column-1);return a.range.contains(l)}).filter(a=>a.command?r.includes(a.command.command):!1);p.ci(`Detected debugging context because activeDebugSession is name:"${this.debugService.activeDebugSession.name}", type: "${this.debugService.activeDebugSession.type}", but fell through with debugLocation: ${JSON.stringify(i)}, and document.uri: ${e.uri.toString()}`)}else return t.filter(i=>i.command?!r.includes(i.command.command):!1);return[]}getCodeLens(e){let t=this.matchWatcher(e.uri);return t?t.getCodeLenses():(p.debug(`Creating a new watcher for document ${e.uri}`),this.createNewCodeWatcher(e).getCodeLenses())}matchWatcher(e){let t=this.activeCodeWatchers.findIndex(i=>i.uri&&i.uri.toString()==e.toString());if(t>=0)return this.activeCodeWatchers[t];let r=La.workspace.textDocuments.filter(i=>i.uri.toString()===e.toString());if(r&&r.length>0)return p.debug(`creating new code watcher with matching document ${e}`),this.createNewCodeWatcher(r[0])}createNewCodeWatcher(e){let t=this.serviceContainer.get(f0);return t.setDocument(e),t.codeLensUpdated(this.onWatcherUpdated.bind(this)),this.activeCodeWatchers.push(t),t}onWatcherUpdated(){this.didChangeCodeLenses.fire()}};$b=v([(0,ac.injectable)(),m(0,(0,ac.inject)(st)),m(1,(0,ac.inject)(BT)),m(1,(0,ac.optional)()),m(2,(0,ac.inject)(ie)),m(3,(0,ac.inject)(M)),m(4,(0,ac.inject)(_i))],$b);var wu=k(N()),fe=require("vscode");var Rf=class extends Error{constructor(t){super("Cell failed to execute");this.cell=t}};function Rme(n,e){if(e<=0)throw new RangeError(`Length must be > 0 not ${e}`);return n<0&&(n+=e),n<0?0:n>=e?e-1:n}var Gt=class{constructor(e,t,r,i,o,s){this.interactiveWindowProvider=e;this.configService=t;this.executionHelper=r;this.dataScienceErrorHandler=i;this.codeLensFactory=o;this.replTracker=s;this.version=-1;this.codeLenses=[];this.cells=[];this.codeLensUpdatedEvent=new fe.EventEmitter;this.disposables=[this.codeLensUpdatedEvent]}setDocument(e){this.document=e,this.version=e.version,this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.disposables.push(this.codeLensFactory.updateRequired(this.onCodeLensFactoryUpdated.bind(this))),this.disposables.push(fe.workspace.onDidCloseTextDocument(this.onDocumentClosed.bind(this))),this.disposables.push(fe.workspace.onDidCloseNotebookDocument(this.ondidCloseNotebook.bind(this)))}get codeLensUpdated(){return this.codeLensUpdatedEvent.event}get uri(){return this.document?.uri}getVersion(){return this.version}getCodeLenses(){let e=this.document;return e&&e.version!=this.version&&(this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.version=e.version),this.codeLenses}async debugCurrentCell(){if(!(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document))return this.runMatchingCell(fe.window.activeTextEditor.selection,!1,!0)}dispose(){let e=this.codeLensFactory.getPerfMeasures();e&&e.codeLensUpdateCount>0&&R("DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",{codeLensUpdateTime:e.totalCodeLensUpdateTimeInMs/e.codeLensUpdateCount,maxCellCount:e.maxCellCount}),z(this.disposables)}async runAllCells(e){let t=await this.getActiveInteractiveWindow(),r=this.codeLenses.filter(s=>s.command&&s.command.command===J.RunCell&&s.command.arguments&&s.command.arguments.length>=5),i=r.length,o=Promise.resolve(!0);for(let s of r){let a=new fe.Range(s.command.arguments[1],s.command.arguments[2],s.command.arguments[3],s.command.arguments[4]);if(this.document){i===r.length&&(a=new fe.Range(new fe.Position(0,0),a.end));let l=this.document.getText(a);i-=1,o=this.addCode(t,l,this.document.uri,a.start.line,e)}}if(await o,r.length===0)return this.runFileAsOneCell(e??!1)}async runFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells();if(this.document)return this.runFileAsOneCell(!1)}async debugFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells(!0);if(this.document)return this.runFileAsOneCell(!0)}async runAllCellsAbove(e,t){let r=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(l=>l.command&&l.command.command===J.RunCell),o=i.findIndex(l=>l.range.start.line>=e&&l.range.start.character>=t);o<0&&(o=i.length);let s=o,a=Promise.resolve(!0);for(let l of i)if(o>0&&this.document){let c=new fe.Range(l.range.start,l.range.end);o===s&&(c=new fe.Range(new fe.Position(0,0),c.end)),o-=1;let u=this.document.getText(c);a=this.addCode(r,u,this.document.uri,l.range.start.line)}else break;await a}async runCellAndAllBelow(e,t){let r=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(l=>l.command&&l.command.command===J.RunCell),o=i.findIndex(l=>l.range.start.line>=e&&l.range.start.character>=t),s=o>0?i.length-o:i.length,a=Promise.resolve(!0);for(let l=o;l>=0&&l<i.length;l+=1)if(s>0&&this.document){let c=i[l];s-=1;let u=this.document.getText(c.range);a=this.addCode(r,u,this.document.uri,c.range.start.line)}await a}async runSelectionOrLine(e,t){if(this.document&&e&&yi(e.document.uri,this.document.uri)){let r=await this.getActiveInteractiveWindow(),i;if(t===void 0||Wn(t)?i=this.executionHelper.getSelectedTextToExecute(e):i=t,!i)return;await this.addCode(r,i,this.document.uri,e.selection.start.line)}}async runToLine(e){if(this.document&&e>0){let t=await this.getActiveInteractiveWindow(),r=this.document.lineAt(e-1),i=this.document.getText(new fe.Range(0,0,r.range.end.line,r.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,0)}}async runFromLine(e){if(this.document&&e<this.document.lineCount){let t=await this.getActiveInteractiveWindow(),r=this.document.lineAt(this.document.lineCount-1),i=this.document.getText(new fe.Range(e,0,r.range.end.line,r.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,e)}}async runCell(e){if(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document)return;let t=e.contains(fe.window.activeTextEditor.selection.start)&&this.configService.getSettings(fe.window.activeTextEditor.document.uri).enableAutoMoveToNextCell;return this.runMatchingCell(e,t)}async debugCell(e){if(!(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document))return this.runMatchingCell(e,!1,!0)}async runCurrentCell(){if(!(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document))return this.runMatchingCell(fe.window.activeTextEditor.selection,!1)}async runCurrentCellAndAdvance(){if(!(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document))return this.runMatchingCell(fe.window.activeTextEditor.selection,!0)}async addEmptyCellToBottom(){let e=fe.window.activeTextEditor;e&&this.insertCell(e,e.document.lineCount+1)}async runCurrentCellAndAddBelow(){if(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document)return;let e=fe.window.activeTextEditor,t=new Do(this.configService.getSettings(e.document.uri)),r=0,i=this.getDefaultCellMarker(e.document.uri);e&&e.edit(s=>{let a=!0;for(let l=e.selection.end.line+1;l<e.document.lineCount;l+=1)if(t.isCell(e.document.lineAt(l).text)){a=!1,r=l,s.insert(new fe.Position(l,0),`${i}

`);break}a&&(r=e.document.lineCount,s.insert(new fe.Position(e.document.lineCount,0),`
${i}
`))}).then(h,h);let o=new fe.Position(r+1,0);return this.runMatchingCell(e.selection,!1).then(()=>this.advanceToRange(new fe.Range(o,o)))}insertCellBelowPosition(){let e=fe.window.activeTextEditor;e&&e.selection&&this.insertCell(e,e.selection.end.line+1)}insertCellBelow(){let e=fe.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.end);t?this.insertCell(e,t.range.end.line+1):this.insertCell(e,e.selection.end.line+1)}}insertCellAbove(){let e=fe.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.start);t?this.insertCell(e,t.range.start.line):this.insertCell(e,e.selection.start.line)}}deleteCells(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCells(e.selection);if(!t)return;let r=t[0],i=t[1],o=0,s=0,a=i.range.end.line+1,l=0;r.range.start.line>0&&(o=r.range.start.line-1,s=e.document.lineAt(o).range.end.character,a=i.range.end.line,l=i.range.end.character);let c=new fe.Range(new fe.Position(o,s),new fe.Position(a,l));e.edit(u=>{u.replace(c,""),this.codeLensUpdatedEvent.fire()}).then(h,h)}selectCell(){let e=fe.window.activeTextEditor;if(e&&e.selection){let t=this.getStartEndCells(e.selection);if(t){let r=t[0],i=t[1];e.selection.anchor.isBeforeOrEqual(e.selection.active)?e.selection=new fe.Selection(r.range.start,i.range.end):e.selection=new fe.Selection(i.range.end,r.range.start)}}}selectCellContents(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCellIndex(e.selection);if(!t)return;let r=t[0],i=t[1],o=e.selection.anchor.isBeforeOrEqual(e.selection.active),s=this.cells,a=[];for(let l=r;l<=i;l+=1){let c=s[l],u=c.range.start.line+1,d=0,f=c.range.end.line,g=c.range.end.character;c.range.start.line===c.range.end.line&&(u=c.range.start.line,d=e.document.lineAt(u).range.end.character,f=u,g=d),o?a.push(new fe.Selection(u,d,f,g)):a.push(new fe.Selection(f,g,u,d))}e.selections=a}extendSelectionByCellAbove(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getStartEndCellIndex(e.selection);if(!r)return;let i=e.selection.anchor.isBefore(e.selection.active),o=this.cells,s=r[0],a=r[1],l=o[s],c=o[a];if(!l.range.start.isEqual(t.start)||!c.range.end.isEqual(t.end)){let u;i?s<a?u=new fe.Selection(l.range.start,o[a-1].range.end):u=new fe.Selection(l.range.end,l.range.start):u=new fe.Selection(c.range.end,l.range.start),e.selection=u}else{let u;i&&s<a?(u=o[a-1],e.selection=new fe.Selection(l.range.start,u.range.end)):s>0&&(u=o[s-1],e.selection=new fe.Selection(c.range.end,u.range.start)),u&&e.revealRange(u.range,fe.TextEditorRevealType.Default)}}extendSelectionByCellBelow(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getStartEndCellIndex(e.selection);if(!r)return;let i=e.selection.anchor.isBeforeOrEqual(e.selection.active),o=this.cells,s=r[0],a=r[1],l=o[s],c=o[a];if(!l.range.start.isEqual(t.start)||!c.range.end.isEqual(t.end)){let u;i?u=new fe.Selection(l.range.start,c.range.end):s<a?u=new fe.Selection(o[s+1].range.start,c.range.end):u=new fe.Selection(c.range.start,c.range.end),e.selection=u}else{let u;i||s===a?a<o.length-1&&(u=o[a+1],e.selection=new fe.Selection(l.range.start,u.range.end)):s<a&&(u=o[s+1],e.selection=new fe.Selection(c.range.end,u.range.start)),u&&e.revealRange(u.range,fe.TextEditorRevealType.Default)}}async moveCellsUp(){await this.moveCellsDirection(!0)}async moveCellsDown(){await this.moveCellsDirection(!1)}changeCellToMarkdown(){this.applyToCells((e,t,r)=>this.changeCellTo(e,t,"markdown"))}changeCellToCode(){this.applyToCells((e,t,r)=>this.changeCellTo(e,t,"code"))}gotoNextCell(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getCurrentCellLens(t.start),i=this.getNextCellLens(t.start);r&&i&&this.advanceToRange(i.range)}gotoPreviousCell(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getCurrentCellLens(t.start),i=this.getPreviousCellLens(t.start);r&&i&&this.advanceToRange(i.range)}applyToCells(e){let t=fe.window.activeTextEditor,r=this.getStartEndCellIndex(t?.selection);if(!t||!r)return;let i=this.cells,o=r[0],s=r[1];for(let a=o;a<=s;a+=1)e(t,i[a],a)}changeCellTo(e,t,r){if(r==="raw")throw Error("Cell Type raw not implemented");if(t.cell_type===r)return;let i=new Do(this.configService.getSettings(e.document.uri)),o=e.document.lineAt(t.range.start.line),s=e.document.getText(o.range),a=this.getDefaultCellMarker(e.document.uri),l=r==="markdown"?i.codeExecRegEx.exec(s):i.markdownExecRegEx.exec(s);if(!l)return;let c=l[l.length-1],u=r==="markdown"?`${a} [markdown]${c}`:`${a}${c}`;e.edit(async d=>{d.replace(o.range,u),t.cell_type=r,t.range.start.line<t.range.end.line&&(e.selection=new fe.Selection(t.range.start.line+1,0,t.range.end.line,t.range.end.character),fe.commands.executeCommand("editor.action.removeCommentLine").then(h,h),r==="markdown"&&fe.commands.executeCommand("editor.action.addCommentLine").then(h,h))}).then(h,h)}async moveCellsDirection(e){let t=fe.window.activeTextEditor;if(!t||!t.selection)return!1;let r=this.getStartEndCellIndex(t.selection);if(!r)return!1;let i=r[0],o=r[1],s=this.cells,a=s[i],l=s[o];if(!a||!l)return!1;let c=new fe.Range(a.range.start,l.range.end),u=new fe.Range(t.selection.start.line-c.start.line,t.selection.start.character,t.selection.end.line-c.start.line,t.selection.end.character),d=t.selection.active.isBefore(t.selection.anchor),f;if(e){if(i===0)return!1;{let g=s[i-1];f=this.exchangeTextLines(t,g.range,c).then(I=>(I&&(t.selection=new fe.Selection(g.range.start.line+u.start.line,u.start.character,g.range.start.line+u.end.line,u.end.character)),I))}}else{if(o===s.length-1)return!1;{let g=s[o+1],b=this.exchangeTextLines(t,c,g.range),I=g.range.end.line-g.range.start.line,w=c.end.line-c.start.line,D=I-w;f=b.then(A=>(A&&(t.selection=new fe.Selection(g.range.start.line+D+u.start.line,u.start.character,g.range.start.line+D+u.end.line,u.end.character)),A))}}return f.then(g=>(g&&d&&(t.selection=new fe.Selection(t.selection.active,t.selection.anchor)),!0))}exchangeTextLines(e,t,r){let i=t.start.line,o=t.end.line,s=r.start.line,a=r.end.line;if(o>=s)throw RangeError(`Above lines must be fully above not ${o} <= ${s}`);let l=new fe.Range(i,0,o,e.document.lineAt(o).range.end.character),c=e.document.getText(l),u=new fe.Range(s,0,a,e.document.lineAt(a).range.end.character),d=e.document.getText(u),f="";if(o+1<s){let I=o+1,w=s-1,D=new fe.Range(I,0,w,e.document.lineAt(w).range.end.character);f=`${e.document.getText(D)}
`}let g=`${d}
${f}${c}`,b=new fe.Range(l.start,u.end);return e.edit(I=>{I.replace(b,g),this.codeLensUpdatedEvent.fire()})}getStartEndCells(e){let t=this.getStartEndCellIndex(e);if(t){let r=this.getCellFromIndex(t[0]),i=this.getCellFromIndex(t[1]);return[r,i]}}getStartEndCellIndex(e){if(!e)return;let t=this.getCellIndex(e.start),r=t;if(e.start.line!==e.end.line&&(r=this.getCellIndex(e.end)),t===-1){if(r===-1)return;{t=0;let i=this.getCellFromIndex(0);if(e.start.line>i.range.start.line)throw RangeError(`Should not be able to pick a range with an end in a cell and start after a cell. ${e.start.line} > ${i.range.end.line}`)}}if(t>=0&&r>=0)return[t,r]}insertCell(e,t){let r=this.getDefaultCellMarker(e.document.uri),i=t>=e.document.lineCount?`
${r}
`:`${r}

`,o=new fe.Position(t,0),s=new fe.Position(t+1,0);e.edit(a=>{a.insert(o,i),this.codeLensUpdatedEvent.fire()}).then(h,h),e.selection=new fe.Selection(s,s)}getDefaultCellMarker(e){return this.configService.getSettings(e).defaultCellMarker||Je.DefaultCodeCellMarker}onCodeLensFactoryUpdated(){this.document&&(this.codeLenses=this.codeLensFactory.createCodeLenses(this.document),this.cells=this.codeLensFactory.getCellRanges(this.document)),this.codeLensUpdatedEvent.fire()}onDocumentClosed(e){this.document&&yi(e.uri,this.document.uri)&&z(this.disposables)}ondidCloseNotebook(e){this.replTracker.isForReplEditor(e)&&this.configService.getSettings(this.document?.uri).addGotoCodeLenses&&this.onCodeLensFactoryUpdated()}getActiveInteractiveWindow(){return this.interactiveWindowProvider.getOrCreate(this.document?.uri)}async addCode(e,t,r,i,o){let s=!1;try{o?s=await e.debugCode(t,r,i):s=await e.addCode(t,r,i)}catch(a){a instanceof Rf||await this.dataScienceErrorHandler.handleError(a)}return s}async runMatchingCell(e,t,r){let i=this.getCurrentCellLens(e.start),o=this.getNextCellLens(e.start);if(i&&this.document){let s=yh(this.document.getText(i.range));if(t){let l=fe.window.activeTextEditor,{newCellOnRunLast:c}=this.configService.getSettings(this.document.uri),u=new Do(this.configService.getSettings(this.document.uri));o?this.advanceToRange(o.range):c&&l&&!u.isEmptyCell(s)&&this.insertCell(l,i.range.end.line+1)}let a=await this.getActiveInteractiveWindow();await this.addCode(a,s,this.document.uri,i.range.start.line,r)}}getCellIndex(e){return this.cells.findIndex(t=>e&&t.range.contains(e))}getCellFromIndex(e){let t=this.cells,r=Rme(e,t.length);return t[r]}getCellFromPosition(e){if(!e){let t=fe.window.activeTextEditor;t&&t.selection&&(e=t.selection.active)}if(e){let t=this.getCellIndex(e);if(t>=0)return this.cells[t]}}getCurrentCellLens(e){return this.codeLenses.find(t=>t.range.contains(e)&&t.command!==void 0&&t.command.command===J.RunCell)}getNextCellLens(e){let t=this.codeLenses.findIndex(r=>r.range.contains(e)&&r.command!==void 0&&r.command.command===J.RunCell);if(t>=0)return this.codeLenses.find((r,i)=>r.command!==void 0&&r.command.command===J.RunCell&&i>t)}getPreviousCellLens(e){let t=this.codeLenses.findIndex(r=>r.range.contains(e)&&r.command!==void 0&&r.command.command===J.RunCell);if(t>=1)return this.codeLenses.find((r,i)=>r.command!==void 0&&i<t&&i+1===t)}async runFileAsOneCell(e){if(this.document){let t=await this.getActiveInteractiveWindow(),r=this.document.getText();await this.addCode(t,r,this.document.uri,0,e)}}advanceToRange(e){let t=fe.window.activeTextEditor,r=new fe.Selection(e.start,e.start);t&&(t.selection=r,t.revealRange(e,fe.TextEditorRevealType.Default))}};v([zr("DATASCIENCE.DEBUG_CURRENT_CELL")],Gt.prototype,"debugCurrentCell",1),v([zr("DATASCIENCE.RUN_ALL_CELLS")],Gt.prototype,"runAllCells",1),v([zr("DATASCIENCE.RUN_FILE_INTERACTIVE")],Gt.prototype,"runFileInteractive",1),v([zr("DATASCIENCE.DEBUG_FILE_INTERACTIVE")],Gt.prototype,"debugFileInteractive",1),v([zr("DATASCIENCE.RUN_ALL_CELLS_ABOVE")],Gt.prototype,"runAllCellsAbove",1),v([zr("DATASCIENCE.RUN_CELL_AND_ALL_BELOW")],Gt.prototype,"runCellAndAllBelow",1),v([zr("DATASCIENCE.RUN_SELECTION_OR_LINE")],Gt.prototype,"runSelectionOrLine",1),v([zr("DATASCIENCE.RUN_TO_LINE")],Gt.prototype,"runToLine",1),v([zr("DATASCIENCE.RUN_FROM_LINE")],Gt.prototype,"runFromLine",1),v([ti("CodeWatcher::runCell",4)],Gt.prototype,"runCell",1),v([zr("DATASCIENCE.DEBUG_CURRENT_CELL")],Gt.prototype,"debugCell",1),v([zr("DATASCIENCE.RUN_CURRENT_CELL")],Gt.prototype,"runCurrentCell",1),v([zr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE")],Gt.prototype,"runCurrentCellAndAdvance",1),v([cr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW")],Gt.prototype,"runCurrentCellAndAddBelow",1),v([cr("DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION")],Gt.prototype,"insertCellBelowPosition",1),v([cr("DATASCIENCE.RUN_INSERT_CELL_BELOW")],Gt.prototype,"insertCellBelow",1),v([cr("DATASCIENCE.RUN_INSERT_CELL_ABOVE")],Gt.prototype,"insertCellAbove",1),v([cr("DATASCIENCE.RUN_DELETE_CELLS")],Gt.prototype,"deleteCells",1),v([cr("DATASCIENCE.RUN_SELECT_CELL")],Gt.prototype,"selectCell",1),v([cr("DATASCIENCE.RUN_SELECT_CELL_CONTENTS")],Gt.prototype,"selectCellContents",1),v([cr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE")],Gt.prototype,"extendSelectionByCellAbove",1),v([cr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW")],Gt.prototype,"extendSelectionByCellBelow",1),v([cr("DATASCIENCE.RUN_MOVE_CELLS_UP")],Gt.prototype,"moveCellsUp",1),v([cr("DATASCIENCE.RUN_MOVE_CELLS_DOWN")],Gt.prototype,"moveCellsDown",1),v([cr("DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN")],Gt.prototype,"changeCellToMarkdown",1),v([cr("DATASCIENCE.RUN_CHANGE_CELL_TO_CODE")],Gt.prototype,"changeCellToCode",1),v([cr("DATASCIENCE.GOTO_NEXT_CELL_IN_FILE")],Gt.prototype,"gotoNextCell",1),v([cr("DATASCIENCE.GOTO_PREV_CELL_IN_FILE")],Gt.prototype,"gotoPreviousCell",1),Gt=v([(0,wu.injectable)(),m(0,(0,wu.inject)(zn)),m(1,(0,wu.inject)(ie)),m(2,(0,wu.inject)(Vx)),m(3,(0,wu.inject)(Br)),m(4,(0,wu.inject)(h0)),m(5,(0,wu.inject)(wo))],Gt);var Af=k(N()),Qn=k(require("vscode"));var xp=require("vscode");var qb=class{constructor(e,t,r,i){this.configuration=t;this.extensionChecker=r;this.cellRangeCache=i;this.computeDecorations(),e.push(this),e.push(this.configuration.getSettings(void 0).onDidChange(this.settingsChanged,this)),e.push(Qn.window.onDidChangeActiveTextEditor(this.changedEditor,this)),e.push(Qn.window.onDidChangeTextEditorSelection(this.changedSelection,this)),e.push(Qn.workspace.onDidChangeTextDocument(this.changedDocument,this)),this.settingsChanged()}activate(){}dispose(){this.timer&&clearTimeout(this.timer)}settingsChanged(){Qn.window.activeTextEditor&&this.triggerUpdate(Qn.window.activeTextEditor)}changedEditor(){this.triggerUpdate(void 0)}changedDocument(e){Qn.window.activeTextEditor&&e.document===Qn.window.activeTextEditor.document&&this.triggerUpdate(xp.window.activeTextEditor)}changedSelection(e){e.textEditor&&e.textEditor.selection.anchor&&this.triggerUpdate(e.textEditor)}triggerUpdate(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.update(e),100)}computeDecorations(){this.currentCellTopUnfocused=xp.window.createTextEditorDecorationType({borderColor:new Qn.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottomUnfocused=xp.window.createTextEditorDecorationType({borderColor:new Qn.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellTop=xp.window.createTextEditorDecorationType({borderColor:new Qn.ThemeColor("interactive.activeCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottom=xp.window.createTextEditorDecorationType({borderColor:new Qn.ThemeColor("interactive.activeCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0})}cellDecorationEnabled(e){return e.decorateCells===!1?!1:e.decorateCells==="currentCell"||e.decorateCells==="allCells"}update(e){let t=e===void 0?xp.window.visibleTextEditors:[e];for(let r of t)if(r&&r.document&&r.document.languageId===ge&&!zh(r.document)&&this.currentCellTop&&this.currentCellBottom&&this.currentCellTopUnfocused&&this.currentCellBottomUnfocused&&this.extensionChecker.isPythonExtensionInstalled){let i=this.configuration.getSettings(r.document.uri);if(this.cellDecorationEnabled(i)){let o=this.cellRangeCache.getCellRanges(r.document),s=o.map(u=>u.range).filter(u=>u.contains(r.selection.anchor)),a=s.length>0?[new Qn.Range(s[0].start,s[0].start)]:[],l=i.decorateCells!=="allCells"&&s.length>0?[new Qn.Range(s[0].end,s[0].end)]:[],c=[];i.decorateCells==="allCells"&&o.forEach(u=>{let d=u.range.start;d!==s[0].start&&c.push(new Qn.Range(d,d))}),xp.window.activeTextEditor===r?(r.setDecorations(this.currentCellTop,a),r.setDecorations(this.currentCellBottom,l),r.setDecorations(this.currentCellTopUnfocused,c),r.setDecorations(this.currentCellBottomUnfocused,[])):(r.setDecorations(this.currentCellTop,[]),r.setDecorations(this.currentCellBottom,[]),r.setDecorations(this.currentCellTopUnfocused,[...c,...a]),r.setDecorations(this.currentCellBottomUnfocused,l))}else r.setDecorations(this.currentCellTop,[]),r.setDecorations(this.currentCellBottom,[]),r.setDecorations(this.currentCellTopUnfocused,[]),r.setDecorations(this.currentCellBottomUnfocused,[])}}};qb=v([(0,Af.injectable)(),m(0,(0,Af.inject)(M)),m(1,(0,Af.inject)(ie)),m(2,(0,Af.inject)($e)),m(3,(0,Af.inject)(Pp))],qb);var YH=k(N()),XH=require("vscode");var P0=class{constructor(){this.codeGeneratorsByFile=new fo}clear(){this.codeGeneratorsByFile.clear()}get all(){return[...this.codeGeneratorsByFile.entries()].map(e=>({uri:e[0],generatedCodes:e[1].filter(t=>!t.deleted)})).filter(e=>e.generatedCodes.length>0)}getFileGeneratedCode(e){return this.codeGeneratorsByFile.get(e)||[]}store(e,t){let r=this.codeGeneratorsByFile.get(e)||[],i=!1;for(let o=0;o<r.length&&!i;o+=1){let s=r[o];t.line>=s.line&&t.line<=s.endLine?(r.splice(o,1,t),i=!0):s.line>t.line&&(r.splice(o,0,t),i=!0)}i||r.push(t),this.codeGeneratorsByFile.set(e,r)}};var Hb=class{constructor(){this.storages=new WeakMap}getOrCreate(e){return this.storages.has(e)||this.storages.set(e,new P0),this.storages.get(e)}get(e){if("notebook"in e)return this.storages.get(e.notebook);{let t=XH.workspace.notebookDocuments.find(r=>this.storages.get(r)?.all.find(o=>o.uri.toString()===e.fileUri.toString()));return t?this.storages.get(t):void 0}}};Hb=v([(0,YH.injectable)()],Hb);var lc=k(N()),zb=k(require("vscode"));var Gb=class{constructor(e,t,r,i,o){this.variableProvider=e;this.interactiveProvider=t;this.disposables=r;this.kernelProvider=i;this.replTracker=o;this.runFiles=new Set;this.stopWatch=new Fe;this.delayer=new us(300)}activate(){this.onDidChangeNotebookCellExecutionStateHandler=nr.onDidChangeNotebookCellExecutionState(e=>this.delayer.trigger(()=>this.onDidChangeNotebookCellExecutionState(e)).catch(h),this),this.kernelProvider.onDidRestartKernel(()=>this.runFiles.clear(),this,this.disposables)}dispose(){this.delayer.dispose(),this.onDidChangeNotebookCellExecutionStateHandler.dispose(),this.hoverProviderRegistration&&this.hoverProviderRegistration.dispose()}async onDidChangeNotebookCellExecutionState(e){try{if(this.replTracker.isForReplEditor(e.cell.notebook))return;let t=this.runFiles.size,r=ns(e.cell);r!==void 0&&this.runFiles.add(r.interactive.uristring),t!==this.runFiles.size&&(this.initializeHoverProvider(),this.onDidChangeNotebookCellExecutionStateHandler.dispose())}catch(t){p.error(t)}}async provideHover(e,t,r){this.stopWatch.reset();let i=await br(300,this.getVariableHover(e,t,r));return R("DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",{duration:this.stopWatch.elapsedTime},{isResultNull:!!i}),i}initializeHoverProvider(){this.hoverProviderRegistration||(this.hoverProviderRegistration=zb.languages.registerHoverProvider(FU,this))}async getVariableHover(e,t,r){let i=e.getWordRangeAtPosition(t);if(i){let o=e.getText(i);if(o){let s=this.getMatchingKernels(e);if(s.length){let a=await tr(r,{},...s.map(c=>this.variableProvider.getVariableProperties(o,c,r))),l=Object.entries(a||{});if(l.length>0){let c=l.reduce((d,f)=>d+`${f[0]}: ${f[1]}
`,"```\n")+"```";return{contents:[new zb.MarkdownString(c)]}}}}}}getMatchingKernels(e){let t=this.interactiveProvider.get(e.uri)?.notebookUri;if(!t)return[];let r=new Set;return zb.workspace.notebookDocuments.filter(i=>t?.toString()===i.uri.toString()).forEach(i=>{let o=this.kernelProvider.get(i);o&&r.add(o)}),Array.from(r)}};Gb=v([(0,lc.injectable)(),m(0,(0,lc.inject)(yn)),m(0,(0,lc.named)(Je.KERNEL_VARIABLES)),m(1,(0,lc.inject)(zn)),m(2,(0,lc.inject)(M)),m(3,(0,lc.inject)(we)),m(4,(0,lc.inject)(wo))],Gb);var Ki=k(N()),Bt=require("vscode");var Ct=require("vscode");var ZH=k(So());var Pu=class{constructor(e,t,r,i,o){this.serviceContainer=e;this._owner=t;this.controllerFactory=r;this.inputUri=o;this._onDidChangeViewState=new Ct.EventEmitter;this.closedEvent=new Ct.EventEmitter;this._submitters=[];this.internalDisposables=[];this.fs=this.serviceContainer.get(tt),this.configuration=this.serviceContainer.get(ie),this.jupyterExporter=this.serviceContainer.get(fg),this.interactiveWindowDebugger=this.serviceContainer.tryGet(g0),this.errorHandler=this.serviceContainer.get(Br),this.codeGeneratorFactory=this.serviceContainer.get(Vb),this.storageFactory=this.serviceContainer.get(Js),this.kernelProvider=this.serviceContainer.get(we),this.debuggingManager=this.serviceContainer.get(y0),this.notebookUri=i instanceof Ct.TabInputInteractiveWindow||i instanceof Ct.TabInputNotebook?i.uri:i.notebook.uri,this._owner&&this._submitters.push(this._owner),Ct.window.onDidChangeActiveNotebookEditor(s=>{s?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire()},this.internalDisposables),Ct.workspace.onDidCloseNotebookDocument(s=>{s.uri.toString()===this.notebookUri.toString()&&this.closedEvent.fire()},this.internalDisposables),Ct.window.activeNotebookEditor?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire(),this.cellMatcher=new Do(this.configuration.getSettings(this.owningResource)),this.notebookDocument&&this.codeGeneratorFactory.getOrCreate(this.notebookDocument)}get onDidChangeViewState(){return this._onDidChangeViewState.event}get closed(){return this.closedEvent.event}get owner(){return this._owner}get submitters(){return this._submitters}get notebookDocument(){return this._notebookDocument||(this._notebookDocument=Ct.workspace.notebookDocuments.find(e=>e.uri.toString()===this.notebookUri.toString())),this._notebookDocument}get kernelConnectionMetadata(){return this.controller?.metadata}async notifyConnectionReset(){if(this.notebookDocument)this.controller||(this.controller=this.initController()),this.controller.setInfoMessageCell(y.noKernelConnected);else{let e=Ct.workspace.onDidOpenNotebookDocument(async t=>{t.uri.toString()===this.notebookUri.toString()&&(this._notebookDocument=t,this.controller=this.initController(),this.internalDisposables.push(this.controller.listenForControllerSelection()),this.controller.setInfoMessageCell(y.noKernelConnected),e.dispose())})}}initController(){let e=this.controllerFactory.create(this,this.errorHandler,this.kernelProvider,this._owner);return this.internalDisposables.push(e.listenForControllerSelection()),e}async ensureInitialized(){if(!this.notebookDocument&&(p.debug("Showing Interactive editor to initialize codeGenerator from notebook document"),await this.showInteractiveEditor(),!this.notebookDocument))throw new Error("Could not open notebook document for Interactive Window");this.codeGeneratorFactory.get(this.notebookDocument)||this.codeGeneratorFactory.getOrCreate(this.notebookDocument),this.controller||(this.controller=this.initController()),this.controller.controller?(this.controller.startKernel().catch(h),await this.controller.resolveSysInfoCell()):(p.info("No controller selected for Interactive Window initialization"),this.controller.setInfoMessageCell(y.selectKernelForEditor))}async showInteractiveEditor(){let e;Ct.window.tabGroups.all.find(i=>{i.tabs.find(o=>{(o.input instanceof Ct.TabInputNotebook||o.input instanceof Ct.TabInputInteractiveWindow)&&o.input.uri.toString()==this.notebookUri.toString()&&(e=o.group.viewColumn)})});let t=this.notebookDocument||await this.openNotebookDocument();return await Ct.window.showNotebookDocument(t,{preserveFocus:!0,viewColumn:e,asRepl:!0})}async openNotebookDocument(){return p.debug(`Opening notebook document ${this.notebookUri}`),await Ct.workspace.openNotebookDocument(this.notebookUri)}dispose(){this.internalDisposables.forEach(e=>e.dispose()),this.controller?.disconnect()}async showErrorForCell(e,t){let r=this.controller?.controller,i=Wh(e);if(r&&i&&t){let o=ki.getOrCreate(t,new bf(r));try{await o.appendOutput(i)}catch(s){p.warn(`Could not append error message "${i}" to cell: ${s}`)}finally{o.end(!1,t.executionSummary?.timing?.endTime)}}else p.info(`Could not append error message to cell "${i}"`)}changeMode(e){this.controller?.updateMode(e)}async addCode(e,t,r){return this.submitCode(e,t,r,!1)}useNewDebugMode(){return!!(this.configuration.getSettings(this.owner).forceIPyKernelDebugger||this.controller?.metadata&&!dt(this.controller.metadata))}async debugCode(e,t,r){let i=!0,o=Ct.workspace.textDocuments.find(a=>this.fs.arePathsSame(a.uri,t));if(!this.useNewDebugMode()&&o&&o.isUntitled){let a=[...Ct.workspace.textDocuments];if(i=await o.save(),i){let l=Ct.workspace.textDocuments.filter(c=>a.indexOf(c)===-1);l&&l.length>0&&(t=(l.find(u=>u.languageId==="python")||l.find(u=>!u.fileName.endsWith(".interactive"))||l[0]).uri,await Ct.workspace.openTextDocument(t))}}let s=!0;return i?this.submitCode(e,t,r,!0):s}async submitCode(e,t,r,i){if(this.cellMatcher.isEmptyCell(e)||!this.controller?.controller)return!0;this.updateOwners(t);let o=Ue(e,{trim:!1}),s=new Do(this.configuration.getSettings(t)),a=-1;s.isMarkdown(o[0])&&pm(o,(u,d)=>void 0,(u,d)=>{u&&u.length>0&&a===-1&&(a=d)});let c=(a>0?[o.slice(0,a).join(`
`),o.slice(a).join(`
`)]:[e]).map(u=>{let d=re();this.controller.setPendingCellAdd(d.promise);let f=this.addNotebookCell(u,t,r),g=this.createExecutionPromise(f,i);return g.catch(b=>{b instanceof Rf?f.then(I=>{b.cell!==I&&this.showErrorForCell(y.cellStopOnErrorMessage,I).then(h,h)}).catch(h):f.then(I=>this.errorHandler.getErrorMessageForDisplayInCellOutput(b,"execution",this.owningResource).then(w=>this.showErrorForCell(w,I))).catch(h)}).finally(()=>{d?.resolve()}),g});return c[c.length-1]}async createExecutionPromise(e,t){if(!this.controller||!this.notebookDocument)return!1;p.ci("InteractiveWindow.ts.createExecutionPromise.start");let r=this.controller.startKernel(),i=await e,o=!0,s=async()=>void 0;try{let a=await r;await this.generateCodeAndAddMetadata(i,t,a),t&&this.useNewDebugMode()?await this.debuggingManager.start(this.notebookDocument,i):t&&dt(a.kernelConnectionMetadata)&&this.interactiveWindowDebugger&&(s=async()=>this.interactiveWindowDebugger?.detach(a),await this.interactiveWindowDebugger.attach(a),await this.interactiveWindowDebugger.updateSourceMaps(this.storageFactory.get({notebook:i.notebook})?.all||[]),this.interactiveWindowDebugger.enable(a)),p.ci("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell");let l=ns(i);o=await this.kernelProvider.getKernelExecution(a).executeCell(i,l?.generatedCode?.code).then(()=>!0,()=>!1),p.ci("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell.finished")}finally{await s(),p.ci("InteractiveWindow.ts.createExecutionPromise.end")}if(!o)throw new Rf(i);return o}async expandAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{await Ct.commands.executeCommand("notebook.cell.expandCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async collapseAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{e.kind===Ct.NotebookCellKind.Code&&await Ct.commands.executeCommand("notebook.cell.collapseCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async scrollToCell(e){let t=await this.showInteractiveEditor(),r=t.notebook.getCells().find(i=>ns(i)?.id===e);if(r){let i=new Ct.NotebookRange(r.index,r.index+1);t.revealRange(i,Ct.NotebookEditorRevealType.Default),t.selection=i}}async hasCell(e){let t=this.notebookDocument;return!!t&&t.getCells().some(r=>ns(r)?.id===e)}get owningResource(){if(this.owner)return this.owner;let e=vl();if(e)return e}updateOwners(e){this._owner||(this._owner=e,this.controller?.updateOwners(e)),this._submitters.find(t=>t.toString()==e.toString())||this._submitters.push(e)}async addNotebookCell(e,t,r){let i=this.notebookDocument;if(!i)throw new Error("No notebook document");let o=this.configuration.getSettings(this.owningResource),s=this.cellMatcher.getCellType(e)===DS,a=s?sk(Ue(e)).join(""):zH(e,o,this.cellMatcher),l=this.cellMatcher.getFirstMarker(e),c=Ct.workspace.textDocuments.find(b=>b.uri.toString()===this.owner?.toString())?.languageId??ge,u=new Ct.NotebookCellData(s?Ct.NotebookCellKind.Markup:Ct.NotebookCellKind.Code,a,s?DS:c),d={uristring:t.toString(),lineIndex:r,originalSource:e},f={interactiveWindowCellMarker:l,interactive:d,id:(0,ZH.default)()};u.metadata=f;let g;return await oc(i,async b=>{g=await this.getAppendIndex();let I=Ct.NotebookEdit.insertCells(g,[u]);b.set(i.uri,[I])}),i.cellAt(g)}async getAppendIndex(){if(!this.notebookDocument)throw new Error("No notebook document");return this.notebookDocument.cellCount}async generateCodeAndAddMetadata(e,t,r){let i=ns(e);if(!i)return;let o=!dt(r.kernelConnectionMetadata)||this.configuration.getSettings(void 0).forceIPyKernelDebugger,s=await this.codeGeneratorFactory.getOrCreate(this.notebookDocument).generateCode(i,e.index,t,o),a={...i,generatedCode:s},l=new Ct.WorkspaceEdit,c=Ct.NotebookEdit.updateCellMetadata(e.index,a);l.set(e.notebook.uri,[c]),await Ct.workspace.applyEdit(l)}async export(){if(!this.notebookDocument)throw new Error("no notebook to export.");let e=HH(this.notebookDocument),t=await new Ka().showDialog("ipynb",this.owningResource);t&&await this.jupyterExporter?.exportToFile(e,Re(t))}async exportAs(){if(await this.ensureInitialized(),!this.controller)throw new Error("An active kernel is required to export the notebook.");let e=this.controller.kernel?.value,t;if(this.submitters&&this.submitters.length){let r=this.submitters[this.submitters.length-1];t=Se(r.path,Ui(r.path))}Mr()?Ct.commands.executeCommand(J.ExportAsPythonScript,this.notebookDocument,e?.kernelConnectionMetadata.interpreter).then(h,h):Ct.commands.executeCommand(J.Export,this.notebookDocument,t,e?.kernelConnectionMetadata.interpreter).then(h,h)}};v([JR()],Pu.prototype,"showErrorForCell",1),v([JR()],Pu.prototype,"createExecutionPromise",1);function e4(n){return y.interactiveWindowTitleFormat(Se(n.path))}var SF=class{constructor(e,t,r,i,o,s,a){this.controllerService=e;this.mode=t;this.interactiveWindow=r;this.errorHandler=i;this.kernelProvider=o;this.owner=s;this.disposables=[];this.controller=a?.controller,this.metadata=a?.connection}updateMode(e){this.mode=e}updateOwners(e){this.owner=e}async startKernel(){if(this.connectingListener?.dispose(),this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Interactive Window kernel not selected");this.setInfoMessage(this.metadata,0);try{let e=await this.createKernel(),t=async()=>{this.interactiveWindow.notebookDocument&&this.metadata&&(this.systemInfoCell=void 0,this.setInfoMessage(this.metadata,1))};return this.disposables.push(e.addHook("willRestart",t)),e.onRestarted(async()=>{p.debug("Restart event handled in IW"),this.fileInKernel=void 0;try{await this.setFileInKernel(e)}catch{p.error("Failed to run initialization after restarting")}finally{this.finishSysInfoMessage(e,1)}},this,this.disposables),this.fileInKernel=void 0,await this.setFileInKernel(e),this.finishSysInfoMessage(e,0),e}catch(e){throw this.owner?this.deleteSysInfoCell():await this.finishSysInfoWithFailureMessage(e),e}}async createKernel(){if(this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Controller not selected");let e=re();e.promise.catch(h),this.kernel=e;try{let{kernel:t,actualController:r}=await this.controllerService.createKernel(this.metadata,this.controller,this.owner,this.interactiveWindow.notebookDocument,this.disposables);return this.metadata=t.kernelConnectionMetadata,this.controller=r,this.disposables.push(t),e.resolve(t),t}catch(t){throw e.reject(t),this.disconnect(),t}}async setFileInKernel(e){let t=this.owner;if(!t){p.ci("Unable to run initialization for IW");return}let r=Re(t),i=this.kernelProvider.getKernelExecution(e);this.mode==="perFile"&&!this.fileInKernel?(p.debug(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${r.replace(/\\/g,"\\\\")}'`)):(!this.fileInKernel||this.fileInKernel.toString()!==t.toString())&&this.mode!=="perFile"?(p.debug(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${r.replace(/\\/g,"\\\\")}'`)):p.debug(`Not Initializing __file__ in setFileInKernel with ${r} for mode ${this.mode} currently ${this.fileInKernel}`)}setPendingCellAdd(e){this.metadata&&this.interactiveWindow.notebookDocument&&this.controllerService.getRegisteredController(this.metadata)?.setPendingCellAddition(this.interactiveWindow.notebookDocument,e)}listenForControllerSelection(){return this.controllerService.onControllerSelected(e=>{if(!(!this.interactiveWindow.notebookDocument||e.notebook.uri.toString()!==this.interactiveWindow.notebookDocument?.uri?.toString())&&e.controller.id!==this.controller?.id){let t=!!this.kernel;this.disconnect(),this.controller=e.controller.controller,this.metadata=e.controller.connection,t?this.startKernel().catch(h):(this.connectingListener?.dispose(),this.connectingListener=e.controller.onConnecting(()=>{this.startKernel().catch(h)}),this.disposables.push(this.connectingListener))}},this)}setInfoMessageCell(e){if(!this.interactiveWindow.notebookDocument){p.warn("Could not set info cell: no notebook document");return}this.systemInfoCell?this.systemInfoCell.updateMessage(e).catch(t=>p.warn(`could not update info cell with message: "${e}", error: ${t}`)):this.systemInfoCell=new S0(this.interactiveWindow,this.interactiveWindow.notebookDocument,e)}async resolveSysInfoCell(){await this.systemInfoCell?.resolveCell()}setInfoMessage(e,t){let r=JH(e,t);this.setInfoMessageCell(r)}finishSysInfoMessage(e,t){let r=BH(e.kernelConnectionMetadata,t);this.systemInfoCell?.updateMessage(r).catch(i=>p.warn(`System info message was not updated: "${r}" because of error: ${i}`)),this.systemInfoCell=void 0}async finishSysInfoWithFailureMessage(e){let t=await this.errorHandler.getErrorMessageForDisplayInCell(e,"start",this.owner);t=t.split(`
`).join(`  
`),this.systemInfoCell?.updateMessage(t).catch(r=>p.warn(`System info message was not updated: "${t}" because of error: ${r}`)),this.systemInfoCell=void 0}deleteSysInfoCell(){this.systemInfoCell?.deleteCell().then(h,h),this.systemInfoCell=void 0}disconnect(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.kernel=void 0}},Nf=class{constructor(e,t,r){this.controllerService=e;this.mode=t;this.initialController=r}create(e,t,r,i){if(!e.notebookDocument)throw Error("could not create controller: no notebook document");let o=this.initialController,s=this.controllerService.getSelectedController(e.notebookDocument);return s&&(o=s),new SF(this.controllerService,this.mode,e,t,r,i,o)}};var XE=class extends Pu{async getAppendIndex(){if(this.editor?.replOptions||(this.editor=await this.showInteractiveEditor()),!this.editor?.replOptions)throw new Error("Interactive editor not found");return this.editor.replOptions.appendIndex}};var t4="ds_asked_per_file_interactive",r4="ds_interactive_window_cache",Qb=class{constructor(e){this.serviceContainer=e}isForReplEditor(e){return this.interactiveWindowProvider||(this.interactiveWindowProvider=this.serviceContainer.get(zn)),this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e.uri)!==void 0}};Qb=v([(0,Ki.injectable)(),m(0,(0,Ki.inject)(st))],Qb);var Yb=class{constructor(e,t,r,i,o,s,a,l){this.serviceContainer=e;this.disposables=t;this.fs=r;this.configService=i;this.globalMemento=o;this.workspaceMemento=s;this.notebookEditorProvider=a;this.controllerHelper=l;this._onDidChangeActiveInteractiveWindow=new Bt.EventEmitter;this._windows=[];this.notebookEditorProvider.registerEmbedNotebookProvider(this),this.restoreWindows()}get onDidChangeActiveInteractiveWindow(){return this._onDidChangeActiveInteractiveWindow.event}get activeWindow(){let e=Bt.window.activeNotebookEditor?.notebook.uri.toString();return e?this._windows.find(t=>t.notebookUri?.toString()===e):void 0}restoreWindows(){let e=new Map;Bt.window.tabGroups.all.forEach(t=>{t.tabs.forEach(r=>{let i=r.input;(i instanceof Bt.TabInputInteractiveWindow||i instanceof Bt.TabInputNotebook)&&e.set(i.uri.toString(),i)})}),this.workspaceMemento.get(r4,[]).forEach(t=>{if(!t.uriString||!e.get(t.uriString))return;let r=e.get(t.uriString);if(!r)return;let i=this.configService.getSettings(r.uri).interactiveWindowMode,o=r instanceof Bt.TabInputInteractiveWindow?new Pu(this.serviceContainer,Bt.Uri.parse(t.owner),new Nf(this.controllerHelper,i),r,Bt.Uri.parse(t.inputBoxUriString)):new XE(this.serviceContainer,Bt.Uri.parse(t.owner),new Nf(this.controllerHelper,i),r,Bt.Uri.parse(t.inputBoxUriString));o.notifyConnectionReset().catch(h),this._windows.push(o),R("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!1,hasOwner:!!t.owner,mode:i,restored:!0});let s=o.closed(this.onInteractiveWindowClosed.bind(this,o));this.disposables.push(o),this.disposables.push(s),this.disposables.push(o.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this)))}),this._updateWindowCache()}async getOrCreate(e,t){if(!Bt.workspace.isTrusted)throw new Error("Workspace not trusted");let r=await this.getInteractiveMode(e);this.pendingCreations&&await this.pendingCreations.catch(h);let i=this.getExisting(e,r,t);return i||(i=await this.create(e,r,t)),await i.ensureInitialized(),i}get(e){let t=this.configService.getSettings(e).interactiveWindowMode;return this.getExisting(e,t)}async create(e,t,r){let i=re();this.pendingCreations=i.promise;try{let o=this.configService.getSettings(e).interactiveReplNotebook,s=o?bt:Yt,a=await this.controllerHelper.getInitialController(e,s,r);p.info(`Starting interactive window for resource '${U(e)}' with controller '${a?.id}'`);let[l,c]=await this.createEditor(a,e,t,o);a&&a.controller.updateNotebookAffinity(c.notebook,Bt.NotebookControllerAffinity.Preferred),p.debug(`Interactive Window Editor Created: ${c.notebook.uri.toString()} with input box: ${l.toString()}`);let u=o?new XE(this.serviceContainer,e,new Nf(this.controllerHelper,t,a),c,l):new Pu(this.serviceContainer,e,new Nf(this.controllerHelper,t,a),c,l);this._windows.push(u),R("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!!a,hasOwner:!!e,mode:t,restored:!1}),this._updateWindowCache(),this.lastActiveInteractiveWindow=u;let d=u.closed(this.onInteractiveWindowClosed.bind(this,u));return this.disposables.push(u),this.disposables.push(d),this.disposables.push(u.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this))),u}finally{i.resolve()}}async createEditor(e,t,r,i){let o=t&&r==="perFile"?e4(t):void 0,s=t!==void 0,a=this.getInteractiveViewColumn(t);if(i)return this.createNotebookBackedEditor(a,s,e?.controller,o);let{inputUri:l,notebookEditor:c}=await Bt.commands.executeCommand("interactive.open",{viewColumn:a,preserveFocus:s},void 0,e?`${Ae}/${e.id}`:void 0,o);if(!c)throw new Error("Failed to request creation of interactive window from VS Code.");return[l,c]}async createNotebookBackedEditor(e,t,r,i){i=i||"Interactive-1";let o=await Bt.workspace.openNotebookDocument(bt),s=await Bt.window.showNotebookDocument(o,{preserveFocus:r?!1:t,viewColumn:e,asRepl:i});if(!s.replOptions)throw new Error("Wrong type of editor created");return r&&await Bt.commands.executeCommand("notebook.selectKernel",{editor:s,id:r.id,extension:Ae}),[o.cellAt(s.replOptions.appendIndex).document.uri,s]}getInteractiveViewColumn(e){if(e)return Bt.ViewColumn.Beside;let t=this.configService.getSettings(e).interactiveWindowViewColumn;return t==="secondGroup"?Bt.ViewColumn.One:t==="active"?Bt.ViewColumn.Active:Bt.ViewColumn.Beside}async getInteractiveMode(e){let t=this.configService.getSettings(e).interactiveWindowMode;if(t==="multiple"&&e&&!this.globalMemento.get(t4)&&this._windows.length===1&&(!this._windows[0].owner||!this.fs.arePathsSame(this._windows[0].owner,e))){this.globalMemento.update(t4,!0).then(h,h);let r=[y.interactiveWindowModeBannerSwitchYes,y.interactiveWindowModeBannerSwitchNo];await Bt.window.showInformationMessage(y.interactiveWindowModeBannerTitle,...r)===r[0]&&(t="perFile",this._windows[0].changeMode(t),await this.configService.updateSetting("interactiveWindow.creationMode",t,e,Bt.ConfigurationTarget.Global))}return t}_updateWindowCache(){let e=this._windows.map(t=>({owner:t.owner?.toString(),uriString:t.notebookUri.toString(),inputBoxUriString:t.inputUri.toString()}));this.workspaceMemento.update(r4,e).then(h,h)}getExisting(e,t,r){return t==="single"?this._windows.length>0?this._windows[0]:void 0:t==="multiple"?e?this.activeWindow||this.lastActiveInteractiveWindow||this._windows[0]:void 0:this._windows.find(i=>!e&&!i.owner&&!r?!0:e&&i.owner&&this.fs.arePathsSame(e,i.owner)?!r||i.kernelConnectionMetadata?.id===r.id:!1)}raiseOnDidChangeActiveInteractiveWindow(){this.lastActiveInteractiveWindow=this.activeWindow?this.activeWindow:this.lastActiveInteractiveWindow,this._onDidChangeActiveInteractiveWindow.fire(this.activeWindow)}onInteractiveWindowClosed(e){p.debug(`Closing interactive window: ${e.notebookUri?.toString()}`),e.dispose(),this._windows=this._windows.filter(t=>t!==e),this._updateWindowCache(),this.lastActiveInteractiveWindow===e&&(this.lastActiveInteractiveWindow=this._windows[0]),this.raiseOnDidChangeActiveInteractiveWindow()}getActiveOrAssociatedInteractiveWindow(){if(this.activeWindow)return this.activeWindow;if(Bt.window.activeTextEditor===void 0)return;let e=Bt.window.activeTextEditor.document.uri;if(e.scheme!==Ys)return this.get(e)}findNotebookEditor(e){let t;if(e&&e.path.endsWith(".interactive"))t=this.get(e)?.notebookDocument;else{let r=this.configService.getSettings(e).interactiveWindowMode;t=this.getExisting(e,r)?.notebookDocument}return t?Bt.window.visibleNotebookEditors.find(r=>r.notebook===t):void 0}findAssociatedNotebookDocument(e){return this._windows.find(i=>i.inputUri?.toString()===e.toString())?.notebookDocument}getInteractiveWindowWithNotebook(e){let t;return e!==void 0?t=this._windows.find(r=>r.notebookUri?.toString()===e.toString()):t=this.getActiveOrAssociatedInteractiveWindow(),t}getInteractiveWindowsWithSubmitter(e){return this._windows.filter(t=>t.submitters.find(r=>this.fs.arePathsSame(e,r)))}};Yb=v([(0,Ki.injectable)(),m(0,(0,Ki.inject)(st)),m(1,(0,Ki.inject)(M)),m(2,(0,Ki.inject)(tt)),m(3,(0,Ki.inject)(ie)),m(4,(0,Ki.inject)(Le)),m(4,(0,Ki.named)(ut)),m(5,(0,Ki.inject)(Le)),m(5,(0,Ki.named)(ri)),m(6,(0,Ki.inject)(An)),m(7,(0,Ki.inject)(v0))],Yb);var ku=k(N());var Xb=class{constructor(e,t,r,i,o,s){this.kernelProvider=e;this.codeGeneratorFactory=r;this.storageFactory=i;this.controllers=o;this.replTracker=s;this.disposables=[];t.push(this)}dispose(){z(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.controllers.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onNotebookControllerSelected({notebook:e}){this.storageFactory.get({notebook:e})?.clear(),this.codeGeneratorFactory.get(e)?.reset()}onDidCreateKernel(e){let t=e.notebook;e.creator!=="jupyterExtension"||this.replTracker.isForReplEditor(t)||(this.storageFactory.get({notebook:t})?.clear(),e.onRestarted(()=>{this.storageFactory.get({notebook:t})?.clear(),this.codeGeneratorFactory.getOrCreate(t).reset()},this,this.disposables))}};Xb=v([(0,ku.injectable)(),m(0,(0,ku.inject)(we)),m(1,(0,ku.inject)(M)),m(2,(0,ku.inject)(Vb)),m(3,(0,ku.inject)(Js)),m(4,(0,ku.inject)(it)),m(5,(0,ku.inject)(wo))],Xb);var Mf=k(N()),L4=require("vscode");var F4=O4(),x0=/(;32m[ ->]*?)(\d+)(.*)/g,Zb=class{constructor(e,t,r,i){this.storageFactory=e;this.platformService=t;this.configurationService=r;this.replTracker=i}format(e,t){if(!this.replTracker.isForReplEditor(e.notebook))return t;let r=this.storageFactory.get({notebook:e.notebook}),i=t.some(a=>/^[Input|Cell|File].*?\n.*/.test(a));if(!i&&!r)return t;let s=this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1;return t.map(a=>i?this.modifyTracebackFrameIPython8(a,r?.all,s):s?this.modifyTracebackFrameIPython7(a,r.all):a)}modifyTracebackFrameIPython8(e,t,r){e=e.replace(/\u001b\[4\dm/g,""),e=e.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),e=e.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(u,d,f,g)=>(g=g.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${d}${f}${g}
`)),p.ci(`Trace frame to match: ${e}`);let i,o,s=/Cell\s+(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,l=/Input\s+?(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\].*line: (?<lineNumber>\d).*/.exec(e),c=s.exec(e);if(l&&l.groups?.executionCount&&l.groups?.lineNumber?(i=parseInt(l.groups.executionCount),o=l.groups?.lineNumber):c&&c.groups?.executionCount&&c.groups?.lineNumber&&(i=parseInt(c.groups.executionCount),o=c.groups.lineNumber),t&&i){let u,d;for(let f of t)if(d=f.generatedCodes.find(g=>g.executionCount===i),d){u=f.uri;break}if(d&&u){let f=e;return r&&(f=f.replace(x0,(g,b,I,w)=>{let D=parseInt(I,10),$=(d.hasCellMarker?d.line-1:d.line)-1+d.lineOffsetRelativeToIndexOfFirstLineInCell+D;return`${b}<a href='${u?.toString()}?line=${$-1}'>${$}</a>${w}`})),f.replace(/.*?\n/,`File \x1B[1;32m${Re(u)}:${o}\x1B[0m
`)}}if(r){let u=/^File.*?\[\d;32m(.*):\d+.*\u001b.*\n/.exec(e);if(u&&u.length>1){let d=Ih(u[1],Re(this.platformService.homeDir)),f=L4.Uri.file(d);return e.replace(x0,(g,b,I,w)=>{let D=parseInt(I,10);return`${b}<a href='${f?.toString()}?line=${D-1}'>${D}</a>${w}`})}}return e}modifyTracebackFrameIPython7(e,t){return t.map(i=>i.uri).forEach(i=>{let o=Re(i),s=U(i),a=this.storageFactory.get({fileUri:i});if(a){if(e.includes(o)&&new RegExp(`\\[.*?;32m${F4(o)}`).test(e)||e.includes(s)&&new RegExp(`\\[.*?;32m${F4(s)}`).test(e)){let l="",c=/(;32m[ ->]*?)(\d+)(.*)/g;for(let d=c.exec(e);d&&d.length>3;d=c.exec(e)){let f=Xl(d[3]).substr(1);l=`${l}${f}
`}let u=this.findCellOffset(a.getFileGeneratedCode(i),l);u!==void 0&&(e=e.replace(x0,(d,f,g,b)=>{let I=parseInt(g,10),w=u+I-1;return`${f}<a href='${i.toString()}?line=${w}'>${w+1}</a>${b}`}))}if(e.includes(o)){let l=this.findCellOffset(a.getFileGeneratedCode(i),e);if(l)return e.replace(x0,(c,u,d,f)=>{let g=parseInt(d,10),b=l+g-1;return`${u}<a href='${i.toString()}?line=${b}'>${b+1}</a>${f}`})}}}),e}findCellOffset(e,t){if(e){for(let r of e)if(r.trimmedRightCode.indexOf(t)>=0)return r.firstNonBlankLineIndex}}};Zb=v([(0,Mf.injectable)(),m(0,(0,Mf.inject)(Js)),m(1,(0,Mf.inject)(wr)),m(2,(0,Mf.inject)(ie)),m(3,(0,Mf.inject)(wo))],Zb);var xu=k(N());var ew=class extends kn{constructor(e,t,r){let i=t||y.jupyterDebuggerNotInstalledError(e);super("notinstalled",i,r)}};function D0(n){let e={source:{path:Re(n.uri)},pydevdSourceMaps:[]};return e.pydevdSourceMaps=n.generatedCodes.map(t=>({line:t.debuggerStartLine,endLine:t.endLine,runtimeSource:{path:t.runtimeFile},runtimeLine:t.runtimeLine})),e}var eI=class{constructor(e,t,r,i){this.apiProvider=e;this.configService=t;this.debugService=r;this.platform=i;this.configs=new WeakMap;this.debuggingActive=!1;this.debuggerPackage="debugpy",this.enableDebuggerCode="import debugpy;debugpy.listen(('localhost', 0))",this.waitForDebugClientCode="import debugpy;debugpy.wait_for_client()",this.tracingEnableCode="from debugpy import trace_this_thread;trace_this_thread(True)",this.tracingDisableCode="from debugpy import trace_this_thread;trace_this_thread(False)"}async attach(e){if(!e.session)throw new Error("Notebook not initialized");let t=this.configService.getSettings(e.resourceUri),r=e.kernelConnectionMetadata.interpreter?.uri;return this.startDebugSession(i=>this.debugService.startDebugging(void 0,i),e,{justMyCode:t.debugJustMyCode,python:r})}async detach(e){if(!e.session)return;let t=e.notebook;this.configs.get(t)&&(p.info("stop debugging"),this.debuggingActive=!1,this.debugService.stop(),e.status!=="dead"&&e.status!=="unknown"&&this.disable(e))}async updateSourceMaps(e){this.debugService.activeDebugSession&&this.debuggingActive&&(p.ci("Sending debug request for source map"),await Promise.all(e.map(async t=>{if(this.debuggingActive)return this.debugService.activeDebugSession.customRequest("setPydevdSourceMap",D0(t))})))}enable(e){e.session?.kernel&&mn(e.session.kernel,this.tracingEnableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(h)}disable(e){e.session?.kernel&&mn(e.session.kernel,this.tracingDisableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure disabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(h)}async startDebugSession(e,t,r){if(p.info("start debugging"),!t.session?.kernel)return;let i=await this.connect(t,r);if(i&&(p.info("connected to notebook during debugging"),this.debuggingActive=await e(i),this.debuggingActive)){this.debugService.removeBreakpoints([]);let o=await mn(t.session.kernel,this.waitForDebugClientCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure starting debug session for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"});o.some(s=>s.output_type==="error")?p.warn(`${this.debuggerPackage} not found in path.`):p.info(`import startup: ${k_(o)}`),await this.disable(t)}}async connect(e,t){let r=e.notebook,i=r,o=this.configs.get(i);if(o)return{...o,...t};p.info("enable debugger attach"),await this.appendDebuggerPaths(e),o={type:"python",name:"IPython",request:"attach",...t};let{host:s,port:a}=await this.connectToLocal(e);if(o.host=s,o.port=a,o.port){this.configs.set(r,o);let l=[],c=()=>{this.configs.delete(i),l.forEach(u=>u.dispose())};l.push(e.onDisposed(c)),l.push(e.onRestarted(c))}return o}async calculateDebuggerPathList(e){let t=[],r=this.configService.getSettings(e.resourceUri).debugpyDistPath;if(r&&(this.platform.isWindows&&(r=r.replace(/\\/g,"\\\\")),t.push(r)),dt(e.kernelConnectionMetadata)){let i=await this.getDebuggerPath();this.platform.isWindows&&(i=i.replace(/\\/g,"\\\\")),t.push(i)}if(t&&t.length>0)return t.reduce((i,o)=>(i.length===0?i=`'${o}'`:i=`${i}, '${o}'`,i),"")}getDebuggerPath(){return this.apiProvider.getApi().then(e=>e.getDebuggerPath())}async appendDebuggerPaths(e){let t=await this.calculateDebuggerPathList(e);if(t&&t.length>0){let r=e.session?.kernel?await mn(e.session.kernel,`import sys as _VSCODE_sys\r
_VSCODE_sys.path.extend([${t}])\r
_VSCODE_sys.path\r
del _VSCODE_sys`,{traceErrors:!0,traceErrorsMessage:"Execute_request failure appending debugger paths for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];p.info(`Appending paths: ${k_(r)}`)}}async connectToLocal(e){let t=e.session?.kernel?await mn(e.session.kernel,this.enableDebuggerCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling debugging for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];if(t.length>0)for(let r of t){let i=k_([r]);if(i){i=Yp(i);let s=/\('(.*?)', ([0-9]*)\)/.exec(i);if(s)return{port:parseInt(s[2],10),host:s[1]}}}if(t.length>0&&t[0].output_type==="error"){let r=t[0];throw new ew(this.debuggerPackage,r.ename,e.kernelConnectionMetadata)}throw new ew(y.jupyterDebuggerOutputParseError(this.debuggerPackage),void 0,e.kernelConnectionMetadata)}};eI=v([(0,xu.injectable)(),m(0,(0,xu.inject)(Qt)),m(1,(0,xu.inject)(ie)),m(2,(0,xu.inject)(Aa)),m(2,(0,xu.named)(Je.MULTIPLEXING_DEBUGSERVICE)),m(3,(0,xu.inject)(wr))],eI);var cc=k(N()),Dp=require("vscode");var _0=class{constructor(e,t,r){this.debugAdapter=e;this.debugCell=t;this.execution=r;this._ready=re();this.ready=this._ready.promise;R("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){p.debug(`[Debug-IW] ${e}: ${t}`)}async willSendEvent(e){return fF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&jE(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){let t=ns(this.debugCell);e.command==="setBreakpoints"&&t&&t.generatedCode&&!this.cellDumpInvoked&&(this.debugCellDumped||(this.debugCellDumped=Pf(this.execution,this.debugAdapter)),await this.debugCellDumped),e.command==="configurationDone"&&t&&t.generatedCode&&(this.debugCellDumped||(this.debugCellDumped=Pf(this.execution,this.debugAdapter)),await this.debugCellDumped,this._ready.resolve())}};var T0=class extends yb{constructor(){super(...arguments);this._ready=re();this.ready=this._ready.promise}resolve(){this._ready.resolve()}};var CF=require("vscode");var R0=class extends Ib{constructor(t,r,i,o,s,a,l){super(t,r,i,o,s,a);this.cellToDebugFileSortedInReverseOrderByLineNumber=[];l&&(this.debugLocationTracker=l.createDebugAdapterTracker(t),this.debugLocationTracker.onWillStartSession&&this.debugLocationTracker.onWillStartSession(),this.onDidSendMessage(c=>{this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(c)},this,this.disposables),this.onDidEndSession(()=>{this.debugLocationTracker?.onWillStopSession&&this.debugLocationTracker.onWillStopSession()},this,this.disposables))}handleClientMessageAsync(t){return p.ci(`KernelDebugAdapter::handleMessage ${JSON.stringify(t,void 0," ")}`),t.type==="request"&&this.debugLocationTracker?.onWillReceiveMessage&&this.debugLocationTracker.onWillReceiveMessage(t),t.type==="response"&&this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(t),super.handleClientMessageAsync(t)}async dumpCell(t){let r=this.notebookDocument.cellAt(t),i=ns(r);if(!i)throw new Error("Not an interactive window cell");try{let o=(i.generatedCode?.code||r.document.getText()).replace(/\r\n/g,`
`),s=await this.session.customRequest("dumpCell",{code:o}),a=cn(s.sourcePath);this.fileToCell.set(a,CF.Uri.parse(i.interactive.uristring));let l=0;i.generatedCode&&!i.generatedCode.hasCellMarker&&(l=i.generatedCode.firstNonBlankLineIndex),this.cellToDebugFileSortedInReverseOrderByLineNumber.push({debugFilePath:a,interactiveWindow:CF.Uri.parse(i.interactive.uristring),metadata:i,lineOffset:l+i.interactive.lineIndex+(i.generatedCode?.lineOffsetRelativeToIndexOfFirstLineInCell||0)}),this.cellToDebugFileSortedInReverseOrderByLineNumber.sort((c,u)=>u.metadata.interactive.lineIndex-c.metadata.interactive.lineIndex)}catch(o){p.error(`Failed to dump cell for ${r.index} with code ${i.interactive.originalSource}`,o)}}translateDebuggerLocationToRealLocation(t,r){if(r=t?.source??r,!r||!r.path)return;let i=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(o=>o.debugFilePath===r.path);i&&(r.name=Se(i.interactiveWindow.path),r.path=i.interactiveWindow.toString(),typeof t?.endLine=="number"&&(t.endLine=t.endLine+(i.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line+(i.lineOffset||0)))}translateRealLocationToDebuggerLocation(t,r){let i=t.line;if(r=t?.source??r,!r||!r.path||typeof i!="number")return;let o=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(s=>i>=s.metadata.interactive.lineIndex+1);!o||o.interactiveWindow.path!==r.path||(r.path=o.debugFilePath,typeof t?.endLine=="number"&&(t.endLine=t.endLine-(o.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line-(o.lineOffset||0)))}async sendRequestToJupyterSession(t){if(t.command==="setBreakpoints"){let r=t.arguments;if(delete r.lines,r.source.path!==this.cellToDebugFileSortedInReverseOrderByLineNumber[0]?.interactiveWindow.path)return super.sendRequestToJupyterSession(t);let i,o=[],s=[],a=()=>{if(o.length){let u=JSON.parse(JSON.stringify(t));u.arguments.breakpoints=o,s.push(super.sendRequestToJupyterSession(u))}};for(let u of t.arguments.breakpoints??[]){let d=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(f=>u.line>=f.metadata.generatedCode.line&&u.line<=f.metadata.generatedCode.endLine);if(d&&d.metadata.interactive.lineIndex!==i)a(),i=d.metadata.interactive.lineIndex,o=[u];else if(d)o.push(u);else{let f={...u,verified:!0};s.push(Promise.resolve({body:{breakpoints:[f]}}))}}a();let l=await Promise.all(s),c=JSON.parse(JSON.stringify(l[0]));return l.slice(1).forEach(u=>{c.body.breakpoints=c.body.breakpoints.concat(u.body.breakpoints??[])}),c.command="setBreakpoints",c.type="response",c.success=!0,c.request_seq=t.seq,c}return super.sendRequestToJupyterSession(t)}getDumpFilesForDeletion(){return this.cellToDebugFileSortedInReverseOrderByLineNumber.map(t=>t.debugFilePath)}};var U4=require("vscode");var A0=class{constructor(e){this.debugCell=e}trace(e,t){p.debug(`[Debug-IWRestart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Showing warning for unsupported restart request"),U4.window.showWarningMessage(y.restartNotSupported,{modal:!0}).then(h,h),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var tI=class extends bb{constructor(t,r,i,o,s,a,l){super(t,r,l);this.platform=i;this.debugLocationTrackerFactory=o;this.configService=s;this.debugService=a}activate(){super.activate(),this.disposables.push(Dp.debug.registerDebugAdapterDescriptorFactory(eC,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return 2}async start(t,r){p.ci("Starting debugging IW"),await this.checkIpykernelAndPrompt(r)===1&&await this.startDebuggingCell(t,r)}async startDebuggingCell(t,r){let i=this.configService.getSettings(t.uri),o={type:eC,name:Se(t.uri.toString()),request:"attach",justMyCode:i.debugJustMyCode,__notebookUri:t.uri.toString(),__mode:2,__cellIndex:r.index},s={suppressSaveBeforeStart:!0};await this.startDebuggingConfig(o,s);let a=this.notebookToDebugger.get(t);if(!a){p.error("Debugger not found, could not start debugging.");return}await a.ready}async createDebugAdapterDescriptor(t){let r=t.configuration;kH(r);let i=Dp.workspace.notebookDocuments.find(s=>s.uri.toString()===r.__notebookUri);if(!i||typeof r.__cellIndex!="number"){p.error("Invalid debug session for debugging of IW using Jupyter Protocol");return}if(this.notebookInProgress.has(i)){p.info("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(i)){p.info("Cannot start debugging. Already debugging this notebook document. Toolbar should update");return}let o=new T0(i,r,t);this.notebookToDebugger.set(i,o);try{return this.notebookInProgress.add(i),await this.doCreateDebugAdapterDescriptor(r,t,i,o)}finally{this.notebookInProgress.delete(i)}}async doCreateDebugAdapterDescriptor(t,r,i,o){let s=await this.ensureKernelIsRunning(i);if(!s?.session){Dp.window.showInformationMessage(y.kernelWasNotStarted).then(h,h);return}let a=new R0(r,i,s.session,s,this.platform,this.debugService,this.debugLocationTrackerFactory);this.disposables.push(a.onDidEndSession(this.endSession.bind(this)));let l=i.cellAt(t.__cellIndex),c=new _0(a,l,this.kernelProvider.getKernelExecution(s));return a.addDebuggingDelegates([c,new A0(l)]),c.ready.then(()=>o.resolve()).catch(u=>console.error("Failed waiting for controller to be ready",u)),this.trackDebugAdapter(i,a),new Dp.DebugAdapterInlineImplementation(a)}async updateSourceMaps(t,r){let i=this.getDebugSession(t.notebook);i&&(p.ci("Sending debug request for source map"),await Promise.all(r.map(async o=>{if(i)return i.customRequest("setPydevdSourceMap",D0(o))})))}};tI=v([(0,cc.injectable)(),m(0,(0,cc.inject)(we)),m(1,(0,cc.inject)(it)),m(2,(0,cc.inject)(wr)),m(3,(0,cc.inject)(JT)),m(4,(0,cc.inject)(ie)),m(5,(0,cc.inject)(_i)),m(6,(0,cc.inject)(st))],tI);var tw=k(N()),rw=require("vscode");var W4="InteractiveShiftEnterBanner";var _p=class{constructor(e,t){this.persistentState=e;this.configuration=t;this.disabledInCurrentSession=!1;this.bannerMessage=WA.bannerMessage;this.bannerLabels=[le.bannerLabelYes,le.bannerLabelNo];this.initialize()}initialize(){this.initialized||(this.initialized=!0,this.isEnabled())}isEnabled(){return this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!0).value}async showBanner(){if(!this.isEnabled()||!await this.shouldShowBanner())return;switch(R("DS_INTERNAL.SHIFTENTER_BANNER_SHOWN"),await rw.window.showInformationMessage(this.bannerMessage,...this.bannerLabels)){case this.bannerLabels[0]:{await this.enableInteractiveShiftEnter();break}case this.bannerLabels[1]:{await this.disableInteractiveShiftEnter();break}default:this.disabledInCurrentSession=!0}}async shouldShowBanner(){let e=this.configuration.getSettings();return Promise.resolve(this.isEnabled()&&!this.disabledInCurrentSession&&!e.sendSelectionToInteractiveWindow)}async disableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!1,void 0,rw.ConfigurationTarget.Global),await this.disableBanner()}async enableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!0,void 0,rw.ConfigurationTarget.Global),await this.disableBanner()}async disableBanner(){await this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!1).updateValue(!1)}};v([zr("DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER")],_p.prototype,"disableInteractiveShiftEnter",1),v([zr("DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER")],_p.prototype,"enableInteractiveShiftEnter",1),_p=v([(0,tw.injectable)(),m(0,(0,tw.inject)(ml)),m(1,(0,tw.inject)(ie))],_p);var Kf=k(N()),V4=require("vscode");var rI=class{constructor(e,t,r,i){this.configService=e;this.fs=t;this.context=r;this.registry=i;this.priority=5}activate(){this.registry.register(this,Yt)}async getCode(e){if(!nt(e.kernelConnectionMetadata))return[];if(!Mr()){if(this.configService.getSettings(void 0).forceIPyKernelDebugger===!0)return[];if(!dt(e.kernelConnectionMetadata))return[]}if(!dt(e.kernelConnectionMetadata))return[];this.addRunCellHookContents||(this.addRunCellHookContents=this.fs.readFile(V4.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","kernel","addRunCellHook.py")));let t=await this.addRunCellHookContents;return Ue(t,{trim:!1})}};rI=v([(0,Kf.injectable)(),m(0,(0,Kf.inject)(ie)),m(1,(0,Kf.inject)(tt)),m(2,(0,Kf.inject)(Ze)),m(3,(0,Kf.inject)(Rc))],rI);var iI=k(N()),oI=require("vscode");var nI=class{constructor(e,t,r){this.dataScienceCodeLensProvider=e;this.extensionContext=t;this.configurationService=r}activate(){this.configurationService.getSettings().pythonCellFolding&&this.extensionContext.subscriptions.push(oI.languages.registerFoldingRangeProvider([Nw],this))}provideFoldingRanges(e,t,r){if([Ys,ch].includes(e.uri.scheme))return;let i=this.dataScienceCodeLensProvider.getCodeWatcher(e);if(i){let o=i.getCodeLenses();return r.isCancellationRequested||o.length==0?void 0:o.map(s=>new oI.FoldingRange(s.range.start.line,s.range.end.line,oI.FoldingRangeKind.Region))}}};nI=v([(0,iI.injectable)(),m(0,(0,iI.inject)(wp)),m(1,(0,iI.inject)(Ze)),m(2,(0,iI.inject)(ie))],nI);var aI=k(N());var j4=require("vscode");var sI=class{constructor(e,t,r){this.dataScienceCodeLensProvider=e;this.extensionContext=t}activate(){this.extensionContext.subscriptions.push(j4.languages.registerCodeLensProvider([Nw],this.dataScienceCodeLensProvider))}};sI=v([(0,aI.injectable)(),m(0,(0,aI.inject)(wp)),m(1,(0,aI.inject)(Ze)),m(2,(0,aI.inject)(Pp))],sI);var $s=k(N());var EF="LastInteractiveKernelSelected",lI=class{constructor(e,t,r,i,o){this.controllerRegistration=e;this.interpreterService=t;this.disposables=r;this.workspaceMemento=i;this.serviceContainer=o;this.onControllerSelected=this.controllerRegistration.onControllerSelected}async getInitialController(e,t,r){if(r){let i=this.controllerRegistration.get(r,t);if(i)return i}if(this.workspaceMemento.get(EF)){let i=this.workspaceMemento.get(EF),o=i?this.controllerRegistration.get(i,t):void 0;if(o)return o}if(this.interpreterService)return await dfe(t,e,this.interpreterService,this.controllerRegistration)}getSelectedController(e){return this.controllerRegistration.getSelected(e)}getRegisteredController(e){return this.controllerRegistration.get(e,"interactive")}async createKernel(e,t,r,i,o){await ua(r,e);let s=(u,d)=>{u!=="start"&&u!=="restart"||p.ci(`(onStart) Looking for controller ${d.controller.id} in ${this.controllerRegistration.all.map(f=>`${f.kind}:${f.id}`).join(", ")}`)},a=await Vs.connectToNotebookKernel(e,this.serviceContainer,{resource:r||i.uri,notebook:i,controller:t},new Ft(!1),o,"jupyterExtension",s),l=this.controllerRegistration.registered.find(u=>u.id===a.controller.id);if(!l)throw Error(`Controller ${a.controller.id} not found or not yet created`);let c=l.controller;return this.interpreterService&&pfe(a.kernelConnectionMetadata,r,this.interpreterService).then(async u=>{await this.workspaceMemento.update(EF,u?void 0:a.kernelConnectionMetadata)}).catch(u=>{p.warn("Failed to store kernel connection metadata",u)}),{kernel:a,actualController:c}}};lI=v([(0,$s.injectable)(),m(0,(0,$s.inject)(it)),m(1,(0,$s.inject)(et)),m(1,(0,$s.optional)()),m(2,(0,$s.inject)(M)),m(3,(0,$s.inject)(Le)),m(3,(0,$s.named)(ri)),m(4,(0,$s.inject)(st))],lI);async function dfe(n,e,t,r){let i=await t.getActiveInterpreter(e);if(i){let o=await ws(i),s=Oo.create({kernelSpec:o,interpreter:i,id:xi(o,i)}),a=r.addOrUpdate(s,[n]),l=a[0];return r.trackActiveInterpreterControllers(a),p.ci(`Active Interpreter Controller ${l.connection.kind}:${l.id} created for View ${n} with resource ${U(e)}`),l}}async function pfe(n,e,t){return(await t.getActiveInterpreter(e))?.id===n.interpreter?.id}var Of=k(require("vscode")),N0=k(N());var cI=class{constructor(e){this.configService=e;this.cache=new Map;this.disposables=[];this.cachedOwnsSetting=this.configService.getSettings(void 0).sendSelectionToInteractiveWindow,Of.workspace.onDidChangeConfiguration(this.onSettingChanged,this,this.disposables),Of.window.onDidChangeActiveTextEditor(this.onChangedActiveTextEditor,this,this.disposables),this.onChangedActiveTextEditor(),Of.workspace.onDidCloseTextDocument(this.onClosedDocument,this,this.disposables)}getCellRanges(e){let t=this.cache.get(e.uri);if(t&&t.version===e.version)return t.ranges;let r=this.configService.getSettings(e.uri),i=yF(e,r);return this.cache.set(e.uri,{version:e.version,ranges:i}),this.updateContextKeys(e),i}clear(){this.cache.clear()}onChangedActiveTextEditor(){let e=Of.window.activeTextEditor;!e||e.document.languageId!=ge||[Ys,ch].includes(e.document.uri.scheme)?(new ir(yr.HasCodeCells).set(!1).catch(r=>p.warn("Failed to set jupyter.HasCodeCells context",r)),this.updateContextKeys(!1)):this.updateContextKeys(e.document)}onSettingChanged(e){if(this.cache.clear(),e.affectsConfiguration("jupyter.interactiveWindow.textEditor.executeSelection")){let t=this.configService.getSettings(void 0);this.cachedOwnsSetting=t.sendSelectionToInteractiveWindow,this.updateContextKeys()}}updateContextKeys(e){let t=!1;if(typeof e=="boolean")t=e;else{let r=e??Of.window.activeTextEditor?.document;t=r?this.getCellRanges(r).length>0:!1}new ir(yr.OwnsSelection).set(this.cachedOwnsSetting||t).catch(h),new ir(yr.HasCodeCells).set(t).catch(h)}onClosedDocument(e){this.cache.delete(e.uri)}dispose(){this.disposables.forEach(e=>e.dispose())}};cI=v([(0,N0.injectable)(),m(0,(0,N0.inject)(ie))],cI);function J4(n){n.addSingleton(zn,Yb),n.addSingleton(wo,Qb),n.addSingleton(v0,lI),n.addSingleton(me,_o),n.addSingleton(me,Gb),n.addSingleton(Pp,cI),n.add(f0,Gt),n.addSingleton(h0,Bb),n.addSingleton(wp,$b),n.addSingleton(me,sI),n.addSingleton(me,nI),n.addSingleton(me,qb),n.addSingleton(me,Xb),n.addSingleton(me,rI),n.addSingleton(Vb,jb,void 0,[me]),n.addSingleton(Js,Hb),n.addSingleton(ig,Zb),n.addSingleton(g0,eI),n.addSingleton(y0,tI,void 0,[me]),n.addSingleton(p2,_p,W4)}var Tp=k(N()),uc=require("vscode");var uI=class{constructor(e,t,r){this.jupyterServerHelper=e;this.fileSystem=t;this.errorHandler=r;this.extractPythonMainVersion=async()=>{if(!this.jupyterServerHelper)return 3;let e=await this.jupyterServerHelper.getUsableJupyterPython(),t=await rd(e);return e&&t&&t.major||3}}async exportToFile(e,t,r=!0){let i=await this.serialize(e);try{if(await this.fileSystem.writeFile(uc.Uri.file(t),i||""),!r)return;let o=y.exportOpenQuestion1;uc.window.showInformationMessage(y.exportDialogComplete(t),o).then(async s=>{try{s===o&&await I0(uc.Uri.file(t))}catch(a){await this.errorHandler.handleError(a)}},h)}catch(o){p.error("Error in exporting notebook file"),uc.window.showInformationMessage(y.exportDialogFailed(o)).then(h,h)}}async serialize(e,t){let r=await this.extractPythonMainVersion(),i={language_info:{codemirror_mode:{name:"ipython",version:r},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:`ipython${r}`,version:r},kernelspec:t},o=uc.extensions.getExtension("vscode.ipynb")?.exports;if(!o)throw new Error("vscode.ipynb extension not found");let s=new uc.NotebookData(e);return s.metadata={metadata:i,nbformat:WR.major,nbformat_minor:WR.minor},o.exportNotebook(s)}};uI=v([(0,Tp.injectable)(),m(0,(0,Tp.inject)(yd)),m(0,(0,Tp.optional)()),m(1,(0,Tp.inject)(tt)),m(2,(0,Tp.inject)(Br))],uI);var Rp=k(N()),B4=require("vscode");var dI=class{constructor(e,t,r,i,o){this.fs=e;this.disposableRegistry=t;this.configuration=r;this.nbConvertDependencyChecker=i;this.exportToPythonService=o;this.isDisposed=!1;this.nbconvertBaseTemplateFormat=`{%- extends '{0}' -%}
{% block codecell %}
{1}
{{ super() }}
{% endblock codecell %}
{% block in_prompt %}{% endblock in_prompt %}
{% block input %}{{ cell.source | ipython2python }}{% endblock input %}
{% block markdowncell scoped %}{1} [markdown]
{{ cell.source | comment_lines }}
{% endblock markdowncell %}`;this.nbconvert5Null="null.tpl";this.nbconvert6Null="base/null.j2";this.dispose=()=>{this.isDisposed=!0};this.addInstructionComments=e=>y.instructionComments(this.defaultCellMarker).concat(e);this.addIPythonImport=e=>FS(dh.ImportIPython,this.defaultCellMarker,e)}async importFromFile(e,t){let r=await this.nbConvertDependencyChecker.getNbConvertVersion(t);if(r){let i;r.major>=6?(this.template6Promise||(this.template6Promise=this.createTemplateFile(!0)),i=await this.template6Promise):(this.template5Promise||(this.template5Promise=this.createTemplateFile(!1)),i=await this.template5Promise);let o=await this.exportToPythonService.exportNotebookToPython(e,t,i);return o.includes("get_ipython()")&&(o=this.addIPythonImport(o)),this.addInstructionComments(o)}throw new Error(y.jupyterNbConvertNotSupported)}get defaultCellMarker(){return this.configuration.getSettings().defaultCellMarker||Je.DefaultCodeCellMarker}async createTemplateFile(e){let t=await this.fs.createTemporaryLocalFile(".tpl");if(t)try{return this.disposableRegistry.push(t),await this.fs.writeFile(B4.Uri.file(t.filePath),FS(this.nbconvertBaseTemplateFormat,e?this.nbconvert6Null:this.nbconvert5Null,this.defaultCellMarker)),t.filePath}catch{}}};dI=v([(0,Rp.injectable)(),m(0,(0,Rp.inject)(dr)),m(1,(0,Rp.inject)(M)),m(2,(0,Rp.inject)(ie)),m(3,(0,Rp.inject)(hg)),m(4,(0,Rp.inject)(Wk))],dI);var qs=k(N());var is=require("vscode");var M0=class{constructor(e,t,r,i,o,s){this.fileConverter=e;this.fs=t;this.interactiveProvider=r;this.controllerRegistration=i;this.preferredKernel=o;this.kernelFinder=s;this.disposables=[]}register(){this.registerCommand(J.ExportAsPythonScript,(e,t)=>this.export(e,"python",void 0,t)),this.registerCommand(J.ExportToHTML,(e,t,r)=>this.export(e,"html",t,r)),this.registerCommand(J.ExportToPDF,(e,t,r)=>this.export(e,"pdf",t,r)),this.registerCommand(J.Export,(e,t,r)=>this.export(e,void 0,t,r)),this.registerCommand(J.NativeNotebookExport,e=>this.nativeNotebookExport(e))}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommand(e,t){let r=is.commands.registerCommand(e,t,this);this.disposables.push(r)}async nativeNotebookExport(e){let t=Wn(e)?e:e?.notebookEditor?.notebookUri,r=t?is.workspace.notebookDocuments.find(i=>this.fs.arePathsSame(i.uri,t)):is.window.activeNotebookEditor?.notebook;if(r){let i,o=this.kernelFinder.registered.find(l=>l.kind==="localPythonEnvironment"),s=new is.CancellationTokenSource;try{i=o?await this.preferredKernel.findPreferredLocalKernelSpecConnection(r,o,s.token).then(l=>l?.interpreter):void 0}finally{s.dispose()}let a=this.controllerRegistration.getSelected(r)?.connection.interpreter||i;return this.export(r,void 0,void 0,a)}else return this.export(void 0,void 0,void 0,void 0)}async export(e,t,r,i){if(!e){if(e=is.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,!e){p.info("Export called without a valid exportable document active");return}i=i||this.controllerRegistration.getSelected(e)?.connection.interpreter,t&&R("DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",void 0,{format:t})}if(t)await this.fileConverter.export(t,e,r,i);else{let o=await this.showExportQuickPickMenu(e,r,i).then(s=>s);o!==void 0?o.handler():R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK")}}getExportQuickPickItems(e,t,r){let i=[];return(r||e.metadata&&wk(lo(e)))&&i.push({label:y.exportPythonQuickPickLabel,picked:!0,handler:()=>{R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"python"}),is.commands.executeCommand(J.ExportAsPythonScript,e,r).then(h,h)}}),i.push({label:y.exportHTMLQuickPickLabel,picked:!1,handler:()=>{R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"html"}),is.commands.executeCommand(J.ExportToHTML,e,t,r).then(h,h)}},{label:y.exportPDFQuickPickLabel,picked:!1,handler:()=>{R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"pdf"}),is.commands.executeCommand(J.ExportToPDF,e,t,r).then(h,h)}}),i}async showExportQuickPickMenu(e,t,r){let i=this.getExportQuickPickItems(e,t,r),o={ignoreFocusOut:!1,matchOnDescription:!0,matchOnDetail:!0,placeHolder:y.exportAsQuickPickPlaceholder};return is.window.showQuickPick(i,o)}};var K0=require("vscode");var pI=class{constructor(e,t,r,i,o,s,a){this.disposables=e;this.fileConverter=t;this.fs=r;this.interactiveProvider=i;this.controllerSelection=o;this.kernelFinder=s;this.jupyterConnection=a;this.exportCommand=new M0(this.fileConverter,this.fs,this.interactiveProvider,o,new vp(a),s),K0.workspace.isTrusted||K0.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){K0.workspace.isTrusted&&this.exportCommand?.register()}};pI=v([(0,qs.injectable)(),m(0,(0,qs.inject)(M)),m(1,(0,qs.inject)(Pb)),m(2,(0,qs.inject)(tt)),m(3,(0,qs.inject)(zn)),m(3,(0,qs.optional)()),m(4,(0,qs.inject)(it)),m(5,(0,qs.inject)(Dr)),m(6,(0,qs.inject)(sn))],pI);var Ap=k(N()),fI=require("vscode");var $4=require("vscode");var wF="JVSC_NEVER_PROMPT_EXTENSIONS_LIST",mfe=new Map([["ms-dotnettools.dotnet-interactive-vscode",{displayName:".NET Interactive Notebooks Preview",extensionLink:"https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.dotnet-interactive-vscode"}]]),ffe=new Map([["c#","ms-dotnettools.dotnet-interactive-vscode"],["csharp","ms-dotnettools.dotnet-interactive-vscode"],["f#","ms-dotnettools.dotnet-interactive-vscode"],["fsharp","ms-dotnettools.dotnet-interactive-vscode"],["powershell","ms-dotnettools.dotnet-interactive-vscode"]]),mI=class{constructor(e,t,r){this.controllerManager=e;this.globalMemento=r;this.disposables=[];this.recommendedInSession=new Set;t.push(this)}dispose(){z(this.disposables)}activate(){fI.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),this.controllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onDidOpenNotebookDocument(e){if(!Pt(e))return;let t=kk(lo(e));t&&this.recommendExtensionForLanguage(t).catch(h)}onNotebookControllerSelected({controller:e}){if(e.connection.kind!=="startUsingLocalKernelSpec"&&e.connection.kind!=="startUsingRemoteKernelSpec"||nt(e.connection))return;let t=uo(e.connection);t&&this.recommendExtensionForLanguage(t).catch(h)}async recommendExtensionForLanguage(e){let t=ffe.get(e.toLowerCase());if(!t||$4.extensions.getExtension(t))return;let r=mfe.get(t);if(!r||this.globalMemento.get(wF,[]).includes(t)||this.recommendedInSession.has(t))return;this.recommendedInSession.add(t);let i=y.recommendExtensionForNotebookLanguage(`[${r.displayName}](${r.extensionLink})`,e);switch(R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"displayed"}),await fI.window.showInformationMessage(i,le.bannerLabelYes,le.bannerLabelNo,le.doNotShowAgain)){case le.bannerLabelYes:{R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"ok"}),fI.commands.executeCommand("extension.open",t).then(h,h);break}case le.bannerLabelNo:{R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"cancel"});break}case le.doNotShowAgain:{R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"doNotShowAgain"});let s=this.globalMemento.get(wF,[]);s.includes(t)||(s.push(t),await this.globalMemento.update(wF,s));break}default:R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"dismissed"})}}};mI=v([(0,Ap.injectable)(),m(0,(0,Ap.inject)(it)),m(1,(0,Ap.inject)(M)),m(2,(0,Ap.inject)(Le)),m(2,(0,Ap.named)(ut))],mI);var dc=k(N()),os=require("vscode");var hI=class{constructor(e,t,r,i,o){this.interactiveProvider=e;this.kernelProvider=r;this.controllers=i;this.jupyterUriProviderRegistration=o;this.disposables=[];this.isPythonFileActive=!1;this.ownedOpenNotebooks=new Set;t.push(this),this.nativeContext=new ir(yr.IsNativeActive),this.canRestartNotebookKernelContext=new ir(yr.CanRestartNotebookKernel),this.canInterruptNotebookKernelContext=new ir(yr.CanInterruptNotebookKernel),this.canRestartInteractiveWindowKernelContext=new ir(yr.CanRestartInteractiveWindowKernel),this.canInterruptInteractiveWindowKernelContext=new ir(yr.CanInterruptInteractiveWindowKernel),this.interactiveContext=new ir(yr.IsInteractiveActive),this.interactiveOrNativeContext=new ir(yr.IsInteractiveOrNativeActive),this.pythonOrNativeContext=new ir(yr.IsPythonOrNativeActive),this.pythonOrInteractiveContext=new ir(yr.IsPythonOrInteractiveActive),this.pythonOrInteractiveOrNativeContext=new ir(yr.IsPythonOrInteractiveOrNativeActive),this.hasNativeNotebookCells=new ir(yr.HaveNativeCells),this.isPythonNotebook=new ir(yr.IsPythonNotebook),this.isJupyterKernelSelected=new ir(yr.IsJupyterKernelSelected),this.hasNativeNotebookOrInteractiveWindowOpen=new ir(yr.HasNativeNotebookOrInteractiveWindowOpen),this.kernelSourceContext=new ir(yr.KernelSource)}dispose(){this.disposables.forEach(e=>e.dispose())}activate(){os.window.onDidChangeActiveTextEditor(this.onDidChangeActiveTextEditor,this,this.disposables),this.kernelProvider.onKernelStatusChanged(this.onDidKernelStatusChange,this,this.disposables),this.interactiveProvider&&(this.interactiveProvider.onDidChangeActiveInteractiveWindow(this.onDidChangeActiveInteractiveWindow,this,this.disposables),this.interactiveProvider.activeWindow&&this.onDidChangeActiveInteractiveWindow()),os.window.activeNotebookEditor&&this.onDidChangeActiveNotebookEditor(os.window.activeNotebookEditor),os.window.onDidChangeActiveNotebookEditor(this.onDidChangeActiveNotebookEditor,this,this.disposables),os.window.activeTextEditor?.document.languageId===ge&&this.onDidChangeActiveTextEditor(os.window.activeTextEditor),os.workspace.onDidCloseNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.controllers.onControllerSelectionChanged(()=>this.updateSelectedKernelContext(),this,this.disposables),this.updateSelectedKernelContext()}updateNativeNotebookCellContext(){let e=(os.window.activeNotebookEditor?.notebook.cellCount||0)>0;this.hasNativeNotebookCells.set(e).catch(h)}onDidChangeActiveInteractiveWindow(e){this.interactiveContext.set(!!e).catch(h),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}onDidChangeActiveNotebookEditor(e){let t=e?e.notebook.notebookType===bt:!1;this.nativeContext.set(t).catch(h),this.isPythonNotebook.set(e&&t?wk(lo(e.notebook)):!1).catch(h),this.updateContextOfActiveNotebookKernel(e),this.updateContextOfActiveInteractiveWindowKernel(),this.updateNativeNotebookCellContext(),this.updateMergedContexts()}updateNativeNotebookInteractiveWindowOpenContext(e,t){t?this.ownedOpenNotebooks.add(e):this.ownedOpenNotebooks.delete(e),this.hasNativeNotebookOrInteractiveWindowOpen.set(this.ownedOpenNotebooks.size>0).catch(h)}updateContextOfActiveNotebookKernel(e){let t=e&&e.notebook.notebookType===bt?this.kernelProvider.get(e.notebook):void 0;if(t){let r=this.kernelProvider.getKernelExecution(t),i=t.status!=="unknown"||r.executionCount>0||t.startedAtLeastOnce;this.canRestartNotebookKernelContext.set(!!i).catch(h);let o=t.status==="busy";this.canInterruptNotebookKernelContext.set(!!o).catch(h)}else this.canRestartNotebookKernelContext.set(!1).catch(h),this.canInterruptNotebookKernelContext.set(!1).catch(h);this.updateKernelSourceContext(t).catch(h),this.updateSelectedKernelContext()}async updateKernelSourceContext(e){if(!e||!xt(e.kernelConnectionMetadata)){this.kernelSourceContext.set("").catch(h);return}let t=e.kernelConnectionMetadata,r=await this.jupyterUriProviderRegistration.jupyterCollections.find(i=>i.extensionId===t.serverProviderHandle.extensionId&&i.id===t.serverProviderHandle.id);if(!r){this.kernelSourceContext.set("").catch(h);return}this.kernelSourceContext.set(r.id).catch(h)}updateSelectedKernelContext(){let e=os.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument;e&&Pt(e)&&this.controllers.getSelected(e)?(this.isJupyterKernelSelected.set(!0).catch(h),this.updateNativeNotebookInteractiveWindowOpenContext(e,!0)):this.isJupyterKernelSelected.set(!1).catch(h)}updateContextOfActiveInteractiveWindowKernel(){let e=this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,t=e?this.kernelProvider.get(e):void 0;if(t){let r=t.status!=="unknown";this.canRestartInteractiveWindowKernelContext.set(!!r).catch(h);let i=t.status==="busy";this.canInterruptInteractiveWindowKernelContext.set(!!i).catch(h)}else this.canRestartInteractiveWindowKernelContext.set(!1).catch(h),this.canInterruptInteractiveWindowKernelContext.set(!1).catch(h);this.updateSelectedKernelContext()}onDidKernelStatusChange({kernel:e}){let t=e.notebook;t.notebookType===Yt?this.updateContextOfActiveInteractiveWindowKernel():t.notebookType===bt&&t===os.window.activeNotebookEditor?.notebook&&this.updateContextOfActiveNotebookKernel(os.window.activeNotebookEditor)}onDidChangeActiveTextEditor(e){this.isPythonFileActive=e?.document.languageId===ge&&!qU(e.document.uri),this.updateNativeNotebookCellContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}updateMergedContexts(){this.interactiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0).catch(h),this.pythonOrNativeContext.set(this.nativeContext.value===!0||this.isPythonFileActive===!0).catch(h),this.pythonOrInteractiveContext.set(this.interactiveContext.value===!0||this.isPythonFileActive===!0).catch(h),this.pythonOrInteractiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0&&this.isPythonFileActive===!0).catch(h)}};hI=v([(0,dc.injectable)(),m(0,(0,dc.inject)(zn)),m(0,(0,dc.optional)()),m(1,(0,dc.inject)(M)),m(2,(0,dc.inject)(we)),m(3,(0,dc.inject)(it)),m(4,(0,dc.inject)(Vt))],hI);var O0=k(N()),pc=require("vscode");var hfe=/^\s*(from (?<fromImport>\w+)(?:\.\w+)* import \w+(?:, \w+)*(?: as \w+)?|import (?<importImport>\w+(?:, \w+)*)(?: as \w+)?)$/,gfe=1e3,vfe=kr(),gI=class{constructor(e,t=1e3){this.pendingChecks=new fo;this.disposables=new xr;this.sentMatches=new Set;this.processedNotebookCells=new WeakMap;e.push(this.disposables),this.disposables.add(new pc.Disposable(()=>z(this.pendingChecks.values()))),this.isTelemetryDisabled=BP(),this.disposables.add(pc.workspace.onDidOpenNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"))),this.disposables.add(pc.workspace.onDidCloseNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"))),this.disposables.add(pc.workspace.onDidSaveNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave")));let r=this.disposables.add(new us(t));this.disposables.add(nr.onDidChangeNotebookCellExecutionState(i=>{r.trigger(()=>{i.state==2&&!this.isTelemetryDisabled&&this.checkNotebookCell(i.cell,"onExecution").catch(h)})},this)),this.disposables.add($P(i=>this.isTelemetryDisabled=i))}activate(){pc.workspace.notebookDocuments.forEach(e=>this.checkNotebookDocument(e,"onOpenCloseOrSave"))}getDocumentLines(e){let t=[];for(let r=0;r<Math.min(gfe,e.lineCount);r++){let i=e.lineAt(r);i.isEmptyOrWhitespace||t.push(i.text.trim())}return t}onOpenedOrClosedNotebookDocument(e,t){!Pt(e)||this.isTelemetryDisabled||this.scheduleCheck(e.uri,this.checkNotebookDocument.bind(this,e,t))}scheduleCheck(e,t){let r=this.pendingChecks.get(e);if(r&&(r.dispose(),this.pendingChecks.delete(e)),vfe)t();else{let i=setTimeout(t,5e3);this.pendingChecks.set(e,new pc.Disposable(()=>clearTimeout(i)))}}async checkNotebookDocument(e,t){!Pt(e)||this.isTelemetryDisabled||await Promise.all(e.getCells().map(async r=>this.checkNotebookCell(r,t)))}async checkNotebookCell(e,t){if(!(!Pt(e.notebook)||e.kind!==pc.NotebookCellKind.Code||e.document.languageId!==ge||this.processedNotebookCells.get(e)===e.document.version))try{this.processedNotebookCells.set(e,e.document.version);let r=e.notebook.notebookType===bt?"notebook":"interactive";await this.sendTelemetryForImports(this.getDocumentLines(e.document),r,t)}catch(r){if(!Un)throw r}}lookForImports(e){let t=[];try{for(let r of e){if(!r.includes("import")&&!r.includes("from"))continue;let i=r?hfe.exec(r):null;i!==null&&i.groups!==void 0&&(i.groups.fromImport!==void 0?t.push(i.groups.fromImport):i.groups.importImport!==void 0&&t.push(...i.groups.importImport.split(",").map(o=>o.trim())))}}catch{}return t}async sendTelemetryForImports(e,t,r){await Promise.all(this.lookForImports(e).map(async i=>{let o=`${i}_${t||""}_${r}`;if(this.sentMatches.has(o))return;this.sentMatches.add(o);let s=await ct(i);R("HASHED_PACKAGE_NAME",void 0,{hashedNamev2:s,resourceType:t,when:r})}))}};gI=v([(0,O0.injectable)(),m(0,(0,O0.inject)(M))],gI);var Du=k(N());var vI=class{constructor(e,t,r){this.disposableRegistry=e;this.rawSupported=t;this.commandListeners=r;this.isDisposed=!1;this.startTime=Date.now()}get activationStartTime(){return this.startTime}activate(){this.disposableRegistry.push(this),this.computeZmqAvailable(),this.commandListeners&&this.commandListeners.forEach(e=>e.register())}async dispose(){this.changeHandler&&(this.changeHandler.dispose(),this.changeHandler=void 0)}computeZmqAvailable(){new ir(yr.ZmqAvailable).set(this.rawSupported?this.rawSupported.isSupported:!1).then(h,h)}};vI=v([(0,Du.injectable)(),m(0,(0,Du.inject)(M)),m(1,(0,Du.inject)(ai)),m(1,(0,Du.optional)()),m(2,(0,Du.multiInject)(Kh))],vI);var pi=k(N()),F0=require("vscode");var Lf=k(N()),Ff=require("vscode");var H4=require("vscode");var PF="JUPYTER_API_ACCESS_INFORMATION",q4=new Set([Ae.split(".")[0],"rchiodo","donjayamanne","SynapseVSCode"]),kF=new Set(["rchiodo","nuant"]),_u=class{constructor(e,t){this.globalState=e;this.context=t;this.extensionAccess=new Map;this.promiseChain=new fh}async getAccessInformation(e){let t=!e.extensionId||e.extensionId===mh?"":e.extensionId.split(".")[0]||"";if(this.context.extensionMode===Ff.ExtensionMode.Test||!t||ks()==="insiders"){if(!q4.has(t)&&!kF.has(t)){p.warn(`Publisher ${t} is allowed to access the Kernel API with a message.`);let s=H4.extensions.getExtension(e.extensionId)?.packageJSON?.displayName||"",a=s&&e.extensionId?`${s} (${e.extensionId})`:e.extensionId||t;Ff.window.showErrorMessage(y.thanksForUsingJupyterKernelApiPleaseRegisterWithUs(a)).then(h,h)}if(!kF.has(t)||!t||this.context.extensionMode===Ff.ExtensionMode.Test)return{extensionId:e.extensionId,accessAllowed:!0}}if(q4.has(t))return{extensionId:e.extensionId,accessAllowed:!0};if(!kF.has(t))return Ff.window.showErrorMessage(`Please contact the Jupyter Extension to get access to the Kernel API. Publisher ${t}`).then(h,h),p.error(`Publisher ${t} is not allowed to access the Kernel API.`),{extensionId:e.extensionId,accessAllowed:!1};let i=this.globalState.get(PF)?.find(s=>s.extensionId===e.extensionId);if(i)return R("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:i.allowed}),{extensionId:e.extensionId,accessAllowed:i.allowed==="yes"};if(this.extensionAccess.get(e.extensionId))return this.extensionAccess.get(e.extensionId);let o=(async()=>{let s=y.allowExtensionToUseJupyterKernelApi(`${e.displayName} (${e.extensionId})`,le.bannerLabelYes),l=await Ff.window.showInformationMessage(s,{modal:!0},le.bannerLabelYes,le.bannerLabelNo)===le.bannerLabelYes;return this.promiseChain.chainFinally(async()=>{let c=[...this.globalState.get(PF,[])];return c=c.filter(u=>u.extensionId!==e.extensionId),c.push({allowed:l?"yes":"no",extensionId:e.extensionId}),this.globalState.update(PF,c)}).then(h,h),R("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:l?"yes":"no"}),{extensionId:e.extensionId,accessAllowed:l}})();return this.extensionAccess.set(e.extensionId,o),o}};_u=v([(0,Lf.injectable)(),m(0,(0,Lf.inject)(Le)),m(0,(0,Lf.named)(ut)),m(1,(0,Lf.inject)(Ze))],_u);var G4=new WeakMap;function xF(n){let e=G4.get(n);return e||(e=yfe(n),G4.set(n,e)),e}function yfe(n){return new Proxy(n,{get(e,t){return t==="kernel"?e.kernel?bfe(e.kernel):void 0:Reflect.get(e,t)}})}var z4=new WeakMap;function bfe(n){let e=z4.get(n);return e||(e=Ife(n),z4.set(n,e)),e}function Ife(n){return new Proxy(n,{get(e,t){return t==="registerCommTarget"?(r,i)=>(Vq(n,r),Reflect.get(e,t).apply(e,[r,i])):t==="removeCommTarget"?(r,i)=>(jq(n,r),Reflect.get(e,t).apply(e,[r,i])):Reflect.get(e,t)}})}var yI=class{constructor(e,t,r,i,o,s,a,l){this.kernelProvider=e;this.kernelFinder=t;this.thirdPartyKernelProvider=r;this.disposables=i;this.controllerRegistration=o;this.apiAccess=s;this.extensions=a;this.serviceContainer=l;this.chainedApiAccess=new fh;this.extensionApi=new Map}async getService(){let e=this.extensions.determineExtensionFromCallStack(),t=await this.chainedApiAccess.chainFinally(()=>this.apiAccess.getAccessInformation(e));if(!t.accessAllowed)return;if(this.extensionApi.get(t.extensionId))return this.extensionApi.get(t.extensionId);let r=new nw(t.extensionId,this.kernelProvider,this.kernelFinder,this.thirdPartyKernelProvider,this.disposables,this.controllerRegistration,this.serviceContainer);return this.extensionApi.set(t.extensionId,r),r}};yI=v([(0,pi.injectable)(),m(0,(0,pi.inject)(we)),m(1,(0,pi.inject)(Dr)),m(2,(0,pi.inject)(hm)),m(3,(0,pi.inject)(M)),m(4,(0,pi.inject)(it)),m(5,(0,pi.inject)(_u)),m(6,(0,pi.inject)(sa)),m(7,(0,pi.inject)(st))],yI);var nw=class{constructor(e,t,r,i,o,s,a){this.callingExtensionId=e;this.kernelProvider=t;this.kernelFinder=r;this.thirdPartyKernelProvider=i;this.disposables=o;this.controllerRegistration=s;this.serviceContainer=a;this._onDidChangeKernelSpecifications=new F0.EventEmitter;this._onDidChangeKernels=new F0.EventEmitter;this.translatedConnections=new WeakMap;this._onDidChangeStatus=new F0.EventEmitter;this._status=this.kernelFinder.status,this.kernelFinder.onDidChangeStatus(()=>{this._status=this.kernelFinder.status,this._onDidChangeStatus.fire()},this,o),this.kernelProvider.onDidDisposeKernel(l=>{p.ci(`Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.kernelProvider.onDidStartKernel(l=>{p.ci(`Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidDisposeKernel(l=>{p.ci(`Third party Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidStartKernel(l=>{p.ci(`Third party Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.controllerRegistration.onDidChange(()=>this._onDidChangeKernelSpecifications.fire(),this,o)}get onDidChangeKernelSpecifications(){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernelSpecifications"}),p.debug(`API called from ${this.callingExtensionId}`),this._onDidChangeKernelSpecifications.event}get onDidChangeKernels(){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernels"}),this._onDidChangeKernels.event}get status(){return this._status}get onDidChangeStatus(){return this._onDidChangeStatus.event}async getKernelSpecifications(){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernelSpecifications"}),this.kernelFinder.kernels.map(e=>this.translateKernelConnectionMetadataToExportedType(e))}getActiveKernels(){R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getActiveKernels"});let e=[],t=new Set;return this.kernelProvider.kernels.filter(r=>r.startedAtLeastOnce||r.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(r=>{let i=this.kernelProvider.get(r.notebook);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(r.kernelConnectionMetadata),uri:r.uri,id:r.id})}),this.thirdPartyKernelProvider.kernels.filter(r=>r.startedAtLeastOnce||r.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(r=>{let i=this.thirdPartyKernelProvider.get(r.uri);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(r.kernelConnectionMetadata),uri:r.uri,id:r.id})}),this.controllerRegistration.registered.forEach(r=>{r.controller.notebookType===bt&&r.connection.kind==="connectToLiveRemoteKernel"&&(!r.connection.kernelModel.id||t.has(r.connection.kernelModel.id)||e.push({metadata:r.connection,uri:void 0,id:r.id}))}),e}getKernel(e){R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernel"});let t=this.thirdPartyKernelProvider.get(e)??this.kernelProvider.get(e);if(t?.session)return{metadata:this.translateKernelConnectionMetadataToExportedType(t.kernelConnectionMetadata),connection:xF(t.session)}}async startKernel(e,t){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"startKernel"}),this.startOrConnect(e,t)}async connect(e,t){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"connect"}),this.startOrConnect(e,t)}async startOrConnect(e,t){let r=this.kernelFinder.kernels.find(o=>o.id===e.id);if(!r)throw new Error("Not found");let i=await Vs.connectToKernel(r,this.serviceContainer,{resource:t},new Ft(!1),this.disposables,"3rdPartyExtension");if(!i?.session)throw new Error("Not found");return xF(i.session)}translateKernelConnectionMetadataToExportedType(e){if(!this.translatedConnections.has(e)){let t=Object.freeze(Cs.fromJSON(e.toJSON()));this.translatedConnections.set(e,t)}return this.translatedConnections.get(e)}};nw=v([m(1,(0,pi.inject)(we)),m(2,(0,pi.inject)(Dr)),m(3,(0,pi.inject)(hm)),m(4,(0,pi.inject)(M)),m(5,(0,pi.inject)(it)),m(6,(0,pi.inject)(st))],nw);var L0=k(N()),mc=require("vscode");var Q4=require("vscode");var Uf=class{constructor(e){this.fileSystem=e;this.activatedWorkspaces=new Set;this.disposables=[]}activate(){this.addHandlers(),this.addRemoveDocOpenedHandlers(),this.activateWorkspace(this.getActiveResource()).catch(h)}getActiveResource(){let e=Q4.window.activeTextEditor;return e&&!e.document.isUntitled?e.document.uri:Array.isArray(mc.workspace.workspaceFolders)&&mc.workspace.workspaceFolders.length>0?mc.workspace.workspaceFolders[0].uri:void 0}async activateWorkspace(e){let t=this.getWorkspaceKey(e);this.activatedWorkspaces.has(t)||(this.activatedWorkspaces.add(t),await v3(this.fileSystem,e))}onDocOpened(e){if(e.languageId!==ge)return;let t=this.getWorkspaceKey(e.uri);if(t===""||(mc.workspace.workspaceFolders||[]).length===0||this.activatedWorkspaces.has(t))return;let r=mc.workspace.getWorkspaceFolder(e.uri);this.activateWorkspace(r?r.uri:void 0).catch(h)}addHandlers(){this.disposables.push(mc.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this))}addRemoveDocOpenedHandlers(){if(this.hasMultipleWorkspaces()){this.docOpenedHandler||(this.docOpenedHandler=mc.workspace.onDidOpenTextDocument(this.onDocOpened,this));return}this.docOpenedHandler&&(this.docOpenedHandler.dispose(),this.docOpenedHandler=void 0)}onWorkspaceFoldersChanged(){let e=(mc.workspace.workspaceFolders||[]).map(i=>this.getWorkspaceKey(i.uri)),r=Array.from(this.activatedWorkspaces.keys()).filter(i=>e.indexOf(i)<0);if(r.length>0)for(let i of r)this.activatedWorkspaces.delete(i);this.addRemoveDocOpenedHandlers()}hasMultipleWorkspaces(){return(mc.workspace.workspaceFolders||[]).length>1}getWorkspaceKey(e){return ys(e,"")}};v([Nh("Failed to activate a workspace")],Uf.prototype,"activateWorkspace",1),Uf=v([(0,L0.injectable)(),m(0,(0,L0.inject)(tt))],Uf);var II=k(N());var bI=class{constructor(e){this.syncActivationServices=e}activate(){this.syncActivationServices.map(e=>{try{e.activate()}catch(t){p.error(`Error in activating extension, failed in ${e.constructor.name}`,t)}})}};bI=v([(0,II.injectable)(),m(0,(0,II.optional)()),m(0,(0,II.multiInject)(me))],bI);var iw=k(N()),Np=require("vscode");var DF=Symbol("ISurveyBanner");var fc=class{constructor(e,t){this.persistentState=e;this.disposables=t;this.disabledInCurrentSession=!1;this.bannerLabels=[NP.bannerLabelYes,NP.bannerLabelNo];this.showBannerState=new Map;this.NotebookExecutionThreshold=250;this.setPersistentState(0,"ShowInsidersNotebookSurveyBanner"),this.setPersistentState(1,"ShowExperimentNotebookSurveyBanner");let r=setTimeout(()=>{fc.surveyDelay=!0},10*60*1e3);this.disposables.push(new Np.Disposable(()=>clearTimeout(r)))}isEnabled(e){switch(e){case 0:if(ks()==="insiders")return this.isEnabledInternal(e);break;case 1:if(ks()==="stable")return this.isEnabledInternal(e);break;default:return p.error("Invalid Banner Type"),!1}return!1}isEnabledInternal(e){return Np.env.uiKind!==Np.UIKind.Desktop?!1:this.showBannerState.get(e).value.expiry?this.showBannerState.get(e).value.expiry<Date.now():!0}activate(){this.onDidChangeNotebookCellExecutionStateHandler=nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}async showBanner(e){let t=this.shouldShowBanner(e);if(this.onDidChangeNotebookCellExecutionStateHandler?.dispose(),!t)return;switch(this.disabledInCurrentSession=!0,await Np.window.showInformationMessage(this.getBannerMessage(e),...this.bannerLabels)){case this.bannerLabels[0]:{await this.launchSurvey(e),await this.disable(0,e);break}default:{await this.disable(1,e);break}}}shouldShowBanner(e){return Hp()||!this.isEnabled(e)||this.disabledInCurrentSession||!fc.surveyDelay?!1:this.getExecutionCount(e)>=this.NotebookExecutionThreshold}setPersistentState(e,t){this.showBannerState.set(e,this.persistentState.createGlobalPersistentState(t,{data:!0}))}async launchSurvey(e){Rd(this.getSurveyLink(e))}async disable(e,t){let r=e===0?6:4;r&&await this.showBannerState.get(t).updateValue({expiry:r*31*864e5+Date.now(),data:!0})}getExecutionCount(e){switch(e){case 0:return this.getPersistentState("DS_InsidersNotebookExecutionCount");case 1:return this.getPersistentState("DS_ExperimentNotebookExecutionCount");default:return p.error("Invalid Banner type"),-1}}getPersistentState(e){return this.persistentState.createGlobalPersistentState(e,0).value}async onDidChangeNotebookCellExecutionState(e){Pt(e.cell.notebook)&&e.state===3&&(this.updateStateAndShowBanner("DS_InsidersNotebookExecutionCount",0).catch(h),this.updateStateAndShowBanner("DS_ExperimentNotebookExecutionCount",1).catch(h))}async updateStateAndShowBanner(e,t){if(!this.shouldShowBanner(t)){this.onDidChangeNotebookCellExecutionStateHandler?.dispose();return}let r=this.persistentState.createGlobalPersistentState(e,0);await r.updateValue(r.value+1),this.showBanner(t).catch(h)}getBannerMessage(e){switch(e){case 0:case 1:return VA.bannerMessage;default:return p.error("Invalid Banner type"),""}}getSurveyLink(e){switch(e){case 0:return"https://aka.ms/vscjupyternb";case 1:return"https://aka.ms/vscnbexp";default:return p.error("Invalid Banner type"),""}}};fc.surveyDelay=!1,fc=v([(0,iw.injectable)(),m(0,(0,iw.inject)(ml)),m(1,(0,iw.inject)(M))],fc);var Ua=require("vscode");function Y4(n,e){e&&Ua.commands.registerCommand("dataScience.ClearCache",async()=>{let t=[];for(let r of n.globalState.keys())t.push(n.globalState.update(r,void 0).then(h,h));for(let r of n.workspaceState.keys())t.push(n.workspaceState.update(r,void 0).then(h,h));t.push(Ua.commands.executeCommand(J.ClearSavedJupyterUris).then(h,h)),await Promise.all(t).catch(h),await Promise.all([Ua.workspace.fs.delete(Ua.Uri.joinPath(n.globalStorageUri,"lastExecutedRemoteCell.json")).then(h,h),Ua.workspace.fs.delete(Ua.Uri.joinPath(n.globalStorageUri,"remoteServersMRUList.json")).then(h,h),Ua.workspace.fs.delete(Ua.Uri.joinPath(n.globalStorageUri,py)).then(h,h),l7(n).then(h,h)]),p.info("Cache cleared")})}function X4(n,e){Y4(n,e)}var V0=k(N()),Lt=require("vscode");var U0=y.percentPipCondaInstallInsteadOfBang("pip"),_F=y.percentPipCondaInstallInsteadOfBang("conda"),Z4=y.matplotlibWidgetInsteadOfOther,W0="Jupyter",SI=class{constructor(e){this.disposables=[];this.notebooksProcessed=new WeakMap;this.cellsToProcess=new Set;this.problems=Lt.languages.createDiagnosticCollection(W0),this.disposables.push(this.problems),e.push(this)}dispose(){z(this.disposables),this.problems.dispose()}activate(){this.disposables.push(Lt.languages.registerCodeActionsProvider(ge,this)),this.disposables.push(Lt.languages.registerHoverProvider(ge,this)),Lt.workspace.onDidChangeTextDocument(t=>{let r=zh(t.document);if(!r)return;let i=r.getCells().find(o=>o.document===t.document);i&&this.analyzeNotebookCell(i)},this,this.disposables),Lt.workspace.onDidCloseNotebookDocument(t=>{this.problems.delete(t.uri);let r=this.notebooksProcessed.get(t);this.notebooksProcessed.delete(t),r&&r.forEach((i,o)=>this.problems.delete(Lt.Uri.parse(o)))},this,this.disposables),Lt.workspace.onDidOpenNotebookDocument(t=>this.analyzeNotebook(t),this,this.disposables);let e=new us(300);this.disposables.push(e),Lt.workspace.onDidChangeNotebookDocument(t=>{e.trigger(()=>{let r=this.notebooksProcessed.get(t.notebook);t.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{r?.delete(o.document.uri.toString())}),i.addedCells.forEach(o=>this.queueCellForProcessing(o))}),t.cellChanges.forEach(i=>this.queueCellForProcessing(i.cell))})},this,this.disposables),Lt.workspace.notebookDocuments.map(t=>this.analyzeNotebook(t))}provideHover(e,t,r){if(zh(e)?.notebookType!==bt)return;let o=this.problems.get(e.uri);if(!o)return;let s=o.find(l=>l.message===U0||l.message===_F);if(!s||!s.range.contains(t))return;let a=s.message===U0?"pip":"conda";return new Lt.Hover(y.pipCondaInstallHoverWarning(a,"https://aka.ms/jupyterCellMagicBangInstall"),s.range)}provideCodeActions(e,t,r,i){if(!zh(e))return[];let o=[];return r.diagnostics.forEach(s=>{switch(s.message){case U0:o.push(this.createReplaceCodeAction(e,"pip",s));break;case _F:o.push(this.createReplaceCodeAction(e,"conda",s));break;case Z4:o.push(this.createGotoWikiAction(e,Lt.Uri.parse("https://aka.ms/vscodejupytermatplotlibwidget"),s));break;default:break}}),o}createReplaceCodeAction(e,t,r){let i=new Lt.CodeAction(y.replacePipCondaInstallCodeAction(t),Lt.CodeActionKind.QuickFix);i.isPreferred=!0,i.diagnostics=[r];let o=new Lt.WorkspaceEdit;return o.replace(e.uri,new Lt.Range(r.range.start,new Lt.Position(r.range.start.line,r.range.start.character+1)),"%"),i.edit=o,i}createGotoWikiAction(e,t,r){let i=new Lt.CodeAction(y.matplotlibWidgetCodeActionTitle,Lt.CodeActionKind.QuickFix);return i.isPreferred=!0,i.diagnostics=[r],i.command={title:y.matplotlibWidgetCodeActionTitle,command:"vscode.open",arguments:[t]},i}analyzeNotebook(e){e.notebookType===bt&&e.getCells().forEach((t,r)=>r<100?this.queueCellForProcessing(t):void 0)}queueCellForProcessing(e){this.cellsToProcess.add(e),this.analyzeNotebookCells()}analyzeNotebookCells(){if(this.cellsToProcess.size===0)return;let e=this.cellsToProcess.values().next().value;e&&(this.cellsToProcess.delete(e),this.analyzeNotebookCell(e)),setTimeout(()=>this.analyzeNotebookCells(),0)}analyzeNotebookCell(e){if(e.kind!==Lt.NotebookCellKind.Code||e.document.languageId!==ge||e.notebook.isClosed||e.document.isClosed||this.notebooksProcessed.get(e.notebook)?.get(e.document.uri.toString())===e.document.version)return;this.problems.delete(e.document.uri);let t=this.notebooksProcessed.get(e.notebook)||new Map;t.set(e.document.uri.toString(),e.document.version),this.notebooksProcessed.set(e.notebook,t);for(let r=0;r<Math.min(e.document.lineCount,50);r++){let i=e.document.lineAt(r),o=i.text;if(o.trim().startsWith("!pip install")){let s=o.indexOf("!"),a=o.indexOf("l"),l=new Lt.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:U0,range:l,severity:Lt.DiagnosticSeverity.Error,source:W0}])}else if(o.trim().startsWith("!conda install")){let s=o.indexOf("!"),a=o.indexOf("l"),l=new Lt.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:_F,range:l,severity:Lt.DiagnosticSeverity.Error,source:W0}])}else if(o.trim().startsWith("%matplotlib")&&!o.trim().endsWith("widget")&&!o.trim().endsWith("inline")){let s=o.indexOf("%"),a=o.length,l=new Lt.Range(i.lineNumber,s,i.lineNumber,a);this.problems.set(e.document.uri,[{message:Z4,range:l,severity:Lt.DiagnosticSeverity.Warning,source:W0}])}}}};SI=v([(0,V0.injectable)(),m(0,(0,V0.inject)(M))],SI);var q0=k(N()),vr=require("vscode");var eG=new Map([["method",0],["function",1],["constructor",2],["field",3],["variable",4],["class",5],["struct",6],["interface",7],["module",8],["property",9],["event",10],["operator",11],["unit",12],["value",13],["constant",14],["enum",15],["enumMember",16],["keyword",17],["text",18],["color",19],["file",20],["reference",21],["customcolor",22],["folder",23],["typeParameter",24],["snippet",25],["<unknown>",3]]);function j0(n){if(n>=300)return"ZZZZZZZ";if(n<=25)return`A${String.fromCharCode(65+n)}`;let e=String.fromCharCode(65+Math.ceil(n/25)),t=String.fromCharCode(65+n%25);return`${e}${t}`}var aG=require("vscode");var Wf=require("vscode");var Cfe=new Map([["julia",kfe],["python",wfe],["r",xfe]]);function tG(n,e){let t=Cfe.get(e.toLowerCase());return t?t(n):n}var Efe=["Docstring:","Options:","Parameters","Returns","See Also","Notes","Examples","Usage:","Subclasses:"];function wfe(n){let e=Ue(n,{trim:!1,removeEmptyEntries:!1}),t=-1,r=!1,i=!1,o=[],s=new Set,a=!1,l="",c=!1,u=!1;if(e.map((f,g)=>{if(g===0){let I=["Signature:","Init signature:"].find(w=>f.toLowerCase().startsWith(w.toLowerCase()));if(I){r=!0,f=f.substring(I.length).trim(),o.push("```python"),f.trim().length&&(o.push(f),c=!0);return}}if(f.startsWith("File:")&&g===e.length-1||f.startsWith("Type:")&&g===0)return;if(!a&&f.toLowerCase().startsWith("String form:".toLowerCase())){i=!0;return}let b=Efe.find(I=>f.trim().toLowerCase().startsWith(I.toLowerCase()));if(b&&!s.has(b)){l=b.toLowerCase(),s.add(b),a=!0,t=g,i=!1,r&&o.push("```","----------"),r=!1,u=!1,l!=="docstring:"&&o.push(`## ${b}`);let I=f.includes(":")?f.split(":")[1].replace("<no docstring>","").trim():"";I.length&&(o.push(I),c=!0);return}if(!i){if(t+1===g&&f.replace(/-/g,"").replace(/:/g,"").replace("<no docstring>","").trim().length===0){t=g,i=!1,r=!1,u=!1;return}if(l==="parameters"||l==="see also"){f.trim().length&&f.includes(":")&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="options:"){f.startsWith("-")&&f.trim().length&&f.includes(":")&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="returns"){f.trim().length&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="examples"&&!r&&(t+1===g||t+2===g))return i=!1,r=!0,c=c||f.trim().length>0,o.push("```python",f);if(!r&&f.startsWith("class ")&&f.trim().endsWith("):")){r=!0,u=!0,o.push("```python",f),c=c||f.trim().length>0;return}if(r&&u&&f.trim().length>0&&f.substring(0,1)!==" "&&f.substring(0,1)!=="	")return r=!1,u=!1,o.push(f,"```");c=c||f.trim().length>0,o.push(f)}}),!c)return"";let d=o.join(`  
`);return r?new Wf.MarkdownString(d+"  \n```"):new Wf.MarkdownString(d)}var Pfe=[{section:"Examples:",header:"Examples",nextLine://g},{section:"Usage note",header:"Usage note",nextLine://g},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"},{section:"Note:",header:"\u2502 Note",nextLine:String.fromCharCode(9474)}];function kfe(n){let e=Ue(n,{trim:!1,removeEmptyEntries:!1}),t=!1,r=[],i=new Set,o="",s=!1,a=!1;e.every(c=>c.trim().length===0||c.startsWith("  "))&&e.forEach((c,u)=>e[u]=c.trim().length?c.substring(2):c),e.map((c,u)=>{if(c.trim()==="\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")return a=!1,r.push(c);if(!a)return o="signature",t=!0,a=!0,c.trim().length?(s=!0,r.push("```julia",c)):r.push("```julia");o==="signature"&&c.trim()===""&&(o="",t=!1,s=!1,r.push("```"));let d=Pfe.find(f=>c.trim().toLowerCase().startsWith(f.header.toLowerCase()));if(d&&(typeof d.nextLine=="string"?e[u+1].trim()===d.nextLine.trim():e[u+1].trim().replace(d.nextLine,"").length===0)){e[u+1]="",o=d.section.toLowerCase(),i.add(d.header),t&&r.push("```"),t=!1,r.push(`## ${d.section}`),o==="note:"&&!e.slice(u+1).every(f=>f.trim().length===0||f.trim().startsWith("|")||f.trim().startsWith(String.fromCharCode(9474)))&&(o="");return}if(o==="examples:"&&!t)return t=!0,c.trim().length?(s=!0,r.push("```julia",c)):r.push("```julia");if(o==="note:"){r.push(c.trim()?c.trim().substring(1):"");return}t&&!s&&c.trim().length===0||r.push(c)});let l=r.join(`  
`);return t?new Wf.MarkdownString(l+"  \n```"):new Wf.MarkdownString(l)}function xfe(n){let e=Ue(n,{trim:!1,removeEmptyEntries:!1}),t=[];e.forEach((a,l)=>e[l]=a.indexOf("     ")===0?a.substring(5):a);let r="",i=!1,o=!1;e.map(a=>{let l=a.replace(/_/g,"").trim();if(a.startsWith("_")&&a.includes(String.fromCharCode(8))&&a.split("_").length===a.split(String.fromCharCode(8)).length&&l){i&&t.push("```"),i=!1,r=l.trim().toLowerCase(),t.push(`## ${l}`);return}if((r==="examples"||r==="examples:"||r==="usage"||r==="usage:")&&!i)return i=!0,a.trim().length?(o=!0,t.push("```r",a)):t.push("```r");if(r==="note:"){t.push(a.trim()?a.trim().substring(1):"");return}i&&!o&&a.trim().length===0||t.push(a)});let s=t.join(`  
`);return i?new Wf.MarkdownString(s+"  \n```"):new Wf.MarkdownString(s)}var rG=new WeakMap;async function Tu(n,e,t){let r=rG.get(n)||0;rG.set(n,r+1);let{api:i}=Kk(Ae,n),o=`application/vnd.vscode.bg.execution.${r}`,s=`application/vnd.vscode.bg.execution.${r}.result`,a=`application/vnd.vscode.bg.execution.${r}.error`,l="",c=`
def __jupyter_exec_background__():
    from IPython.display import display
    from threading import Thread
    from traceback import format_exc

    # First send a dummy response to get the display id.
    # Later we'll send the real response with the actual data.
    # And that can happen much later even after the execution completes,
    # as that response will be sent from a bg thread.
    output = display({"${o}": ""}, raw=True, display_id=True)

    def do_implementation():
        ${e.map((f,g)=>g===0?f:`        ${f}`).join(`
`)}

    def bg_main():
        try:
            output.update({"${s}": do_implementation()}, raw=True)
        except Exception as e:
            output.update({"${a}": format_exc()}, raw=True)


    Thread(target=bg_main, daemon=True).start()


__jupyter_exec_background__()
del __jupyter_exec_background__
`.trim(),u=new xr;u.add(t.onCancellationRequested(()=>u.dispose()));let d=tr(t,new Promise((f,g)=>{u.add(i.onDidReceiveDisplayUpdate(async b=>{if(t.isCancellationRequested)return f(void 0);let I=gm(b);if(!l||I?.transient?.display_id!==l)return;let w=b.items.find(D=>D.mime===s);if(w)try{return f(JSON.parse(new TextDecoder().decode(w.data)))}catch(D){return g(new Error("Failed to parse the result",D))}}))})).finally(()=>{n.session&&Bj(n.session,l),u.dispose()});for await(let f of i.executeCode(c,t)){if(t.isCancellationRequested)return;let g=gm(f);if(!g?.transient?.display_id)continue;if(f.items.find(I=>I.mime===o)){l=g.transient.display_id;continue}if(l===g.transient.display_id){let I=f.items.find(w=>w.mime===s||w.mime===a);if(I?.mime===s)return JSON.parse(new TextDecoder().decode(I.data));if(I?.mime===a){p.warn(`Error in background execution:
`,new TextDecoder().decode(I.data));return}}}if(!t.isCancellationRequested){if(!l){p.warn("Failed to get display id for completions");return}return d}}var Dfe=1,Mp=Xn.IntellisenseResolveTimeout,nG=5,TF=new WeakSet,J0=class extends Error{constructor(){super("Request timed out")}};async function lG(n,e,t,r,i,o,s,a){if(!n.range||!r.session?.kernel||TF.has(r)||!nt(r.kernelConnectionMetadata)&&r.status!=="idle")return n;let l=Lfe(e||n,s,a),c=Ffe(l,r,t),u=yg(t);try{let d=await hh(Mp,new J0,tr(u.token,c));if(!t.isCancellationRequested&&d?.status==="ok"&&d?.found){let f=_fe(d);n.documentation=tG(f,o)}}catch(d){if(d instanceof aG.CancellationError)return n;d instanceof J0&&(u.cancel(),Tfe(r,o,i))}finally{u.dispose()}return n}function _fe(n){return!n||n.status!=="ok"||!n.found?";":!n.data||typeof n.data!="object"?"":"text/plain"in n.data?Xl(n.data["text/plain"]):""}var iG=new WeakSet;function Tfe(n,e,t){nt(n.kernelConnectionMetadata)||TF.has(n)||(TF.add(n),p.warn(`Failed to inspect code in kernel ${ot(n.kernelConnectionMetadata)}`),iG.has(n)||(iG.add(n),R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",void 0,{kernelId:t,kernelConnectionType:n.kernelConnectionMetadata.kind,kernelLanguage:e})))}var RF=new WeakMap,AF=new WeakMap;async function Rfe(n,e,t){let r=`return get_ipython().kernel.do_inspect("${IC(e.code)}", ${e.cursor_pos}, ${e.detail_level})`;return{content:await Tu(n,[r],t)}}var oG={data:{},found:!1,status:"ok",metadata:{}};function Afe(n,e){if(!n.session?.kernel)return;let t=JSON.stringify(e);return RF.get(n.session.kernel)?.get(t)}function Nfe(n,e,t){if(!n.session?.kernel||t.status!=="ok"||!t.found)return;let r=JSON.stringify(e),i=RF.get(n.session.kernel)||new Map;RF.set(n.session.kernel,i),i.size>100&&i.clear(),i.set(r,t)}function Mfe(n){if(!n.session?.kernel)return!1;let e=AF.get(n.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};return!nt(n.kernelConnectionMetadata)&&e.maxTime>Mp?(p.warn(`Not sending inspect request as previous requests took over ${Mp}s.`),!1):e.numberOfTimesMaxedOut>nG?(p.warn(`Not sending inspect request as there have been at least ${nG} requests that took over ${Mp}s.`),!1):e.maxTime>Mp&&Date.now()-e.lastRequestTime<3e4?(p.warn(`Not sending inspect request as previous requests took over ${Mp}s.`),!1):!0}async function Kfe(n,e){if(!n.session?.kernel||!sG(n))return;p.info(`Too many pending requests ${cG(n)} for kernel ${n.id}, waiting for it to be ready.`);let t=n.session.kernel,r=new xr;await tr(e,new Promise(i=>{let o=()=>{if(e.isCancellationRequested)return;if(!sG(n)){i(),z(r);return}let s=setTimeout(o,100);r.add({dispose:()=>clearTimeout(s)})};r.add(la(e.onCancellationRequested)(()=>{i(),t.statusChanged.disconnect(o)})),t.statusChanged.connect(o),r.add({dispose:()=>{t.statusChanged.disconnect(o)}})})).finally(()=>z(r))}function Ofe(n,e){if(!n.session?.kernel)return;let t=AF.get(n.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};t.maxTime=Math.max(t.maxTime,e),t.lastRequestTime=Date.now(),e>Mp&&(t.numberOfTimesMaxedOut+=1),AF.set(n.session.kernel,t)}async function Ffe(n,e,t){if(!e.session?.kernel)return;let r=Afe(e,n);if(r)return r;if(!Mfe(e)||(await Kfe(e,t),t.isCancellationRequested))return oG;let i=Ufe(e),o=new Fe,s=Ue(n.code).reverse()[0].slice(-50);p.trace(`Inspecting code ${s}`);let a=nt(e.kernelConnectionMetadata)?Rfe(e,n,t):e.session.kernel.requestInspect(n);return a.finally(()=>i.dispose()),a.then(({content:l})=>{if(!e.session?.kernel)return;Nfe(e,n,l),Ofe(e,o.elapsedTime);let c=o.elapsedTime>Mp?p.warn:p.debug;return t.isCancellationRequested?c(`Inspected code ${s} in ${o.elapsedTime}ms (but cancelled)`):c(`Inspected code ${s} in ${o.elapsedTime}ms`),l})}function Lfe(n,e,t){let r=e.getText(),i=(typeof n.insertText=="string"?n.insertText:n.insertText?.value)||(typeof n.label=="string"?n.label:n.label.label)||"",o=r.substring(0,t.character)+i,s=t.character+i.length;return{code:o,cursor_pos:s,detail_level:0}}var ow=new WeakMap;function sG(n){return n.session?.kernel?cG(n)>=Dfe:!1}function cG(n){return n.session?.kernel?(ow.has(n.session?.kernel)||ow.set(n.session?.kernel,{count:0}),ow.get(n.session?.kernel)?.count||0):0}function Ufe(n){if(!n.session?.kernel)return{dispose:h};let e=ow.get(n.session?.kernel)||{count:0};return ow.set(n.session?.kernel,e),e.count+=1,{dispose:()=>{e.count-=1}}}var $0=class extends Error{constructor(){super("Request timed out")}},NF=class{constructor(e,t,r){this.kernelId=e;this.kernel=t;this.monacoLanguage=r;this.pendingCompletionRequest=new WeakMap;this.previousCompletionItems=new WeakMap}async provideCompletionItems(e,t,r,i){if(!this.kernel.session?.kernel)return[];let o=e.version;if(this.pendingCompletionRequest.has(e))return[];this.pendingCompletionRequest.set(e,{position:t,version:o});let s=new vr.Disposable(()=>{this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===o&&this.pendingCompletionRequest.delete(e)});try{let a=Xi(tr(r,Promise.resolve(vr.commands.executeCommand("vscode.executeCompletionItemProvider",e.uri,t)).then(f=>f?.items||[]))),l=new Fe;if(await vi(50),r.isCancellationRequested)return[];let c=await hh(Xn.IntellisenseTimeout,new $0,this.provideCompletionItemsFromKernel(e,t,r,i));if(r.isCancellationRequested||!c||!c.length)return[];let u=await br(0,a.promise);nt(this.kernel.kernelConnectionMetadata)&&!a.completed&&l.elapsedTime<Xn.IntellisenseTimeout+50&&(u=await br(Xn.IntellisenseTimeout-l.elapsedTime,a.promise));let d=new Set((u||[]).map(f=>{let g=typeof f.label=="string"?f.label:f.label.label,b=f.insertText,I=[g,`.${g}`];return typeof b=="string"&&I.push(b),I}).flat());return c.filter(f=>{let g=typeof f.label=="string"?f.label:f.label.label;return!d.has(g)&&!d.has(`* ${g}`)})}catch(a){if(a instanceof $0)return[];throw a instanceof vr.CancellationError||p.debug("Completions failed",a),a}finally{s.dispose()}}async provideCompletionItemsFromKernel(e,t,r,i){if(r.isCancellationRequested||!this.kernel.session?.kernel)return[];let o=new Fe,s={duration:0,timesExceededTimeout:0,requestDuration:0,completionItems:0},a={kernelId:this.kernelId,kernelConnectionType:this.kernel.kernelConnectionMetadata.kind,kernelLanguage:G0(this.kernel),monacoLanguage:this.monacoLanguage,cancelled:!1,kernelStatusBeforeRequest:this.kernel.status,completed:!1,requestSent:!1};if(!nt(this.kernel.kernelConnectionMetadata)&&this.kernel.status!=="idle")return[];let l=e.getText(),c=e.offsetAt(t);a.requestSent=!0;let u=await tr(r,this.getKernelCompletion(l,c,r));if(p.debug(`Jupyter completion time: ${o.elapsedTime}`),a.cancelled=r.isCancellationRequested,a.completed=!r.isCancellationRequested,a.kernelStatusAfterRequest=this.kernel.status,s.requestDuration=r.isCancellationRequested?0:o.elapsedTime,r.isCancellationRequested)return[];if(u?.content?.status!=="ok"||(u?.content?.matches?.length??0)===0)return dG(this.kernel,s,a),[];let d={matches:u.content.matches,cursor:{start:u.content.cursor_start,end:u.content.cursor_end},metadata:u.content.metadata},f=d.metadata?d.metadata._jupyter_types_experimental:[];s.completionItems=d.matches.length,dG(this.kernel,s,a);let g={code:l,cursor:d.cursor,documentRef:new WeakRef(e),position:e.positionAt(d.cursor.start)},b=new vr.Range(e.positionAt(d.cursor.start),e.positionAt(d.cursor.end)),I=[];return Array.isArray(f)&&f.length>=d.matches.length&&f.every(w=>w&&typeof w.text=="string")?I=u.content.matches.map((w,D)=>{let A=f[D],T=A.type?eG.get(A.type):vr.CompletionItemKind.Field,$=new vr.CompletionItem(w,T);return typeof A.start=="number"&&typeof A.end=="number"?$.range=new vr.Range(e.positionAt(A.start),e.positionAt(A.end)):$.range=b,$.insertText=A.text,$.sortText=j0(D),nt(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&($.sortText=`ZZZ${$.sortText}`),this.previousCompletionItems.set($,{...g,originalCompletionItem:JSON.parse(JSON.stringify($))}),$}):I=d.matches.map((w,D)=>{let A=new vr.CompletionItem(w);return A.range=b,A.sortText=j0(D),nt(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&(A.sortText=`ZZZ${A.sortText}`),this.previousCompletionItems.set(A,{...g,originalCompletionItem:A}),A}),nt(this.kernel.kernelConnectionMetadata)?Jfe(i.triggerCharacter,this.allowStringFilterForPython,I,e,t):I}async resolveCompletionItem(e,t){if(!e.range||!this.kernel.session?.kernel)return e;let r=this.previousCompletionItems.get(e);if(!r)return e;let{documentRef:i,position:o,originalCompletionItem:s}=r,a=i.deref();return a?lG(e,s,t,this.kernel,this.kernelId,this.monacoLanguage,a,o):e}async getKernelCompletion(e,t,r){if(this.kernel.session?.kernel)return nt(this.kernel.kernelConnectionMetadata)?this.getPythonKernelCompletion(e,t,r):tr(r,this.kernel.session.kernel.requestComplete({code:e,cursor_pos:t}))}async getPythonKernelCompletion(e,t,r){let i=`return get_ipython().kernel.do_complete("${IC(e)}", ${t})`;return{content:await Tu(this.kernel,[i],r)}}},uG=new WeakMap,B0=new WeakMap;function dG(n,e,t){let r=uG.get(n),i=B0.get(n)?.count||0;e.duration>=Xn.IntellisenseTimeout&&B0.set(n,{count:i+1,measures:e,properties:t}),e.timesExceededTimeout=i,r?r.elapsedTime>6e4&&(R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),r.reset(),B0.delete(n)):(R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),r=new Fe,uG.set(n,new Fe),B0.delete(n))}var MF=class extends $t{constructor(t,r){super();this.kernel=t;this.notebookEditorProvider=r;this.cellCompletionProviders=new WeakMap;this.completionItemsSent=new WeakMap;this.monacoLanguage=H0(this.kernel);this.registerCompletionProvider(),this._register(vr.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("jupyter.enableKernelCompletions"))if(pG(this.kernel.notebook.uri))this.completionProvider||this.registerCompletionProvider();else{this.completionProvider?.dispose(),this.completionProvider=void 0;return}!i.affectsConfiguration("jupyter.completionTriggerCharacters")&&!i.affectsConfiguration("jupyter.pythonCompletionTriggerCharacters")||this.registerCompletionProvider()}))}registerCompletionProvider(){if(!pG(this.kernel.notebook.uri))return;let t=Wfe(this.kernel);if(t.length===0){Vfe(this.kernel);return}p.trace(`Registering Kernel Completion Provider from kernel ${ot(this.kernel.kernelConnectionMetadata)} for language ${this.monacoLanguage}`),this.allowStringFilterForPython=t.includes("'")||t.includes('"'),this.completionProvider?.dispose(),this.completionProvider=void 0,this.completionProvider=vr.languages.registerCompletionItemProvider(this.monacoLanguage,this,...t)}dispose(){super.dispose(),this.completionProvider?.dispose()}async provideCompletionItems(t,r,i,o){if(this.notebookEditorProvider.findAssociatedNotebookDocument(t.uri)!==this.kernel.notebook)return[];let s=this.cellCompletionProviders.get(t);if(!s){let a=await ct(this.kernel.kernelConnectionMetadata.id);s=new NF(a,this.kernel,this.monacoLanguage),this.cellCompletionProviders.set(t,s)}return s.allowStringFilterForPython=this.allowStringFilterForPython,s.provideCompletionItems(t,r,i,o).then(a=>(a.forEach(l=>this.completionItemsSent.set(l,s)),a))}async resolveCompletionItem(t,r){let i=this.completionItemsSent.get(t);return i?i.resolveCompletionItem(t,r):t}},Kp=class extends $t{constructor(t){super();this.kernelCompletionProviders=new WeakMap;t.push(this)}activate(){let t=ve.instance.get(we);this._register(t.onDidStartKernel(async r=>{if(r.session?.kernel&&nt(r.kernelConnectionMetadata)&&r.session.kernel.requestComplete({code:"__file__.",cursor_pos:9}),!H0(r)||this.kernelCompletionProviders.has(r))return;let o=ve.instance.get(An),s=this._register(new MF(r,o));this.kernelCompletionProviders.set(r,s)})),this._register(t.onDidDisposeKernel(r=>{this.kernelCompletionProviders.get(r)?.dispose()}))}};Kp=v([(0,q0.injectable)(),m(0,(0,q0.inject)(M))],Kp);function H0(n){return yl(G0(n))}function G0(n){let e="";switch(n.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":e=n.kernelConnectionMetadata.kernelModel.language;break;case"startUsingRemoteKernelSpec":e=n.kernelConnectionMetadata.kernelSpec.language;break;case"startUsingLocalKernelSpec":e=n.kernelConnectionMetadata.kernelSpec.language;break;default:e=n.kernelConnectionMetadata.kernelSpec.language;break}return(e||"").toLowerCase()}function pG(n){return vr.workspace.getConfiguration("jupyter",n).get("enableKernelCompletions",!1)}function Wfe(n){let e=vr.workspace.getConfiguration("jupyter",n.notebook.uri).get("completionTriggerCharacters");if(!e||typeof e!="object")return[];let t=G0(n),r=H0(n);return t in e?Array.isArray(e[t])?e[t]:[]:r in e?Array.isArray(e[r])?e[r]:[]:[]}function Vfe(n){let e=G0(n),t=H0(n);e.toLowerCase()===t.toLowerCase()?p.warn(vr.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,ot(n.kernelConnectionMetadata),`{${e}`)):p.warn(vr.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
 or the following: 
jupyter.completionTriggerCharacters = {2}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,ot(n.kernelConnectionMetadata),`{${e}`,`{${t}`))}function jfe(n,e){let t=n.indexOf('"'),r=n.indexOf("'"),i=n.lastIndexOf('"'),o=n.lastIndexOf("'"),s=t>=0?t:r,a=i>=0?i:o;return s>=0&&e.character>s&&e.character<=a}function Jfe(n,e,t,r,i){let o=i.character===0?void 0:new vr.Range(i.line,i.character-1,i.line,i.character),a=(o?r.getText(o):void 0)===".",l=r.getWordRangeAtPosition(a||n==="."?new vr.Position(i.line,i.character-1):i),c=l&&o?l.union(o):void 0,u=r.lineAt(i.line).text,d=c?r.getText(c):u,f=d.endsWith(".")||a,g=e&&(n=="'"||n=='"'||jfe(u,i));p.ci(`Jupyter completions filtering applied: ${g} on ${u}`);let b=t.map((I,w)=>{let D=typeof I.label=="string"?I.label:I.label.label,A=typeof I.label=="string"?I.label:I.label.label;if(A.startsWith("%")||A.startsWith("!"))return{...I,sortText:`ZZZ${I.sortText}`};if(g)return I;let T=d?A.indexOf(d):-1,$,ne,H;if(d&&f&&A.includes(d)){$=A.substring(A.indexOf(d)+(f?d.length:0)),ne=A.substring(A.indexOf(d)+d.length);let oe=(typeof I.label=="string"?I.label.length:I.label.label.length)-ne.length;H=I.range&&"start"in I.range?new vr.Range(new vr.Position(I.range.start.line,I.range.start.character+oe),I.range.end):I.range}if(!ne&&T>0){$=A.substring(A.indexOf(d)+(f?d.length:0)),ne=A.substring(A.indexOf(d)+d.length);let oe=(typeof I.label=="string"?I.label.length:I.label.label.length)-ne.length;H=I.range&&"start"in I.range?new vr.Range(new vr.Position(I.range.start.line,I.range.start.character+oe),I.range.end):I.range}return $&&ne&&H&&(I.label=$,D=ne,I.insertText=ne,I.filterText=f?`.${ne}`:ne,I.range=H,I.sortText=j0(w)),D.endsWith("/")?{...I,command:{command:"editor.action.triggerSuggest",title:""}}:(D.includes(" ")&&(D=D.replace(/\\ /g," "),typeof I.label=="string"?I.label=I.label.replace(/\\ /g," "):I.label.label=I.label.label.replace(/\\ /g," ")),g||!D.includes(".")&&!D.endsWith("/")||D.startsWith(".")&&!D.endsWith("/")?I:void 0)}).filter(I=>I!==void 0);return p.ci(`Jupyter completions for ${d} at pos ${i.line}:${i.character} with trigger: ${n}
   ${t.map(I=>I.label).join(",")}`),p.ci(`Jupyter results for ${d} at pos ${i.line}:${i.character} with trigger: ${n}
   ${b.map(I=>I.label).join(",")}`),b}var Op=k(N()),KF=require("vscode");var fG=k(Jo());var mG=require("vscode");function z0(){let e=mG.workspace.getConfiguration("python")?.get("languageServer");return!(e!=="Pylance"&&e!=="Default")}var Fp=class{constructor(e,t,r,i,o){this.apiProvider=e;this.extensionChecker=t;this.notebookEditorProvider=r;this.controllerRegistration=i;this.kernelProvider=o;this._isPylanceExtensionInstalled()||(this.extensionChangeHandler=KF.extensions.onDidChange(this.extensionsChangeHandler.bind(this)))}activate(){!this.isUsingPylance()||!this.extensionChecker.isPythonExtensionInstalled||this.apiProvider.getApi().then(e=>{e.registerJupyterPythonPathFunction!==void 0&&e.registerJupyterPythonPathFunction(t=>this._jupyterPythonPathFunction(t))}).catch(h)}async reset(){this._isEnabled=void 0,await this.activate()}_isPylanceExtensionInstalled(){return KF.extensions.getExtension(Gp)!==void 0}async extensionsChangeHandler(){this._isPylanceExtensionInstalled()&&this.extensionChangeHandler&&(this.extensionChangeHandler.dispose(),this.extensionChangeHandler=void 0,await this.reset())}isUsingPylance(){return this._isEnabled===void 0&&(this._isEnabled=z0()),this._isEnabled}async _jupyterPythonPathFunction(e){let t=this.notebookEditorProvider.findAssociatedNotebookDocument(e);if(!t)return;let r=this.controllerRegistration.getSelected(t);if(r&&xt(r.connection)){let o=this.kernelProvider.get(t);if(!o)return;let s=[];if(!o.startedAtLeastOnce){let b=new Promise(I=>o.onStarted(I,void 0,s));await br(5e3,void 0,b)}if(!o.startedAtLeastOnce)return;let a=this.kernelProvider.getKernelExecution(o),l=`
import os as _VSCODE_os
import sys as _VSCODE_sys
import builtins as _VSCODE_builtins

if _VSCODE_os.path.exists("${__filename}"):
    _VSCODE_builtins.print(f"EXECUTABLE{_VSCODE_sys.executable}EXECUTABLE")

del _VSCODE_os, _VSCODE_sys, _VSCODE_builtins
`,u=(await a.executeHidden(l).catch(h)||[]).find(b=>b.output_type==="stream"&&b.name==="stdout");if(!u||!(u.text||"").toString().includes("EXECUTABLE"))return;let d=(u.text||"").toString();d=d.substring(d.indexOf("EXECUTABLE"));let f=d.split("EXECUTABLE").filter(b=>b.trim().length),g=f.length?f[0].trim():"";return!g||!await fG.pathExists(g)?void 0:(p.debug(`Remote Interpreter for Pylance for Notebook URI "${U(t.uri)}" is ${U(g)}`),g)}let i=r?.connection?.interpreter;return i?(p.debug(`Interpreter for Pylance for Notebook URI "${U(t.uri)}" is ${U(i.uri)}`),Re(i.uri)):(p.debug(`No interpreter for Pylance for Notebook URI "${U(t.uri)}"`),"")}};Fp=v([(0,Op.injectable)(),m(0,(0,Op.inject)(Qt)),m(1,(0,Op.inject)($e)),m(2,(0,Op.inject)(An)),m(3,(0,Op.inject)(it)),m(4,(0,Op.inject)(we))],Fp);function hG(n){n.addSingleton(me,SI),n.addSingleton(Kp,Kp),n.addBinding(Kp,me),n.addSingleton(Fp,Fp),n.addBinding(Fp,me)}var EI=k(N());var gG=require("vscode");var CI=class{constructor(e,t,r){this.extensionChecker=e;this.disposables=t;this.kernelProvider=r}activate(){this.extensionChecker.onPythonExtensionInstallationStatusChanged(this.onPythonExtensionInstallationStatusChanged,this,this.disposables)}async onPythonExtensionInstallationStatusChanged(e){e==="installed"&&this.anyKernelsAreActive()&&gG.window.showInformationMessage(y.pythonExtensionInstalled,le.ok).then(h,h)}anyKernelsAreActive(){return this.kernelProvider.kernels.length>0}};CI=v([(0,EI.injectable)(),m(0,(0,EI.inject)($e)),m(1,(0,EI.inject)(M)),m(2,(0,EI.inject)(we))],CI);var Xr=k(N()),yG=k(So()),Et=require("vscode");var hc=require("vscode");var Q0=class{constructor(e,t,r,i,o){this.configService=e;this.agentCreator=t;this.requestCreator=r;this.serverUriStorage=i;this.disposables=o;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");let t=wI(e.url),r=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterConnectionInfo({url:t,isTokenEmpty:e.isTokenEmpty,disposables:r,validationErrorMessage:e.validationErrorMessage}).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(p.warn(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&z(r)}).catch(h),this.savedConnectInfo.set(e.handle,o)),o}async getJupyterConnectionInfo(e){let t,r,i,o,s=await this.needPassword(e.url);if(s||e.isTokenEmpty){if(s&&e.isTokenEmpty){let a=hc.window.createInputBox();e.disposables.push(a),a.title=y.jupyterSelectPasswordTitle,a.placeholder=y.jupyterSelectPasswordPrompt,a.ignoreFocusOut=!0,a.password=!0,a.validationMessage=e.validationErrorMessage||"",a.show(),a.buttons=[hc.QuickInputButtons.Back],o=await new Promise((l,c)=>{a.onDidTriggerButton(u=>{u===hc.QuickInputButtons.Back&&c(xe.back)},this,e.disposables),a.onDidChangeValue(()=>a.validationMessage="",this,e.disposables),a.onDidAccept(()=>l(a.value),this,e.disposables),a.onDidHide(()=>c(xe.cancel),this,e.disposables)})}if(typeof o===void 0&&!o&&e.isTokenEmpty)throw new hc.CancellationError;if(o||e.isTokenEmpty)if(t=await this.getXSRFToken(e.url,""),t){let a=await this.getSessionCookie(e.url,t,o||"");r=a.sessionCookieName,i=a.sessionCookieValue}else r="authservice_session",i=o,t=await this.getXSRFToken(e.url,`${r}=${i}`);else return{requiresPassword:s}}else return{requiresPassword:s};return t&&r&&(i||e.isTokenEmpty)?(R("DS_INTERNAL.GET_PASSWORD_SUCCESS"),{requestHeaders:{Cookie:`_xsrf=${t}; ${r}=${i||""}`,"X-XSRFToken":t},requiresPassword:s}):(R("DS_INTERNAL.GET_PASSWORD_FAILURE"),{requiresPassword:s})}addAllowUnauthorized(e,t,r){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...r,agent:i}}return r}async getXSRFToken(e,t){let r,i,o=new URL("login?",wI(e)).toString();t!=""?(o=new URL("tree",wI(e)).toString(),i={Connection:"keep-alive",Cookie:t}):i={Connection:"keep-alive"};let s=await this.makeRequest(o,{method:"get",redirect:"manual",headers:i});if(s!==void 0&&s.ok){let a=this.getCookies(s);a.has("_xsrf")&&(r=a.get("_xsrf")?.split(";")[0])}return r}async needPassword(e){let t=await this.makeRequest(wI(e),{method:"get",redirect:"follow",headers:{Connection:"keep-alive"}});if(t.status===200&&t.redirected){if(t.url.toLowerCase().includes("/login?"))return!0;if(t.url.toLowerCase().includes("/lab?"))return!1}let r=new URL("tree?",wI(e)).toString();return t=await this.makeRequest(r,{method:"get",redirect:"manual",headers:{Connection:"keep-alive"}}),t.status===404?(p.error(`Jupyter Server not found at ${e}, got 404 for ${r}`),!1):t.status!==200}async makeRequest(e,t){let r=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!r,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await hc.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,hc.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}async getSessionCookie(e,t,r){let i,o,s=new URLSearchParams;s.append("_xsrf",t),s.append("password",r);let a=await this.makeRequest(new URL("login?",wI(e)).toString(),{method:"post",headers:{Cookie:`_xsrf=${t}`,Connection:"keep-alive","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a.status===302){let l=this.getCookies(a);if(l.size>0){let c=l.entries().next().value;c&&(i=c[0],o=c[1])}}return{sessionCookieName:i,sessionCookieValue:o}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function wI(n){let e=n;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var X0=require("vscode");var Y0=class{constructor(e,t,r){this.configService=e;this.agentCreator=t;this.requestCreator=r}async isJupyterHub(e){try{if(e.toLowerCase().includes("/user/")&&e.includes("token="))return!1;if(e.toLowerCase().includes("/user/")&&!e.includes("token="))return!0;let t=await this.makeRequest(new URL("hub/api",Bfe(e)).toString(),{method:"get"});if(t.status!==200)return!1;try{let r=await t.json();return p.trace(`JupyterHub version is ${r&&r.version} for url ${e}`),r&&r.version}catch{}return!1}catch(t){return p.debug(`Error in detecting whether url is isJupyterHub: ${t}`),!1}}addAllowUnauthorized(e,t,r){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...r,agent:i}}return r}async makeRequest(e,t){let r=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!r,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await X0.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,X0.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}};function Bfe(n){let e=n;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var Z0="user-jupyter-server-uri-list-version2";var $fe="DataScienceAllowInsecureConnections",PI=class extends $t{constructor(t,r,i,o,s,a,l,c,u,d,f,g=xS){super();this.jupyterConnection=r;this.context=u;this.fs=d;this.jupyterServerProviderRegistry=f;this.id=g;this.extensionId=Ae;this.documentation=Et.Uri.parse("https://aka.ms/vscodeJuptyerExtKernelPickerExistingServer");this.displayName=y.UserJupyterServerUrlProviderDisplayName;this.detail=y.UserJupyterServerUrlProviderDetail;this._onDidChangeHandles=this._register(new Et.EventEmitter);this.onDidChangeHandles=this._onDidChangeHandles.event;this._onDidChangeServers=this._register(new Et.EventEmitter);this.onDidChangeServers=this._onDidChangeServers.event;a.push(this),this.newStorage=new lw(i),this.secureConnectionValidator=new aw(s),this.jupyterServerUriInput=new sw(c),this.jupyterServerUriDisplayName=new OF,this.jupyterPasswordConnect=new Q0(t,l,c,o,a),this.jupyterHubPasswordConnect=new Y0(t,l,c)}activate(){let t=this._register(this.jupyterServerProviderRegistry.createJupyterServerCollection(Ae,this.id,this.displayName,this));t.commandProvider=this,t.documentation=this.documentation,this._register(this.onDidChangeHandles(()=>this._onDidChangeServers.fire(),this)),this._register(Et.commands.registerCommand("dataScience.ClearUserProviderJupyterServerCache",async()=>{await Promise.all([this.newStorage.clear().catch(h),this.fs.delete(Et.Uri.joinPath(this.context.globalStorageUri,py)).catch(h)]),this._onDidChangeHandles.fire()})),this.initializeServers().catch(h)}async resolveJupyterServer(t,r){let i=await this.getServerUri(t.id);return{...t,connectionInformation:{id:t.id,label:t.label,baseUrl:Et.Uri.parse(i.baseUrl),token:i.token,headers:i.authorizationHeader,mappedRemoteNotebookDir:i.mappedRemoteNotebookDir?Et.Uri.file(i.mappedRemoteNotebookDir):void 0}}}async handleCommand(t,r){let i=new Et.CancellationTokenSource;this._register(new Et.Disposable(()=>{i.cancel(),i.dispose()}));try{let o="url"in t?t.url:void 0,s=await this.captureRemoteJupyterUrl(i.token,o);if(!s||s===xe.cancel)throw new Et.CancellationError;if(s&&s instanceof xe)return;let l=(await this.provideJupyterServers(i.token)).find(c=>c.id===s);if(!l)throw new Error(`Server ${s} not found`);return l}catch(o){if(o instanceof Et.CancellationError)throw o;p.error("Failed to select a Jupyter Server",o);return}finally{i.cancel(),i.dispose()}}async provideCommands(t,r){let i="";try{t=(t||"").trim(),["http:","https:"].includes(new URL(t.trim()).protocol.toLowerCase())&&(i=t)}catch{}return i?[{label:y.connectToToTheJupyterServer(i),url:i}]:[{label:y.jupyterSelectUriCommandLabel,canBeAutoSelected:!0}]}async provideJupyterServers(t){return await this.initializeServers(),(await this.newStorage.getServers(!1)).map(i=>({id:i.handle,label:i.serverInfo.displayName}))}async removeJupyterServer(t){await this.initializeServers(),await this.newStorage.remove(t.id),this._onDidChangeHandles.fire()}initializeServers(){if(this._cachedServerInfoInitialized)return this._cachedServerInfoInitialized;let t=re();return this._cachedServerInfoInitialized=t.promise,(async()=>{this.newStorage.getServers(!1).catch(h),t.resolve()})().then(()=>t.resolve(),r=>t.reject(r)).catch(h),this._cachedServerInfoInitialized}recommendInstallingJupyterHubExtension(){throw Et.extensions.getExtension(uh)?Et.window.showInformationMessage(y.useJupyterHubExtension,{modal:!0,detail:y.useJupyterHubExtensionDetail}).then(()=>{Et.commands.executeCommand("notebook.selectKernel",{notebookEditor:Et.window.activeNotebookEditor}).then(h,h)},h):Et.window.showInformationMessage(y.installJupyterHub,{modal:!0,detail:y.installJupyterHubDetail},le.install,le.moreInfo).then(t=>{t===le.install?Et.commands.executeCommand("workbench.extensions.installExtension",uh,{context:{skipWalkthrough:!0}}).then(h,h):t===le.moreInfo&&Et.env.openExternal(Et.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter-hub")).then(h,h)},h),new Et.CancellationError}async captureRemoteJupyterUrl(t,r=""){await this.initializeServers();let i=[],o={baseUrl:"",displayName:"",token:""},s="",a=!1,l=!1,c,u="Get Url",d="Get Url",f=r,g=!1;if(r){let b=await this.jupyterServerUriInput.parseUserUriAndGetValidationError(r);typeof b.validationError=="string"?(s=b.validationError,u="Get Url"):(g=!0,o=b.jupyterServerUri,u="Check Passwords")}try{let b=!1;for(;;)try{if(c=(0,yG.default)(),u==="Get Url"){g=!1,u="Check Passwords",d=void 0;let w=s;s="";let D=await this.jupyterServerUriInput.getUrlFromUser(f||r,w,i);o=D.jupyterServerUri,f=D.url}if(t.isCancellationRequested)return xe.cancel;let I=[];if(u==="Check Passwords"){u="Check Insecure Connections",d=g&&r?void 0:"Get Url";try{let w=s;if(s="",!o.token&&await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl))return this.recommendInstallingJupyterHubExtension(),xe.cancel;let D=await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:c,validationErrorMessage:w,disposables:I});a=D.requiresPassword,o.authorizationHeader=D.requestHeaders,b=!1}catch(w){if(b=!1,w instanceof Et.CancellationError||w==xe.back||w==xe.cancel)throw w;if(!Fo.isSelfCertsError(w)){if(!Sl.isSelfCertsExpiredError(w)){Vf(c,o.baseUrl,!1,"ConnectionFailure");let D=/(https?:\/\/[^\s]+)/g,A=(w.message||w.toString()).replace(D,T=>`[${T}](${T})`);if(s=(Mr()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(A),o.token.length>0&&(w.message||"").toLowerCase()==="Failed to fetch".toLowerCase())b=!0;else{u="Get Url";continue}}}}finally{I.forEach(w=>this._register(w))}}if(t.isCancellationRequested)return xe.cancel;if(u==="Check Insecure Connections"&&(u="Verify Connection",d=a&&o.token.length===0?"Check Passwords":"Get Url",d==="Get Url"&&(d=g&&r?void 0:"Get Url"),!a&&o.token.length===0&&new URL(o.baseUrl).protocol.toLowerCase()==="http:"&&(l=!0,z(I),!await this.secureConnectionValidator.promptToUseInsecureConnections())))return Vf(c,o.baseUrl,!1,"InsecureHTTP"),xe.cancel;if(t.isCancellationRequested)return xe.cancel;if(u==="Verify Connection")try{u="Get Display Name",await this.jupyterConnection.validateRemoteUri({id:this.id,handle:c,extensionId:Ae},o,!0)}catch(w){if(p.warn("Uri verification error",w),b&&s){u="Get Url";continue}if(w instanceof Et.CancellationError||w==xe.back||w==xe.cancel)throw w;if(Fo.isSelfCertsError(w)){s=y.jupyterSelfCertFailErrorMessageOnly,u="Get Url",Vf(c,o.baseUrl,!1,"SelfCert");continue}else if(Sl.isSelfCertsExpiredError(w)){s=y.jupyterSelfCertExpiredErrorMessageOnly,u="Get Url",Vf(c,o.baseUrl,!1,"ExpiredCert");continue}else if(a&&o.token.length===0){s=y.passwordFailure,u="Check Passwords",Vf(c,o.baseUrl,!1,"AuthFailure");continue}else{Vf(c,o.baseUrl,!1,"ConnectionFailure");let D=/(https?:\/\/[^\s]+)/g,A=(w.message||w.toString()).replace(D,T=>`[${T}](${T})`);s=(Mr()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(A),u="Get Url";continue}}finally{z(I)}if(t.isCancellationRequested)return xe.cancel;if(u==="Get Display Name"){z(I),d=l?"Check Insecure Connections":a&&o.token.length===0?"Check Passwords":"Get Url",d==="Get Url"&&(d=g&&r?void 0:"Get Url"),o.displayName=await this.jupyterServerUriDisplayName.getDisplayName(c,o.displayName||new URL(o.baseUrl).hostname);break}}catch(I){if(I instanceof Et.CancellationError||I===xe.cancel)return xe.cancel;if(I===xe.back){if(!d)return xe.back;u=d;continue}throw I}return t.isCancellationRequested?xe.cancel:(await this.addNewServer({handle:c,uri:f,serverInfo:o}),ND({extensionId:this.extensionId,id:this.id,handle:c},o.displayName),Vf(c,o.baseUrl,!1),c)}catch(b){if(b instanceof Et.CancellationError)return xe.cancel;throw b}finally{z(i)}}async addNewServer(t){await this.newStorage.add(t),this._onDidChangeHandles.fire()}async getServerUri(t){let i=(await this.newStorage.getServers(!1)).find(l=>l.handle===t);if(!i)throw new Error("Server not found");let o=i.serverInfo,s=this.jupyterServerUriDisplayName.displayNamesOfHandles.get(t);s&&(o.displayName=s);let a=Object.assign({},o);try{let l=await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:t});a=Object.assign({},o,{authorizationHeader:l.requestHeaders||o.authorizationHeader})}catch(l){p.error("Failed to validate Password info",l)}return a}};PI=v([(0,Xr.injectable)(),m(0,(0,Xr.inject)(ie)),m(1,(0,Xr.inject)(sn)),m(2,(0,Xr.inject)(kC)),m(3,(0,Xr.inject)(Ht)),m(4,(0,Xr.inject)(Le)),m(4,(0,Xr.named)(ut)),m(5,(0,Xr.inject)(M)),m(6,(0,Xr.inject)(Id)),m(6,(0,Xr.optional)()),m(7,(0,Xr.inject)(Mc)),m(8,(0,Xr.inject)(Ze)),m(9,(0,Xr.inject)(tt)),m(10,(0,Xr.inject)(Vt)),m(11,(0,Xr.optional)()),m(11,(0,Xr.inject)(Date.now().toString()))],PI);var sw=class{constructor(e){this.requestCreator=e}async getUrlFromUser(e,t="",r){if(!e&&!$w)try{let s=await Et.env.clipboard.readText(),a=s.trim().startsWith("https://github.com/")?void 0:Et.Uri.parse(s.trim(),!0);e=s&&a&&a.scheme.toLowerCase().startsWith("http")?s:""}catch{e=""}let i=Et.window.createInputBox();r.push(i),i.title=y.jupyterSelectUriInputTitle,i.placeholder=y.jupyterSelectUriInputPlaceholder,i.value=e,i.validationMessage=t,i.buttons=[Et.QuickInputButtons.Back],i.ignoreFocusOut=!0,i.show();let o=re();return i.onDidChangeValue(()=>i.validationMessage="",this,r),i.onDidHide(()=>o.reject(xe.cancel),this,r),i.onDidTriggerButton(s=>{s===Et.QuickInputButtons.Back&&o.reject(xe.back)},this,r),i.onDidAccept(async()=>{let s=await this.parseUserUriAndGetValidationError(i.value);if(typeof s.validationError=="string"){i.validationMessage=s.validationError;return}o.resolve(s)}),o.promise}async parseUserUriAndGetValidationError(e){let t=e.trim().replace(/\/(lab|tree)(\??)$/,""),r=FF(t,"");return r?(r.baseUrl=await qfe(t,this.requestCreator)||r.baseUrl,!t.toLowerCase().startsWith("http:")&&!t.toLowerCase().startsWith("https:")?{validationError:y.jupyterSelectURIMustBeHttpOrHttps}:{jupyterServerUri:r,url:t,validationError:void 0}):{validationError:y.jupyterSelectURIInvalidURI}}};sw=v([m(0,(0,Xr.inject)(Mc))],sw);async function qfe(n,e){try{if(n=FF(n,"")?.baseUrl||n,new URL(n).pathname==="/")return n;let t=n.indexOf("token=")>0?n.substring(0,n.indexOf("token=")):n,o=(await e.getFetchMethod()(t,{method:"GET",redirect:"manual"})).headers.get("location");if(o&&o.includes("login?"))return o.substring(0,o.indexOf("login?"))}catch(t){p.debug("Unable to identify the baseUrl of the Jupyter Server",t)}}function Vf(n,e,t,r){e=e.trim().toLowerCase();let i=Mt({handle:n,extensionId:Ae,id:xS});Promise.all([ct(e.toLowerCase()),ct(i.toLowerCase())]).then(([o,s])=>{R("DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",void 0,{serverIdHash:s,failed:!!r,baseUrlHash:o,isJupyterHub:t,isLocalHost:["localhost","127.0.0.1","::1"].includes(new URL(e).hostname),reason:r})}).catch(o=>p.error(`Failed to hash remote url ${e}`,o))}var OF=class{constructor(){this.displayNamesOfHandles=new Map}async getDisplayName(e,t){let r=[];try{let i=Et.window.createInputBox();r.push(i),i.ignoreFocusOut=!0,i.title=y.jupyterRenameServer,i.value=t,i.placeholder=y.jupyterServerUriDisplayNameInputPlaceholder,i.buttons=[Et.QuickInputButtons.Back],i.show();let o=re();return r.push(i.onDidHide(()=>o.reject(xe.cancel))),i.onDidTriggerButton(s=>{s===Et.QuickInputButtons.Back&&o.reject(xe.back)},this,r),i.onDidAccept(()=>{let s=i.value.trim()||t;this.displayNamesOfHandles.set(e,s),o.resolve(s)},this,r),await o.promise}finally{z(r)}}},aw=class{constructor(e){this.globalMemento=e}async promptToUseInsecureConnections(){if(this.globalMemento.get($fe,!1))return!0;let e=[],t=re();try{let r=Et.window.createQuickPick();return e.push(r),r.canSelectMany=!1,r.ignoreFocusOut=!0,r.title=y.insecureSessionMessage,r.buttons=[Et.QuickInputButtons.Back],r.items=[{label:le.bannerLabelYes},{label:le.bannerLabelNo}],r.show(),e.push(r.onDidHide(()=>t.reject(xe.cancel))),r.onDidTriggerButton(i=>{i===Et.QuickInputButtons.Back&&t.reject(xe.back)},this,e),r.onDidAccept(()=>t.resolve(r.selectedItems.some(i=>i.label===le.bannerLabelYes)),this,e),await t.promise}finally{z(e)}}};aw=v([m(0,(0,Xr.inject)(Le)),m(0,(0,Xr.named)(ut))],aw);function FF(n,e){if(!n.startsWith(Je.REMOTE_URI))try{let t=new URL(n);return{baseUrl:`${t.protocol}//${t.host}${t.pathname==="/lab"||t.pathname==="/tree"?"":t.pathname}`,token:t.searchParams.get("token")||"",displayName:e||t.hostname}}catch(t){p.error(`Failed to parse URI ${n}`,t);return}}function vG(n){return n.map(e=>({handle:e.handle,uri:e.uri,displayName:e.serverInfo.displayName}))}function Hfe(n){let e=[];return n.forEach(t=>{let r=FF(t.uri,t.displayName);r&&e.push({handle:t.handle,uri:t.uri,serverInfo:r})}),e}var lw=class{constructor(e){this.encryptedStorage=e;this.updatePromise=Promise.resolve()}async getServers(e){if(this.servers&&!e)return this.servers;let t=await this.encryptedStorage.retrieve(Xn.JupyterServerRemoteLaunchService,Z0);if(!t||t==="[]")return[];try{return this.servers=Hfe(JSON.parse(t))}catch{return[]}}async add(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e.handle).concat(e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).concat(e);this.servers=t,await this.encryptedStorage.store(Xn.JupyterServerRemoteLaunchService,Z0,JSON.stringify(vG(t)))}).catch(h))}async remove(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).filter(r=>r.handle!==e);return this.servers=t,this.encryptedStorage.store(Xn.JupyterServerRemoteLaunchService,Z0,JSON.stringify(vG(t)))}).catch(h))}async clear(){this.servers=[],await(this.updatePromise=this.updatePromise.then(async()=>{this.servers=[],await this.encryptedStorage.store(Xn.JupyterServerRemoteLaunchService,Z0,void 0)}).catch(h))}};lw=v([m(0,(0,Xr.inject)(kC))],lw);var cw=k(N()),xI=require("vscode");var kI=class extends $t{constructor(t,r){super();this.uriProviderRegistration=t;this.serverUriStorage=r;this.handleMappings=new Map;this._onDidChangeHandles=this._register(new xI.EventEmitter);this.extensionId=Ae;this.id=Aw;this.displayName="Jupyter Server for Testing";this.onDidChangeServers=this._onDidChangeHandles.event}async provideJupyterServers(t){return Array.from(this.handleMappings.values()).map(r=>r.server)}async resolveJupyterServer(t,r){return t}activate(){this._register(this.uriProviderRegistration.createJupyterServerCollection(Ae,this.id,this.displayName,this)),this._register(xI.commands.registerCommand("jupyter.selectjupyteruri",this.selectJupyterUri,this))}async selectJupyterUri(t){p.info(`Setting Jupyter Server URI to remote: ${t}`);let r=t.toString(!0),i=new URL(r),o=xI.Uri.parse(`${i.protocol}//${i.host}${i.pathname==="/lab"?"":i.pathname}`),s=i.searchParams.get("token")??"",a=await ia(t.toString(!0),"SHA-1"),l={label:this.displayName,id:a,connectionInformation:{baseUrl:o,token:s}};this.handleMappings.set(a,{uri:t,server:l}),await this.serverUriStorage.add({id:this.id,handle:a,extensionId:Ae}),this._onDidChangeHandles.fire()}};kI=v([(0,cw.injectable)(),m(0,(0,cw.inject)(Vt)),m(1,(0,cw.inject)(Ht))],kI);var e1=k(N());var uw=require("vscode");var DI=class{constructor(e){this.disposables=e}activate(){this.registerCommandsIfTrusted()}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){uw.workspace.isTrusted&&this.registerCommand(J.ContinueEditSessionInCodespace,this.continueEditSessionInCodespace)}registerCommand(e,t){let r=uw.commands.registerCommand(e,t,this);this.disposables.push(r)}async continueEditSessionInCodespace(){await uw.commands.executeCommand("_workbench.editSessions.actions.continueEditSession.github.codespaces.continueEditSessionInCodespaceWithJupyterServer")}};DI=v([(0,e1.injectable)(),m(0,(0,e1.inject)(M))],DI);var bG=k(N());var IG=require("vscode");var _I=class{activate(){this.eagerlyActivateOtherExtensions().catch(h)}async eagerlyActivateOtherExtensions(){await Promise.all(IG.extensions.all.filter(e=>e.packageJSON?.contributes?.pythonRemoteServerProvider).map(e=>e.isActive?Promise.resolve():e.activate().then(h,h)))}};_I=v([(0,bG.injectable)()],_I);var t1=k(N()),SG=require("vscode");var TI=class{constructor(e){this.uriStorage=e}activate(){SG.commands.registerCommand("jupyter.getUsedAzMLServerHandles",()=>{let e=[];return this.uriStorage.all.forEach(r=>{r.provider.extensionId.toLowerCase()==="ms-toolsai.vscode-ai".toLowerCase()&&e.push(r.provider)}),e})}};TI=v([(0,t1.injectable)(),m(0,(0,t1.inject)(Ht))],TI);var Ru=require("vscode");var CG=k(N());var RI=class{activate(){let e=ve.instance.get(M),t=new xr;e.push(t),e.push(Ru.commands.registerCommand("jupyter.manageAccessToKernels",()=>Gfe(t)))}};RI=v([(0,CG.injectable)()],RI);async function Gfe(n){let e=await Gj(),t=[];Array.from(e.entries()).forEach(([s])=>{let a=Ru.extensions.getExtension(s)?.packageJSON?.displayName;a&&t.push({label:a,description:s,extensionId:s})});let r=[];n.add({dispose:()=>{r=z(r)}});let i=Ru.window.createQuickPick();i.title=Ru.l10n.t("Manage Access To Jupyter Kernels"),i.placeholder=Ru.l10n.t("Choose which extensions can access Jupyter Kernels"),i.items=t,i.selectedItems=t.filter(s=>e.get(s.extensionId)===!0),i.canSelectMany=!0,i.ignoreFocusOut=!1;let o=!1;r.push(i),i.show(),await Promise.race([uC(i.onDidAccept,void 0,r).then(()=>o=!0),uC(i.onDidHide,void 0,r)]),o&&(await zj(i.selectedItems.map(s=>s.extensionId)),r=z(r))}var PG=require("vscode");var r1=class{constructor(){this.cache=new Map;this.executionCount=0}getResults(e,t){return this.executionCount!==e&&(this.cache.clear(),this.executionCount=e),this.cache.get(t)}setResults(e,t,r){if(this.executionCount<e)this.cache.clear(),this.executionCount=e;else if(this.executionCount>e)return;this.cache.set(t,r)}},EG=r1,wG=r1;var jf=k(N());var AI=class{constructor(e,t){this.variables=e;this.kernelProvider=t;this.variableResultCache=new EG;this.variableSummaryCache=new wG;this.runningKernels=new Set;this._onDidChangeVariables=new PG.EventEmitter;this.onDidChangeVariables=this._onDidChangeVariables.event;this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this)}onKernelStatusChanged({kernel:e}){if("variableProvider"in e.controller&&e.controller.variableProvider!==this)return;let t=e.notebook.uri.toString(),r=this.runningKernels.has(t);e.status==="idle"&&!r?this.runningKernels.add(t):e.status!=="busy"&&e.status!=="idle"&&r&&(this.runningKernels.delete(t),this._onDidChangeVariables.fire(e.notebook))}_getVariableResultCacheKey(e,t,r){let i="",o=t;return o&&(i=`${o.name}.${o.propertyChain.join(".")}[[${r}`),`${e}:${i}`}async*provideVariables(e,t,r,i,o){if(o.isCancellationRequested)return;let s=this.kernelProvider.get(e);if(!s||s.status==="dead"||s.status==="terminating")return;let a=this.kernelProvider.getKernelExecution(s).executionCount,l=this._getVariableResultCacheKey(e.uri.toString(),t,i),c=this.variableResultCache.getResults(a,l);if(t){let u=t;if(!c&&u.getChildren)c=(await u.getChildren(i,o)).map(f=>this.createVariableResult(f,s)),this.variableResultCache.setResults(a,l,c);else if(!c)return;for(let d of c)yield d;if(r===2&&u.count&&c.length>0&&u.count>i+c.length)for await(let d of this.provideVariables(e,t,r,i+c.length,o))yield d}else{c||(c=(await this.variables.getAllVariableDiscriptions(s,void 0,i,o)).map(d=>this.createVariableResult(d,s)),this.variableResultCache.setResults(a,l,c));for(let u of c)yield u}}_getVariableSummaryCacheKey(e,t){return`${e}:${t.name}`}async*provideVariablesWithSummarization(e,t,r,i,o){let s=this.kernelProvider.get(e),a=this.provideVariables(e,t,r,i,o);for await(let l of a)if(s&&s.status!=="dead"&&s.status!=="terminating"){let c=this._getVariableSummaryCacheKey(e.uri.toString(),l.variable),u=this.kernelProvider.getKernelExecution(s).executionCount,d=this.variableSummaryCache.getResults(u,c);d==null&&l.variable.type==="pandas.core.frame.DataFrame"&&(d=await this.variables.getVariableValueSummary({name:l.variable.name,value:l.variable.value,supportsDataExplorer:!1,type:l.variable.type??"",size:0,count:0,shape:"",truncated:!0},s,o),this.variableSummaryCache.setResults(u,c,d??null)),yield{hasNamedChildren:l.hasNamedChildren,indexedChildrenCount:l.indexedChildrenCount,variable:{name:l.variable.name,value:l.variable.value,expression:l.variable.expression,type:l.variable.type,language:l.variable.language,summary:d??""}}}}createVariableResult(e,t){let r=e.count??0,i=!!e.hasNamedChildren,o={getChildren:(s,a)=>this.getChildren(o,s,t,a),expression:zfe(e.root,e.propertyChain),...e};return{variable:o,hasNamedChildren:i,indexedChildrenCount:r}}async getChildren(e,t,r,i){let o=e;return await this.variables.getAllVariableDiscriptions(r,o,t,i)}};AI=v([(0,jf.injectable)(),m(0,(0,jf.inject)(yn)),m(0,(0,jf.named)(Je.KERNEL_VARIABLES)),m(1,(0,jf.inject)(we))],AI);function zfe(n,e){let t=n;for(let r of e)typeof r=="string"?t+=`.${r}`:t+=`[${r}]`;return t}var Au=k(N()),n1=require("vscode");var Qfe=/Type:\s*(\w+)/,Yfe=/Value:\s*(.*)/,Xfe=/String form:\s*([\s\S]+?)\n/,Zfe=/Docstring:\s*(.*)/,ehe=/Length:\s+(.*)/,the=/^\s+\[(\d+) rows x (\d+) columns\]/m,rhe=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]),NI=class{constructor(e,t,r,i){this.configService=e;this.disposables=r;this.kernelProvider=i;this.variableRequesters=new Map;this.cachedVariables=new Map;this.refreshEventEmitter=new n1.EventEmitter;this.variableRequesters.set(ge,t)}get refreshRequired(){return this.refreshEventEmitter.event}async getAllVariableDiscriptions(e,t,r,i){let o=uo(e.kernelConnectionMetadata)||ge,s=this.variableRequesters.get(o);return s?s.getAllVariableDiscriptions(e,t,r,i):[]}async getVariables(e,t){return this.getVariablesBasedOnKernel(t,e)}async getMatchingVariable(e,t,r){let i=this.cachedVariables.get(t.uri.toString());if(i){let o=i.variables.find(s=>s.name===e);return o&&!o.value&&(o=await this.getVariableValueFromKernel(o,t,r)),o}else{let o=await this.getVariableNamesAndTypesFromKernel(t,r);if(o){let s=o.find(a=>a.name===e);if(s)return this.getVariableValueFromKernel({name:e,value:void 0,supportsDataExplorer:!1,type:s.type,fullType:s.fullType,size:0,count:0,shape:"",truncated:!0},t,r)}}}async getVariableValueSummary(e,t,r){if(!t)return;let i=uo(t?.kernelConnectionMetadata)||ge,o=this.variableRequesters.get(i);if(o)return o.getVariableValueSummary(e,t,r)}async getDataFrameInfo(e,t,r,i){if(!t)return e;let o=uo(t?.kernelConnectionMetadata)||ge,s=this.variableRequesters.get(o);if(s){i&&(e=await this.getFullVariable(e,t));let a=e.name;return r&&(a=`${e.name}${r}`),s.getDataFrameInfo(e,t,a)}return e}async getDataFrameRows(e,t,r,i,o){let s=uo(i?.kernelConnectionMetadata)||ge,a=this.variableRequesters.get(s);if(a){let l=e.name;return o&&(l=`${e.name}${o}`),a.getDataFrameRows(t,r,i,l)}return{data:[]}}async getFullVariable(e,t,r){let i=uo(t?.kernelConnectionMetadata)||ge,o=this.variableRequesters.get(i);return o?o.getFullVariable(e,t,r):e}async getVariablesBasedOnKernel(e,t){let r=this.cachedVariables.get(e.uri.toString()),i=this.kernelProvider.getKernelExecution(e).pendingCells.length>0,o=this.kernelProvider.getKernelExecution(e);(!r||!i&&(r.currentExecutionCount!==t.executionCount||r.currentExecutionCount!==o.executionCount))&&(r={currentExecutionCount:o.executionCount,variables:(await this.getVariableNamesAndTypesFromKernel(e)).map(l=>({name:l.name,value:void 0,supportsDataExplorer:!1,type:l.type,fullType:l.fullType,size:0,shape:"",count:0,truncated:!0,fileName:e.notebook.uri}))});let s=this.configService.getSettings(e.resourceUri).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],a={executionCount:o.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(r){let l=t.sortColumn,c=(f,g)=>{let b=f[l]?f[l]:"",I=g[l]?g[l]:"";return t.sortAscending?b.localeCompare(I,void 0,{sensitivity:"base"}):I.localeCompare(b,void 0,{sensitivity:"base"})};r.variables.sort(c);let u=t.startIndex?t.startIndex:0,d=t.pageSize?t.pageSize:100;a.pageStartIndex=u;for(let f=u;f<u+d&&f<r.variables.length;){if(s&&s.indexOf(r.variables[f].type)>=0){r.variables.splice(f,1);continue}let g=typeof r.variables[f].value=="string"?r.variables[f]:await this.getVariableValueFromKernel(r.variables[f],e);r.variables[f]=g,a.pageResponse.push(g),f+=1}this.cachedVariables.set(e.uri.toString(),r),a.totalCount=r.variables.length}return a}async getVariableProperties(e,t,r){let i=await this.getMatchingVariable(e,t,r),o=uo(t.kernelConnectionMetadata)||ge,s=this.variableRequesters.get(o);return s?s.getVariableProperties(e,r,i):{}}async getVariableNamesAndTypesFromKernel(e,t){let r=uo(e.kernelConnectionMetadata)||ge,i=this.variableRequesters.get(r);return i?i.getVariableNamesAndTypesFromKernel(e,t):[]}inspect(e,t,r=0,i){let o=re();try{e.requestInspect({code:t,cursor_pos:r,detail_level:0}).then(s=>{s&&s.content.status==="ok"?o.resolve(s.content.data):o.resolve(void 0)}).catch(s=>{o.reject(s)})}catch(s){o.reject(s)}return i&&this.disposables.push(i.onCancellationRequested(()=>o.reject(new n1.CancellationError))),o.promise}async getVariableValueFromKernel(e,t,r){let i={...e};if(!t.disposed&&t.session?.kernel){let o=await this.inspect(t.session.kernel,e.name,0,r);if(o&&o.hasOwnProperty("text/plain")){let s=Xl(o["text/plain"].toString()),a=Qfe.exec(s),l=ehe.exec(s),c=the.exec(s);a&&(i.type=a[1]),i.value=[Yfe,Xfe,Zfe].reduce((u,d)=>u||d.exec(s)?.[1]||"",""),l&&(i.count=parseInt(l[1],10)),c&&(i.shape=`(${c[1]}, ${c[2]})`)}o&&o.type&&(i.type=o.type.toString()),o&&o.value&&(i.value=o.value.toString()),rhe.has(i.type)&&(i.supportsDataExplorer=!0)}return i.type&&i.count&&!i.shape&&nt(t.kernelConnectionMetadata)&&i.supportsDataExplorer&&i.type!=="list"&&(i=await this.getFullVariable(i,t)),i}};NI=v([(0,Au.injectable)(),m(0,(0,Au.inject)(ie)),m(1,(0,Au.inject)(lT)),m(1,(0,Au.named)(Je.PYTHON_VARIABLES_REQUESTER)),m(2,(0,Au.inject)(M)),m(3,(0,Au.inject)(we))],NI);var dw=k(N());var MI=class extends qe{constructor(){super("unknown",y.jupyterDataRateExceeded)}};async function i1(n,{code:e,initializeCode:t,cleanupCode:r},i){if(n.disposed||n.disposing||!n.session?.kernel||!n.session.kernel||n.session.isDisposed)return[];try{return t&&await mn(n.session.kernel,t,i),await mn(n.session.kernel,e,i)}catch(o){if(o instanceof pn)return[];throw o}finally{r&&await mn(n.session.kernel,r,i)}}var KI=class{constructor(e,t){this.varScriptGenerator=e;this.dfScriptGenerator=t}async getDataFrameInfo(e,t,r){let{code:i,cleanupCode:o,initializeCode:s}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!1,variableName:r}),a=await i1(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameInfo",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"}),l=t.notebook?.uri||t.resourceUri||t.uri;return{...e,...this.deserializeJupyterResult(a),fileName:l}}async getDataFrameRows(e,t,r,i){let{code:o,cleanupCode:s,initializeCode:a}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!1,variableName:i,startIndex:e,endIndex:t}),l=await i1(r,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameRows",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return l.length===0?{data:[]}:HT(this.deserializeJupyterResult(l))}async getVariableProperties(e,t,r){let i={};return r&&r.value&&(i[`${e}`]=r.value),i}async getVariableValueSummary(e,t,r){let i=await this.varScriptGenerator.generateCodeToGetVariableValueSummary(e.name);try{return(await Tu(t,i.split(/\r?\n/),r))?.summary}catch(o){p.warn(`Exception when getting variable summary for variable "${e.name}": ${o.message}`);return}}async getAllVariableDiscriptions(e,t,r,i){if(!e.session)return[];let o=t?{root:t.root,propertyChain:t.propertyChain,startIndex:r}:void 0,s=await this.varScriptGenerator.generateCodeToGetAllVariableDescriptions(o),a=await Tu(e,s.split(/\r?\n/),i);if(e.disposed||e.disposing||i?.isCancellationRequested||!a)return[];try{return a}catch(l){return p.error(l),[]}}async getVariableNamesAndTypesFromKernel(e,t){if(e.session){let{code:r,cleanupCode:i,initializeCode:o}=await this.varScriptGenerator.generateCodeToGetVariableTypes({isDebugging:!1}),s=await i1(e,{code:r,cleanupCode:i,initializeCode:o},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getVariableNamesAndTypesFromKernel",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing)return[];let a=this.deserializeJupyterResult(s),l=[];for(let c of a){let u={...c,value:void 0,supportsDataExplorer:!1,size:0,shape:"",count:0,truncated:!0};l.push(u)}return l}return[]}async getFullVariable(e,t,r){let{code:i,cleanupCode:o,initializeCode:s}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!1,variableName:e.name}),a=await i1(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getFullVariable",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return{...e,...this.deserializeJupyterResult(a)}}extractJupyterResultText(e){if(e.length>0){let t=e[0];if(t&&t.output_type==="stream"&&t.name==="stderr"&&t.hasOwnProperty("text")){let r=t.text;if(r.includes("iopub_data_rate_limit"))throw new MI;{let i=y.jupyterGetVariablesExecutionError(r);throw p.error(i),new Error(i)}}if(t&&t.output_type==="execute_result"){let r=t.data;if(r&&r.hasOwnProperty("text/plain"))return r["text/plain"]}if(t&&t.output_type==="stream"&&t.hasOwnProperty("text"))return t.text;if(t&&t.output_type==="error"&&t.hasOwnProperty("traceback")){let i=t.traceback.map(Xl).join(`\r
`),o=y.jupyterGetVariablesExecutionError(i);throw p.error(o),new Error(o)}}throw new Error(y.jupyterGetVariablesBadResults)}deserializeJupyterResult(e){let t=this.extractJupyterResultText(e);return JSON.parse(t)}};KI=v([(0,dw.injectable)(),m(0,(0,dw.inject)(Oh)),m(1,(0,dw.inject)(Fh))],KI);var gc=k(N());var OI=class{constructor(e,t,r,i,o,s,a){this.activationService=e;this.jupyterInterpreterService=t;this.disposables=r;this.extensionChecker=i;this.apiProvider=o;this.rawNotebookSupported=s;this.condaService=a}activate(){this.rawNotebookSupported.isSupported||(this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(()=>this.preWarmInterpreterVariables().catch(h))),this.preWarmInterpreterVariables().catch(h),this.apiProvider.onDidActivatePythonExtension(this.preWarmInterpreterVariables,this,this.disposables)),this.extensionChecker.isPythonExtensionInstalled&&(this.condaService.getCondaFile().catch(h),this.condaService.getCondaVersion().catch(h))}async preWarmInterpreterVariables(){if(!this.extensionChecker.isPythonExtensionActive)return;let e=await this.jupyterInterpreterService.getSelectedInterpreter();e&&this.activationService.getActivatedEnvironmentVariables(void 0,e).catch(h)}};OI=v([(0,gc.injectable)(),m(0,(0,gc.inject)(Ps)),m(1,(0,gc.inject)(si)),m(2,(0,gc.inject)(M)),m(3,(0,gc.inject)($e)),m(4,(0,gc.inject)(Qt)),m(5,(0,gc.inject)(ai)),m(6,(0,gc.inject)(Ds))],OI);function kG(n,e,t){e.addSingleton(me,vI),e.addSingleton(me,Uf),e.addSingleton(me,mI),e.addSingleton(me,hI),e.addSingleton(me,gI),e.addSingleton(me,_I),e.addSingleton(me,kI),e.add(fg,uI),e.add(Uk,dI),e.addSingleton(me,pI),e.addSingleton(me,DI),e.addSingleton(DF,fc),e.addBinding(DF,me),e.add(qk,bI),e.addSingleton($k,yI),e.addSingleton(_u,_u),e.addSingleton(me,CI),hG(e),X4(n,t),e.addSingleton(me,PI),e.addSingleton(me,TI),e.addSingleton(me,RI),e.addSingleton(cT,AI),e.addSingleton(yn,NI,Je.KERNEL_VARIABLES),e.addSingleton(lT,KI,Je.PYTHON_VARIABLES_REQUESTER),e.addSingleton(me,OI)}var vc=k(N()),To=require("vscode");var o1=class{constructor(e,t,r){this.disposedCallback=r,this.callback=e,this.viewChanged=t}dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged(e)}};var xG=1e3,nhe;(t=>(t.Fetching="fetching",t.Skipped="skipped"))(nhe||={});var ss;(f=>(f.Started="started",f.UpdateSettings="update_settings",f.InitializeData="init",f.GetAllRowsRequest="get_all_rows_request",f.GetAllRowsResponse="get_all_rows_response",f.GetRowsRequest="get_rows_request",f.GetRowsResponse="get_rows_response",f.CompletedData="complete",f.GetSliceRequest="get_slice_request",f.RefreshDataViewer="refresh_data_viewer",f.SliceEnablementStateChanged="slice_enablement_state_changed",f.DeprecationWarningClicked="deprecation_warning_clicked"))(ss||={});var FI=Symbol("IDataViewerFactory"),s1=Symbol("IDataViewer"),a1=Symbol("IJupyterVariableDataProvider"),l1=Symbol("IJupyterVariableDataProviderFactory"),LI=Symbol("IDataViewerDependencyService");var UF;function WF(n,e){return UF&&UF.hasOwnProperty(n)?UF[n]:e}function VF(n,...e){return n.replace(/{(\d+)}/g,(t,r)=>e[r]===void 0?t:e[r])}var ihe=/^\s*((?<StartRange>-?\d+:)|(?<StopRange>-?:\d+)|(?:(?<Start>-?\d+)(?::(?<Stop>-?\d+))?(?::(?<Step>-?\d+))?))\s*$/;function jF(n){let e=n.length-2;return"["+n.map(()=>e>0?(e-=1,"0"):":").join(", ")+"]"}function ohe(n,e){if(n.startsWith("[")&&n.endsWith("]")){let t,r=n.substring(1,n.length-1).split(",").map((i,o)=>{let s=ihe.exec(i);if(s?.groups?.Start&&!s.groups.Stop){let a=parseInt(s.groups.Start),l=e[o];return(a>=0&&a>=l||a<0&&a<-l)&&(t={shapeIndex:o,value:a}),a}});if(t){let{shapeIndex:i,value:o}=t,s=WF("sliceIndexError","Index {0} out of range for axis {1} with {2} elements");return VF(s,o.toString(),i.toString(),e[i].toString())}else if(r&&r.length!==e.length){let i=WF("sliceMismatchedAxesError","Expected {0} axes, got {1} in slice expression");return VF(i,e.length.toString(),r.length.toString())}}return""}function DG(n,e){return ohe(n,e)===""}var Mu=require("vscode");var Nu=class{constructor(e,t,r){this.configService=e;this.rootPath=t;this.scripts=r;this.disposed=!1;this.themeIsDarkPromise=re();this.webviewInit=re();this._disposables=[];this.onMessageListeners=[];this._onDidDisposeWebviewPanel=new Mu.EventEmitter;this.onDataScienceSettingsChanged=async()=>{let e=JSON.stringify(await this.generateDataScienceExtraSettings());this.postMessageInternal("update_settings",e).catch(h)};this.onWebViewLoadFailed=async()=>{this.dispose()};this.onPossibleSettingsChange=async e=>{if(e.affectsConfiguration("workbench.colorTheme")||e.affectsConfiguration("editor.fontSize")||e.affectsConfiguration("editor.fontFamily")||e.affectsConfiguration("editor.cursorStyle")||e.affectsConfiguration("editor.cursorBlinking")||e.affectsConfiguration("editor.autoClosingBrackets")||e.affectsConfiguration("editor.autoClosingQuotes")||e.affectsConfiguration("editor.autoSurround")||e.affectsConfiguration("editor.autoIndent")||e.affectsConfiguration("editor.scrollBeyondLastLine")||e.affectsConfiguration("editor.fontLigatures")||e.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")||e.affectsConfiguration("editor.scrollbar.horizontalScrollbarSize")||e.affectsConfiguration("files.autoSave")||e.affectsConfiguration("files.autoSaveDelay")||e.affectsConfiguration("jupyter.widgetScriptSources")){let t=await this.generateDataScienceExtraSettings();if(t){let r=JSON.stringify(t);this.postMessageInternal("update_settings",r).catch(h)}}};this._disposables.push(Mu.workspace.onDidChangeConfiguration(this.onPossibleSettingsChange,this)),this._disposables.push(this.configService.getSettings(void 0).onDidChange(this.onDataScienceSettingsChanged.bind(this)))}get onDidDispose(){return this._onDidDisposeWebviewPanel.event}dispose(){this.disposed||(this.disposed=!0,this._disposables.forEach(e=>e.dispose())),this.webviewInit=void 0,this._onDidDisposeWebviewPanel.fire()}getHTMLById(e){if(!this.activeHTMLRequest)this.activeHTMLRequest=re(),this.postMessageInternal("get_html_by_id_request",e).catch(h);else throw new Error("getHTMLById request already in progress");return this.activeHTMLRequest.promise}addMessageListener(e){this.onMessageListeners.push(e)}removeMessageListener(e){let t=this.onMessageListeners.indexOf(e);t>=0&&this.onMessageListeners.splice(t,1)}asWebviewUri(e){if(!this.webview)throw new Error("asWebViewUri called too early");return this.webview?.asWebviewUri(e)}postMessage(e,t){return this.postMessageInternal(e.toString(),t)}onMessage(e,t){switch(e){case"started":this.webViewRendered();break;case"get_html_by_id_response":this.activeHTMLRequest&&(this.activeHTMLRequest.resolve(t),this.activeHTMLRequest=void 0);break;default:break}this.onMessageListeners.forEach(r=>{r(e,t)})}async loadWebview(e,t){if(this.disposed=!1,this.webviewInit=this.webviewInit||re(),this.webview===void 0){let r=await this.generateDataScienceExtraSettings(),i=Mu.workspace.getWorkspaceFolder(e)?.uri;this.webview=await this.provideWebview(e,r,i,t),this._disposables.push(this.webview.loadFailed(this.onWebViewLoadFailed,this))}this.onDataScienceSettingsChanged().catch(h),this.sendLocStrings().catch(h)}async generateDataScienceExtraSettings(){let e=this.owningResource,t=Mu.workspace.getConfiguration("editor"),r=Mu.workspace.getConfiguration("workbench"),i=r?r.get("colorTheme",UR):UR,o=Mu.extensions.getExtension(Zn);return{...JSON.parse(JSON.stringify(this.configService.getSettings(e))),extraSettings:{editor:{cursor:this.getValue(t,"cursorStyle","line"),cursorBlink:this.getValue(t,"cursorBlinking","blink"),autoClosingBrackets:this.getValue(t,"autoClosingBrackets","languageDefined"),autoClosingQuotes:this.getValue(t,"autoClosingQuotes","languageDefined"),autoSurround:this.getValue(t,"autoSurround","languageDefined"),autoIndent:this.getValue(t,"autoIndent",!1),fontLigatures:this.getValue(t,"fontLigatures",!1),scrollBeyondLastLine:this.getValue(t,"scrollBeyondLastLine",!0),verticalScrollbarSize:this.getValue(t,"scrollbar.verticalScrollbarSize",14),horizontalScrollbarSize:this.getValue(t,"scrollbar.horizontalScrollbarSize",10),fontSize:this.getValue(t,"fontSize",14),fontFamily:this.getValue(t,"fontFamily","Consolas, 'Courier New', monospace")},theme:i,hasPythonExtension:o!==void 0,isWeb:Kr()==="Unknown"}}}async sendLocStrings(){let e={collapseSingle:Nt.collapseSingle,expandSingle:Nt.expandSingle,openExportFileYes:y.openExportFileYes,openExportFileNo:y.openExportFileNo,noRowsInDataViewer:Nt.noRowsInDataViewer,sliceIndexError:Nt.sliceIndexError,sliceMismatchedAxesError:Nt.sliceMismatchedAxesError,filterRowsTooltip:Nt.sliceMismatchedAxesError,fetchingDataViewer:Nt.fetchingDataViewer,dataViewerHideFilters:Nt.dataViewerHideFilters,dataViewerShowFilters:Nt.dataViewerShowFilters,refreshDataViewer:Nt.refreshDataViewer,clearFilters:Nt.refreshDataViewer,sliceSummaryTitle:Nt.sliceSummaryTitle,sliceData:Nt.sliceData,sliceSubmitButton:Nt.sliceSubmitButton,sliceDropdownAxisLabel:Nt.sliceDropdownAxisLabel,sliceDropdownIndexLabel:Nt.sliceDropdownIndexLabel,variableExplorerNameColumn:Nt.variableExplorerNameColumn,variableExplorerTypeColumn:Nt.variableExplorerTypeColumn,variableExplorerCountColumn:Nt.variableExplorerCountColumn,variableExplorerValueColumn:Nt.variableExplorerValueColumn,collapseVariableExplorerLabel:Nt.collapseVariableExplorerLabel,variableLoadingValue:Nt.variableLoadingValue,showDataExplorerTooltip:Nt.showDataExplorerTooltip,noRowsInVariableExplorer:Nt.noRowsInVariableExplorer,loadingRowsInVariableExplorer:Nt.loadingRowsInVariableExplorer,previousPlot:Nt.previousPlot,nextPlot:Nt.nextPlot,panPlot:Nt.panPlot,zoomInPlot:Nt.zoomInPlot,zoomOutPlot:Nt.zoomOutPlot,exportPlot:Nt.exportPlot,deletePlot:Nt.deletePlot,selectedImageListLabel:Nt.selectedImageListLabel,selectedImageLabel:Nt.selectedImageLabel,dvDeprecationWarning:Nt.dvDeprecationWarning};this.postMessageInternal("loc_init",JSON.stringify(e)).catch(h)}async postMessageInternal(e,t){this.webviewInit&&(await this.webviewInit.promise,this.webview?.postMessage({type:e.toString(),payload:t}))}webViewRendered(){this.webviewInit&&!this.webviewInit.resolved&&this.webviewInit.resolve(),this.sendLocStrings().catch(h),this.onDataScienceSettingsChanged().catch(h)}getValue(e,t,r){return e?e.get(t,r):r}};v([gh()],Nu.prototype,"getHTMLById",1),v([gh()],Nu.prototype,"addMessageListener",1),v([gh()],Nu.prototype,"removeMessageListener",1);var UI=class extends Nu{constructor(t,r,i,o,s,a,l){super(t,o,s);this.configService=t;this.provider=r;this._title=a;this.viewColumn=l;this.viewState={visible:!1,active:!1};this.webPanelViewStateChanged=t=>{let r=t.isVisible(),i=t.isActive(),o={visible:r,active:i},s={visible:this.viewState.visible,active:this.viewState.active};this.viewState.visible=r,this.viewState.active=i,this.onViewStateChanged({current:o,previous:s})};this.messageListener=i(this.onMessage.bind(this),this.webPanelViewStateChanged.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webPanel(){if(this.webview)return this.webview}async show(t){this.isDisposed||this.webPanel&&await this.webPanel.show(t)}dispose(){this.isDisposed||this.webPanel&&this.webPanel.close(),super.dispose()}get title(){return this._title}setTitle(t){this._title=t,!this.isDisposed&&this.webPanel&&this.webPanel.setTitle(t)}onViewStateChanged(t){}async provideWebview(t,r,i,o){return this.provider.create({viewColumn:this.viewColumn,listener:this.messageListener,title:this.title,rootPath:this.rootPath,scripts:this.scripts,settings:r,cwd:t,webviewHost:o,additionalPaths:i?[i]:[]})}};var _G="JupyterDataViewerPreferredViewColumn",Jf=class extends UI{constructor(t,r,i,o,s){let a=zt(s.extensionUri,"dist","webviews","webview-side","viewers");super(r,t,(l,c,u)=>new o1(l,c,u),a,[zt(a,"dataExplorer.js")],y.dataExplorerTitle,i.get(_G)??To.ViewColumn.One);this.globalMemento=i;this.errorHandler=o;this.context=s;this.pendingRowsCount=0;this.sentDataViewerSliceDimensionalityTelemetry=!1;this._onDidDisposeDataViewer=new To.EventEmitter;this._onDidChangeDataViewerViewState=new To.EventEmitter;this.onDidDispose(this.dataViewerDisposed,this)}get active(){return!!this.webPanel?.isActive()}get refreshPending(){return this.pendingRowsCount>0}get onDidDisposeDataViewer(){return this._onDidDisposeDataViewer.event}get onDidChangeDataViewerViewState(){return this._onDidChangeDataViewerViewState.event}async showData(t,r){if(!this.isDisposed){this.dataProvider=t,await super.loadWebview(To.Uri.file(process.cwd())).catch(p.error),super.setTitle(r),await super.show(!0);let i=await this.prepDataFrameInfo();if(i.shape&&i.shape.length>2){this.maybeSendSliceDataDimensionalityTelemetry(i.shape.length);let o=jF(i.shape);i=await this.getDataFrameInfo(o)}this.postMessage(ss.InitializeData,i).catch(h)}}get kernel(){if(this.dataProvider&&"kernel"in this.dataProvider)return this.dataProvider.kernel}dataViewerDisposed(){this._onDidDisposeDataViewer.fire(this)}async refreshData(){let t=this.currentSliceExpression;this.dataFrameInfoPromise=void 0;let r=await this.getDataFrameInfo(void 0,!0);if(t!==void 0&&r.shape!==void 0)if(DG(t,r.shape))r=await this.getDataFrameInfo(t);else{let i=jF(r.shape);r=await this.getDataFrameInfo(i)}p.info(`Refreshing data viewer for variable ${r.name}`),this.postMessage(ss.InitializeData,r).catch(h)}dispose(){super.dispose(),this.dataProvider&&(this.dataProvider.dispose(),this.dataProvider=void 0)}async onViewStateChanged(t){t.current.active&&t.current.visible&&t.previous.active&&t.current.visible&&await this.globalMemento.update(_G,this.webPanel?.viewColumn),this._onDidChangeDataViewerViewState.fire()}get owningResource(){}onMessage(t,r){switch(t){case ss.GetAllRowsRequest:this.getAllRows(r).catch(h);break;case ss.GetRowsRequest:this.getRowChunk(r).catch(h);break;case ss.GetSliceRequest:this.getSlice(r).catch(h);break;case ss.RefreshDataViewer:this.refreshData().catch(h),R("DATASCIENCE.REFRESH_DATA_VIEWER");break;case ss.SliceEnablementStateChanged:R("DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",void 0,{newState:r.newState?"checked":"unchecked"});break;case ss.DeprecationWarningClicked:To.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(h,h);break;default:break}super.onMessage(t,r)}getDataFrameInfo(t,r){return(!this.dataFrameInfoPromise||t!==this.currentSliceExpression)&&(this.dataFrameInfoPromise=this.dataProvider?this.dataProvider.getDataFrameInfo(t,r):Promise.resolve({}),this.currentSliceExpression=t),this.dataFrameInfoPromise}async prepDataFrameInfo(){this.rowsTimer=new Fe;let t=await this.getDataFrameInfo();try{R("DATASCIENCE.SHOW_DATA_EXPLORER",void 0,{rows:t.rowCount?t.rowCount:0,columns:t.columns?t.columns.length:0}),this.pendingRowsCount=t.rowCount?t.rowCount:0}catch{}return t}async getAllRows(t){return this.wrapRequest(async()=>{if(this.dataProvider){let r=await this.dataProvider.getAllRows(t);return this.pendingRowsCount=0,this.postMessage(ss.GetAllRowsResponse,r)}})}getSlice(t){return this.wrapRequest(async()=>{if(this.dataProvider){let r=await this.getDataFrameInfo(t.slice);return r.shape?.length&&this.maybeSendSliceDataDimensionalityTelemetry(r.shape.length),R("DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",void 0,{source:t.source}),this.postMessage(ss.InitializeData,r)}})}getRowChunk(t){return this.wrapRequest(async()=>{if(this.dataProvider){let r=await this.getDataFrameInfo(t.sliceExpression),i=await this.dataProvider.getRows(t.start,Math.min(t.end,r.rowCount?r.rowCount:0),t.sliceExpression);return this.pendingRowsCount=Math.max(0,this.pendingRowsCount-i.length),this.postMessage(ss.GetRowsResponse,{rows:i,start:t.start,end:t.end})}})}async wrapRequest(t){try{return await t()}catch(r){if(r instanceof MI){p.error(r.message);let i=y.pythonInteractiveHelpLink;To.window.showErrorMessage(y.jupyterDataRateExceeded,i).then(o=>{o===i&&To.env.openExternal(To.Uri.parse(_S.JupyterDataRateHelpLink))},h),this.dispose()}p.error(r),this.errorHandler.handleError(r).then(h,h)}finally{this.sendElapsedTimeTelemetry()}}sendElapsedTimeTelemetry(){this.rowsTimer&&this.pendingRowsCount===0&&R("DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",void 0,{rowsTimer:this.rowsTimer.elapsedTime})}maybeSendSliceDataDimensionalityTelemetry(t){this.sentDataViewerSliceDimensionalityTelemetry||(R("DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",{numberOfDimensions:t}),this.sentDataViewerSliceDimensionalityTelemetry=!0)}};v([cr("DATAVIEWER.WEBVIEW_LOADED")],Jf.prototype,"showData",1),Jf=v([(0,vc.injectable)(),m(0,(0,vc.inject)(kd)),m(1,(0,vc.inject)(ie)),m(2,(0,vc.inject)(Le)),m(2,(0,vc.named)(ut)),m(3,(0,vc.inject)(Br)),m(4,(0,vc.inject)(Ze))],Jf);var Rr=k(N()),Ro=require("vscode");var u1=require("vscode");var c1=class{constructor(e){this.configuration=e}async isRequestedColumnSizeAllowed(e,t){if(e>xG&&await this.shouldAskForLargeData(t)){let r=y.tooManyColumnsMessage,i=y.tooManyColumnsYes,o=y.tooManyColumnsNo,s=y.tooManyColumnsDontAskAgain,a=await u1.window.showWarningMessage(r,i,o,s);return a===s&&await this.disableAskForLargeData(),a===i}return!0}async shouldAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();return t&&t.askForLargeDataFrames===!0}async disableAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();t&&(t.askForLargeDataFrames=!1,this.configuration.updateSetting("askForLargeDataFrames",!1,void 0,u1.ConfigurationTarget.Global).catch(h))}};var Wa=require("vscode");var TG=k(N());var Va=class{async showContributedDataViewer(e,t){try{let r=this.getMatchingExternalVariableViewers(e);if(r.length===0)return Wa.window.showInformationMessage(y.dataViewerExtensionRequired,{modal:!0},le.bannerLabelYes).then(i=>{i===le.bannerLabelYes&&Wa.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(h,h)});if(r.length===1){let i=r[0].jupyterVariableViewers.command;return p.info(`Showing data viewer with command ${i} for variable ${JSON.stringify({...e,value:"..."})}`),Wa.commands.executeCommand(i,e)}else{let i=r.filter(s=>s.extension.id!==Ae);if(i.length===1){let s=i[0].jupyterVariableViewers.command;return p.info(`Showing data viewer viewer with command ${s} for variable ${JSON.stringify({...e,value:"..."})}`),Wa.commands.executeCommand(s,e)}let o=Wa.window.createQuickPick();o.title=y.selectExternalDataViewer,o.items=r.map(s=>({label:s.jupyterVariableViewers.title,detail:s.extension.packageJSON?.displayName??s.extension.id,command:s.jupyterVariableViewers.command})),o.onDidAccept(async()=>{let s=o.selectedItems[0];if(s)return o.hide(),p.info(`Showing data viewer viewer with command ${s.command} for variable ${JSON.stringify({...e,value:"..."})}`),Wa.commands.executeCommand(s.command,e)}),o.show()}}catch(r){p.error(r),R("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",void 0,{reason:"exception",fromVariableView:t}),Wa.window.showErrorMessage(y.showDataViewerFail).then(h,h)}}getMatchingExternalVariableViewers(e){return this.getVariableViewers().filter(r=>!e.type||r.jupyterVariableViewers.dataTypes.includes(e.type)).filter(r=>r.extension.id!==Ae)}getVariableViewers(){return Wa.extensions.all.filter(t=>t.packageJSON?.contributes?.jupyterVariableViewers&&t.packageJSON?.contributes?.jupyterVariableViewers.length).map(t=>{let r=t.packageJSON?.contributes;return r?.jupyterVariableViewers?r.jupyterVariableViewers.map(i=>({extension:t,jupyterVariableViewers:i})):[]}).flat()}};Va=v([(0,TG.injectable)()],Va);var RG="ds_prompt_about_deprecation",WI=class{constructor(e,t,r,i,o,s,a,l,c,u,d,f,g,b,I){this.disposables=e;this.debugService=t;this.jupyterVariableDataProviderFactory=i;this.dataViewerFactory=o;this.variableProvider=s;this.errorHandler=a;this.dataViewerDependencyService=l;this.interpreterService=c;this.platformService=u;this.kernelProvider=d;this.interactiveWindowProvider=f;this.experimentService=g;this.globalMemento=b;this.dataViewerDelegator=I;this.dataViewerChecker=new c1(r),Ro.workspace.isTrusted||Ro.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){Ro.workspace.isTrusted&&(this.registerCommand(J.ShowDataViewer,this.delegateDataViewer),this.registerCommand(J.ShowJupyterDataViewer,this.delegateDataViewer))}registerCommand(e,t){let r=Ro.commands.registerCommand(e,t,this);this.disposables.push(r)}async delegateDataViewer(e){let t="variable"in e?await this.getVariableFromRequest(e):e;if(!t){p.error("Variable info could not be retreived"),R("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",void 0,{reason:"no variable info",fromVariableView:!1});return}return this.dataViewerDelegator.showContributedDataViewer(t,!1)}async getVariableFromRequest(e){if(this.variableProvider){let t=qT(e.variable);try{return await this.variableProvider.getFullVariable(t)}catch(r){return p.warn("Full variable info could not be retreived, will attempt with partial info.",r),t}}}async showJupyterVariableView(e){R("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX");let t=this.experimentService.inExperiment("DataViewerDeprecation");if(!this.globalMemento.get(RG)&&t&&(this.globalMemento.update(RG,!0).then(h,h),Ro.window.showInformationMessage(y.dataViewerDeprecationMessage,y.dataViewerDeprecationRecommendationActionMessage).then(r=>{r===y.dataViewerDeprecationRecommendationActionMessage&&Ro.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(h,h)},h)),this.debugService?.activeDebugSession&&this.variableProvider&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory)try{if(this.debugService.activeDebugSession.configuration&&this.dataViewerDependencyService&&this.interpreterService){let s=await this.getDebugAdapterPython(this.debugService.activeDebugSession.configuration);s&&await this.dataViewerDependencyService.checkAndInstallMissingDependencies(s)}let r=await this.jupyterVariableDataProviderFactory.create(e),o=(await r.getDataFrameInfo())?.columns?.length;if(o&&await this.dataViewerChecker.isRequestedColumnSizeAllowed(o)){let s=`${y.dataExplorerTitle} - ${e.name}`,a=await this.dataViewerFactory.create(r,s);return R("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX"),a}}catch(r){R("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",void 0,void 0,r),p.error(r),this.errorHandler.handleError(r).then(h,h)}else try{let r=this.getActiveKernel();if(r&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory){let i=await this.jupyterVariableDataProviderFactory.create(e,r),o=`${y.dataExplorerTitle} - ${e.name}`;return await this.dataViewerFactory.create(i,o)}}catch(r){p.error(r),R("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),Ro.window.showErrorMessage(y.showDataViewerFail).then(h,h)}}getActiveKernel(){let e=Ro.window.activeNotebookEditor?.notebook,t=e?.notebookType==bt?this.kernelProvider.get(e):void 0;if(t)return t;let r=this.getActiveInteractiveWindowDocument(),i=r?this.kernelProvider.get(r):void 0;if(i)return i;let o=this.dataViewerFactory?.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return Ro.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}async getDebugAdapterPython(e){if(!this.interpreterService){p.info("Interpreter Service missing when trying getDebugAdapterPython");return}let t="";if(e.debugAdapterPython!==void 0?(p.info("Found debugAdapterPython on Debug Configuration to use"),t=e.debugAdapterPython):e.pythonPath&&(p.info("Found pythonPath on Debug Configuration to use"),t=e.pythonPath),t){let r=t;return r.startsWith("~")&&this.platformService.homeDir&&(r=Ih(r,this.platformService.homeDir.path)),this.interpreterService.getInterpreterDetails(Ro.Uri.file(r))}else return this.interpreterService.getActiveInterpreter()}};WI=v([(0,Rr.injectable)(),m(0,(0,Rr.inject)(M)),m(1,(0,Rr.inject)(_i)),m(1,(0,Rr.optional)()),m(2,(0,Rr.inject)(ie)),m(3,(0,Rr.inject)(l1)),m(3,(0,Rr.optional)()),m(4,(0,Rr.inject)(FI)),m(4,(0,Rr.optional)()),m(5,(0,Rr.inject)(yn)),m(5,(0,Rr.named)(Je.DEBUGGER_VARIABLES)),m(6,(0,Rr.inject)(Br)),m(7,(0,Rr.inject)(LI)),m(7,(0,Rr.optional)()),m(8,(0,Rr.inject)(et)),m(8,(0,Rr.optional)()),m(9,(0,Rr.inject)(wr)),m(10,(0,Rr.inject)(we)),m(11,(0,Rr.inject)(zn)),m(12,(0,Rr.inject)(sd)),m(13,(0,Rr.inject)(Le)),m(13,(0,Rr.named)(ut)),m(14,(0,Rr.inject)(Va))],WI);var jI=k(N());var d1="0.20.0";var p1=require("vscode");var Bf=class{async getVersion(e,t){try{let r=await this._getVersion(e,t);return typeof r=="string"?ak(r):r}catch(r){p.warn(y.failedToGetVersionOfPandas,r.message);return}}async promptInstall(e,t,r){let i=r?y.pandasTooOldForViewingFormat(r,d1):y.pandasRequiredForViewing(d1);if((Hp()?le.install:await p1.window.showErrorMessage(i,{modal:!0},le.install))===le.install)await this._doInstall(e,t);else throw R("DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS"),new Error(i)}async checkOrInstall(e){let t=new p1.CancellationTokenSource;try{let r=await this.getVersion(e,t.token);if(t.token.isCancellationRequested){R("DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED");return}if(r){if(r.compare(d1)>0){R("DS_INTERNAL.SHOW_DATA_PANDAS_OK");return}R("DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD");let i=`${r.major}.${r.minor}.${r.build}`;await this.promptInstall(e,t,i)}R("DS_INTERNAL.SHOW_DATA_NO_PANDAS"),await this.promptInstall(e,t)}finally{t.dispose()}}};v([cr("DS_INTERNAL.PYTHON_MODULE_INSTALL",{action:"displayed",moduleName:ur.get(23)})],Bf.prototype,"promptInstall",1);var JF="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",she=`import pandas;print(pandas.__version__);print("${JF}")`,m1=class extends Bf{constructor(t,r,i){super();this.installer=t;this.pythonFactory=r;this.interpreterService=i}async _getVersion(t,r){let s=(await(await this.pythonFactory.createActivatedEnvironment({resource:void 0,interpreter:t})).exec(["-c",she],{token:r})).stdout;if(!s?.includes(JF))return p.warn(y.failedToGetVersionOfPandas,`Output is ${s}`),"";let a=Ue(s.trim()),l=a.indexOf(JF);return l>=0?a[l-1]:""}async _doInstall(t,r){let i=t||await this.interpreterService.getActiveInterpreter();if(r.token.isCancellationRequested)return;await tr(r.token,2,this.installer.install(23,i,r))===0&&R("DATASCIENCE.USER_INSTALLED_PANDAS")}async checkAndInstallMissingDependencies(t){R("DATAVIEWER.USING_INTERPRETER"),await this.checkOrInstall(t)}};var BF="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",ahe=`import pandas as _VSCODE_pandas;print(_VSCODE_pandas.__version__);print("${BF}"); del _VSCODE_pandas`;function lhe(n){return(n.kernelConnectionMetadata.interpreter&&Ve(n.kernelConnectionMetadata.interpreter))==="Conda"?"%conda":"%pip"}var f1=class extends Bf{async execute(e,t){if(!t.session?.kernel)throw new pn;let r=await mn(t.session.kernel,e),i=r.find(o=>o.output_type==="error");return i&&p.warn(y.failedToGetVersionOfPandas,i.message),r.map(o=>o.text?.toString())}async _getVersion(e){let r=(await this.execute(ahe,e)).map(s=>s?s.toString():void 0).find(s=>s);if(!r?.includes(BF))return p.warn(y.failedToGetVersionOfPandas,`Output is ${r}`),"";let i=Ue(r.trim()),o=i.indexOf(BF);return o>=0?i[o-1]:""}async _doInstall(e){let t=`${lhe(e)} install pandas`;try{await this.execute(t,e),R("DATASCIENCE.USER_INSTALLED_PANDAS")}catch(r){throw R("DATASCIENCE.USER_INSTALLED_PANDAS",void 0,void 0,r),new Error(y.failedToInstallPandas)}}async checkAndInstallMissingDependencies(e){if(R("DATAVIEWER.USING_KERNEL"),!e.session?.kernel)throw R("DATASCIENCE.NO_ACTIVE_KERNEL_SESSION"),new Error("No no active kernel session.");await this.checkOrInstall(e)}};var VI=class{constructor(e,t,r){this.withKernel=new f1,this.withInterpreter=new m1(e,t,r)}async checkAndInstallMissingDependencies(e){return"controller"in e?this.withKernel.checkAndInstallMissingDependencies(e):this.withInterpreter.checkAndInstallMissingDependencies(e)}};VI=v([(0,jI.injectable)(),m(0,(0,jI.inject)(Ai)),m(1,(0,jI.inject)(Fr)),m(2,(0,jI.inject)(et))],VI);var pw=k(N());var AG=require("vscode");var Lp=class{constructor(e,t){this.serviceContainer=e;this.disposables=t;this.knownViewers=new Set;t.push(this),this.viewContext=new ir(yr.IsDataViewerActive),this.disposables.push(AG.commands.registerCommand(J.RefreshDataViewer,this.refreshDataViewer,this))}dispose(){for(let e of this.knownViewers)e.dispose()}async create(e,t){let r,i=this.serviceContainer.get(s1);try{this.knownViewers.add(i),i.onDidDisposeDataViewer(this.updateOpenDataViewers,this,this.disposables),i.onDidChangeDataViewerViewState(this.updateViewStateContext,this,this.disposables),await i.showData(e,t),r=i}finally{r||i.dispose()}return r}get activeViewer(){return[...this.knownViewers.values()].find(e=>e.active)}updateOpenDataViewers(e){this.knownViewers.delete(e)}async updateViewStateContext(){let e=!1;this.knownViewers.forEach(t=>{t.active&&(e=!0)}),await this.viewContext.set(e)}refreshDataViewer(){for(let e of this.knownViewers)e.active&&e.refreshData().then(h,h)}};v([cr("DATASCIENCE.START_SHOW_DATA_EXPLORER")],Lp.prototype,"create",1),v([Sv(1e3)],Lp.prototype,"refreshDataViewer",1),Lp=v([(0,pw.injectable)(),m(0,(0,pw.inject)(st)),m(1,(0,pw.inject)(M))],Lp);var Ou=k(N());var Ku=class{constructor(e,t){this.variableManager=e;this.dependencyService=t;this.initialized=!1}get kernel(){return this._kernel}static getNormalizedColumns(e){return e.map(t=>{let r;switch(t.type){case"bool":r="bool";break;case"integer":case"int32":case"int64":case"float":case"float32":case"float64":case"number":r="number";break;default:r="string"}return{key:t.key,type:r}})}static parseShape(e){try{if(e.startsWith("(")&&e.endsWith(")"))return e.substring(1,e.length-1).split(",").map(t=>parseInt(t))}catch{p.error(`Could not parse IJupyterVariable with malformed shape: ${e}`)}}dispose(){}setDependencies(e,t){this._kernel=t,this.variable=e}async getDataFrameInfo(e,t){let r={};await this.ensureInitialized();let i=this.variable;return i&&((e||t)&&(i=await this.variableManager.getDataFrameInfo(i,this._kernel,e,t)),r={columns:i.columns?Ku.getNormalizedColumns(i.columns):i.columns,indexColumn:i.indexColumn,rowCount:i.rowCount,dataDimensionality:i.dataDimensionality,shape:Ku.parseShape(i.shape),sliceExpression:e,type:i.type,maximumRowChunkSize:i.maximumRowChunkSize,name:i.name,fileName:Re(i.fileName)}),t&&(this.variable=i),r}async getAllRows(e){let t=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(t=(await this.variableManager.getDataFrameRows(this.variable,0,this.variable.rowCount,this._kernel,e)).data),t}async getRows(e,t,r){let i=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(i=(await this.variableManager.getDataFrameRows(this.variable,e,t,this._kernel,r)).data),i}async ensureInitialized(){!this.initialized&&this.variable&&(this.initialized=!0,this._kernel?.kernelConnectionMetadata&&this.dependencyService&&await this.dependencyService.checkAndInstallMissingDependencies(Ha()?this._kernel:this._kernel?.kernelConnectionMetadata.interpreter||this._kernel),this.variable=await this.variableManager.getDataFrameInfo(this.variable,this._kernel))}};Ku=v([(0,Ou.injectable)(),m(0,(0,Ou.inject)(yn)),m(0,(0,Ou.named)(Je.ALL_VARIABLES)),m(1,(0,Ou.inject)(LI)),m(1,(0,Ou.optional)())],Ku);var h1=k(N());var JI=class{constructor(e){this.serviceContainer=e}async create(e,t){let r=this.serviceContainer.get(a1);return r.setDependencies(e,t),r}};JI=v([(0,h1.injectable)(),m(0,(0,h1.inject)(st))],JI);var $I=k(N()),g1=require("vscode");var BI=class{constructor(e,t,r){this.kernelProvider=e;this.controllers=t;this.ipywidgetMessageDispatcher=r;this.disposables=[];this.widgetOutputsPerNotebook=new WeakMap}dispose(){z(this.disposables)}activate(){let e=g1.notebooks.createRendererMessaging("jupyter-ipywidget-renderer");e.onDidReceiveMessage(this.onDidReceiveMessage.bind(this,e),this,this.disposables),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){this.hookupKernel(e),e.onStarted(()=>this.hookupKernel(e),this,this.disposables),e.onRestarted(()=>this.hookupKernel(e),this,this.disposables)}hookupKernel(e){this.widgetOutputsPerNotebook.delete(e.notebook);let t=e.session?.kernel,r=e.session?.kernel?.iopubMessage;if(!r)return;let i=this.ipywidgetMessageDispatcher.create(e.notebook);this.disposables.push(i.onDisplayMessage(a=>{this.trackModelId(e.notebook,a)}));let o=require("@jupyterlab/services"),s=(a,l)=>{a===t&&(o.KernelMessage.isDisplayDataMsg(l)||o.KernelMessage.isUpdateDisplayDataMsg(l)||o.KernelMessage.isExecuteReplyMsg(l)||o.KernelMessage.isExecuteResultMsg(l))&&this.trackModelId(e.notebook,l)};r.connect(s),this.disposables.push(new g1.Disposable(()=>r.disconnect(s)))}trackModelId(e,t){let r=t.content;if(r.data&&typeof r.data=="object"&&Li in r.data){let i=r.data[Li];if(i&&"model_id"in i){let o=this.widgetOutputsPerNotebook.get(e)||new Set;o.add(i.model_id),this.widgetOutputsPerNotebook.set(e,o)}}}onDidReceiveMessage(e,{editor:t,message:r}){r&&typeof r=="object"&&r.command==="query-widget-state"&&this.queryWidgetState(e,t,r),r&&typeof r=="object"&&r.command==="ipywidget-renderer-loaded"&&this.sendWidgetVersionAndState(e,t)}queryWidgetState(e,t,r){let i=this.widgetOutputsPerNotebook.get(t.notebook),o=!!this.controllers.getSelected(t.notebook),s=!!i?.has(r.model_id);e.postMessage({command:"query-widget-state",model_id:r.model_id,hasWidgetState:s,kernelSelected:o},t).then(h,h)}sendWidgetVersionAndState(e,t){let r=this.kernelProvider.get(t.notebook),i=r?.ipywidgetsVersion;r?.ipywidgetsVersion&&p.trace(`IPyWidget version in Kernel is ${r?.ipywidgetsVersion}.`);let o=!!this.controllers.getSelected(t.notebook);e.postMessage({command:"ipywidget-renderer-init",version:i,widgetState:void 0,kernelSelected:o},t).then(h,h)}};BI=v([(0,$I.injectable)(),m(0,(0,$I.inject)(we)),m(1,(0,$I.inject)(it)),m(2,(0,$I.inject)(_a))],BI);var qf=k(N());var $F=require("vscode");var $f=k(N());var yc=require("vscode");var v1=class{constructor(e,t,r){this.disposedCallback=r,this.callback=e,this.viewChanged=t}dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged&&this.viewChanged(e)}};var Hs;(s=>(s.Started="started",s.UpdateSettings="update_settings",s.SendPlot="send_plot",s.CopyPlot="copy_plot",s.ExportPlot="export_plot",s.RemovePlot="remove_plot"))(Hs||={});var NG=class{static{Hs.Started,Hs.UpdateSettings,Hs.SendPlot,Hs.CopyPlot,Hs.ExportPlot,Hs.RemovePlot}},y1=Symbol("IPlotViewerProvider"),b1=Symbol("IPlotViewer");var qI=class extends UI{constructor(t,r,i,o){let s=new Fe,a=zt(o.extensionUri,"dist","webviews","webview-side","viewers");super(r,t,(l,c,u)=>new v1(l,c,u),a,[zt(a,"plotViewer.js")],y.plotViewerTitle,yc.ViewColumn.One);this.fs=i;this.context=o;this.closedEvent=new yc.EventEmitter;this.removedEvent=new yc.EventEmitter;this.addPlot=async t=>{this.isDisposed||(await super.show(!1),this.postMessage(Hs.SendPlot,t).catch(h))};super.loadWebview(yc.Uri.file(process.cwd())).catch(p.error).finally(()=>{R("PLOTVIEWER.WEBVIEW_LOADED",{duration:s.elapsedTime})})}get closed(){return this.closedEvent.event}get removed(){return this.removedEvent.event}async show(){if(!this.isDisposed)return super.show(!0)}dispose(){super.dispose(),this.removedEvent.dispose(),this.closedEvent&&this.closedEvent.fire(this)}get owningResource(){}onMessage(t,r){switch(t){case Hs.CopyPlot:this.copyPlot(r.toString()).catch(h);break;case Hs.ExportPlot:this.exportPlot(r).catch(h);break;case Hs.RemovePlot:this.removePlot(r);break;default:break}super.onMessage(t,r)}removePlot(t){this.removedEvent.fire(t)}copyPlot(t){return Promise.resolve()}async exportPlot(t){p.info("exporting plot...");let r={};r[y.pngFilter]=["png"],r[y.svgFilter]=["svg"];let i=await yc.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:r});try{if(i)switch(Ui(i.path).toLowerCase()){case".png":let s=og(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){p.error(o),yc.window.showErrorMessage(y.exportImageFailed(o.toString())).then(h,h)}}};qI=v([(0,$f.injectable)(),m(0,(0,$f.inject)(kd)),m(1,(0,$f.inject)(ie)),m(2,(0,$f.inject)(tt)),m(3,(0,$f.inject)(Ze))],qI);var HI=class extends qI{constructor(t,r,i,o){super(t,r,i,o);this.fsNode=i}async exportPlot(t){p.info("exporting plot...");let r={};r[y.pdfFilter]=["pdf"],r[y.pngFilter]=["png"],r[y.svgFilter]=["svg"];let i=await $F.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:r});try{if(i)switch(Ui(i.fsPath).toLowerCase()){case".pdf":await qF(t.svg,this.fsNode,i);break;case".png":let s=og(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){p.error(o),$F.window.showErrorMessage(y.exportImageFailed(o)).then(h,h)}}};HI=v([(0,qf.injectable)(),m(0,(0,qf.inject)(kd)),m(1,(0,qf.inject)(ie)),m(2,(0,qf.inject)(dr)),m(3,(0,qf.inject)(Ze))],HI);async function qF(n,e,t){p.info("Attempting pdf write...");let r=(await import("svg-to-pdfkit")).default,i=re(),o=require("pdfkit/js/pdfkit.standalone"),s=new o,a=e.createLocalWriteStream(t.fsPath);p.info(`Writing pdf to ${t.fsPath}`),a.on("finish",()=>i.resolve),r(s,n,0,0,{preserveAspectRatio:"xMinYMin meet"}),s.pipe(a),s.end(),p.info(`Finishing pdf to ${t.fsPath}`),await i.promise,p.info(`Completed pdf to ${t.fsPath}`)}var mw=k(N());var GI=class{constructor(e,t){this.serviceContainer=e;this.imageList=[];this.closedViewer=()=>{this.currentViewer&&(this.currentViewer=void 0),this.currentViewerClosed&&(this.currentViewerClosed.dispose(),this.currentViewerClosed=void 0)};this.removedPlot=e=>{this.imageList.splice(e,1)};t.push(this)}dispose(){this.currentViewer&&this.currentViewer.dispose()}async showPlot(e){this.imageList.push(e);let t=this.currentViewer?[e]:this.imageList,r=await this.getOrCreate();await Promise.all(t.map(r.addPlot))}async getOrCreate(){return this.currentViewer||(this.currentViewer=this.serviceContainer.get(b1),this.currentViewerClosed=this.currentViewer.closed(this.closedViewer),this.currentViewer.removed(this.removedPlot),R("DATASCIENCE.OPEN_PLOT_VIEWER"),await this.currentViewer.show()),this.currentViewer}};GI=v([(0,mw.injectable)(),m(0,(0,mw.inject)(st)),m(1,(0,mw.inject)(M))],GI);var E1=k(N());var S1=k(N()),Up=require("vscode");var C1="image/svg+xml",I1={"image/png":"png","image/jpeg":"jpeg","image/gif":"gif",[C1]:"svg"},zI=class{constructor(e){this.fs=e}async savePlot(e,t,r){if(e.isClosed)return;let i=che(e,t,r);if(!i)return p.error(`No plot to save ${U(e.uri)}, id: ${t} for ${r}`);if(!(r.toLowerCase()in I1))return p.error(`Unsupported MimeType ${U(e.uri)}, id: ${t} for ${r}`);let o=await this.getSaveTarget(i,r);o&&(o.path.toLowerCase().endsWith("pdf")?await this.saveAsPdf(i,o):await this.saveAsImage(i,o))}getSaveTarget(e,t){let r=I1[t.toLowerCase()],i={};e.items.find(l=>l.mime.toLowerCase()===C1)&&(i[y.pdfFilter]=["pdf"],i[y.svgFilter]=["svg"]),r==="png"&&(i[y.pngFilter]=["png"]),Object.keys(i).length===0&&(i.Images=[r]);let o=(Up.workspace.workspaceFolders?.length||0)>0?Up.workspace.workspaceFolders[0].uri:void 0,s="output",a=o?Up.Uri.joinPath(o,s):Up.Uri.file(s);return Up.window.showSaveDialog({defaultUri:a,saveLabel:y.exportPlotTitle,filters:i})}async saveAsImage(e,t){let r=Ui(t.path).substring(1),i=Object.keys(I1).find(s=>I1[s]===r),o=e.items.find(s=>s.mime===i);if(!o)throw new Error(`Unsupported MimeType ${t.toString()}, available mime Types: ${e.items.map(s=>s.mime).join(", ")}`);await this.fs.writeFile(t,o.data)}async saveAsPdf(e,t){return p.error("Save as PDF is not yet supported on the web.")}};zI=v([(0,S1.injectable)(),m(0,(0,S1.inject)(tt))],zI);function che(n,e,t){for(let r of n.getCells())for(let i of r.outputs)if(i.id===e&&i.items.find(o=>o.mime===t))return i}var QI=class extends zI{constructor(t){super(t);this.fsNode=t}async saveAsPdf(t,r){let i=Buffer.from(t.items.find(o=>o.mime===C1).data).toString();await qF(i,this.fsNode,r)}};QI=v([(0,E1.injectable)(),m(0,(0,E1.inject)(dr))],QI);var w1=k(N());var uhe="image/svg+xml",dhe="image/png",Fu=class{constructor(e){this.plotViewProvider=e}async openPlot(e,t){if(e.isClosed)return;let r=MG(e,t,uhe),i;if(r)i=new TextDecoder().decode(r.data);else{let o=MG(e,t,dhe);if(!o)return p.error(`No SVG or PNG Plot to open ${U(e.uri)}, id: ${t}`);i=phe(o)}i&&await this.plotViewProvider.showPlot(i)}};Fu=v([(0,w1.injectable)(),m(0,(0,w1.inject)(y1))],Fu);function MG(n,e,t){for(let r of n.getCells())for(let i of r.outputs)if(i.id===e)return i.items.find(o=>o.mime===t)}function phe(n){let e=n.data,t=Sk(e),r=mhe(e);return`<?xml version="1.0" encoding="utf-8" standalone="no"?>
<svg height="${r.height}" width="${r.width}" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g>
        <image xmlns="http://www.w3.org/2000/svg" x="0" y="0" height="100%" width="100%" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,${t}"/>
    </g>
</svg>`}function mhe(n){if(!fhe(n))throw new Error("The buffer is not a valid png");let e=new DataView(new Uint8Array(n).buffer);return{width:e.getUint32(16,!1),height:e.getUint32(20,!1)}}function fhe(n){return n[0]===137&&n[1]===80&&n[2]===78&&n[3]===71&&n[4]===13&&n[5]===10&&n[6]===26&&n[7]===10&&n.length>8+21}var fw=k(N()),hw=require("vscode");var P1=Symbol("IPlotSaveHandler");var YI=class{constructor(e,t){this.plotSaveHandler=e;this.plotViewHandler=t;this.disposables=[]}dispose(){z(this.disposables)}activate(){this.activateImpl().catch(h)}async activateImpl(){let e=hw.extensions.getExtension(Vu);if(!e)return;e.isActive||await e.activate(),e.exports.onDidReceiveMessage(async({editor:r,message:i})=>{let o=r.notebook||hw.window.activeNotebookEditor?.notebook;if(o)try{i.type==="saveImageAs"?await this.plotSaveHandler.savePlot(o,i.outputId,i.mimeType):i.type==="openImageInPlotViewer"&&await this.plotViewHandler.openPlot(o,i.outputId)}catch(s){p.error(s),hw.window.showErrorMessage(y.exportImageFailed(s.message)).then(h,h)}},this,this.disposables)}};YI=v([(0,fw.injectable)(),m(0,(0,fw.inject)(P1)),m(1,(0,fw.inject)(Fu))],YI);var Hf=k(N()),bc=require("vscode");var XI=class{constructor(e,t,r,i){this.interactiveWindowProvider=e;this.kernelProvider=t;this.dataViewerFactory=r;this.disposables=i;this._onDidFinisheExecutingActiveNotebook=new bc.EventEmitter;this._onDidChangeActiveNotebook=new bc.EventEmitter;this._onDidRestartActiveNotebook=new bc.EventEmitter;this._executionCountTracker=new WeakMap;bc.window.onDidChangeActiveNotebookEditor(this.activeEditorChanged,this,this.disposables),bc.workspace.onDidCloseNotebookDocument(this.notebookEditorClosed,this,this.disposables),this.kernelProvider.onDidRestartKernel(o=>{this.handleRestart({state:1,notebook:o.notebook})},this,this.disposables),nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}get onDidChangeActiveNotebook(){return this._onDidChangeActiveNotebook.event}get onDidFinishExecutingActiveNotebook(){return this._onDidFinisheExecutingActiveNotebook.event}get onDidRestartActiveNotebook(){return this._onDidRestartActiveNotebook.event}get activeKernel(){let e=bc.window.activeNotebookEditor?.notebook,t=e?.notebookType==bt?this.kernelProvider.get(e):void 0;if(t)return t;let r=this.getActiveInteractiveWindowDocument(),i=r?this.kernelProvider.get(r):void 0;if(i)return i;let o=this.dataViewerFactory.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}get activeNotebookExecutionCount(){let e=this.activeKernel?.notebook;return e?this._executionCountTracker.get(e):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return bc.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}onDidChangeNotebookCellExecutionState(e){Pt(e.cell.notebook)&&e.state===1&&this.handleExecute({notebook:e.cell.notebook,state:0,cell:e.cell})}handleExecute(e){this.isNonSilentExecution(e)&&(e.cell?.executionSummary?.executionOrder!==void 0&&this._executionCountTracker.set(e.notebook,e.cell.executionSummary?.executionOrder),this.isActiveNotebookEvent(e)&&e.cell?.executionSummary?.executionOrder!==void 0&&this.activeKernel&&this.kernelProvider.getKernelExecution(this.activeKernel).pendingCells.length===0&&this._onDidFinisheExecutingActiveNotebook.fire({executionCount:e.cell.executionSummary?.executionOrder}))}handleRestart(e){this._executionCountTracker.delete(e.notebook),this.isActiveNotebookEvent(e)&&this._onDidRestartActiveNotebook.fire()}notebookEditorClosed(e){this._executionCountTracker.delete(e)}activeEditorChanged(e){let t={};if(e&&Pt(e.notebook)){let r=this._executionCountTracker.get(e.notebook);r&&(t.executionCount=r)}this._onDidChangeActiveNotebook.fire(t)}isNonSilentExecution(e){return!!(e.state===0&&e.cell&&e.cell.executionSummary?.executionOrder)}isActiveNotebookEvent(e){return this.activeKernel?.notebook===e.notebook}};XI=v([(0,Hf.injectable)(),m(0,(0,Hf.inject)(zn)),m(1,(0,Hf.inject)(we)),m(2,(0,Hf.inject)(FI)),m(3,(0,Hf.inject)(M))],XI);var KG=class{static{"force_variable_refresh","settings_updated","activate","show_data_explorer","get_variables_request","get_variables_response","variable_explorer_toggle","set_variable_explorer_height","variable_explorer_height_response","open_link","variables_complete","update_settings","loc_init","update_variable_view_execution_count","get_html_by_id_request","get_html_by_id_response","restart_kernel"}},k1=Symbol("INotebookWatcher"),x1=Symbol("IVariableViewProvider");var gw=k(N()),OG=require("vscode");var ZI=class{constructor(e,t){this.extensionContext=e;this.variableViewProvider=t}activate(){this.extensionContext.subscriptions.push(OG.window.registerWebviewViewProvider(this.variableViewProvider.viewType,this.variableViewProvider,{webviewOptions:{retainContextWhenHidden:!1}}))}};ZI=v([(0,gw.injectable)(),m(0,(0,gw.inject)(Ze)),m(1,(0,gw.inject)(x1))],ZI);var Gs=k(N());var T1=require("vscode");var D1=class{constructor(e,t){this.disposedCallback=t,this.callback=e}dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}};var _1=class extends Nu{constructor(t,r,i,o,s){super(t,o,s);this.configService=t;this.provider=i;this.messageListener=r(this.onMessage.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webviewView(){return this.webview&&this.webview}async provideWebview(t,r,i,o){if(!o)throw new Error("WebviewViews must be passed an initial VS Code Webview");return this.provider.create({additionalPaths:i?[i]:[],rootPath:this.rootPath,cwd:t,listener:this.messageListener,scripts:this.scripts,settings:r,webviewHost:o})}};var Gf=class extends _1{constructor(t,r,i,o,s,a,l){let c=zt(i.extensionUri,"dist","webviews","webview-side","viewers");super(t,(u,d)=>new D1(u,d),r,c,[zt(c,"variableView.js")]);this.variables=o;this.disposables=s;this.notebookWatcher=a;this.dataViewerDelegator=l;this.notebookWatcher.onDidFinishExecutingActiveNotebook(this.activeNotebookExecuted,this,this.disposables),this.notebookWatcher.onDidChangeActiveNotebook(this.activeNotebookChanged,this,this.disposables),this.notebookWatcher.onDidRestartActiveNotebook(this.activeNotebookRestarted,this,this.disposables),this.variables.refreshRequired(this.sendRefreshMessage,this,this.disposables),T1.window.onDidChangeActiveTextEditor(this.activeTextEditorChanged,this,this.disposables)}get owningResource(){}async load(t){await super.loadWebview(T1.Uri.file(process.cwd()),t).catch(p.error),this.webviewView&&this.disposables.push(this.webviewView.onDidChangeVisibility(()=>{this.handleVisibilityChanged()})),this.handleVisibilityChanged()}get title(){return"variableView"}onMessage(t,r){switch(t){case"get_variables_request":this.handleMessage(t,r,this.requestVariables);break;case"show_data_explorer":this.handleMessage(t,r,this.showDataViewer);break;default:break}super.onMessage(t,r)}handleMessage(t,r,i){let o=r;i.bind(this)(o)}handleVisibilityChanged(){let t=new ir("jupyter.variableViewVisible"),r=!1;this.webviewView&&(r=this.webviewView.visible),t.set(r).catch(h),r&&(R("DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE"),this.notebookWatcher.activeNotebookExecutionCount!==void 0?this.postMessage("update_variable_view_execution_count",{executionCount:this.notebookWatcher.activeNotebookExecutionCount}).catch(h):this.postMessage("force_variable_refresh").catch(h))}async showDataViewer(t){return t.variable.fileName=t.variable.fileName??this.notebookWatcher.activeKernel?.notebook.uri,this.dataViewerDelegator.showContributedDataViewer(t.variable,!0)}postProcessSupportsDataExplorer(t){let r=this.dataViewerDelegator.getVariableViewers();return t.pageResponse.forEach(i=>{i.supportsDataExplorer=r.some(o=>o.jupyterVariableViewers.dataTypes.includes(i.type))}),t}async requestVariables(t){let r=this.notebookWatcher.activeKernel;if(r){let i=await this.variables.getVariables(t,r);this.postMessage("get_variables_response",this.postProcessSupportsDataExplorer(i)).catch(h),R("DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",{variableCount:i.totalCount})}else{let i={executionCount:t.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};this.postMessage("get_variables_response",i).catch(h)}}async activeNotebookExecuted(t){this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(h)}async activeNotebookChanged(t){t.executionCount?this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(h):this.postMessage("update_variable_view_execution_count",{executionCount:0}).catch(h),this.postMessage("force_variable_refresh").catch(h)}activeTextEditorChanged(){this.postMessage("force_variable_refresh").catch(h)}async activeNotebookRestarted(){this.postMessage("restart_kernel").catch(h)}async sendRefreshMessage(){this.postMessage("force_variable_refresh").catch(h)}};v([cr("DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED")],Gf.prototype,"load",1),v([qr()],Gf.prototype,"showDataViewer",1),v([qr()],Gf.prototype,"requestVariables",1);var eS=class{constructor(e,t,r,i,o,s,a){this.configuration=e;this.webviewViewProvider=t;this.context=r;this.variables=i;this.disposables=o;this.notebookWatcher=s;this.dataViewerDelegator=a;this.viewType="jupyterViewVariables"}get activeVariableView(){if(!kr())throw new Error("activeVariableView only for test code");return this.variableView?Promise.resolve(this.variableView):(this.activeVariableViewPromise=re(),this.activeVariableViewPromise.promise)}async resolveWebviewView(e,t,r){e.webview.options={enableScripts:!0},this.variableView=new Gf(this.configuration,this.webviewViewProvider,this.context,this.variables,this.disposables,this.notebookWatcher,this.dataViewerDelegator),this.activeVariableViewPromise&&this.activeVariableViewPromise.resolve(this.variableView),await this.variableView.load(e)}};eS=v([(0,Gs.injectable)(),m(0,(0,Gs.inject)(ie)),m(1,(0,Gs.inject)(ex)),m(2,(0,Gs.inject)(Ze)),m(3,(0,Gs.inject)(yn)),m(3,(0,Gs.named)(Je.ALL_VARIABLES)),m(4,(0,Gs.inject)(M)),m(5,(0,Gs.inject)(k1)),m(6,(0,Gs.inject)(Va))],eS);function FG(n){n.addSingleton(me,YI),n.add(s1,Jf),n.addSingleton(FI,Lp),n.addSingleton(LI,VI),n.addSingleton(me,WI),n.addSingleton(Va,Va),n.add(b1,HI),n.addSingleton(y1,GI),n.addSingleton(P1,QI),n.addSingleton(Fu,Fu),n.addSingleton(k1,XI),n.addSingleton(me,ZI),n.addSingleton(me,BI),n.addSingleton(x1,eS),n.add(a1,Ku),n.addSingleton(l1,JI)}var Wp=require("os");var Ao=k(require("vscode"));var WG=k(require("vscode"));var zf=k(require("vscode")),HF;(t=>{function n(r){return r.start.line===r.end.line&&r.start.character===r.end.character}t.isEmpty=n;function e(r,i){let o=r.start.line,s=r.start.character,a=r.end.line,l=r.end.character,c=i.start.line,u=i.start.character,d=i.end.line,f=i.end.character;return o<c?(o=c,s=u):o===c&&(s=Math.max(s,u)),a>d?(a=d,l=f):a===d&&(l=Math.min(l,f)),!(o>a||o===a&&s>l)}t.intersects=e})(HF||={});function GF(n){n.sort((t,r)=>t-r);let e=n.shift();return e===void 0?[]:n.reduce(function(t,r){return r<=t[0][1]?t[0][1]=r+1:t.unshift([r,r+1]),t},[[e,e+1]]).reverse().map(t=>new zf.NotebookRange(t[0],t[1]))}function LG(n){return n.reduce((t,r)=>{for(let i=r.start;i<r.end;i++)t.push(i);return t},[])}function hhe(n){return zf.workspace.notebookDocuments.find(e=>e.uri.authority===n.uri.authority&&e.uri.path===n.uri.path)}function vw(n){let e=zf.workspace.textDocuments.find(o=>o.uri.toString()===n?.document.uri.toString())??zf.window.activeTextEditor?.document;if(!e)return;let t=hhe(e);if(!t)return;let i=t.getCells().find(o=>o.document.uri.toString()===e.uri.toString());if(i)return{notebook:t,cell:i}}function zF(n,e){return n.start.line===e.start.line&&n.start.character===e.start.character&&n.end.line===e.end.line&&n.end.character===e.end.character}function mi(){}var UG="ms-python.vscode-pylance";async function ghe(n){return await n.activate()}var QF;async function VG(){let n=WG.extensions.getExtension(UG);if(n)return QF||new Promise((e,t)=>{ghe(n).then(async r=>{if(!r){console.error("Could not start Pylance"),t();return}r.client&&await r.client.start(),QF=r.notebook,e(r.notebook)}).then(mi,mi)})}var Ar=k(require("vscode"));var vhe=Ar.window.createTextEditorDecorationType({after:{contentText:"write",margin:"0 0 0 1em",backgroundColor:"red"}}),yhe=Ar.window.createTextEditorDecorationType({after:{contentText:"read",margin:"0 0 0 1em",backgroundColor:"green"}}),R1=class{constructor(e,t,r){this._notebookDocument=e;this._cellExecution=t;this._cellRefs=r}_getVirtualCellList(e){return this._cellExecution.findIndex(r=>r.cell.document.uri.toString()===e.document.uri.toString())===-1?this._notebookDocument.getCells():this._cellExecution.map(r=>r.cell)}getPredecessorCells(e,t=!1){let r=t?this._notebookDocument.getCells():this._getVirtualCellList(e);var i;for(i=r.length-1;i>=0&&r[i].document.uri.toString()!==e.document.uri.toString();i--);if(i===-1)return[];let o=i,s=r.slice(0,o+1),a=new Array(s.length).fill(!1);a[o]=!0;let l=new Map;for(let[d,f]of this._cellRefs.entries()){let g=f.filter(b=>b.kind==="write").map(b=>b.uri.fragment);f.forEach(b=>{let I=b.uri.fragment;l.has(I)?l.get(I)?.push(d):l.set(I,[d])}),f.forEach(b=>{let I=b.uri.fragment;l.has(I)?l.get(I)?.push(...g):l.set(I,g)})}let c=e.document.uri.fragment;this._resolveDependencies(l,a,c,s,t);let u=[];for(let d=0;d<a.length;d++)a[d]&&u.push(s[d]);return u}getSuccessorCells(e){let t=this._getVirtualCellList(e),r=t.findIndex(a=>a.document.uri.fragment===e.document.uri.fragment);if(r===-1)return[];let i=new Array(t.length).fill(!1);i[r]=!0;let o=new Map;this._cellRefs.forEach(a=>{a.forEach(l=>{if(l.kind==="write"){let c=l.uri.fragment,u=o.get(c)??[];u.push(...a.filter(d=>d!==l)),o.set(c,u)}})});for(let a=r;a<t.length;a++)if(i[a]){let l=this._cellRefs.get(t[a].document.uri.fragment)||[],c=o.get(t[a].document.uri.fragment)||[];[...l,...c].forEach(d=>{let f=t.findIndex(g=>g.document.uri.fragment===d.uri.fragment);f!==-1&&f>=a&&(i[f]=!0)})}let s=[];for(let a=0;a<i.length;a++)i[a]&&s.push(t[a]);return s}_resolveDependencies(e,t,r,i,o=!1){if(e.has(r))for(let s of e.get(r)){let a=i.findIndex(l=>l.document.uri.fragment===s);if(a===-1){if(o)continue;throw new Error(`Dependency ${s} is not in the execution list.`)}t[a]||(t[a]=!0,this._resolveDependencies(e,t,s,i,o))}}};var A1=class{constructor(e,t){this._notebookEditor=e;this._client=t;this._pendingRequests=new Map;this._cellRefs=new Map;this._staleCellRefs=new Map;this._cellExecution=[];this._disposables=[];this._notebookEditor.notebook.getCells().forEach(r=>{this._requestCellSymbols(r,!1).then(mi,mi)}),this._disposables.push(Ar.workspace.onDidChangeNotebookDocument(r=>{r.notebook===this._notebookEditor.notebook&&(r.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{this._pendingRequests.delete(o.document.uri.fragment),this._cellRefs.delete(o.document.uri.fragment)}),i.addedCells.forEach(o=>{this._requestCellSymbols(o,!1).then(mi,mi)})}),r.cellChanges.forEach(i=>{i.document&&(this._requestCellSymbols(i.cell,!1).then(mi,mi),this._updateCellStatus(i.cell,0))}))})),this._disposables.push(nr.onDidChangeNotebookCellExecutionState(r=>{r.state===3&&r.cell.document.languageId==="python"&&this._updateCellStatus(r.cell,1),r.state===1&&r.cell.document.languageId==="python"&&(this._cellExecution.push({cell:r.cell,executionCount:r.cell.executionSummary?.executionOrder??0}),this._updateCellStatus(r.cell,2))}))}_updateCellStatus(e,t){this._staleCellRefs.set(e.document.uri.fragment,t)}async _requestCellSymbolsSync(){let e=[...this._pendingRequests.keys()];this._pendingRequests.forEach(t=>t.cancel()),this._pendingRequests.clear();for(let t of e){let r=this._notebookEditor.notebook.getCells().find(i=>i.document.uri.fragment===t);r&&await this._requestCellSymbols(r,!0)}}async getCellSymbolRefs(e){let t=this._cellRefs.get(e.document.uri.fragment);if(t)return t}async selectPrecedentCells(e){let t=await this.getPrecedentCells(e);this._notebookEditor.selections=t}async selectSuccessorCells(e){let t=await this.getSuccessorCells(e);this._notebookEditor.selections=t}async runPrecedentCells(e){let t=await this.getPrecedentCells(e);await Ar.commands.executeCommand("notebook.cell.execute",{ranges:t.map(r=>({start:r.start,end:r.end})),document:this._notebookEditor.notebook.uri}).then(mi,mi)}async runSuccessorCells(e){let t=await this.getSuccessorCells(e);await Ar.commands.executeCommand("notebook.cell.execute",{ranges:t.map(r=>({start:r.start,end:r.end})),document:this._notebookEditor.notebook.uri}).then(mi,mi)}async getPrecedentCells(e){await this._requestCellSymbolsSync();let t=new R1(this._notebookEditor.notebook,this._cellExecution,this._cellRefs),r=[];try{r=t.getPredecessorCells(e)}catch{try{r=t.getPredecessorCells(e,!0)}catch{throw new Error("No precedent cells found")}}let i=r.findIndex(s=>(this._staleCellRefs.get(s.document.uri.fragment)??0)===0);return GF((i===-1?r:r.slice(i)).map(s=>s.index))}async getSuccessorCells(e){await this._requestCellSymbolsSync();let r=new R1(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e);return GF(r.map(o=>o.index))}async debugSymbols(){let e=[];await this._requestCellSymbolsSync(),console.log(JSON.stringify(Array.from(this._cellRefs.entries())));for(let r of Ar.window.visibleTextEditors){let i=r.document;if(i.uri.scheme==="vscode-notebook-cell"&&i.uri.path===this._notebookEditor.notebook.uri.path){let o=this._cellRefs.get(i.uri.fragment);o&&e.push(...o)}}let t=new Map;e.forEach(r=>{let i=r.uri.fragment;t.has(i)||t.set(i,[]),t.get(i)?.push(r)}),t.forEach((r,i)=>{let o=Ar.window.visibleTextEditors.find(s=>s.document.uri.path===this._notebookEditor.notebook.uri.path&&s.document.uri.fragment===i);if(o){let s=[],a=[];r.reduce((c,u)=>c.find(f=>zF(f.range,u.range))?c:c.concat([u]),[]).forEach(c=>{let u=new Ar.Position(c.range.end.line,c.range.end.character),d=new Ar.Range(u,u);c.kind==="write"?s.push(d):c.kind==="read"&&a.push(d)}),o.setDecorations(vhe,s),o.setDecorations(yhe,a)}})}async _requestCellSymbols(e,t){let r=this._pendingRequests.get(e.document.uri.fragment);if(r&&r.cancel(),t){let o=new Ar.CancellationTokenSource;await this._doRequestCellSymbols(e,o.token),o.dispose();return}let i=new Ar.CancellationTokenSource;this._pendingRequests.set(e.document.uri.fragment,i),setTimeout(()=>{this._pendingRequests.get(e.document.uri.fragment)===i&&(this._pendingRequests.delete(e.document.uri.fragment),!i.token.isCancellationRequested&&this._doRequestCellSymbols(e,i.token).then(mi,mi))},500)}async _getDocumentSymbols(e){if(this._client.getDocumentSymbols){let t=new Ar.CancellationTokenSource,r=await this._client.getDocumentSymbols(e.document,t.token);if(r&&r.length>0)return t.dispose(),r}if(e.document.lineCount>1||e.document.lineAt(0).text.length>0)return Ar.commands.executeCommand("vscode.executeDocumentSymbolProvider",e.document.uri)}async _doRequestCellSymbols(e,t){let r=await this._getDocumentSymbols(e);if(!r)return;let i=[];for(let o of r){let s=await this._client.getReferences(e.document,o.selectionRange.start,{includeDeclaration:!0},t);s&&i.push(...s.filter(a=>a.uri.scheme==="vscode-notebook-cell").map(a=>({...a,associatedSymbol:o})))}i.length&&this._cellRefs.set(e.document.uri.fragment,i.map(o=>({range:o.range,uri:o.uri,kind:zF(o.range,o.associatedSymbol.selectionRange)?"write":o.kind,associatedSymbol:o.associatedSymbol})))}dispose(){this._pendingRequests.forEach(e=>e.cancel()),this._pendingRequests.clear(),this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},N1=class{constructor(e){this._client=e;this._disposables=[];this._notebookDocumentSymbolTrackers=new Map;Ar.window.visibleNotebookEditors.forEach(t=>{this._notebookDocumentSymbolTrackers.set(t.notebook.uri.toString(),new A1(t,this._client))}),this._disposables.push(Ar.window.onDidChangeVisibleNotebookEditors(t=>{t.forEach(r=>{this._notebookDocumentSymbolTrackers.has(r.notebook.uri.toString())||this._notebookDocumentSymbolTrackers.set(r.notebook.uri.toString(),new A1(r,this._client))}),this._notebookDocumentSymbolTrackers.forEach((r,i)=>{Ar.window.visibleNotebookEditors.find(o=>o.notebook.uri.toString()===i)||(r.dispose(),this._notebookDocumentSymbolTrackers.delete(i))})}))}getNotebookDocumentSymbolTracker(e){return this._notebookDocumentSymbolTrackers.get(e.toString())}async debugSymbols(e){let t=this._notebookDocumentSymbolTrackers.get(e.uri.toString());t&&await t.debugSymbols()}async runSuccessorCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.runSuccessorCells(t)}async runPrecedentCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.runPrecedentCells(t)}async selectSuccessorCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.selectSuccessorCells(t)}async selectPrecedentCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.selectPrecedentCells(t)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},M1=class{constructor(e){this.symbolsTracker=e}async provideCodeActions(e,t,r,i){let o=Ar.workspace.notebookDocuments.filter(b=>b.uri.path===e.uri.path),s,a;for(let b of o)if(s=b.getCells().find(I=>I.document.uri.toString()===e.uri.toString()),s){a=b;break}if(!s||!a)return[];let l=this.symbolsTracker.getNotebookDocumentSymbolTracker(a.uri);if(!l)return[];let c=r.diagnostics.find(b=>b.source==="Cell Execution Error"&&b.message.startsWith("NameError")&&b.message.endsWith("is not defined"));if(!c)return[];let u=c.message.match(/NameError: name '(.+)' is not defined/);if(!u)return[];let d=u[1],f=await l.getPrecedentCells(s),g=await Promise.all(LG(f).map(async b=>{let I=a?.cellAt(b);if(!I)return!1;let w=await l.getCellSymbolRefs(I);if(!w||w.length<=0)return!1;let D=w.filter(A=>A.associatedSymbol?.name===d).find(A=>A.uri.toString()===s?.document.uri.toString());if(!D)return!1;if(HF.intersects(D.range,t))return!0}));if(i.isCancellationRequested)return[];if(g.some(b=>b)){let b=new Ar.CodeAction("Run Precedent Cells",Ar.CodeActionKind.QuickFix);return b.command={command:"jupyter.runPrecedentCells",title:"Run Precedent Cells",arguments:[s]},[b]}return[]}};async function jG(n){if(!Ao.workspace.getConfiguration("jupyter").get("executionAnalysis.enabled"))return;let t=await VG();if(!t)return;let r=new N1(t);n.subscriptions.push(r),n.subscriptions.push(Ao.commands.registerCommand("jupyter.selectDependentCells",async i=>{let o=vw(i);if(!o)return;let{notebook:s,cell:a}=o;await r.selectSuccessorCells(s,a)})),n.subscriptions.push(Ao.commands.registerCommand("jupyter.runPrecedentCells",async i=>{let o=vw(i);if(!o)return;let{notebook:s,cell:a}=o;await r.runPrecedentCells(s,a)})),n.subscriptions.push(Ao.commands.registerCommand("jupyter.runDependentCells",async i=>{let o=vw(i);if(!o)return;let{notebook:s,cell:a}=o;await r.runSuccessorCells(s,a)})),n.subscriptions.push(Ao.commands.registerCommand("jupyter.selectPrecedentCells",async i=>{let o=vw(i);if(!o)return;let{notebook:s,cell:a}=o;await r.selectPrecedentCells(s,a)})),n.subscriptions.push(Ao.commands.registerCommand("jupyter.debugCellSymbols",async()=>{let i=Ao.window.activeNotebookEditor;i&&await r.debugSymbols(i.notebook)})),n.subscriptions.push(Ao.languages.registerCodeActionsProvider({language:"python",notebookType:"jupyter-notebook"},new M1(r),{providedCodeActionKinds:[Ao.CodeActionKind.QuickFix]}))}function JG(){}var as=k(require("vscode"));async function BG(n){n.subscriptions.push(as.commands.registerCommand("jupyter.listPipPackages",async e=>{let t=e??as.window.activeNotebookEditor?.notebook.uri;if(t){let i=await ve.instance.get(we).get(t);if(i){let o=new as.CancellationTokenSource().token;try{let s=await bhe(i,o);if(Array.isArray(s.content))return s.content}catch(s){p.warn("Failed to get pip packages",s)}}}return[]})),n.subscriptions.push(as.commands.registerCommand("jupyter.listVariables",async e=>{let t=e??as.window.activeNotebookEditor?.notebook.uri;if(!t)return[];let r=as.workspace.notebookDocuments.find(u=>u.uri.toString()===t.toString());if(!r)return[];let o=ve.instance.get(it).getSelected(r);if(!o)return[];let s=o.controller.variableProvider;if(!s)return[];let a=new as.CancellationTokenSource().token,l=s.provideVariablesWithSummarization(r,void 0,as.NotebookVariablesRequestKind.Named,0,a),c=[];for await(let u of l)c.push(u);return c}))}async function bhe(n,e){let t=`import subprocess
proc = subprocess.Popen(["pip", "list", "--format", "json"], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
stdout, stderr = proc.communicate()
return stdout
`.split(`
`);try{return{content:await Tu(n,t,e)}}catch(r){throw r}}var zG=k(RA());var $G=k(N());var Qf=class{constructor(e){this.container=e}getContainer(){return this.container}add(e,t,r,i){r?this.container.bind(e).to(t).whenTargetNamed(r):this.container.bind(e).to(t),i&&i.forEach(o=>{this.addBinding(e,o)})}addFactory(e,t){this.container.bind(e).toFactory(t)}addBinding(e,t){this.container.bind(t).toService(e)}addSingleton(e,t,r,i){r?this.container.bind(e).to(t).inSingletonScope().whenTargetNamed(r):this.container.bind(e).to(t).inSingletonScope(),i&&i.forEach(o=>{this.addBinding(e,o)})}addSingletonInstance(e,t,r){r?this.container.bind(e).toConstantValue(t).whenTargetNamed(r):this.container.bind(e).toConstantValue(t)}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}rebind(e,t,r){r?this.container.rebind(e).to(t).whenTargetNamed(r):this.container.rebind(e).to(t)}rebindSingleton(e,t,r){r?this.container.rebind(e).to(t).inSingletonScope().whenTargetNamed(r):this.container.rebind(e).to(t).inSingletonScope()}rebindInstance(e,t,r){r?this.container.rebind(e).toConstantValue(t).whenTargetNamed(r):this.container.rebind(e).toConstantValue(t)}dispose(){this.container.unbindAll(),this.container.unload()}};v([gh()],Qf.prototype,"getContainer",1),Qf=v([(0,$G.injectable)()],Qf);var fn=require("vscode");var HG=require("vscode");function GG(n){let e=HG.window.createOutputChannel(y.jupyterServerConsoleOutputChannel,"log");n.push(e);let t={get(r,i){let o=r[i];if(typeof o=="function"){if(i==="append")return(...s)=>{e.append(...s),qG(...s)};if(i==="appendLine")return(...s)=>{e.appendLine(...s),qG(...s)}}return o}};return new Proxy(e,t)}function qG(...n){n.length===1?p.debug(Ue(n[0]).map((e,t)=>t===0?e:`    ${e}`).join(`
`)):p.debug(...n)}async function QG(n,e){let t=o2(e);t.appendLine(`${fn.env.appName} (${fn.version}, ${fn.env.remoteName}, ${fn.env.appHost})`),t.appendLine(`Jupyter Extension Version: ${n.extension.packageJSON.version}.`);let r=fn.extensions.getExtension(Zn);r?t.appendLine(`Python Extension Version: ${r.packageJSON.version}.`):t.appendLine("Python Extension not installed.");let i=fn.extensions.getExtension(Gp);return i?t.appendLine(`Pylance Extension Version${z0()?"":" (Not Used) "}: ${i.packageJSON.version}.`):t.appendLine("Pylance Extension not installed."),e?.platform&&t.appendLine(`Platform: ${e.platform} (${e.arch}).`),t.appendLine(`Home = ${e?.homePath}`),t.appendLine(`Temp Storage folder ${U(await cE(n))}`),!fn.workspace.workspaceFolders||fn.workspace.workspaceFolders.length===0?t.appendLine("No workspace folder opened."):fn.workspace.workspaceFolders.length===1?t.appendLine(`Workspace folder ${U(fn.workspace.workspaceFolders[0].uri)}`):t.appendLine(`Multiple Workspace folders opened ${fn.workspace.workspaceFolders.map(o=>U(o.uri)).join(", ")}`),t}function YG(n,e){let t=new zG.Container({skipBaseClassChecks:!0}),r=new Qf(t),i=new ve(t);return r.addSingletonInstance(st,i),r.addSingletonInstance(z9,r),r.addSingletonInstance(M,n.subscriptions),r.addSingletonInstance(Le,n.globalState,ut),r.addSingletonInstance(Le,n.workspaceState,ri),r.addSingletonInstance(Ze,n),r.addSingletonInstance(Mo,e,Wu),r.addSingletonInstance(Mo,GG(n.subscriptions),ph),[r,i]}function XG(){let n=re(),e={location:fn.ProgressLocation.Window,title:le.loadingExtension};return fn.window.withProgress(e,()=>n.promise).then(h,h),{dispose:()=>n.resolve()}}function ZG(n,e,t){Ihe(le.handleExtensionActivationError),console.error("extension activation failed",n),p.error("extension activation failed",n),g9(n,e,t)}function Ihe(n){try{fn.window.showErrorMessage(n).then(h,h)}catch(e){p.error("failed to notify user",e)}}async function ez(n,e){let t=e.get(sd),r=new Fe;await t.activate();let i=r.elapsedTime;R("DS_INTERNAL.EXPERIMENT_LOAD",{duration:i}),fn.commands.executeCommand("setContext","jupyter.vscode.channel",ks()).then(h,h),e.get(qk).activate();let o=e.get(LP);o.initialize(),n.subscriptions.push(o)}var K1=k(Jo()),tz=require("vscode");async function rz(n){let e=await K1.readdir(n.globalStorageUri.fsPath).catch(()=>[]),t=FD(n);await Promise.all(e.filter(r=>r.startsWith(LD)&&r!==t).map(r=>{let i=tz.Uri.joinPath(n.globalStorageUri,r).fsPath;return p.info(`Deleting old temp dir ${i}`),K1.remove(i)})).catch(h)}var YF=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}},Yf=new YF,tS={totalActivateTime:0,codeLoadingTime:0,startActivateTime:0,endActivateTime:0,workspaceFolderCount:0};tS.codeLoadingTime=Yf.elapsedTime;var XF;async function She(n){tS.startActivateTime=Yf.elapsedTime;let e=await QG(n,{addConsoleLogger:!!process.env.VSC_JUPYTER_FORCE_LOGGING,userNameRegEx:whe(),homePathRegEx:Phe(),arch:(0,Wp.arch)(),platform:(0,Wp.platform)(),homePath:Ax.fsPath});Z2(Yf),bW(n.subscriptions),MU(ja.env.uiKind==ja.UIKind.Web),OU(!1),n.subscriptions.push({dispose:()=>kS.isExiting=!0});try{let[t,r]=Ehe(n,e);return await r,tS.endActivateTime=Yf.elapsedTime,h9(tS,Yf),rz(n).catch(h),t}catch(t){return tS.endActivateTime=Yf.elapsedTime,ZG(t,tS,Yf),p.error("Failed to active the Jupyter Extension",t),{ready:Promise.resolve(),registerPythonApi:h,registerRemoteServerProvider:()=>({dispose:h}),getKernelService:()=>Promise.resolve(void 0),addRemoteJupyterServer:()=>Promise.resolve(void 0),openNotebook:()=>Promise.reject(),createJupyterServerCollection:()=>{throw new Error("Not Implemented")},kernels:{getKernel:()=>Promise.resolve(void 0),onDidStart:()=>({dispose:h})},onDidChangePythonEnvironment:void 0,getPythonEnvironment:()=>{}}}}function Che(){if(kS.isExiting=!0,XF){let n=XF.get(aa);if(n)return n.dispose()}return JG(),Promise.resolve()}function Ehe(n,e){let t=XG();try{let[r,i]=YG(n,e);XF=i,z2(a=>i.get(vd).getPackageVersions(a));let o=khe(n,r,i);return jG(n).then(h,h),BG(n).then(h,h),[p9(o,r,i,n),o,i]}finally{t.dispose()}}function nz(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function whe(){try{let n=nz((0,Wp.userInfo)().username);return new RegExp(n,"ig")}catch(n){console.info(`jupyter extension failed to get username info with ${n}
 username will not be obfuscated in local logs`)}}function Phe(){try{let n=nz(Kd().fsPath);return new RegExp(n,"ig")}catch(n){console.info(`jupyter extension failed to get home directory path with ${n}
 home Path will not be obfuscated in local logs`)}}async function khe(n,e,t){let r=!kr()&&(n.extensionMode===ja.ExtensionMode.Development||ja.workspace.getConfiguration("jupyter").get("development",!1));e.addSingletonInstance(u2,r),r&&ja.commands.executeCommand("setContext","jupyter.development",!0).then(h,h),ja.commands.executeCommand("setContext","jupyter.webExtension",!1).then(h,h),s2((0,Wp.homedir)()),H$(e),Lq(e,r),jH(e,r),J4(e),kG(n,e,r),FG(e),await ez(n,t)}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

tmp/lib/tmp.js:
  (*!
   * Tmp
   *
   * Copyright (c) 2011-2015 KARASZI Istvan <github@spam.raszi.hu>
   *
   * MIT Licensed
   *)

strip-comments/index.js:
  (*!
   * strip-comments <https://github.com/jonschlinkert/strip-comments>
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
